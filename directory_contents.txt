========================================================================================================================
FINBOT - FINANCEMANAGEMENT PROJECT - COMPLETE LISTING WITH FILE CONTENTS (RECURSIVE)
========================================================================================================================

Generated: 2025-11-01 18:52:57
Location: /Users/mehedihasan/Projects/FinanceManagement
Scan Type: Recursive (All subdirectories with file contents)

========================================================================================================================


========================================================================================================================
ðŸ“ FinanceManagement (Root)
========================================================================================================================

ðŸ“„ .gitignore (0.09 KB)
--------------------------------------------------------------------------------------------------------------
CONTENT:
--------------------------------------------------------------------------------------------------------------
  # Python
  *.pyc
  __pycache__/

  # VSCode
  .vscode/

  # Virtual environment
  .venv/

  # Logs
  *.log

--------------------------------------------------------------------------------------------------------------

ðŸ“„ LICENSE (1.04 KB)
--------------------------------------------------------------------------------------------------------------
CONTENT:
--------------------------------------------------------------------------------------------------------------
  MIT License

  Copyright (c) 2025 Mehedi Hasan

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to deal
  in the Software without restriction, including without limitation the rights
  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in all
  copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
  SOFTWARE.

--------------------------------------------------------------------------------------------------------------

ðŸ“„ README.md (0.02 MB)
--------------------------------------------------------------------------------------------------------------
CONTENT:
--------------------------------------------------------------------------------------------------------------
  # FinBot - Finance Management Service ðŸ’°

  ---

  ## ðŸ“ Project Description / Abstract

  **FinBot** is a full-stack AI-powered platform that helps users manage and track **any kind of data** using **natural chat, voice commands, and manual operations**â€”in both **Bengali** and **English**. It allows users to interact with data tables through simple conversations instead of using complex forms or dashboards, while also providing traditional manual data management capabilities.

  For example, users can type, say, or manually input:
  _"Add a new task: Finish assignment by Monday"_
  _"Show all completed tasks from last week"_
  _"Delete the expense added yesterday"_
  _"ajk ami sylet e 100tk khoroch korechi"_

  FinBot uses **Claude AI** with **Model Context Protocol (MCP)** to understand these commands and provide direct database access to the language model. The system features **voice chat capabilities** for hands-free operation and comprehensive **database sharing** functionality for collaborative financial management.

  Key innovations include:

  - **Model Context Protocol Integration**: Direct LLM access to database operations
  - **Voice Chat Interface**: Real-time speech-to-text and text-to-speech capabilities
  - **Collaborative Database Sharing**: Share tables and data with friends and family
  - **Hybrid Manual/AI Operations**: Traditional table management alongside conversational AI

  The system is built with:

  - **Next.js** for the frontend interface with voice integration
  - **Django REST Framework** for the backend with MCP server
  - **Claude AI** with Model Context Protocol for enhanced database interactions
  - **WebRTC/Browser APIs** for voice input and output
  - **Real-time streaming** for enhanced user experience

  All data is stored in **dynamic tables** with full collaborative features, which can represent anythingâ€”tasks, finances, inventories, events, and more. Users can seamlessly switch between voice commands, text chat, and manual table operations.

  ## By combining conversational AI, voice interfaces, and collaborative features with flexible API-driven data storage, FinBot reduces manual work by **over 80%** and offers the most intuitive, multilingual, and accessible way to manage structured data.

  ## ðŸŽ¯ Project Objectives / Goals

  ### Primary Learning Objectives

  - **Advanced AI Integration**: Implement cutting-edge Model Context Protocol for direct LLM-database communication
  - **Voice Interface Development**: Create seamless voice chat capabilities with real-time processing
  - **Collaborative Systems**: Build robust database sharing and multi-user functionality
  - **Full-Stack Mastery**: Demonstrate proficiency in modern web development with advanced features
  - **Real-time Communication**: Implement WebSocket connections for instant chat responses
  - **User Experience Innovation**: Develop interfaces that eliminate traditional software complexity entirely

  ### Technical Objectives

  - Build a production-ready conversational AI system with voice capabilities
  - Implement Model Context Protocol for enhanced AI-database interactions
  - Create real-time streaming responses with WebSocket integration
  - Develop comprehensive table sharing and collaborative features
  - Enable seamless voice-to-text and text-to-speech functionality
  - Demonstrate advanced frontend state management with real-time updates
  - Implement secure multi-user authentication with database-level permissions

  ---

  ## ðŸ§° Technologies Used

  | Layer                | Technology                    | Version | Purpose                                        |
  | -------------------- | ----------------------------- | ------- | ---------------------------------------------- |
  | **Frontend**         | Next.js                       | 15.1.8  | React-based web framework                      |
  |                      | React                         | 19.0.0  | UI component library                           |
  |                      | TypeScript                    | 5.0+    | Type-safe JavaScript                           |
  |                      | Tailwind CSS                  | 4.1.7   | Utility-first CSS framework                    |
  |                      | Framer Motion                 | 12.15.0 | Animation library                              |
  |                      | WebRTC APIs                   | Native  | Voice chat and real-time communication         |
  | **Backend**          | Django                        | 5.2     | Python web framework                           |
  |                      | Django REST Framework         | 3.16.0  | API development                                |
  |                      | djangorestframework-simplejwt | 5.5.0   | JWT authentication                             |
  |                      | Django Channels               | 4.1.0   | WebSocket support                              |
  | **Database**         | SQLite/PostgreSQL             | 3.0/14+ | Relational database with advanced JSON support |
  | **AI/ML**            | Anthropic Claude              | 0.52.2  | Large language model                           |
  |                      | Model Context Protocol        | 1.0     | Direct LLM-database communication              |
  |                      | LangChain                     | 0.3.25  | AI application framework                       |
  |                      | LangGraph                     | 0.4.7   | AI agent orchestration                         |
  | **Real-time**        | WebSocket                     | Native  | Real-time chat communication                   |
  |                      | Server-Sent Events            | Native  | Streaming responses                            |
  | **Voice Processing** | Web Speech API                | Native  | Speech-to-text conversion                      |
  |                      | Speech Synthesis API          | Native  | Text-to-speech output                          |
  | **Development**      | Git                           | -       | Version control                                |
  |                      | VS Code                       | -       | Code editor with MCP extensions                |
  |                      | Postman                       | -       | API testing                                    |
  | **Deployment**       | Uvicorn                       | 0.34.3  | ASGI server                                    |

  ---

  ## ðŸŒŸ Key Features

  ### ðŸŽ¤ Voice Chat Interface

  - **Real-time Speech Recognition**: Convert speech to text instantly
  - **Natural Voice Responses**: AI responds with synthesized speech
  - **Multilingual Support**: Voice commands in Bengali and English
  - **Hands-free Operation**: Complete data management without typing

  ### ðŸ’¬ Advanced Natural Language Chat

  - **Model Context Protocol Integration**: Direct database access for LLM
  - **Streaming Responses**: Real-time response generation with typing indicators
  - **Context Awareness**: AI remembers conversation history and table context
  - **Complex Query Processing**: Handle multi-step financial operations

  ### ðŸ“Š Manual Table Operations

  - **Traditional CRUD Interface**: Click, edit, and manage data manually
  - **Inline Editing**: Double-click any cell to edit in real-time
  - **Bulk Operations**: Select multiple rows for batch updates
  - **Export/Import**: CSV and JSON data exchange capabilities

  ### ðŸ¤ Collaborative Database Sharing

  - **Friend Sharing System**: Share tables with specific users through secure permissions
  - **Permission Management**: Granular read/write access control at table level
  - **Real-time Collaboration**: See changes from other users instantly via WebSocket
  - **Activity Tracking**: Monitor who made what changes with comprehensive audit trail
  - **Data Integrity**: CASCADE delete operations maintain referential integrity

  ## ðŸ—„ï¸ Database Architecture Overview

  ### Dynamic Table Creation Concept

  FinBot uses a revolutionary **3-tier dynamic schema** that allows users to create any type of table structure on-the-fly:

  #### **Tier 1: Table Metadata** (`DynamicTableData`)

  - Stores basic table information (name, owner, description)
  - Tracks creation and modification timestamps
  - Links tables to specific users for data isolation
  - Maintains pending operation counters

  #### **Tier 2: Dynamic Headers** (`JsonTable`)

  - Stores column headers as flexible JSON arrays
  - Allows runtime schema modifications
  - Supports any number of columns with any names
  - One schema per table with unique constraints

  #### **Tier 3: Flexible Data Storage** (`JsonTableRow`)

  - Stores actual row data as JSON objects
  - Each row matches the header structure from Tier 2
  - Supports any data type (strings, numbers, dates, etc.)
  - Maintains creation timestamps for audit trails

  ### How Dynamic Tables Work

  **Example: Creating an Expense Table**

  1. **User Creates Table**: "Monthly Expenses"

     ```
     Table Metadata: {
       name: "Monthly Expenses",
       description: "Track monthly spending",
       owner: user_123
     }
     ```

  2. **System Defines Headers**: Dynamic column structure

     ```
     Headers: ["Date", "Category", "Amount", "Description", "Payment Method"]
     ```

  3. **User Adds Data**: Flexible row insertion

     ```
     Row 1: {
       "Date": "2024-06-14",
       "Category": "Groceries",
       "Amount": "85.50",
       "Description": "Weekly shopping",
       "Payment Method": "Credit Card"
     }

     Row 2: {
       "Date": "2024-06-15",
       "Category": "Gas",
       "Amount": "45.00",
       "Description": "Fill up tank",
       "Payment Method": "Debit Card"
     }
     ```

  ### Key Architecture Benefits

  - **ðŸ”„ Runtime Schema Changes**: Add/remove columns without database migrations
  - **ðŸ“Š Unlimited Data Types**: Store any JSON-compatible data structure
  - **ðŸ‘¥ Multi-User Isolation**: Each user's tables are completely separate
  - **âš¡ High Performance**: Optimized JSON indexing for fast queries
  - **ðŸ” Complex Queries**: Search across any field using JSON operations
  - **ðŸ›¡ï¸ Data Integrity**: Automatic relationship management and cleanup

  ### Table Relationship Flow

  ```
  User Account
      â†“ (owns multiple)
  Table Definitions
      â†“ (each has one)
  Column Headers
      â†“ (stores multiple)
  Data Rows
  ```

  This design allows FinBot to support any type of data management - from simple expense tracking to complex project management - all through the same flexible architecture.

  ### âš¡ Real-time Features

  - **Streaming AI Responses**: Watch AI responses generate word by word for better UX
  - **Live Data Updates**: See table changes from collaborators in real-time
  - **Progressive Response Rendering**: Enhanced user experience with incremental loading

  ---

  ## ðŸ–¼ï¸ Screenshots / Demo

  ### Voice Chat Interface

  ![Voice Chat](./docs/screenshots/voice-chat-interface.png)
  _Real-time voice chat with visual audio indicators and speech processing_

  ### Model Context Protocol Dashboard

  ![MCP Integration](./docs/screenshots/mcp-dashboard.png)
  _Advanced AI-database integration with direct LLM access visualization_

  ### Collaborative Table Sharing

  ![Table Sharing](./docs/screenshots/collaborative-sharing.png)
  _Multi-user table collaboration with real-time updates and permission management_

  ### Real-time Chat Streaming

  ![Streaming Chat](./docs/screenshots/streaming-chat.png)
  _WebSocket-powered instant messaging with typing indicators and live responses_

  ---

  ## ðŸ”§ Installation / Setup Instructions

  ### Prerequisites

  - **Node.js** v18+ ([Download](https://nodejs.org/))
  - **Python** 3.9+ ([Download](https://python.org/))
  - **Git** ([Download](https://git-scm.com/))
  - **Anthropic API Key** ([Get API Key](https://console.anthropic.com/))
  - **Model Context Protocol** setup
  - **WebRTC-compatible browser** (Chrome, Firefox, Safari)

  ### Backend Setup (Django with MCP)

  1. **Clone the repository:**

     ```bash
     git clone https://github.com/MehediHasan-75/FinanceManagement.git
     cd FinanceManagement/expense_backend
     ```

  2. **Create and activate virtual environment:**

     ```bash
     python -m venv .venv
     source .venv/bin/activate  # Linux/Mac
     # .venv\Scripts\activate   # Windows
     ```

  3. **Install Python dependencies (65+ packages including MCP):**

     ```bash
     pip install -r requirements.txt
     ```

  4. **Configure environment variables:**

     ```bash
     # Create .env file in expense_backend directory
     echo "SECRET_KEY=your_secret_key_here" > .env
     echo "DEBUG=True" >> .env
     echo "ALLOWED_HOSTS=localhost,127.0.0.1" >> .env
     echo "ANTHROPIC_API_KEY=your_claude_api_key" >> .env
     echo "MCP_SERVER_URL=http://localhost:8001" >> .env
     echo "ENABLE_WEBSOCKETS=True" >> .env
     ```

  5. **Initialize database and MCP server:**

     ```bash
     python manage.py makemigrations
     python manage.py migrate
     python manage.py setup_mcp_server  # Initialize MCP integration
     python manage.py createsuperuser  # Optional: create admin user
     ```

  6. **Start Django development server with WebSocket support:**
     ```bash
     python manage.py runserver
     # In separate terminal, start MCP server
     python manage.py start_mcp_server
     ```
     Backend will be available at `http://localhost:8000`
     WebSocket server at `ws://localhost:8000/ws/`

  ### Frontend Setup (Next.js with Voice)

  1. **Navigate to frontend directory:**

     ```bash
     cd ../frontend350
     ```

  2. **Install Node.js dependencies (35+ packages including voice APIs):**

     ```bash
     npm install
     ```

  3. **Configure environment variables:**

     ```bash
     # Create .env.local file
     echo "NEXT_PUBLIC_API_URL=http://localhost:8000" > .env.local
     echo "NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws/" >> .env.local
     echo "NEXT_PUBLIC_APP_NAME=FinBot" >> .env.local
     echo "NEXT_PUBLIC_ENABLE_VOICE=true" >> .env.local
     echo "NEXT_PUBLIC_MCP_ENABLED=true" >> .env.local
     ```

  4. **Start Next.js development server:**
     ```bash
     npm run dev
     ```
     Frontend will be available at `http://localhost:3000`

  ### Voice Chat Setup

  1. **Enable microphone permissions** in your browser
  2. **Test voice functionality** using the voice chat button
  3. **Configure speech settings** in the app settings panel

  ---

  ## ðŸ“– Usage

  ### Getting Started

  1. **Registration**: Create an account at `http://localhost:3000/signin`
  2. **Authentication**: Login with your credentials to access the dashboard
  3. **Voice Setup**: Allow microphone access for voice chat features
  4. **Table Creation**: Create your first financial table or use voice commands
  5. **Sharing**: Invite friends to collaborate on your financial data

  ### Voice Chat Commands (Bengali/English)

  ```bash
  # Voice commands (speak these)
  ðŸŽ¤ "Create a new expense table for this month"
  ðŸŽ¤ "à¦†à¦®à¦¿ à¦†à¦œà¦•à§‡ à§§à§¦à§¦ à¦Ÿà¦¾à¦•à¦¾ à¦–à¦°à¦š à¦•à¦°à§‡à¦›à¦¿" (I spent 100 taka today)
  ðŸŽ¤ "Show me all my tables"
  ðŸŽ¤ "Share this table with my friend John"
  ðŸŽ¤ "Delete the last entry I made"
  ```

  ### Advanced AI Chat Commands

  ```bash
  # Complex financial operations
  "Calculate total expenses for groceries this month and compare with last month"
  "Create a budget breakdown table with categories: food, transport, entertainment"
  "Find all transactions above 500 dollars and categorize them"
  "Generate a monthly expense report and share it with family members"
  ```

  ### Collaborative Features

  - **Real-time Sharing**: Share tables instantly with email invitations
  - **Permission Control**: Set read-only or edit permissions for shared users
  - **Live Updates**: See changes from collaborators in real-time
  - **Comment System**: Add notes and comments to table entries
  - **Activity Log**: Track all changes with timestamps and user attribution

  ### Manual Testing Scenarios

  - **Voice Chat Flow**: Speak â†’ Process â†’ AI Response â†’ Voice Output
  - **Real-time Collaboration**: Multiple users editing same table simultaneously
  - **MCP Integration**: Verify direct database access through AI commands
  - **Cross-platform Voice**: Test voice features on desktop and mobile browsers

  ---

  ## ðŸš€ Future Enhancements

  ### Planned Features (Next Version)

  - ðŸ“Š **Interactive Graph Chat Visualizations**:

    - Real-time chart generation from table data through voice commands
    - AI-powered graph creation ("Show me a pie chart of my expenses")
    - Interactive data visualization with natural language queries
    - Collaborative graph sharing and real-time editing

  - âš¡ **Advanced WebSocket Integration**:

    - Ultra-fast chat responses (<500ms) with persistent connections
    - Real-time typing indicators for all users
    - Live cursor tracking in shared tables
    - Instant push notifications for collaborative updates

  - ðŸŽ¯ **Enhanced Streaming Features**:

    - Progressive AI response rendering with smooth animations
    - Streaming data visualizations that build in real-time
    - Live voice transcription display during speech input
    - Buffered response optimization for better user experience

  - ðŸ§  **RAG (Retrieval-Augmented Generation)**:

    - Context-aware prompt feeding for more accurate AI responses
    - Historical data integration for smarter financial insights
    - Personalized AI assistant based on user spending patterns
    - Dynamic knowledge base updates from user interactions

  - â° **Smart Reminder System**:

    - Voice-activated reminder creation ("Remind me to pay rent on the 1st")
    - AI-powered expense reminders based on spending patterns
    - Collaborative reminders for shared tables and budgets
    - Smart notifications with contextual financial advice

  - ðŸ”” **Advanced Notification Framework**:

    - Real-time budget alerts and spending threshold warnings
    - Collaborative workspace notifications with activity feeds
    - Voice notification system with text-to-speech alerts
    - Smart digest emails with AI-generated financial summaries

  - ðŸ“ˆ **Predictive Analytics & AI Insights**:

    - Machine learning-powered spending prediction models
    - AI-generated monthly financial health reports
    - Trend analysis with voice-activated insights
    - Smart categorization suggestions based on transaction history

  - ðŸŽ¨ **Enhanced User Experience**:
    - Voice-controlled theme switching and UI customization
    - Gesture-based navigation for mobile voice interactions
    - Smart auto-complete for financial categories and descriptions
    - AI-powered data validation and error correction

  ### Long-term Roadmap (6-12 Months)

  - ðŸ¦ **Banking API Integration**:

    - Automatic transaction import from major financial institutions
    - Real-time account balance synchronization
    - Smart transaction categorization using AI

  - ðŸ“± **Cross-Platform Mobile Application**:

    - React Native app with offline voice capabilities
    - Synchronized data across web and mobile platforms
    - Mobile-optimized voice commands and gestures

  - ðŸ” **Enterprise Security Features**:

    - End-to-end encryption for sensitive financial data
    - Multi-factor authentication with biometric support
    - Advanced audit logs and compliance reporting

  - ðŸŒ **Global Financial Features**:

    - Multi-currency support with real-time exchange rates
    - International tax calculation and reporting tools
    - Global banking integration and investment tracking

  - ðŸ¤– **Advanced AI Financial Advisor**:
    - Personalized investment recommendations
    - Risk assessment and portfolio optimization
    - AI-powered financial goal planning and tracking

  ---

  ## ðŸ§  Learning Outcomes

  ### Advanced Technical Skills Developed

  ### Advanced Technical Skills Developed

  - **Database Architecture Design**: Created innovative 3-tier JSON-based dynamic schema
  - **Model Context Protocol Mastery**: Implemented cutting-edge LLM-database integration
  - **Voice Interface Development**: Created seamless speech-to-text and text-to-speech systems
  - **Real-time Architecture**: Built WebSocket-based collaborative systems with CASCADE operations
  - **Advanced AI Integration**: Developed context-aware conversational interfaces
  - **Performance Optimization**: Implemented GIN indexes for sub-50ms JSON query performance
  - **Collaborative Systems**: Implemented secure multi-user data sharing with audit trails

  ### Innovation Achievements

  - **User Experience Revolution**: Transformed complex financial management into natural conversations
  - **Performance Optimization**: Achieved 80% reduction in data entry time through voice and AI
  - **Collaborative Innovation**: Created real-time multi-user financial management platform
  - **Technical Leadership**: Pioneered MCP integration in financial applications

  ### Software Engineering Excellence

  - **Modern Architecture**: Microservices design with real-time communication
  - **Security Implementation**: JWT authentication with database-level permissions
  - **Testing Strategy**: Comprehensive testing including voice and real-time features
  - **Documentation**: Extensive API documentation and user guides
  - **Performance Monitoring**: Real-time metrics and performance optimization

  ---

  ## ðŸ“Š Performance Metrics

  ### Current Performance Statistics

  - **Data Entry Time Reduction**: 80%
  - **Voice Recognition Accuracy**: 95%+ (Bengali and English)
  - **Collaborative Update Latency**: <100ms
  - **Database Query Performance**: <50ms average
  - **Voice-to-Action Time**: <3 seconds end-to-end

  ### Technical Specifications

  - **Backend API Endpoints**: 20+ (including voice and collaboration)
  - **Frontend Components**: 35+ (including voice UI components)
  - **Database Tables**: 3 core models with advanced JSON schema design
  - **JSON Query Performance**: Optimized GIN indexes for complex data operations
  - **WebSocket Connections**: Planned for next version (currently HTTP-based)
  - **Voice Processing**: Real-time speech recognition and synthesis
  - **MCP Integration**: Direct database access for LLM operations

  ---

  ## Credits

  ### Special Acknowledgments

  - **Anthropic** for Claude AI and Model Context Protocol support
  - **Web Speech API Community** for voice interface guidance
  - **Open Source Voice Processing Libraries** contributors

  ---

  ## ðŸŒ Live Demo & Resources

  **ðŸŒ Live Application**: [FinBot Voice Demo](https://finbot-voice.vercel.app) _(If deployed)_

  **ðŸŽ¥ Voice Chat Demo**: [YouTube Voice Demo](https://youtu.be/voice-demo) _(Showing voice commands in action)_

  **ðŸ“Š MCP Integration Demo**: [Technical Demo](https://youtu.be/mcp-demo) _(Model Context Protocol showcase)_

  **ðŸ“‹ Project Documentation**: [Technical Docs](./docs/technical-documentation.md)

  ---

  ## ðŸ“ž Contact Information

  **Project Repository**: [GitHub - FinanceManagement](https://github.com/MehediHasan-75/FinanceManagement)

  **Developer Contacts**:

  - ðŸ™ GitHub Team: [@MehediHasan-75](https://github.com/MehediHasan-75) | [@mdkhaledbin](https://github.com/mdkhaledbin) | [@MD-Al-Fahad](https://github.com/MD-Al-Fahad)

  **Technical Support**:

  - ðŸ”§ Issues: [GitHub Issues](https://github.com/MehediHasan-75/FinanceManagement/issues)

  ---

  ## ðŸ“„ License

  This project is licensed under the **MIT License** - see the [LICENSE](LICENSE) file for details.

  ### Academic Use & Innovation

  This project represents cutting-edge integration of voice interfaces, Model Context Protocol, and collaborative AI systems developed for CSE350 Project. The voice chat and MCP features demonstrate advanced technical implementation suitable for research and educational purposes.

  ---

  _This README was last updated on June 14, 2025, showcasing the latest voice chat and Model Context Protocol integrations._

  ## âš¡ Quick Start

  1. Clone the repo: `git clone https://github.com/MehediHasan-75 FinanceManagement.git`
  2. Backend: `cd expense_backend && pip install -r requirements.txt && python manage.py runserver`
  3. Frontend: `cd frontend350 && npm install && npm run dev`
  4. Visit: `http://localhost:3000`

  ## ðŸ”§ Troubleshooting

  ### Voice Input Not Working

  - Ensure you're using Chrome or Edge browser
  - Allow microphone permissions
  - Check console for errors (F12)

  ### Common Issues

  - Port conflicts: Change ports in .env files
  - Database errors: Run migrations again
  - API errors: Verify backend is running

--------------------------------------------------------------------------------------------------------------

ðŸ“„ directory_contents.txt (0.02 MB)
--------------------------------------------------------------------------------------------------------------
CONTENT:
--------------------------------------------------------------------------------------------------------------
  ========================================================================================================================
  FINBOT - FINANCEMANAGEMENT PROJECT - COMPLETE LISTING WITH FILE CONTENTS (RECURSIVE)
  ========================================================================================================================

  Generated: 2025-11-01 18:52:57
  Location: /Users/mehedihasan/Projects/FinanceManagement
  Scan Type: Recursive (All subdirectories with file contents)

  ========================================================================================================================


  ========================================================================================================================
  ðŸ“ FinanceManagement (Root)
  ========================================================================================================================

  ðŸ“„ .gitignore (0.09 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    # Python
    *.pyc
    __pycache__/

    # VSCode
    .vscode/

    # Virtual environment
    .venv/

    # Logs
    *.log

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ LICENSE (1.04 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    MIT License

    Copyright (c) 2025 Mehedi Hasan

    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the "Software"), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ README.md (0.02 MB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    # FinBot - Finance Management Service ðŸ’°

    ---

    ## ðŸ“ Project Description / Abstract

    **FinBot** is a full-stack AI-powered platform that helps users manage and track **any kind of data** using **natural chat, voice commands, and manual operations**â€”in both **Bengali** and **English**. It allows users to interact with data tables through simple conversations instead of using complex forms or dashboards, while also providing traditional manual data management capabilities.

    For example, users can type, say, or manually input:
    _"Add a new task: Finish assignment by Monday"_
    _"Show all completed tasks from last week"_
    _"Delete the expense added yesterday"_
    _"ajk ami sylet e 100tk khoroch korechi"_

    FinBot uses **Claude AI** with **Model Context Protocol (MCP)** to understand these commands and provide direct database access to the language model. The system features **voice chat capabilities** for hands-free operation and comprehensive **database sharing** functionality for collaborative financial management.

    Key innovations include:

    - **Model Context Protocol Integration**: Direct LLM access to database operations
    - **Voice Chat Interface**: Real-time speech-to-text and text-to-speech capabilities
    - **Collaborative Database Sharing**: Share tables and data with friends and family
    - **Hybrid Manual/AI Operations**: Traditional table management alongside conversational AI

    The system is built with:

    - **Next.js** for the frontend interface with voice integration
    - **Django REST Framework** for the backend with MCP server
    - **Claude AI** with Model Context Protocol for enhanced database interactions
    - **WebRTC/Browser APIs** for voice input and output
    - **Real-time streaming** for enhanced user experience

    All data is stored in **dynamic tables** with full collaborative features, which can represent anythingâ€”tasks, finances, inventories, events, and more. Users can seamlessly switch between voice commands, text chat, and manual table operations.

    ## By combining conversational AI, voice interfaces, and collaborative features with flexible API-driven data storage, FinBot reduces manual work by **over 80%** and offers the most intuitive, multilingual, and accessible way to manage structured data.

    ## ðŸŽ¯ Project Objectives / Goals

    ### Primary Learning Objectives

    - **Advanced AI Integration**: Implement cutting-edge Model Context Protocol for direct LLM-database communication
    - **Voice Interface Development**: Create seamless voice chat capabilities with real-time processing
    - **Collaborative Systems**: Build robust database sharing and multi-user functionality
    - **Full-Stack Mastery**: Demonstrate proficiency in modern web development with advanced features
    - **Real-time Communication**: Implement WebSocket connections for instant chat responses
    - **User Experience Innovation**: Develop interfaces that eliminate traditional software complexity entirely

    ### Technical Objectives

    - Build a production-ready conversational AI system with voice capabilities
    - Implement Model Context Protocol for enhanced AI-database interactions
    - Create real-time streaming responses with WebSocket integration
    - Develop comprehensive table sharing and collaborative features
    - Enable seamless voice-to-text and text-to-speech functionality
    - Demonstrate advanced frontend state management with real-time updates
    - Implement secure multi-user authentication with database-level permissions

    ---

    ## ðŸ§° Technologies Used

    | Layer                | Technology                    | Version | Purpose                                        |
    | -------------------- | ----------------------------- | ------- | ---------------------------------------------- |
    | **Frontend**         | Next.js                       | 15.1.8  | React-based web framework                      |
    |                      | React                         | 19.0.0  | UI component library                           |
    |                      | TypeScript                    | 5.0+    | Type-safe JavaScript                           |
    |                      | Tailwind CSS                  | 4.1.7   | Utility-first CSS framework                    |
    |                      | Framer Motion                 | 12.15.0 | Animation library                              |
    |                      | WebRTC APIs                   | Native  | Voice chat and real-time communication         |
    | **Backend**          | Django                        | 5.2     | Python web framework                           |
    |                      | Django REST Framework         | 3.16.0  | API development                                |
    |                      | djangorestframework-simplejwt | 5.5.0   | JWT authentication                             |
    |                      | Django Channels               | 4.1.0   | WebSocket support                              |
    | **Database**         | SQLite/PostgreSQL             | 3.0/14+ | Relational database with advanced JSON support |
    | **AI/ML**            | Anthropic Claude              | 0.52.2  | Large language model                           |
    |                      | Model Context Protocol        | 1.0     | Direct LLM-database communication              |
    |                      | LangChain                     | 0.3.25  | AI application framework                       |
    |                      | LangGraph                     | 0.4.7   | AI agent orchestration                         |
    | **Real-time**        | WebSocket                     | Native  | Real-time chat communication                   |
    |                      | Server-Sent Events            | Native  | Streaming responses                            |
    | **Voice Processing** | Web Speech API                | Native  | Speech-to-text conversion                      |
    |                      | Speech Synthesis API          | Native  | Text-to-speech output                          |
    | **Development**      | Git                           | -       | Version control                                |
    |                      | VS Code                       | -       | Code editor with MCP extensions                |
    |                      | Postman                       | -       | API testing                                    |
    | **Deployment**       | Uvicorn                       | 0.34.3  | ASGI server                                    |

    ---

    ## ðŸŒŸ Key Features

    ### ðŸŽ¤ Voice Chat Interface

    - **Real-time Speech Recognition**: Convert speech to text instantly
    - **Natural Voice Responses**: AI responds with synthesized speech
    - **Multilingual Support**: Voice commands in Bengali and English
    - **Hands-free Operation**: Complete data management without typing

    ### ðŸ’¬ Advanced Natural Language Chat

    - **Model Context Protocol Integration**: Direct database access for LLM
    - **Streaming Responses**: Real-time response generation with typing indicators
    - **Context Awareness**: AI remembers conversation history and table context
    - **Complex Query Processing**: Handle multi-step financial operations

    ### ðŸ“Š Manual Table Operations

    - **Traditional CRUD Interface**: Click, edit, and manage data manually
    - **Inline Editing**: Double-click any cell to edit in real-time
    - **Bulk Operations**: Select multiple rows for batch updates
    - **Export/Import**: CSV and JSON data exchange capabilities

    ### ðŸ¤ Collaborative Database Sharing

    - **Friend Sharing System**: Share tables with specific users through secure permissions
    - **Permission Management**: Granular read/write access control at table level
    - **Real-time Collaboration**: See changes from other users instantly via WebSocket
    - **Activity Tracking**: Monitor who made what changes with comprehensive audit trail
    - **Data Integrity**: CASCADE delete operations maintain referential integrity

    ## ðŸ—„ï¸ Database Architecture Overview

    ### Dynamic Table Creation Concept

    FinBot uses a revolutionary **3-tier dynamic schema** that allows users to create any type of table structure on-the-fly:

    #### **Tier 1: Table Metadata** (`DynamicTableData`)

    - Stores basic table information (name, owner, description)
    - Tracks creation and modification timestamps
    - Links tables to specific users for data isolation
    - Maintains pending operation counters

    #### **Tier 2: Dynamic Headers** (`JsonTable`)

    - Stores column headers as flexible JSON arrays
    - Allows runtime schema modifications
    - Supports any number of columns with any names
    - One schema per table with unique constraints

    #### **Tier 3: Flexible Data Storage** (`JsonTableRow`)

    - Stores actual row data as JSON objects
    - Each row matches the header structure from Tier 2
    - Supports any data type (strings, numbers, dates, etc.)
    - Maintains creation timestamps for audit trails

    ### How Dynamic Tables Work

    **Example: Creating an Expense Table**

    1. **User Creates Table**: "Monthly Expenses"

       ```
       Table Metadata: {
         name: "Monthly Expenses",
         description: "Track monthly spending",
         owner: user_123
       }
       ```

    2. **System Defines Headers**: Dynamic column structure

       ```
       Headers: ["Date", "Category", "Amount", "Description", "Payment Method"]
       ```

    3. **User Adds Data**: Flexible row insertion

       ```
       Row 1: {
         "Date": "2024-06-14",
         "Category": "Groceries",
         "Amount": "85.50",
         "Description": "Weekly shopping",
         "Payment Method": "Credit Card"
       }

       Row 2: {
         "Date": "2024-06-15",
         "Category": "Gas",
         "Amount": "45.00",
         "Description": "Fill up tank",
         "Payment Method": "Debit Card"
       }
       ```

    ### Key Architecture Benefits

    - **ðŸ”„ Runtime Schema Changes**: Add/remove columns without database migrations
    - **ðŸ“Š Unlimited Data Types**: Store any JSON-compatible data structure
    - **ðŸ‘¥ Multi-User Isolation**: Each user's tables are completely separate
    - **âš¡ High Performance**: Optimized JSON indexing for fast queries
    - **ðŸ” Complex Queries**: Search across any field using JSON operations
    - **ðŸ›¡ï¸ Data Integrity**: Automatic relationship management and cleanup

    ### Table Relationship Flow

    ```
    User Account
        â†“ (owns multiple)
    Table Definitions
        â†“ (each has one)
    Column Headers
        â†“ (stores multiple)
    Data Rows
    ```

    This design allows FinBot to support any type of data management - from simple expense tracking to complex project management - all through the same flexible architecture.

    ### âš¡ Real-time Features

    - **Streaming AI Responses**: Watch AI responses generate word by word for better UX
    - **Live Data Updates**: See table changes from collaborators in real-time
    - **Progressive Response Rendering**: Enhanced user experience with incremental loading

    ---

    ## ðŸ–¼ï¸ Screenshots / Demo

    ### Voice Chat Interface

    ![Voice Chat](./docs/screenshots/voice-chat-interface.png)
    _Real-time voice chat with visual audio indicators and speech processing_

    ### Model Context Protocol Dashboard

    ![MCP Integration](./docs/screenshots/mcp-dashboard.png)
    _Advanced AI-database integration with direct LLM access visualization_

    ### Collaborative Table Sharing

    ![Table Sharing](./docs/screenshots/collaborative-sharing.png)
    _Multi-user table collaboration with real-time updates and permission management_

    ### Real-time Chat Streaming

    ![Streaming Chat](./docs/screenshots/streaming-chat.png)
    _WebSocket-powered instant messaging with typing indicators and live responses_

    ---

    ## ðŸ”§ Installation / Setup Instructions

    ### Prerequisites

    - **Node.js** v18+ ([Download](https://nodejs.org/))
    - **Python** 3.9+ ([Download](https://python.org/))
    - **Git** ([Download](https://git-scm.com/))
    - **Anthropic API Key** ([Get API Key](https://console.anthropic.com/))
    - **Model Context Protocol** setup
    - **WebRTC-compatible browser** (Chrome, Firefox, Safari)

    ### Backend Setup (Django with MCP)

    1. **Clone the repository:**

       ```bash
       git clone https://github.com/MehediHasan-75/FinanceManagement.git
       cd FinanceManagement/expense_backend
       ```

    2. **Create and activate virtual environment:**

       ```bash
       python -m venv .venv
       source .venv/bin/activate  # Linux/Mac
       # .venv\Scripts\activate   # Windows
       ```

    3. **Install Python dependencies (65+ packages including MCP):**

       ```bash
       pip install -r requirements.txt
       ```

    4. **Configure environment variables:**

       ```bash
       # Create .env file in expense_backend directory
       echo "SECRET_KEY=your_secret_key_here" > .env
       echo "DEBUG=True" >> .env
       echo "ALLOWED_HOSTS=localhost,127.0.0.1" >> .env
       echo "ANTHROPIC_API_KEY=your_claude_api_key" >> .env
       echo "MCP_SERVER_URL=http://localhost:8001" >> .env
       echo "ENABLE_WEBSOCKETS=True" >> .env
       ```

    5. **Initialize database and MCP server:**

       ```bash
       python manage.py makemigrations
       python manage.py migrate
       python manage.py setup_mcp_server  # Initialize MCP integration
       python manage.py createsuperuser  # Optional: create admin user
       ```

    6. **Start Django development server with WebSocket support:**
       ```bash
       python manage.py runserver
       # In separate terminal, start MCP server
       python manage.py start_mcp_server
       ```
       Backend will be available at `http://localhost:8000`
       WebSocket server at `ws://localhost:8000/ws/`

    ### Frontend Setup (Next.js with Voice)

    1. **Navigate to frontend directory:**

       ```bash
       cd ../frontend350
       ```

    2. **Install Node.js dependencies (35+ packages including voice APIs):**

       ```bash
       npm install
       ```

    3. **Configure environment variables:**

       ```bash
       # Create .env.local file
       echo "NEXT_PUBLIC_API_URL=http://localhost:8000" > .env.local
       echo "NEXT_PUBLIC_WS_URL=ws://localhost:8000/ws/" >> .env.local
       echo "NEXT_PUBLIC_APP_NAME=FinBot" >> .env.local
       echo "NEXT_PUBLIC_ENABLE_VOICE=true" >> .env.local
       echo "NEXT_PUBLIC_MCP_ENABLED=true" >> .env.local
       ```

    4. **Start Next.js development server:**
       ```bash
       npm run dev
       ```
       Frontend will be available at `http://localhost:3000`

    ### Voice Chat Setup

    1. **Enable microphone permissions** in your browser
    2. **Test voice functionality** using the voice chat button
    3. **Configure speech settings** in the app settings panel

    ---

    ## ðŸ“– Usage

    ### Getting Started

    1. **Registration**: Create an account at `http://localhost:3000/signin`
    2. **Authentication**: Login with your credentials to access the dashboard
    3. **Voice Setup**: Allow microphone access for voice chat features
    4. **Table Creation**: Create your first financial table or use voice commands
    5. **Sharing**: Invite friends to collaborate on your financial data

    ### Voice Chat Commands (Bengali/English)

    ```bash
    # Voice commands (speak these)
    ðŸŽ¤ "Create a new expense table for this month"
    ðŸŽ¤ "à¦†à¦®à¦¿ à¦†à¦œà¦•à§‡ à§§à§¦à§¦ à¦Ÿà¦¾à¦•à¦¾ à¦–à¦°à¦š à¦•à¦°à§‡à¦›à¦¿" (I spent 100 taka today)
    ðŸŽ¤ "Show me all my tables"
    ðŸŽ¤ "Share this table with my friend John"
    ðŸŽ¤ "Delete the last entry I made"
    ```

    ### Advanced AI Chat Commands

    ```bash
    # Complex financial operations
    "Calculate total expenses for groceries this month and compare with last month"
    "Create a budget breakdown table with categories: food, transport, entertainment"
    "Find all transactions above 500 dollars and categorize them"
    "Generate a monthly expense report and share it with family members"
    ```

    ### Collaborative Features

    - **Real-time Sharing**: Share tables instantly with email invitations
    - **Permission Control**: Set read-only or edit permissions for shared users
    - **Live Updates**: See changes from collaborators in real-time
    - **Comment System**: Add notes and comments to table entries
    - **Activity Log**: Track all changes with timestamps and user attribution

    ### Manual Testing Scenarios

    - **Voice Chat Flow**: Speak â†’ Process â†’ AI Response â†’ Voice Output
    - **Real-time Collaboration**: Multiple users editing same table simultaneously
    - **MCP Integration**: Verify direct database access through AI commands
    - **Cross-platform Voice**: Test voice features on desktop and mobile browsers

    ---

    ## ðŸš€ Future Enhancements

    ### Planned Features (Next Version)

    - ðŸ“Š **Interactive Graph Chat Visualizations**:

      - Real-time chart generation from table data through voice commands
      - AI-powered graph creation ("Show me a pie chart of my expenses")
      - Interactive data visualization with natural language queries
      - Collaborative graph sharing and real-time editing

    - âš¡ **Advanced WebSocket Integration**:

      - Ultra-fast chat responses (<500ms) with persistent connections
      - Real-time typing indicators for all users
      - Live cursor tracking in shared tables
      - Instant push notifications for collaborative updates

    - ðŸŽ¯ **Enhanced Streaming Features**:

      - Progressive AI response rendering with smooth animations
      - Streaming data visualizations that build in real-time
      - Live voice transcription display during speech input
      - Buffered response optimization for better user experience

    - ðŸ§  **RAG (Retrieval-Augmented Generation)**:

      - Context-aware prompt feeding for more accurate AI responses
      - Historical data integration for smarter financial insights
      - Personalized AI assistant based on user spending patterns
      - Dynamic knowledge base updates from user interactions

    - â° **Smart Reminder System**:

      - Voice-activated reminder creation ("Remind me to pay rent on the 1st")
      - AI-powered expense reminders based on spending patterns
      - Collaborative reminders for shared tables and budgets
      - Smart notifications with contextual financial advice

    - ðŸ”” **Advanced Notification Framework**:

      - Real-time budget alerts and spending threshold warnings
      - Collaborative workspace notifications with activity feeds
      - Voice notification system with text-to-speech alerts
      - Smart digest emails with AI-generated financial summaries

    - ðŸ“ˆ **Predictive Analytics & AI Insights**:

      - Machine learning-powered spending prediction models
      - AI-generated monthly financial health reports
      - Trend analysis with voice-activated insights
      - Smart categorization suggestions based on transaction history

    - ðŸŽ¨ **Enhanced User Experience**:
      - Voice-controlled theme switching and UI customization
      - Gesture-based navigation for mobile voice interactions
      - Smart auto-complete for financial categories and descriptions
      - AI-powered data validation and error correction

    ### Long-term Roadmap (6-12 Months)

    - ðŸ¦ **Banking API Integration**:

      - Automatic transaction import from major financial institutions
      - Real-time account balance synchronization
      - Smart transaction categorization using AI

    - ðŸ“± **Cross-Platform Mobile Application**:

      - React Native app with offline voice capabilities
      - Synchronized data across web and mobile platforms
      - Mobile-optimized voice commands and gestures

    - ðŸ” **Enterprise Security Features**:

      - End-to-end encryption for sensitive financial data
      - Multi-factor authentication with biometric support
      - Advanced audit logs and compliance reporting

    - ðŸŒ **Global Financial Features**:

      - Multi-currency support with real-time exchange rates
      - International tax calculation and reporting tools
      - Global banking integration and investment tracking

    - ðŸ¤– **Advanced AI Financial Advisor**:
      - Personalized investment recommendations
      - Risk assessment and portfolio optimization
      - AI-powered financial goal planning and tracking

    ---

    ## ðŸ§  Learning Outcomes

    ### Advanced Technical Skills Developed

    ### Advanced Technical Skills Developed

    - **Database Architecture Design**: Created innovative 3-tier JSON-based dynamic schema
    - **Model Context Protocol Mastery**: Implemented cutting-edge LLM-database integration
    - **Voice Interface Development**: Created seamless speech-to-text and text-to-speech systems
    - **Real-time Architecture**: Built WebSocket-based collaborative systems with CASCADE operations
    - **Advanced AI Integration**: Developed context-aware conversational interfaces
    - **Performance Optimization**: Implemented GIN indexes for sub-50ms JSON query performance
    - **Collaborative Systems**: Implemented secure multi-user data sharing with audit trails

    ### Innovation Achievements

    - **User Experience Revolution**: Transformed complex financial management into natural conversations
    - **Performance Optimization**: Achieved 80% reduction in data entry time through voice and AI
    - **Collaborative Innovation**: Created real-time multi-user financial management platform
    - **Technical Leadership**: Pioneered MCP integration in financial applications

    ### Software Engineering Excellence

    - **Modern Architecture**: Microservices design with real-time communication
    - **Security Implementation**: JWT authentication with database-level permissions
    - **Testing Strategy**: Comprehensive testing including voice and real-time features
    - **Documentation**: Extensive API documentation and user guides
    - **Performance Monitoring**: Real-time metrics and performance optimization

--------------------------------------------------------------------------------------------------------------

ðŸ“„ read_finbot_dir.py (7.67 KB)
--------------------------------------------------------------------------------------------------------------
CONTENT:
--------------------------------------------------------------------------------------------------------------
  import os
  from datetime import datetime
  from pathlib import Path

  def read_file_content(file_path):
      """
      Safely read file content with encoding detection.
      Returns content if readable, otherwise returns error message.
      """
      try:
          # Try UTF-8 first
          with open(file_path, 'r', encoding='utf-8') as f:
              content = f.read()
          return content
      except UnicodeDecodeError:
          # Try with error handling
          try:
              with open(file_path, 'r', encoding='utf-8', errors='ignore') as f:
                  content = f.read()
              return content
          except Exception as e:
              return f"[Binary/Unreadable file: {str(e)}]"
      except Exception as e:
          return f"[Error reading file: {str(e)}]"

  def list_all_contents_with_file_content(output_filename="directory_contents.txt"):
      """
      Recursively reads all files and folders from the FinanceManagement directory
      and includes the CONTENT of each file (not just names).

      Args:
          output_filename: Name of the output text file (default: directory_contents.txt)
      """
      try:
          # Get current directory (FinanceManagement)
          directory_path = os.getcwd()

          # Set output file path in the same directory
          output_path = os.path.join(directory_path, output_filename)

          # File extensions to skip (binary files)
          skip_extensions = {'.jpg', '.png', '.gif', '.ico', '.svg', '.pack', '.idx', '.DS_Store',
                            '.mp4', '.mp3', '.mov', '.zip', '.tar', '.gz', '.pyc', '.o', '.so',
                            '.dll', '.exe', '.bin', '.woff', '.woff2', '.ttf', '.otf'}

          skip_files = {'.DS_Store', 'package-lock.json', 'node_modules'}
          skip_dirs = {'node_modules', '.git', '.next', 'venv', '__pycache__', '.env', 'dist', 'build'}

          total_files = 0
          total_folders = 0
          total_size = 0
          processed_content = 0
          skipped_binary = 0

          # Write to text file
          with open(output_path, 'w', encoding='utf-8') as f:
              f.write("=" * 120 + "\n")
              f.write("FINBOT - FINANCEMANAGEMENT PROJECT - COMPLETE LISTING WITH FILE CONTENTS (RECURSIVE)\n")
              f.write("=" * 120 + "\n\n")

              f.write(f"Generated: {datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n")
              f.write(f"Location: {os.path.abspath(directory_path)}\n")
              f.write(f"Scan Type: Recursive (All subdirectories with file contents)\n")
              f.write("\n" + "=" * 120 + "\n\n")

              # Walk through all directories recursively
              for root, dirs, files in os.walk(directory_path):
                  # Skip directories
                  dirs[:] = [d for d in dirs if d not in skip_dirs]

                  # Calculate depth
                  depth = root.replace(directory_path, '').count(os.sep)

                  # Create relative path for cleaner display
                  relative_path = os.path.relpath(root, directory_path)
                  if relative_path == '.':
                      relative_path = 'FinanceManagement (Root)'
                  else:
                      relative_path = f"FinanceManagement/{relative_path}"

                  # Write directory header
                  indent = "  " * depth

                  if relative_path == 'FinanceManagement (Root)':
                      f.write(f"\n{'=' * 120}\n")
                      f.write(f"ðŸ“ {relative_path}\n")
                      f.write(f"{'=' * 120}\n\n")
                  else:
                      f.write(f"\n{indent}{'â”€' * (120 - len(indent))}\n")
                      f.write(f"{indent}ðŸ“ {os.path.basename(relative_path)}\n")
                      f.write(f"{indent}{'â”€' * (120 - len(indent))}\n\n")

                  total_folders += 1

                  # Process files
                  for file in sorted(files):
                      # Skip certain files
                      if file in skip_files:
                          continue

                      file_path = os.path.join(root, file)
                      file_ext = os.path.splitext(file)[1]

                      try:
                          file_size = os.path.getsize(file_path)
                          total_size += file_size

                          if file_size / (1024 * 1024) > 0.01:
                              size_display = f"{file_size / (1024 * 1024):.2f} MB"
                          else:
                              size_display = f"{file_size / 1024:.2f} KB"

                          total_files += 1

                          # Check if file should be read
                          if file_ext in skip_extensions or file_size > 5 * 1024 * 1024:  # Skip files > 5MB
                              skipped_binary += 1
                              f.write(f"{indent}ðŸ“„ {file} ({size_display}) [Binary/Large file - skipped]\n\n")
                          else:
                              # Read and display file content
                              content = read_file_content(file_path)

                              f.write(f"{indent}ðŸ“„ {file} ({size_display})\n")
                              f.write(f"{indent}{'-' * 110}\n")
                              f.write(f"{indent}CONTENT:\n")
                              f.write(f"{indent}{'-' * 110}\n")

                              # Add content with indentation
                              for line in content.split('\n'):
                                  if line.strip():  # Only write non-empty lines
                                      f.write(f"{indent}  {line}\n")
                                  else:
                                      f.write(f"\n")

                              f.write(f"{indent}{'-' * 110}\n\n")
                              processed_content += 1

                      except Exception as e:
                          total_files += 1
                          f.write(f"{indent}ðŸ“„ {file} [Error: {str(e)}]\n\n")

              # Write summary
              f.write("\n" + "=" * 120 + "\n")
              f.write("SUMMARY REPORT\n")
              f.write("-" * 120 + "\n")
              f.write(f"Total Directories: {total_folders}\n")
              f.write(f"Total Files: {total_files}\n")
              f.write(f"Files with Content Displayed: {processed_content}\n")
              f.write(f"Binary/Large Files Skipped: {skipped_binary}\n")
              f.write(f"Total Size: {total_size / (1024 * 1024):.2f} MB ({total_size / 1024:.2f} KB)\n")
              f.write(f"\nNote: Binary files and files larger than 5MB are listed but content is skipped.\n")
              f.write(f"Directories excluded: {', '.join(skip_dirs)}\n")

              f.write("\n" + "=" * 120 + "\n")
              f.write("Report generated by FinBot Complete Content Analyzer\n")
              f.write("=" * 120 + "\n")

          print(f"âœ“ Success! Complete directory listing with file contents saved!")
          print(f"âœ“ File: {output_filename}")
          print(f"âœ“ Location: {output_path}")
          print(f"âœ“ Total Directories: {total_folders}")
          print(f"âœ“ Total Files: {total_files}")
          print(f"âœ“ Files with Content: {processed_content}")
          print(f"âœ“ Binary/Large Files (skipped): {skipped_binary}")
          print(f"âœ“ Total Size: {total_size / (1024 * 1024):.2f} MB")

      except Exception as e:
          print(f"âœ— Error: {str(e)}")

  # Usage - Run this script in the FinanceManagement directory
  if __name__ == "__main__":
      list_all_contents_with_file_content("directory_contents.txt")
--------------------------------------------------------------------------------------------------------------


  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ðŸ“ frontend350
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ðŸ“„ .gitignore (0.49 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    # See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

    # dependencies
    /node_modules
    /.pnp
    .pnp.*
    .yarn/*
    !.yarn/patches
    !.yarn/plugins
    !.yarn/releases
    !.yarn/versions

    # testing
    /coverage

    # next.js
    /.next/
    /out/

    # production
    /build

    # misc
    .DS_Store
    *.pem

    # debug
    npm-debug.log*
    yarn-debug.log*
    yarn-error.log*
    .pnpm-debug.log*

    # env files (can opt-in for committing if needed)
    .env*

    # vercel
    .vercel

    # typescript
    *.tsbuildinfo
    next-env.d.ts

    package-lock.json

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ components.json (0.44 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    {
      "$schema": "https://ui.shadcn.com/schema.json",
      "style": "new-york",
      "rsc": true,
      "tsx": true,
      "tailwind": {
        "config": "tailwind.config.ts",
        "css": "src/app/globals.css",
        "baseColor": "neutral",
        "cssVariables": true,
        "prefix": ""
      },
      "aliases": {
        "components": "@/components",
        "utils": "@/lib/utils",
        "ui": "@/components/ui",
        "lib": "@/lib",
        "hooks": "@/hooks"
      },
      "iconLibrary": "lucide"
    }
  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ eslint.config.mjs (0.38 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    import { dirname } from "path";
    import { fileURLToPath } from "url";
    import { FlatCompat } from "@eslint/eslintrc";

    const __filename = fileURLToPath(import.meta.url);
    const __dirname = dirname(__filename);

    const compat = new FlatCompat({
      baseDirectory: __dirname,
    });

    const eslintConfig = [
      ...compat.extends("next/core-web-vitals", "next/typescript"),
    ];

    export default eslintConfig;

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ next.config.ts (0.13 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    import type { NextConfig } from "next";

    const nextConfig: NextConfig = {
      /* config options here */
    };

    export default nextConfig;

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ package.json (1.30 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    {
      "name": "frontend350",
      "version": "0.1.0",
      "private": true,
      "scripts": {
        "dev": "next dev --turbopack",
        "build": "next build",
        "start": "next start",
        "lint": "next lint"
      },
      "dependencies": {
        "@radix-ui/react-checkbox": "^1.3.2",
        "@radix-ui/react-dialog": "^1.1.14",
        "@radix-ui/react-label": "^2.1.7",
        "@radix-ui/react-popover": "^1.1.14",
        "@radix-ui/react-slot": "^1.2.3",
        "@radix-ui/react-switch": "^1.2.5",
        "@tailwindcss/postcss": "^4.1.7",
        "@types/react-speech-recognition": "^3.9.6",
        "axios": "^1.9.0",
        "class-variance-authority": "^0.7.1",
        "clsx": "^2.1.1",
        "framer-motion": "^12.15.0",
        "highlight.js": "^11.11.1",
        "lucide-react": "^0.511.0",
        "next": "15.1.8",
        "next-themes": "^0.4.6",
        "react": "^19.0.0",
        "react-dom": "^19.0.0",
        "react-hook-form": "^7.56.4",
        "react-icons": "^5.5.0",
        "react-speech-recognition": "^4.0.1",
        "tailwind-merge": "^3.3.0",
        "tailwindcss": "^4.1.7"
      },
      "devDependencies": {
        "@eslint/eslintrc": "^3",
        "@types/node": "^20",
        "@types/react": "^19",
        "@types/react-dom": "^19",
        "eslint": "^9",
        "eslint-config-next": "15.1.8",
        "postcss": "^8.5.3",
        "tw-animate-css": "^1.3.3",
        "typescript": "^5"
      }
    }

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ postcss.config.mjs (0.09 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    const config = {
      plugins: {
        "@tailwindcss/postcss": {},
      },
    };
    export default config;

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ tailwind.config.ts (0.38 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    import type { Config } from "tailwindcss";

    export default {
      content: [
        "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
        "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
        "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
      ],
      theme: {
        extend: {
          colors: {
            background: "var(--background)",
            foreground: "var(--foreground)",
          },
        },
      },
      plugins: [],
    } satisfies Config;

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ tsconfig.json (0.59 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    {
      "compilerOptions": {
        "target": "ES2017",
        "lib": ["dom", "dom.iterable", "esnext"],
        "allowJs": true,
        "skipLibCheck": true,
        "strict": true,
        "noEmit": true,
        "esModuleInterop": true,
        "module": "esnext",
        "moduleResolution": "bundler",
        "resolveJsonModule": true,
        "isolatedModules": true,
        "jsx": "preserve",
        "incremental": true,
        "plugins": [
          {
            "name": "next"
          }
        ],
        "paths": {
          "@/*": ["./src/*"]
        }
      },
      "include": ["next-env.d.ts", "**/*.ts", "**/*.tsx", ".next/types/**/*.ts"],
      "exclude": ["node_modules"]
    }

  --------------------------------------------------------------------------------------------------------------


    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ðŸ“ public
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ðŸ“„ Hero.png (1.27 MB) [Binary/Large file - skipped]

    ðŸ“„ Image.png (0.08 MB) [Binary/Large file - skipped]

    ðŸ“„ file.svg (0.38 KB) [Binary/Large file - skipped]

    ðŸ“„ finance_favicon.png (0.89 MB) [Binary/Large file - skipped]

    ðŸ“„ finance_navbar_logo.png (1.00 MB) [Binary/Large file - skipped]

    ðŸ“„ globe.svg (1.01 KB) [Binary/Large file - skipped]

    ðŸ“„ next.svg (1.34 KB) [Binary/Large file - skipped]

    ðŸ“„ unsplash_1.jpg (5.43 MB) [Binary/Large file - skipped]

    ðŸ“„ unsplash_2.jpg (3.11 MB) [Binary/Large file - skipped]

    ðŸ“„ unsplash_3.jpg (5.00 MB) [Binary/Large file - skipped]

    ðŸ“„ unsplash_4.jpg (2.26 MB) [Binary/Large file - skipped]

    ðŸ“„ unsplash_5.jpg (2.05 MB) [Binary/Large file - skipped]

    ðŸ“„ unsplash_6.jpg (2.32 MB) [Binary/Large file - skipped]

    ðŸ“„ vercel.svg (0.12 KB) [Binary/Large file - skipped]

    ðŸ“„ window.svg (0.38 KB) [Binary/Large file - skipped]


    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ðŸ“ src
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ context
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ AuthProvider.tsx (3.31 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        // context/UserContext.tsx
        "use client";
        import React, {
          createContext,
          useState,
          useEffect,
          useContext,
          ReactNode,
          useCallback,
        } from "react";
        import { getSelfDetail, updateAccessToken, logoutUser } from "@/api/AuthApi";
        import { useRouter } from "next/navigation";

        export interface User {
          id: number;
          username: string;
          email: string;
          name?: string;
          // Add other user fields as needed
        }

        export interface UserContextType {
          user: User | null;
          setUser: (user: User | null) => void;
          refreshUser: () => Promise<void>;
          loading: boolean;
          signOut: () => Promise<void>;
        }

        export const UserContext = createContext<UserContextType | undefined>(
          undefined
        );

        const TOKEN_REFRESH_INTERVAL = 4 * 60 * 1000; // 4 minutes in milliseconds

        export const UserProvider = ({ children }: { children: ReactNode }) => {
          const [user, setUser] = useState<User | null>(null);
          const [loading, setLoading] = useState(true);
          const router = useRouter();

          const handleTokenExpiration = useCallback(() => {
            // Remove all user-related data from localStorage
            localStorage.removeItem("user");
            localStorage.removeItem("user_data");
            setUser(null);
            router.push("/signin");
          }, [router]);

          const refreshUser = useCallback(async () => {
            const existingUser = localStorage.getItem("user");

            if (!existingUser && window.location.pathname !== "/signin") {
              setLoading(false);
              return;
            }

            // if (!existingUser) {
            //   return;
            // }

            try {
              const userData = await getSelfDetail();
              if (userData.success && userData.data) {
                localStorage.setItem("user", JSON.stringify(userData.data));
                setUser(userData.data);
              } else {
                throw new Error("User data is invalid");
              }
            } catch (error) {
              console.error("Failed to get user info:", error);
              handleTokenExpiration();
            } finally {
              setLoading(false);
            }
          }, [handleTokenExpiration]);

          const refreshToken = useCallback(async () => {
            try {
              const response = await updateAccessToken();
              if (!response.success) {
                throw new Error("Failed to refresh token");
              }
            } catch (error) {
              console.error("Token refresh failed:", error);
              handleTokenExpiration();
            }
          }, [handleTokenExpiration]);

          const signOut = useCallback(async () => {
            try {
              const response = await logoutUser();
              if (!response.success) {
                throw new Error(response.error || "Logout failed");
              }
            } catch (error) {
              console.error("Logout failed:", error);
            } finally {
              // Always clear user data and redirect, even if the API call fails
              handleTokenExpiration();
            }
          }, [handleTokenExpiration]);

          // Initial user data fetch
          useEffect(() => {
            refreshUser();
          }, [refreshUser]);

          // Periodic token refresh
          useEffect(() => {
            const intervalId = setInterval(() => {
              refreshToken();
            }, TOKEN_REFRESH_INTERVAL);

            return () => clearInterval(intervalId);
          }, [refreshToken]);

          return (
            <UserContext.Provider
              value={{ user, setUser, refreshUser, loading, signOut }}
            >
              {children}
            </UserContext.Provider>
          );
        };

        export const useUser = (): UserContextType => {
          const context = useContext(UserContext);
          if (!context) {
            throw new Error("useUser must be used within a UserProvider");
          }
          return context;
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ DataProvider.tsx (2.33 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import { getTableData, TableDataType } from "@/data/table";
        import { getAllTableContents, JsonTableItem } from "@/data/TableContent";
        import { JsonTableAction, jsonTableReducer } from "@/reducers/TableContentReducer";
        import { TableReducer, TableDataAction } from "@/reducers/TableReducer";
        import { ReactNode, useReducer, createContext, useContext } from "react";

        interface TablesDataContextType {
          tablesData: TableDataType[];
          dispatchTablesData: React.Dispatch<TableDataAction>;
          getTableData: (tableId: number | null) => TableDataType[];
        }

        const initialTablesData: TableDataType[] = getTableData("1");

        export const TablesDataContext = createContext<TablesDataContextType | null>(null);


        interface TablesContentContextType {
            tablesContent: JsonTableItem[];
            dispatchtablesContent: React.Dispatch<JsonTableAction>;
            getTableContents: (tableId: number | null) => JsonTableItem[];
        }
        const initialTablesContent: JsonTableItem[] = getAllTableContents();
        export const TablesContentContext = createContext<TablesContentContextType | null> (null);


        export const DataProvider = ({ children }: { children: ReactNode }) => {
          const [tablesData, dispatchTablesData] = useReducer(TableReducer,initialTablesData);
          const [tablesContent, dispatchtablesContent] = useReducer(jsonTableReducer, initialTablesContent);

          const getTableContents = (tableId: number | null) => {
                if (tableId === null) return [];
                return tablesContent.filter(table => table.id === tableId)
            };

          const getTableData = (tableId: number | null) => {
                if (tableId === null) return [];
                return tablesData.filter(table => table.id === tableId)
            };

          return (
            <TablesDataContext.Provider value={{ tablesData, getTableData, dispatchTablesData }}>
                <TablesContentContext.Provider value={{tablesContent, dispatchtablesContent, getTableContents}}>
              {children}
              </TablesContentContext.Provider>
            </TablesDataContext.Provider>
          );
        };

        export const useTablesData = () => {
          const context = useContext(TablesDataContext);
          if (!context) {
            throw new Error("useTablesData must be used within a DataProvider");
          }
          return context;
        };

        export const useTablesContent = () => {
          const context = useContext(TablesContentContext);
          if (!context) {
            throw new Error("useTablesData must be used within a DataProvider");
          }
          return context;
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ DataProviderReal.tsx (3.07 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import { jsonTableApi } from "@/api/TableContentApi";
        import { tableApi } from "@/api/TableDataApi";
        import { TableDataType } from "@/data/table";
        import { JsonTableItem } from "@/data/TableContent";
        import {
          JsonTableAction,
          jsonTableReducer,
        } from "@/reducers/TableContentReducer";
        import { TableReducer, TableDataAction } from "@/reducers/TableReducer";
        import {
          ReactNode,
          useReducer,
          createContext,
          useContext,
          useEffect,
        } from "react";

        interface TablesDataContextType {
          tablesData: TableDataType[];
          dispatchTablesData: React.Dispatch<TableDataAction>;
          getTableData: (tableId: number | null) => TableDataType[];
        }

        const initialTablesData: TableDataType[] = [];

        export const TablesDataContext = createContext<TablesDataContextType | null>(
          null
        );

        interface TablesContentContextType {
          tablesContent: JsonTableItem[];
          dispatchtablesContent: React.Dispatch<JsonTableAction>;
          getTableContents: (tableId: number | null) => JsonTableItem[];
          refreshData: () => Promise<void>;
        }

        const initialTablesContent: JsonTableItem[] = [];

        export const TablesContentContext =
          createContext<TablesContentContextType | null>(null);

        export const DataProvider = ({ children }: { children: ReactNode }) => {
          const [tablesData, dispatchTablesData] = useReducer(
            TableReducer,
            initialTablesData
          );
          const [tablesContent, dispatchtablesContent] = useReducer(
            jsonTableReducer,
            initialTablesContent
          );

          const refreshData = async () => {
            // Fetch table contents
            const contentResponse = await jsonTableApi.getTables();
            if (contentResponse.success && contentResponse.data) {
              dispatchtablesContent({
                type: "SET_TABLES",
                payload: contentResponse.data,
              });
            }

            // Fetch table data
            const dataResponse = await tableApi.getTables();
            if (dataResponse.success && dataResponse.data) {
              dispatchTablesData({ type: "SET_TABLES", payload: dataResponse.data });
            }
          };

          useEffect(() => {
            refreshData();
          }, []);

          const getTableContents = (tableId: number | null) => {
            if (tableId === null) return [];
            return tablesContent.filter((table) => table.id === tableId);
          };

          const getTableData = (tableId: number | null) => {
            if (tableId === null) return [];
            return tablesData.filter((table) => table.id === tableId);
          };

          return (
            <TablesDataContext.Provider
              value={{ tablesData, getTableData, dispatchTablesData }}
            >
              <TablesContentContext.Provider
                value={{
                  tablesContent,
                  dispatchtablesContent,
                  getTableContents,
                  refreshData,
                }}
              >
                {children}
              </TablesContentContext.Provider>
            </TablesDataContext.Provider>
          );
        };

        export const useTablesData = () => {
          const context = useContext(TablesDataContext);
          if (!context) {
            throw new Error("useTablesData must be used within a DataProvider");
          }
          return context;
        };

        export const useTablesContent = () => {
          const context = useContext(TablesContentContext);
          if (!context) {
            throw new Error("useTablesContent must be used within a DataProvider");
          }
          return context;
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ SelectedTableProvider.tsx (0.82 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        "use client";
        import { createContext, useContext, useState } from "react";

        export interface SelectedTableType {
          selectedTable: number | null;
          setSelectedTable: (table: number | null) => void;
        }

        const initialSelectedTable: SelectedTableType = {
          selectedTable: null,
          setSelectedTable: () => {},
        };

        export const SelectedTableContext =
          createContext<SelectedTableType>(initialSelectedTable);

        import { ReactNode } from "react";

        export const SelectedTableProvider = ({ children,}: { children: ReactNode;}) => {
          const [selectedTable, setSelectedTable] = useState<number | null>(null);

          return (
            <SelectedTableContext.Provider value={{ selectedTable, setSelectedTable }}>
              {children}
            </SelectedTableContext.Provider>
          );
        };

        export const useSelectedTable = () => {
          return useContext(SelectedTableContext);
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ ThemeProvider.tsx (1.79 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        "use client";
        import { createContext, useContext, useEffect, useState } from "react";

        export type ThemeMode = "light" | "dark";

        export interface ThemeType {
          theme: ThemeMode;
          setTheme: (mode: ThemeMode) => void;
          toggleTheme: () => void;
        }

        const initialTheme: ThemeType = {
          theme: "dark",
          setTheme: () => {},
          toggleTheme: () => {},
        };

        export const ThemeContext = createContext<ThemeType>(initialTheme);

        import { ReactNode } from "react";

        export const ThemeProvider = ({ children }: { children: ReactNode }) => {
          const [theme, setTheme] = useState<ThemeMode>("dark");
          const [mounted, setMounted] = useState(false);

          useEffect(() => {
            setMounted(true);
            const storedTheme = localStorage.getItem("theme") as ThemeMode;
            if (storedTheme) {
              setTheme(storedTheme);
            } else {
              // Check system preference
              const systemTheme = window.matchMedia("(prefers-color-scheme: dark)")
                .matches
                ? "dark"
                : "light";
              setTheme(systemTheme);
              localStorage.setItem("theme", systemTheme);
            }
          }, []);

          useEffect(() => {
            if (mounted) {
              document.documentElement.classList.remove("light", "dark");
              document.documentElement.classList.add(theme);
            }
          }, [theme, mounted]);

          const toggleTheme = () => {
            setTheme((prev) => {
              const newTheme = prev === "light" ? "dark" : "light";
              localStorage.setItem("theme", newTheme);
              return newTheme;
            });
          };

          if (!mounted) {
            return null;
          }

          return (
            <ThemeContext.Provider value={{ theme, setTheme, toggleTheme }}>
              {children}
            </ThemeContext.Provider>
          );
        };

        export const useTheme = () => {
          const context = useContext(ThemeContext);
          if (context === undefined) {
            throw new Error("useTheme must be used within a ThemeProvider");
          }
          return context;
        };

      --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ app
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ favicon.ico (0.01 MB) [Binary/Large file - skipped]

      ðŸ“„ globals.css (4.48 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        @import "tailwindcss";

        @import "../components/SideBarComps/CreateTableModal.css";

        @import "tw-animate-css";

        @custom-variant dark (&:is(.dark *));

        .scrollbar-custom::-webkit-scrollbar {
          width: 8px;
        }

        .scrollbar-custom::-webkit-scrollbar-track {
          background: rgba(209, 213, 219, 0.3);
        }

        .scrollbar-custom::-webkit-scrollbar-thumb {
          background: rgba(156, 163, 175, 0.5);
          border-radius: 4px;
        }

        .dark .scrollbar-custom::-webkit-scrollbar-track {
          background: rgba(17, 24, 39, 0.3);
        }

        .dark .scrollbar-custom::-webkit-scrollbar-thumb {
          background: rgba(75, 85, 99, 0.5);
        }

        @theme inline {
          --radius-sm: calc(var(--radius) - 4px);
          --radius-md: calc(var(--radius) - 2px);
          --radius-lg: var(--radius);
          --radius-xl: calc(var(--radius) + 4px);
          --color-background: var(--background);
          --color-foreground: var(--foreground);
          --color-card: var(--card);
          --color-card-foreground: var(--card-foreground);
          --color-popover: var(--popover);
          --color-popover-foreground: var(--popover-foreground);
          --color-primary: var(--primary);
          --color-primary-foreground: var(--primary-foreground);
          --color-secondary: var(--secondary);
          --color-secondary-foreground: var(--secondary-foreground);
          --color-muted: var(--muted);
          --color-muted-foreground: var(--muted-foreground);
          --color-accent: var(--accent);
          --color-accent-foreground: var(--accent-foreground);
          --color-destructive: var(--destructive);
          --color-border: var(--border);
          --color-input: var(--input);
          --color-ring: var(--ring);
          --color-chart-1: var(--chart-1);
          --color-chart-2: var(--chart-2);
          --color-chart-3: var(--chart-3);
          --color-chart-4: var(--chart-4);
          --color-chart-5: var(--chart-5);
          --color-sidebar: var(--sidebar);
          --color-sidebar-foreground: var(--sidebar-foreground);
          --color-sidebar-primary: var(--sidebar-primary);
          --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);
          --color-sidebar-accent: var(--sidebar-accent);
          --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);
          --color-sidebar-border: var(--sidebar-border);
          --color-sidebar-ring: var(--sidebar-ring);
        }

        :root {
          --radius: 0.625rem;
          --background: oklch(1 0 0);
          --foreground: oklch(0.145 0 0);
          --card: oklch(1 0 0);
          --card-foreground: oklch(0.145 0 0);
          --popover: oklch(1 0 0);
          --popover-foreground: oklch(0.145 0 0);
          --primary: oklch(0.205 0 0);
          --primary-foreground: oklch(0.985 0 0);
          --secondary: oklch(0.97 0 0);
          --secondary-foreground: oklch(0.205 0 0);
          --muted: oklch(0.97 0 0);
          --muted-foreground: oklch(0.556 0 0);
          --accent: oklch(0.97 0 0);
          --accent-foreground: oklch(0.205 0 0);
          --destructive: oklch(0.577 0.245 27.325);
          --border: oklch(0.922 0 0);
          --input: oklch(0.922 0 0);
          --ring: oklch(0.708 0 0);
          --chart-1: oklch(0.646 0.222 41.116);
          --chart-2: oklch(0.6 0.118 184.704);
          --chart-3: oklch(0.398 0.07 227.392);
          --chart-4: oklch(0.828 0.189 84.429);
          --chart-5: oklch(0.769 0.188 70.08);
          --sidebar: oklch(0.985 0 0);
          --sidebar-foreground: oklch(0.145 0 0);
          --sidebar-primary: oklch(0.205 0 0);
          --sidebar-primary-foreground: oklch(0.985 0 0);
          --sidebar-accent: oklch(0.97 0 0);
          --sidebar-accent-foreground: oklch(0.205 0 0);
          --sidebar-border: oklch(0.922 0 0);
          --sidebar-ring: oklch(0.708 0 0);
        }

        .dark {
          --background: oklch(0.145 0 0);
          --foreground: oklch(0.985 0 0);
          --card: oklch(0.205 0 0);
          --card-foreground: oklch(0.985 0 0);
          --popover: oklch(0.205 0 0);
          --popover-foreground: oklch(0.985 0 0);
          --primary: oklch(0.922 0 0);
          --primary-foreground: oklch(0.205 0 0);
          --secondary: oklch(0.269 0 0);
          --secondary-foreground: oklch(0.985 0 0);
          --muted: oklch(0.269 0 0);
          --muted-foreground: oklch(0.708 0 0);
          --accent: oklch(0.269 0 0);
          --accent-foreground: oklch(0.985 0 0);
          --destructive: oklch(0.704 0.191 22.216);
          --border: oklch(1 0 0 / 10%);
          --input: oklch(1 0 0 / 15%);
          --ring: oklch(0.556 0 0);
          --chart-1: oklch(0.488 0.243 264.376);
          --chart-2: oklch(0.696 0.17 162.48);
          --chart-3: oklch(0.769 0.188 70.08);
          --chart-4: oklch(0.627 0.265 303.9);
          --chart-5: oklch(0.645 0.246 16.439);
          --sidebar: oklch(0.205 0 0);
          --sidebar-foreground: oklch(0.985 0 0);
          --sidebar-primary: oklch(0.488 0.243 264.376);
          --sidebar-primary-foreground: oklch(0.985 0 0);
          --sidebar-accent: oklch(0.269 0 0);
          --sidebar-accent-foreground: oklch(0.985 0 0);
          --sidebar-border: oklch(1 0 0 / 10%);
          --sidebar-ring: oklch(0.556 0 0);
        }

        @layer base {
          * {
            @apply border-border outline-ring/50;
          }
          body {
            @apply bg-background text-foreground;
          }
        }

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ layout.tsx (1.12 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        // app/layout.tsx
        import type { Metadata } from "next";
        import { Geist, Geist_Mono } from "next/font/google";
        import "./globals.css";
        import { ThemeProvider } from "@/context/ThemeProvider";
        import { UserProvider } from "@/context/AuthProvider"; // Update this import

        const geistSans = Geist({
          variable: "--font-geist-sans",
          subsets: ["latin"],
        });

        const geistMono = Geist_Mono({
          variable: "--font-geist-mono",
          subsets: ["latin"],
        });

        export const metadata: Metadata = {
          title: "Finance Management",
          description: "Project 350 for SUST",
        };

        export default function RootLayout({
          children,
        }: {
          children: React.ReactNode;
        }) {
          return (
            <html lang="en">
              <body
                className={`${geistSans.variable} ${geistMono.variable} antialiased`}
              >
                {/* Create a client component wrapper */}
                <Providers>
                  {children}
                </Providers>
              </body>
            </html>
          );
        }

        // Create a separate client component to wrap the providers
        function Providers({ children }: { children: React.ReactNode }) {
          return (
            <UserProvider>
              <ThemeProvider>{children}</ThemeProvider>
            </UserProvider>
          );
        }

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ page.tsx (1.17 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        "use client";
        import React from "react";
        import Navbar from "@/components/landingPageComponents/Nabvar";
        import Hero from "@/components/landingPageComponents/Hero";
        import Features from "@/components/landingPageComponents/Features";
        import Benefits from "@/components/landingPageComponents/Benefits";
        import CTA from "@/components/landingPageComponents/CTA";
        import Footer from "@/components/landingPageComponents/Footer";
        import { useTheme } from "@/context/ThemeProvider";
        import { DataProvider } from "@/context/DataProviderReal";
        import { SelectedTableProvider } from "@/context/SelectedTableProvider";

        const HomePage = () => {
          const { theme } = useTheme();

          return (
            <DataProvider>
              <SelectedTableProvider>
                <main
                  className={`min-h-screen font-sans antialiased transition-colors duration-300 ${
                    theme === "dark"
                      ? "bg-gray-900 text-gray-100"
                      : "bg-white text-gray-800"
                  }`}
                >
                  <Navbar />
                  <Hero />
                  <Features />
                  <Benefits />
                  <CTA />
                  <Footer />
                </main>
              </SelectedTableProvider>
            </DataProvider>
          );
        };

        export default HomePage;

      --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ chat
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ page.tsx (1.58 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client";
          import MainContent from "@/components/MainContent";
          import Navbar from "@/components/Navbar";
          import SideBar from "@/components/SideBarComps/SideBar";
          import ToggleChat from "@/components/ToggleChat";
          import { useUser } from "@/context/AuthProvider";
          import { DataProvider } from "@/context/DataProviderReal";
          import { SelectedTableProvider } from "@/context/SelectedTableProvider";
          import { useRouter } from "next/navigation";
          import { useEffect, useState } from "react";

          const Page = () => {
            const [showChatArea, setShowChatArea] = useState(false);
            const [showSidebar, setShowSidebar] = useState(false);
            const [isClient, setIsClient] = useState(false);
            const router = useRouter();
            const { user, loading } = useUser();

            useEffect(() => {
              setIsClient(true);
            }, []);

            useEffect(() => {
              if (!loading && user === null) {
                router.push("/signin");
              }
            }, [user, loading, router]);

            if (!isClient || loading) return null;
            if (!user) return null;

            const handleShowChat = () => {
              setShowChatArea(!showChatArea);
            };

            return (
              <DataProvider>
                <SelectedTableProvider>
                  <div className="flex overflow-hidden transition-all duration-500 ease-in-out">
                    <Navbar isOpen={showSidebar} setIsOpen={setShowSidebar} />
                    <ToggleChat onToggle={handleShowChat} />
                    <SideBar isOpen={showSidebar} setIsOpen={setShowSidebar} />
                    <div className="flex-1 overflow-x-auto">
                      <MainContent showChat={showChatArea} />
                    </div>
                  </div>
                </SelectedTableProvider>
              </DataProvider>
            );
          };

          export default Page;

        --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ signin
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ page.tsx (0.01 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          /* eslint-disable @typescript-eslint/no-explicit-any */
          "use client";

          import { useState } from "react";
          import { useRouter } from "next/navigation";
          import { Input } from "@/components/ui/input";
          import { Button } from "@/components/ui/button";
          import { Label } from "@/components/ui/label";
          import {
            Card,
            CardContent,
            CardDescription,
            CardHeader,
            CardTitle,
          } from "@/components/ui/card";
          import { SunIcon, MoonIcon, HomeIcon } from "lucide-react";
          import { useTheme } from "@/context/ThemeProvider";
          import clsx from "clsx";
          import { registerUser, loginUser } from "../../api/AuthApi";
          import { useUser } from "@/context/AuthProvider";
          import { motion } from "framer-motion";

          type FormData = {
            username: string;
            email: string;
            password: string;
            password2: string;
            rememberMe: boolean;
          };

          const AuthForm = () => {
            const [isSignUp, setIsSignUp] = useState(false);
            const [error, setError] = useState("");
            const [formData, setFormData] = useState<FormData>({
              username: "",
              email: "",
              password: "",
              password2: "",
              rememberMe: false,
            });

            const { theme, toggleTheme } = useTheme();
            const router = useRouter();
            const { refreshUser } = useUser();

            const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
              const { name, value, type, checked } = e.target;
              setFormData((prev) => ({
                ...prev,
                [name]: type === "checkbox" ? checked : value,
              }));
              if (error) setError("");
            };

            const toggleAuthMode = () => {
              setIsSignUp((prev) => !prev);
              setError("");
              setFormData({
                username: "",
                email: "",
                password: "",
                password2: "",
                rememberMe: false,
              });
            };

            const handleSubmit = async (e: React.FormEvent) => {
              e.preventDefault();

              try {
                if (isSignUp) {
                  if (formData.password !== formData.password2) {
                    setError("Passwords do not match");
                    return;
                  }

                  await registerUser({
                    username: formData.username,
                    email: formData.email,
                    password: formData.password,
                    password2: formData.password2,
                  });
                } else {
                  const result = await loginUser({
                    username: formData.username,
                    password: formData.password,
                  });
                  if (!result.success) {
                    setError(result.error || "Invalid username or password");
                    return;
                  }
                }

                await refreshUser();
                router.push("/chat");
              } catch (err: any) {
                // fallback for unexpected errors
                setError("An unexpected error occurred. Please try again.");
              }
            };

            // Enhanced gradient color scheme
            const cardClasses = clsx(
              "w-[90%] max-w-[500px] rounded-xl shadow-2xl transition-all duration-300 border",
              theme === "dark"
                ? "bg-gradient-to-br from-gray-800/90 via-gray-800/80 to-gray-900/90 border-gray-700 backdrop-blur-sm"
                : "bg-gradient-to-br from-white/95 via-blue-50/90 to-white/95 border-gray-200/80 backdrop-blur-sm"
            );

            const textColor = theme === "dark" ? "text-gray-100" : "text-gray-800";
            const secondaryTextColor =
              theme === "dark" ? "text-gray-400" : "text-gray-600";
            const gradientText = clsx(
              "bg-clip-text text-transparent font-bold",
              theme === "dark"
                ? "bg-gradient-to-r from-blue-400 via-teal-400 to-emerald-400"
                : "bg-gradient-to-r from-blue-600 via-teal-500 to-emerald-500"
            );

            const inputClasses = clsx(
              "transition-all duration-300",
              theme === "dark"
                ? "bg-gray-700/40 border-gray-600 text-white focus:border-blue-400 focus:ring-2 focus:ring-blue-500/50"
                : "bg-white/80 border-gray-300 focus:border-blue-400 focus:ring-2 focus:ring-blue-500/30",
              "placeholder-gray-500/60"
            );

            const buttonClasses = clsx(
              "w-full font-semibold py-3 rounded-lg transition-all duration-300 group",
              theme === "dark"
                ? "bg-gradient-to-r from-blue-600 via-teal-500 to-emerald-500 hover:from-blue-700 hover:via-teal-600 hover:to-emerald-600"
                : "bg-gradient-to-r from-blue-500 via-teal-400 to-emerald-400 hover:from-blue-600 hover:via-teal-500 hover:to-emerald-500",
              "text-white shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.99]",
              "relative overflow-hidden"
            );

            return (
              <div
                className={clsx(
                  "min-h-screen flex items-center justify-center p-4 transition-colors duration-300 relative overflow-hidden",
                  theme === "dark"
                    ? "bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900"
                    : "bg-gradient-to-br from-gray-50 via-blue-50/70 to-gray-50"
                )}
              >
                {/* Animated gradient background elements */}
                <div className="fixed inset-0 overflow-hidden pointer-events-none">
                  <div className="absolute top-1/4 -left-20 w-96 h-96 rounded-full bg-gradient-to-r from-blue-400/20 to-emerald-400/20 blur-3xl animate-float opacity-70"></div>
                  <div className="absolute bottom-1/3 -right-20 w-96 h-96 rounded-full bg-gradient-to-r from-teal-400/20 to-blue-400/20 blur-3xl animate-float-delay opacity-70"></div>
                  <div className="absolute top-1/2 right-1/4 w-64 h-64 rounded-full bg-gradient-to-r from-emerald-400/20 to-teal-400/20 blur-3xl animate-float-delay-2 opacity-60"></div>
                </div>

                {/* Glowing orb decoration */}
                <div className="fixed top-1/4 left-1/4 w-32 h-32 rounded-full bg-blue-500/10 blur-3xl animate-pulse-slow"></div>
                <div className="fixed bottom-1/4 right-1/4 w-40 h-40 rounded-full bg-teal-500/10 blur-3xl animate-pulse-slow-delay"></div>

                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5 }}
                  className="absolute top-4 left-4 z-20"
                >
                  <Button
                    variant="outline"
                    size="icon"
                    onClick={() => router.push("/")}
                    className={clsx(
                      "rounded-full backdrop-blur-sm",
                      theme === "dark"
                        ? "bg-gray-800/50 text-blue-400 border-gray-700 hover:bg-gray-700/60"
                        : "bg-white/70 text-blue-600 border-gray-300 hover:bg-gray-200/70"
                    )}
                  >
                    <HomeIcon className="h-5 w-5" />
                    <span className="sr-only">Go to Home</span>
                  </Button>
                </motion.div>

                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5, delay: 0.1 }}
                  className="absolute top-4 right-4 z-20"
                >
                  <Button
                    variant="outline"
                    size="icon"
                    onClick={toggleTheme}
                    className={clsx(
                      "rounded-full backdrop-blur-sm",
                      theme === "dark"
                        ? "bg-gray-800/50 text-blue-400 border-gray-700 hover:bg-gray-700/60"
                        : "bg-white/70 text-blue-600 border-gray-300 hover:bg-gray-200/70"
                    )}
                  >
                    {theme === "dark" ? (
                      <SunIcon className="h-5 w-5" />
                    ) : (
                      <MoonIcon className="h-5 w-5" />
                    )}
                    <span className="sr-only">Toggle theme</span>
                  </Button>
                </motion.div>

                <motion.div
                  initial={{ opacity: 0, scale: 0.95 }}
                  animate={{ opacity: 1, scale: 1 }}
                  transition={{ duration: 0.5, delay: 0.2 }}
                  className="w-full flex justify-center z-10"
                >
                  <Card className={cardClasses}>
                    <CardHeader className="text-center">
                      <motion.div
                        initial={{ opacity: 0, y: -20 }}
                        animate={{ opacity: 1, y: 0 }}
                        transition={{ duration: 0.5, delay: 0.3 }}
                      >
                        <CardTitle
                          className={clsx("text-3xl font-bold mb-2", gradientText)}
                        >
                          {isSignUp ? "Create an Account" : "Welcome Back"}
                        </CardTitle>
                        <CardDescription className={clsx("text-sm", secondaryTextColor)}>
                          {isSignUp
                            ? "Join FinBot today and take control of your finances"
                            : "Sign in to continue your financial journey"}
                        </CardDescription>
                      </motion.div>
                    </CardHeader>

                    <CardContent className="space-y-6 p-6 sm:p-8">
                      {error && (
                        <motion.div
                          initial={{ opacity: 0, y: -10 }}
                          animate={{ opacity: 1, y: 0 }}
                          className={clsx(
                            "flex items-center gap-2 p-3 rounded-lg text-sm border backdrop-blur-sm",
                            theme === "dark"
                              ? "bg-red-900/30 text-red-300 border-red-800/50"
                              : "bg-red-50 text-red-700 border-red-200"
                          )}
                        >
                          {error}
                        </motion.div>
                      )}

                      <form onSubmit={handleSubmit} className="space-y-5">
                        <motion.div
                          initial={{ opacity: 0 }}
                          animate={{ opacity: 1 }}
                          transition={{ duration: 0.5 }}
                          className="space-y-1"
                        >
                          <Label
                            htmlFor="username"
                            className={clsx("text-sm font-medium", textColor)}
                          >
                            Username
                          </Label>
                          <Input
                            id="username"
                            name="username"
                            type="text"
                            required
                            value={formData.username}
                            onChange={handleInputChange}
                            className={inputClasses}
                            placeholder="Enter your username"
                          />
                        </motion.div>

                        {isSignUp && (
                          <motion.div
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            transition={{ duration: 0.5 }}
                            className="space-y-1"
                          >
                            <Label
                              htmlFor="email"
                              className={clsx("text-sm font-medium", textColor)}
                            >
                              Email
                            </Label>
                            <Input
                              id="email"
                              name="email"
                              type="email"
                              required
                              value={formData.email}
                              onChange={handleInputChange}
                              className={inputClasses}
                              placeholder="Enter your email"
                            />
                          </motion.div>
                        )}

                        <motion.div
                          initial={{ opacity: 0 }}
                          animate={{ opacity: 1 }}
                          transition={{ duration: 0.5 }}
                          className="space-y-1"
                        >
                          <Label
                            htmlFor="password"
                            className={clsx("text-sm font-medium", textColor)}
                          >
                            Password
                          </Label>
                          <Input
                            id="password"
                            name="password"
                            type="password"
                            required
                            value={formData.password}
                            onChange={handleInputChange}
                            className={inputClasses}
                            placeholder="Enter your password"
                          />
                        </motion.div>

                        {isSignUp && (
                          <motion.div
                            initial={{ opacity: 0 }}
                            animate={{ opacity: 1 }}
                            transition={{ duration: 0.5 }}
                            className="space-y-1"
                          >
                            <Label
                              htmlFor="password2"
                              className={clsx("text-sm font-medium", textColor)}
                            >
                              Confirm Password
                            </Label>
                            <Input
                              id="password2"
                              name="password2"
                              type="password"
                              required
                              value={formData.password2}
                              onChange={handleInputChange}
                              className={inputClasses}
                              placeholder="Confirm your password"
                            />
                          </motion.div>
                        )}

                        <motion.div
                          initial={{ opacity: 0, y: 20 }}
                          animate={{ opacity: 1, y: 0 }}
                          transition={{ duration: 0.5, delay: 0.8 }}
                          className="pt-2"
                        >
                          <Button type="submit" className={buttonClasses}>
                            <span className="relative z-10">
                              {isSignUp ? "Create Account" : "Sign In"}
                            </span>
                            <span
                              className={clsx(
                                "absolute inset-0 bg-gradient-to-r opacity-0 group-hover:opacity-10 transition-opacity duration-300",
                                theme === "dark"
                                  ? "from-white to-white"
                                  : "from-white to-white"
                              )}
                            ></span>
                          </Button>
                        </motion.div>
                      </form>

                      <motion.p
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        transition={{ duration: 0.5, delay: 0.9 }}
                        className={clsx("text-center text-sm", secondaryTextColor)}
                      >
                        {isSignUp ? "Already have an account?" : "Don't have an account?"}{" "}
                        <button
                          type="button"
                          onClick={toggleAuthMode}
                          className={clsx(
                            "font-medium hover:underline transition-colors duration-300",
                            theme === "dark"
                              ? "text-blue-400 hover:text-blue-300"
                              : "text-blue-600 hover:text-blue-500"
                          )}
                        >
                          {isSignUp ? "Sign In" : "Sign Up"}
                        </button>
                      </motion.p>
                    </CardContent>
                  </Card>
                </motion.div>

                {/* Add this to your global CSS or styles */}
                <style jsx global>{`
                  @keyframes float {
                    0% {
                      transform: translateY(0) rotate(0deg);
                    }
                    50% {
                      transform: translateY(-20px) rotate(5deg);
                    }
                    100% {
                      transform: translateY(0) rotate(0deg);
                    }
                  }
                  @keyframes pulse-slow {
                    0%,
                    100% {
                      opacity: 0.5;
                    }
                    50% {
                      opacity: 0.8;
                    }
                  }
                  .animate-float {
                    animation: float 12s ease-in-out infinite;
                  }
                  .animate-float-delay {
                    animation: float 12s ease-in-out infinite 3s;
                  }
                  .animate-float-delay-2 {
                    animation: float 12s ease-in-out infinite 6s;
                  }
                  .animate-pulse-slow {
                    animation: pulse-slow 8s ease-in-out infinite;
                  }
                  .animate-pulse-slow-delay {
                    animation: pulse-slow 8s ease-in-out infinite 2s;
                  }
                `}</style>
              </div>
            );
          };

          export default AuthForm;

        --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ users
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ page.tsx (0.01 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client";

          import { useState, useEffect } from "react";
          import {
            getUsersList,
            getFriendsList,
            manageFriend,
            getSelfDetail,
          } from "@/api/AuthApi";
          import Navbar from "@/components/Navbar";

          interface User {
            id: number;
            username: string;
            email: string;
            first_name: string;
            last_name: string;
          }

          interface Friend extends User {
            isFriend: boolean;
            added_by_me?: boolean;
            isMe?: boolean;
          }

          export default function UsersPage() {
            const [friends, setFriends] = useState<Friend[]>([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState("");
            const [activeTab, setActiveTab] = useState<"all" | "friends">("all");
            const [showDummySidebar, setShowDummySidebar] = useState(false);
            const [currentUser, setCurrentUser] = useState<User | null>(null);

            useEffect(() => {
              const fetchCurrentUser = async () => {
                const response = await getSelfDetail();
                if (response.success && response.data) {
                  setCurrentUser(response.data);
                }
              };
              fetchCurrentUser();
            }, []);

            const fetchData = async () => {
              try {
                setLoading(true);
                // Fetch users first
                const usersResponse = await getUsersList();
                if (usersResponse.success && usersResponse.data) {
                  const usersData = usersResponse.data;

                  // Then fetch friends
                  const friendsResponse = await getFriendsList();
                  if (friendsResponse.success && friendsResponse.data) {
                    const friendsList = friendsResponse.data.data || [];

                    // Mark users as friends and set added_by_me status
                    const usersWithFriendStatus = usersData.map((user: User) => {
                      const friendInfo = friendsList.find(
                        (friend: Friend) => friend.id === user.id
                      );
                      return {
                        ...user,
                        isFriend: !!friendInfo,
                        added_by_me: friendInfo?.added_by_me,
                        isMe: currentUser ? user.id === currentUser.id : false,
                      };
                    });

                    setFriends(usersWithFriendStatus);
                  } else {
                    setError(friendsResponse.error || "Failed to fetch friends");
                  }
                } else {
                  setError(usersResponse.error || "Failed to fetch users");
                }
              } catch (err) {
                setError("Failed to fetch data");
                console.error(err);
              } finally {
                setLoading(false);
              }
            };

            useEffect(() => {
              if (currentUser) {
                fetchData();
              }
            }, [currentUser]);

            const refetchUsers = () => {
              fetchData();
            };

            const handleFriendAction = async (
              userId: number,
              action: "add" | "remove"
            ) => {
              try {
                const response = await manageFriend({
                  friend_id: userId,
                  action: action,
                });

                if (response.success) {
                  // Update friends list
                  setFriends((prevFriends) =>
                    prevFriends.map((friend) =>
                      friend.id === userId
                        ? { ...friend, isFriend: action === "add" }
                        : friend
                    )
                  );
                } else {
                  setError(response.error || `Failed to ${action} friend`);
                }
              } catch (err) {
                setError(`Failed to ${action} friend`);
                console.error(err);
              }
            };

            const filteredUsers =
              activeTab === "friends" ? friends.filter((user) => user.isFriend) : friends;

            if (loading) {
              return (
                <>
                  <Navbar isOpen={showDummySidebar} setIsOpen={setShowDummySidebar} />
                  <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-900 dark:to-gray-800 p-8">
                    <div className="max-w-4xl mx-auto">
                      <div className="flex items-center justify-center h-[60vh]">
                        <div className="animate-spin rounded-full h-16 w-16 border-4 border-blue-500 border-t-transparent"></div>
                      </div>
                    </div>
                  </div>
                </>
              );
            }

            return (
              <>
                <Navbar isOpen={showDummySidebar} setIsOpen={setShowDummySidebar} />
                <div className="min-h-screen bg-gradient-to-br from-gray-50 via-white to-gray-100 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 pt-20 mt-20 p-4 md:p-8">
                  <div className="max-w-4xl mx-auto">
                    {/* Header Section */}
                    <div className="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-8">
                      <div>
                        <h1 className="text-3xl md:text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-500 dark:from-blue-400 dark:to-indigo-400 bg-clip-text text-transparent">
                          Users & Friends
                        </h1>
                        <p className="text-gray-500 dark:text-gray-400 mt-1">
                          {activeTab === "friends"
                            ? "Manage your connections"
                            : "Discover new people"}
                        </p>
                      </div>
                      <div className="flex space-x-1 bg-white dark:bg-gray-800 p-1 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                        <button
                          onClick={() => setActiveTab("all")}
                          className={`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-300 ${
                            activeTab === "all"
                              ? "bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-md"
                              : "text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"
                          }`}
                        >
                          All Users
                        </button>
                        <button
                          onClick={() => setActiveTab("friends")}
                          className={`px-4 py-2 text-sm font-medium rounded-lg transition-all duration-300 ${
                            activeTab === "friends"
                              ? "bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow-md"
                              : "text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700"
                          }`}
                        >
                          My Friends
                        </button>
                      </div>
                    </div>

                    {/* Error Message */}
                    {error && (
                      <div className="bg-red-50 dark:bg-red-900/20 border-l-4 border-red-500 dark:border-red-400 text-red-700 dark:text-red-200 px-4 py-3 rounded-lg mb-6 shadow-sm transform transition-all duration-300 hover:scale-[1.01]">
                        <div className="flex items-center">
                          <svg
                            className="w-5 h-5 mr-3 flex-shrink-0"
                            fill="currentColor"
                            viewBox="0 0 20 20"
                          >
                            <path
                              fillRule="evenodd"
                              d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                              clipRule="evenodd"
                            />
                          </svg>
                          <span>{error}</span>
                        </div>
                      </div>
                    )}

                    {/* Users List */}
                    <div className="bg-white dark:bg-gray-800 rounded-2xl shadow-lg overflow-hidden border border-gray-100 dark:border-gray-700 transition-all duration-300 hover:shadow-xl">
                      {filteredUsers.length === 0 ? (
                        <div className="text-center py-16 px-4">
                          <div className="w-20 h-20 mx-auto mb-6 text-gray-300 dark:text-gray-600">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path
                                strokeLinecap="round"
                                strokeLinejoin="round"
                                strokeWidth="1.5"
                                d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
                              />
                            </svg>
                          </div>
                          <h3 className="text-lg font-medium text-gray-700 dark:text-gray-300 mb-2">
                            {activeTab === "friends"
                              ? "No friends yet"
                              : "No users found"}
                          </h3>
                          <p className="text-gray-500 dark:text-gray-400 max-w-md mx-auto">
                            {activeTab === "friends"
                              ? "Start adding friends to see them here"
                              : "Try adjusting your search or check back later"}
                          </p>
                          {activeTab === "all" && (
                            <button
                              onClick={() => refetchUsers()}
                              className="mt-4 px-4 py-2 bg-blue-50 dark:bg-gray-700 text-blue-600 dark:text-blue-300 rounded-lg text-sm font-medium hover:bg-blue-100 dark:hover:bg-gray-600 transition-colors"
                            >
                              Refresh Users
                            </button>
                          )}
                        </div>
                      ) : (
                        <ul className="divide-y divide-gray-100 dark:divide-gray-700">
                          {filteredUsers.map((user) => (
                            <li
                              key={user.id}
                              className="p-4 hover:bg-gray-50 dark:hover:bg-gray-700/30 transition-colors duration-200"
                            >
                              <div className="flex items-center justify-between">
                                <div className="flex items-center space-x-4">
                                  <div className="relative">
                                    <div className="w-12 h-12 rounded-full bg-gradient-to-r from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 flex items-center justify-center overflow-hidden">
                                      <span className="text-xl font-medium text-blue-600 dark:text-blue-300">
                                        {user.username.charAt(0).toUpperCase()}
                                      </span>
                                    </div>
                                  </div>
                                  <div>
                                    <h3 className="font-medium text-gray-900 dark:text-white">
                                      {user.username}
                                      {user.isMe && (
                                        <span className="ml-2 px-2 py-0.5 bg-blue-100 dark:bg-blue-900/50 text-blue-800 dark:text-blue-300 text-xs rounded-full">
                                          me
                                        </span>
                                      )}
                                      {user.isFriend && !user.isMe && (
                                        <span className="ml-2 px-2 py-0.5 bg-green-100 dark:bg-green-900/50 text-green-800 dark:text-green-300 text-xs rounded-full">
                                          {user.added_by_me ? "Friend" : "Added you"}
                                        </span>
                                      )}
                                    </h3>
                                    <p className="text-sm text-gray-500 dark:text-gray-400">
                                      {user.email}
                                    </p>
                                  </div>
                                </div>
                                <button
                                  onClick={() =>
                                    handleFriendAction(
                                      user.id,
                                      user.isFriend ? "remove" : "add"
                                    )
                                  }
                                  disabled={user.isFriend && !user.added_by_me}
                                  className={`px-4 py-2 rounded-lg transition-all duration-300 flex items-center space-x-2 text-sm font-medium ${
                                    user.isFriend
                                      ? user.added_by_me
                                        ? "bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-300 hover:bg-red-100 dark:hover:bg-red-900/30"
                                        : "bg-gray-50 dark:bg-gray-900/20 text-gray-600 dark:text-gray-300 cursor-not-allowed"
                                      : "bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 hover:bg-blue-100 dark:hover:bg-blue-900/30"
                                  }`}
                                >
                                  {user.isFriend ? (
                                    <>
                                      {user.added_by_me ? (
                                        <svg
                                          className="w-4 h-4"
                                          fill="none"
                                          stroke="currentColor"
                                          viewBox="0 0 24 24"
                                        >
                                          <path
                                            strokeLinecap="round"
                                            strokeLinejoin="round"
                                            strokeWidth="2"
                                            d="M6 18L18 6M6 6l12 12"
                                          />
                                        </svg>
                                      ) : (
                                        ""
                                      )}
                                      <span>
                                        {user.added_by_me ? "Remove" : "Added you"}
                                      </span>
                                    </>
                                  ) : (
                                    <>
                                      {!user.isMe ? (
                                        <>
                                          <svg
                                            className="w-4 h-4"
                                            fill="none"
                                            stroke="currentColor"
                                            viewBox="0 0 24 24"
                                          >
                                            <path
                                              strokeLinecap="round"
                                              strokeLinejoin="round"
                                              strokeWidth="2"
                                              d="M12 4v16m8-8H4"
                                            />
                                          </svg>
                                          <span>Add Friend</span>
                                        </>
                                      ) : (
                                        <span>You</span>
                                      )}
                                    </>
                                  )}
                                </button>
                              </div>
                            </li>
                          ))}
                        </ul>
                      )}
                    </div>
                  </div>
                </div>
              </>
            );
          }

        --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ utils
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ csrf.ts (0.17 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        export function getCSRFToken(): string | null {
          const match = document.cookie.match(/(^|;)\s*csrftoken=([^;]*)/);
          return match ? decodeURIComponent(match[2]) : null;
        }
      --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ components
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ MainContent.tsx (2.12 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import React from "react";
        import ChatArea from "./chat/ChatAreaReal"; //use ChatAreaReal after integration of Api
        import ShowTable from "./MainComponents/ShowTable";
        import { useTheme } from "@/context/ThemeProvider";

        const MainContent = ({ showChat }: { showChat: boolean }) => {
          const { theme } = useTheme();

          return (
            <div
              className={`flex flex-col lg:flex-row h-screen w-full ${
                theme === "dark" ? "bg-gray-900" : "bg-gray-100"
              } transition-colors duration-500 ease-in-out overflow-hidden`}
            >
              {/* Main Table Area */}
              <div
                className={`${
                  showChat ? "lg:w-3/5" : "w-full"
                } h-full overflow-hidden pt-[5vh] transition-all duration-500 ease-in-out`}
              >
                <div className="h-full flex flex-col">
                  <div
                    className={`${
                      showChat
                        ? "hidden lg:block translate-x-0"
                        : "-translate-x-full lg:translate-x-0"
                    } py-6 lg:py-10 h-screen overflow-hidden transition-all duration-500 ease-in-out transform ${
                      showChat ? "translate-x-0" : "-translate-x-full"
                    }`}
                  >
                    <ShowTable />
                  </div>
                </div>
              </div>

              {/* Chat Area - conditionally rendered and responsive */}
              {showChat && (
                <>
                  {/* Mobile overlay backdrop */}
                  <div className="lg:hidden fixed inset-0 bg-black bg-opacity-50 z-0 transition-opacity duration-500 ease-in-out" />

                  <div
                    className={`fixed lg:relative inset-0 lg:inset-auto lg:w-2/5 z-10 ${
                      theme === "dark" ? "bg-gray-800" : "bg-white"
                    } shadow-xl lg:shadow-none transition-all duration-500 ease-in-out transform ${
                      showChat ? "translate-x-0" : "translate-x-full"
                    }`}
                  >
                    <div
                      className={`h-full flex flex-col border-l ${
                        theme === "dark" ? "border-gray-700" : "border-gray-200"
                      } transition-colors duration-500 ease-in-out`}
                    >
                      <ChatArea />
                    </div>
                  </div>
                </>
              )}
            </div>
          );
        };

        export default MainContent;

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ Navbar.tsx (0.01 MB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        "use client";
        import React, { useState } from "react";
        import Image from "next/image";
        import { LuSunDim } from "react-icons/lu";
        import { HiMoon } from "react-icons/hi2";
        import {
          HiMenu,
          HiX,
          HiLogout,
          HiUser,
          HiCog,
          HiUserGroup,
          HiChat,
        } from "react-icons/hi";
        import { useTheme } from "@/context/ThemeProvider";
        import { useUser } from "@/context/AuthProvider";
        import { useRouter, usePathname } from "next/navigation";
        import SettingsModal from "./SettingsModal";
        import { createPortal } from "react-dom";

        interface SideBarProps {
          isOpen: boolean;
          setIsOpen: (isOpen: boolean) => void;
        }

        const Navbar = ({ isOpen, setIsOpen }: SideBarProps) => {
          const { theme, toggleTheme } = useTheme();
          const { user, signOut } = useUser();
          const [showUserMenu, setShowUserMenu] = useState(false);
          const [showSettingsModal, setShowSettingsModal] = useState(false);
          const router = useRouter();
          const pathname = usePathname();

          const handleSignOut = () => {
            signOut();
            setShowUserMenu(false);
          };

          const handleFriendsClick = () => {
            router.push("/users");
          };

          const handleChatClick = () => {
            router.push("/chat");
          };

          return (
            <>
              <nav
                className={`fixed top-0 left-0 w-full flex justify-between items-center h-16 md:h-20 px-4 sm:px-6 lg:px-8 z-[1010] transition-all duration-500 ease-in-out ${
                  theme === "dark"
                    ? "bg-gray-900/95 backdrop-blur-sm border-gray-800"
                    : "bg-white/95 backdrop-blur-sm border-gray-200"
                } border-b shadow-lg`}
              >
                {/* When sidebar is open, show toggle button first */}
                {isOpen ? (
                  <div className="flex justify-between">
                    <div
                      onClick={() => router.push("/")}
                      className={`mr-12 w-32 md:w-40 lg:w-48 transition-all duration-500 ease-in-out hover:scale-105 cursor-pointer ${
                        isOpen ? "mx-auto" : ""
                      }`}
                    >
                      <Image
                        src="/image.png"
                        alt="Logo"
                        width={192}
                        height={48}
                        className="w-full h-auto transition-opacity duration-500"
                        priority
                      />
                    </div>
                    <button
                      onClick={() => setIsOpen(!isOpen)}
                      className={`ml-12 p-2 rounded-lg transition-all duration-500 ease-in-out lg:hidden ${
                        theme === "dark"
                          ? "bg-gray-800/80 text-white hover:bg-gray-700 hover:scale-105"
                          : "bg-gray-50/80 text-gray-900 hover:bg-gray-100 hover:scale-105"
                      } shadow-lg border ${
                        theme === "dark" ? "border-gray-700" : "border-gray-200"
                      }`}
                      aria-label="Toggle menu"
                    >
                      <HiX
                        size={22}
                        className="transition-all duration-500 ease-in-out"
                      />
                    </button>
                  </div>
                ) : (
                  <div className="flex">
                    <button
                      onClick={() => setIsOpen(!isOpen)}
                      className={`p-2 rounded-lg transition-all duration-500 ease-in-out lg:hidden ${
                        theme === "dark"
                          ? "bg-gray-800/80 text-white hover:bg-gray-700 hover:scale-105"
                          : "bg-gray-50/80 text-gray-900 hover:bg-gray-100 hover:scale-105"
                      } shadow-lg border ${
                        theme === "dark" ? "border-gray-700" : "border-gray-200"
                      }`}
                      aria-label="Toggle menu"
                    >
                      <HiMenu
                        size={22}
                        className="transition-all duration-500 ease-in-out"
                      />
                    </button>

                    <div
                      onClick={() => router.push("/")}
                      className={`w-32 md:w-40 lg:w-48 transition-all duration-500 ease-in-out hover:scale-105 cursor-pointer ${
                        isOpen ? "mx-auto" : ""
                      }`}
                    >
                      <Image
                        src="/image.png"
                        alt="Logo"
                        width={192}
                        height={48}
                        className="w-full h-auto transition-opacity duration-500"
                        priority
                      />
                    </div>
                  </div>
                )}

                <div className="flex items-center space-x-2 md:space-x-4">
                  {/* Chat Button */}
                  {pathname !== "/chat" && (
                    <button
                      onClick={handleChatClick}
                      className={`p-2 rounded-full transition-all duration-500 ease-in-out ${
                        theme === "dark"
                          ? "bg-gray-700/80 text-white hover:bg-gray-600 hover:scale-110"
                          : "bg-gray-100/80 text-gray-900 hover:bg-gray-200 hover:scale-110"
                      } shadow-lg flex items-center justify-center`}
                      aria-label="Chat"
                    >
                      <HiChat
                        size={20}
                        className="transition-all duration-500 ease-in-out hover:rotate-12"
                      />
                    </button>
                  )}

                  {/* Friends Button */}
                  {pathname !== "/users" && (
                    <button
                      onClick={handleFriendsClick}
                      className={`p-2 rounded-full transition-all duration-500 ease-in-out ${
                        theme === "dark"
                          ? "bg-gray-700/80 text-white hover:bg-gray-600 hover:scale-110"
                          : "bg-gray-100/80 text-gray-900 hover:bg-gray-200 hover:scale-110"
                      } shadow-lg flex items-center justify-center`}
                      aria-label="Friends"
                    >
                      <HiUserGroup
                        size={20}
                        className="transition-all duration-500 ease-in-out hover:rotate-12"
                      />
                    </button>
                  )}

                  {/* Theme Toggle */}
                  <button
                    onClick={() => toggleTheme()}
                    className={`p-2 rounded-full transition-all duration-500 ease-in-out ${
                      theme === "dark"
                        ? "bg-gray-700/80 text-amber-300 hover:bg-gray-600 hover:scale-110"
                        : "bg-gray-100/80 text-indigo-600 hover:bg-gray-200 hover:scale-110"
                    } shadow-lg flex items-center justify-center`}
                    aria-label="Toggle theme"
                  >
                    {theme === "dark" ? (
                      <LuSunDim
                        size={20}
                        className="transition-all duration-500 ease-in-out hover:rotate-45"
                      />
                    ) : (
                      <HiMoon
                        size={20}
                        className="transition-all duration-500 ease-in-out hover:-rotate-45"
                      />
                    )}
                  </button>

                  {/* User Menu */}
                  {user && (
                    <div className="relative">
                      <button
                        onClick={() => setShowUserMenu(!showUserMenu)}
                        className={`flex items-center space-x-2 p-2 rounded-lg transition-all duration-500 ease-in-out ${
                          theme === "dark"
                            ? "bg-gray-700/80 text-white hover:bg-gray-600 hover:scale-105"
                            : "bg-gray-100/80 text-gray-900 hover:bg-gray-200 hover:scale-105"
                        } shadow-lg border ${
                          theme === "dark" ? "border-gray-600" : "border-gray-200"
                        }`}
                        aria-label="User menu"
                      >
                        <HiUser
                          size={18}
                          className="transition-all duration-500 ease-in-out"
                        />
                        <span className="hidden sm:block text-sm font-medium transition-all duration-500 ease-in-out">
                          {user.name || user.username}
                        </span>
                      </button>

                      {/* User Dropdown Menu */}
                      {showUserMenu && (
                        <div
                          className={`absolute right-0 mt-2 w-48 rounded-lg shadow-xl transition-all duration-500 ease-in-out transform origin-top-right ${
                            theme === "dark"
                              ? "bg-gray-800/95 backdrop-blur-sm border-gray-700"
                              : "bg-white/95 backdrop-blur-sm border-gray-200"
                          } border z-50`}
                        >
                          <div className="py-1">
                            {/* User Info */}
                            <div
                              className={`px-4 py-3 border-b transition-colors duration-500 ease-in-out ${
                                theme === "dark" ? "border-gray-700" : "border-gray-200"
                              }`}
                            >
                              <p
                                className={`text-sm font-medium transition-colors duration-500 ease-in-out ${
                                  theme === "dark" ? "text-white" : "text-gray-900"
                                }`}
                              >
                                {user.name || user.username}
                              </p>
                              <p
                                className={`text-xs transition-colors duration-500 ease-in-out ${
                                  theme === "dark" ? "text-gray-400" : "text-gray-600"
                                }`}
                              >
                                {user.email}
                              </p>
                            </div>

                            {/* Settings */}
                            <button
                              onClick={() => {
                                setShowSettingsModal(true);
                                setShowUserMenu(false);
                              }}
                              className={`w-full flex items-center px-4 py-2 text-sm transition-all duration-500 ease-in-out ${
                                theme === "dark"
                                  ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                  : "text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                              }`}
                            >
                              <HiCog className="mr-3 h-4 w-4 transition-transform duration-500 ease-in-out hover:rotate-45" />
                              Settings
                            </button>

                            {/* Sign Out */}
                            <button
                              onClick={handleSignOut}
                              className={`w-full flex items-center px-4 py-2 text-sm transition-all duration-500 ease-in-out ${
                                theme === "dark"
                                  ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                  : "text-gray-700 hover:bg-gray-100 hover:text-gray-900"
                              }`}
                            >
                              <HiLogout className="mr-3 h-4 w-4 transition-transform duration-500 ease-in-out hover:rotate-12" />
                              Sign Out
                            </button>
                          </div>
                        </div>
                      )}
                    </div>
                  )}
                </div>

                {/* Click outside to close user menu */}
                {showUserMenu && (
                  <div
                    className="fixed inset-0 z-40 transition-opacity duration-500 ease-in-out"
                    onClick={() => setShowUserMenu(false)}
                  />
                )}
              </nav>

              {/* Settings Modal */}
              {typeof window !== "undefined" &&
                createPortal(
                  <SettingsModal
                    isOpen={showSettingsModal}
                    onClose={() => {
                      setTimeout(() => {
                        setShowSettingsModal(false);
                      }, 300);
                    }}
                  />,
                  document.body
                )}
            </>
          );
        };

        export default Navbar;

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ ProtectedRoute.tsx (1.45 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        "use client";
        import { useEffect } from "react";
        import { useRouter } from "next/navigation";
        import { useUser } from "@/context/AuthProvider";
        import { useTheme } from "@/context/ThemeProvider";
        import clsx from "clsx";

        interface ProtectedRouteProps {
          children: React.ReactNode;
        }

        const ProtectedRoute = ({ children }: ProtectedRouteProps) => {
          const { user, loading } = useUser();
          const { theme } = useTheme();
          const router = useRouter();

          useEffect(() => {
            if (!loading && !user) {
              router.push("/signin");
            }
          }, [user, loading, router]);

          // Show loading spinner while checking authentication
          if (loading) {
            return (
              <div
                className={clsx(
                  "min-h-screen flex items-center justify-center",
                  theme === "dark" ? "bg-gray-900" : "bg-gray-100"
                )}
              >
                <div className="flex flex-col items-center space-y-4">
                  <div
                    className={clsx(
                      "animate-spin rounded-full h-12 w-12 border-b-2",
                      theme === "dark" ? "border-blue-400" : "border-blue-600"
                    )}
                  />
                  <p
                    className={clsx(
                      "text-lg",
                      theme === "dark" ? "text-gray-300" : "text-gray-600"
                    )}
                  >
                    Loading...
                  </p>
                </div>
              </div>
            );
          }

          // Don't render children if not authenticated
          if (!user) {
            return null;
          }

          return <>{children}</>;
        };

        export default ProtectedRoute;

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ SettingsModal.tsx (0.02 MB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        "use client";
        import React, { useState, useEffect } from "react";
        import { useTheme } from "@/context/ThemeProvider";
        import { useUser } from "@/context/AuthProvider";
        import { HiX, HiUser, HiMail, HiKey, HiSun, HiMoon } from "react-icons/hi";
        import {
          getUserDetail,
          updateUserPassword,
          updateUserProfile,
          getSelfDetail,
        } from "@/api/AuthApi";

        interface SettingsModalProps {
          isOpen: boolean;
          onClose: () => void;
        }

        const SettingsModal = ({ isOpen, onClose }: SettingsModalProps) => {
          const { theme, toggleTheme } = useTheme();
          const { user, setUser } = useUser();
          const [activeTab, setActiveTab] = useState<"profile" | "security">("profile");
          const [formData, setFormData] = useState({
            username: "",
            email: "",
            currentPassword: "",
            newPassword: "",
            confirmPassword: "",
          });
          const [isLoading, setIsLoading] = useState(false);
          const [message, setMessage] = useState({ type: "", text: "" });

          // Check if user is logged in
          const isLoggedIn = () => {
            return localStorage.getItem("user") !== null;
          };

          useEffect(() => {
            const fetchUserDetails = async () => {
              if (isOpen && user?.id) {
                setIsLoading(true);
                try {
                  const response = await getUserDetail(user.id);
                  if (response.success && response.data) {
                    setFormData((prev) => ({
                      ...prev,
                      username: response.data.username || "",
                      email: response.data.email || "",
                    }));
                  } else {
                    setMessage({
                      type: "error",
                      text: response.error || "Failed to fetch user details",
                    });
                  }
                } catch (error) {
                  setMessage({
                    type: "error",
                    text: `An error occurred while fetching user details: ${error}`,
                  });
                } finally {
                  setIsLoading(false);
                }
              }
            };

            fetchUserDetails();
          }, [isOpen, user?.id]);

          const handleInputChange = (e: React.ChangeEvent<HTMLInputElement>) => {
            setFormData((prev) => ({
              ...prev,
              [e.target.name]: e.target.value,
            }));
          };

          const handleProfileUpdate = async (e: React.FormEvent) => {
            e.preventDefault();
            setIsLoading(true);
            setMessage({ type: "", text: "" });

            if (!formData.currentPassword) {
              setMessage({
                type: "error",
                text: "Current password is required to update profile",
              });
              setIsLoading(false);
              return;
            }

            try {
              const response = await updateUserProfile({
                email: formData.email,
                username: formData.username,
                password: formData.currentPassword,
              });

              if (response.success) {
                // Call getSelfDetail to update user data everywhere
                const userData = await getSelfDetail();
                if (userData.success && userData.data) {
                  // Update localStorage with new user data
                  localStorage.setItem("user", JSON.stringify(userData.data));
                  // Update user context
                  setUser(userData.data);
                }

                setMessage({
                  type: "success",
                  text: response.data.message || "Profile updated successfully",
                });
                // Clear password field
                setFormData((prev) => ({
                  ...prev,
                  currentPassword: "",
                }));
              } else {
                setMessage({
                  type: "error",
                  text: response.error || "Failed to update profile",
                });
              }
            } catch (error) {
              setMessage({
                type: "error",
                text: `An error occurred while updating profile: ${error}`,
              });
            } finally {
              setIsLoading(false);
            }
          };

          const handlePasswordUpdate = async (e: React.FormEvent) => {
            e.preventDefault();
            if (formData.newPassword !== formData.confirmPassword) {
              setMessage({ type: "error", text: "New passwords do not match" });
              return;
            }
            setIsLoading(true);
            setMessage({ type: "", text: "" });

            try {
              const response = await updateUserPassword({
                email: formData.email,
                username: formData.username,
                password: formData.currentPassword,
                newpassword: formData.newPassword,
                newpassword2: formData.confirmPassword,
              });

              if (response.success) {
                setMessage({
                  type: "success",
                  text: response.data.message || "Password updated successfully",
                });
                // Clear password fields
                setFormData((prev) => ({
                  ...prev,
                  currentPassword: "",
                  newPassword: "",
                  confirmPassword: "",
                }));
              } else {
                setMessage({
                  type: "error",
                  text: response.error || "Failed to update password",
                });
              }
            } catch (error) {
              setMessage({
                type: "error",
                text: `An error occurred while updating password: ${error}`,
              });
            } finally {
              setIsLoading(false);
            }
          };

          if (!isOpen) return null;

          return (
            <div className="fixed inset-0 z-[9999] flex items-center justify-center w-screen h-screen">
              {/* Overlay */}
              <div
                className={`fixed inset-0 bg-black/50 backdrop-blur-sm transition-all duration-300 ease-in-out ${
                  isOpen ? "opacity-100" : "opacity-0"
                }`}
                onClick={onClose}
                aria-hidden="true"
              />

              {/* Modal */}
              <div
                className={`fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl mx-4 rounded-xl shadow-2xl transition-all duration-300 ease-in-out transform ${
                  theme === "dark" ? "bg-gray-900 text-white" : "bg-white text-gray-900"
                } ${isOpen ? "opacity-100 scale-100" : "opacity-0 scale-95"}`}
              >
                {/* Header */}
                <div
                  className={`flex items-center justify-between p-6 border-b ${
                    theme === "dark" ? "border-gray-800" : "border-gray-200"
                  }`}
                >
                  <h2 className="text-2xl font-bold bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                    Settings
                  </h2>
                  <button
                    onClick={onClose}
                    className={`p-2 rounded-lg transition-all duration-300 ${
                      theme === "dark"
                        ? "hover:bg-gray-800 text-gray-400 hover:text-white"
                        : "hover:bg-gray-100 text-gray-500 hover:text-gray-900"
                    }`}
                  >
                    <HiX size={24} />
                  </button>
                </div>

                {/* Content */}
                <div className="p-6">
                  {message.text && (
                    <div
                      className={`mb-4 p-4 rounded-lg ${
                        message.type === "error"
                          ? "bg-red-100 text-red-700"
                          : "bg-green-100 text-green-700"
                      }`}
                    >
                      {message.text}
                    </div>
                  )}

                  {isLoggedIn() ? (
                    <>
                      {/* Tabs */}
                      <div
                        className={`flex border-b ${
                          theme === "dark" ? "border-gray-800" : "border-gray-200"
                        }`}
                      >
                        <button
                          onClick={() => setActiveTab("profile")}
                          className={`flex-1 py-4 text-center font-medium transition-all duration-300 ${
                            activeTab === "profile"
                              ? theme === "dark"
                                ? "bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent border-b-2 border-blue-500"
                                : "bg-gradient-to-r from-blue-600 to-purple-700 bg-clip-text text-transparent border-b-2 border-blue-600"
                              : theme === "dark"
                              ? "text-gray-400 hover:text-white"
                              : "text-gray-500 hover:text-gray-900"
                          }`}
                        >
                          Profile
                        </button>
                        <button
                          onClick={() => setActiveTab("security")}
                          className={`flex-1 py-4 text-center font-medium transition-all duration-300 ${
                            activeTab === "security"
                              ? theme === "dark"
                                ? "bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent border-b-2 border-blue-500"
                                : "bg-gradient-to-r from-blue-600 to-purple-700 bg-clip-text text-transparent border-b-2 border-blue-600"
                              : theme === "dark"
                              ? "text-gray-400 hover:text-white"
                              : "text-gray-500 hover:text-gray-900"
                          }`}
                        >
                          Security
                        </button>
                      </div>

                      {/* Profile and Security Forms */}
                      {activeTab === "profile" ? (
                        <form onSubmit={handleProfileUpdate} className="space-y-6">
                          <div className="space-y-4">
                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                Username
                              </label>
                              <div className="relative">
                                <div
                                  className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  <HiUser size={20} />
                                </div>
                                <input
                                  type="text"
                                  name="username"
                                  value={formData.username}
                                  onChange={handleInputChange}
                                  className={`w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300 ${
                                    theme === "dark"
                                      ? "bg-gray-800 border-gray-700 focus:border-blue-500"
                                      : "bg-gray-50 border-gray-200 focus:border-blue-500"
                                  }`}
                                />
                              </div>
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                Email
                              </label>
                              <div className="relative">
                                <div
                                  className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  <HiMail size={20} />
                                </div>
                                <input
                                  type="email"
                                  name="email"
                                  value={formData.email}
                                  onChange={handleInputChange}
                                  className={`w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300 ${
                                    theme === "dark"
                                      ? "bg-gray-800 border-gray-700 focus:border-blue-500"
                                      : "bg-gray-50 border-gray-200 focus:border-blue-500"
                                  }`}
                                />
                              </div>
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                Current Password
                              </label>
                              <div className="relative">
                                <div
                                  className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  <HiKey size={20} />
                                </div>
                                <input
                                  type="password"
                                  name="currentPassword"
                                  value={formData.currentPassword}
                                  onChange={handleInputChange}
                                  required
                                  className={`w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300 ${
                                    theme === "dark"
                                      ? "bg-gray-800 border-gray-700 focus:border-blue-500"
                                      : "bg-gray-50 border-gray-200 focus:border-blue-500"
                                  }`}
                                />
                              </div>
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                Theme
                              </label>
                              <button
                                type="button"
                                onClick={toggleTheme}
                                className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-300 ${
                                  theme === "dark"
                                    ? "bg-gray-800 hover:bg-gray-700"
                                    : "bg-gray-100 hover:bg-gray-200"
                                }`}
                              >
                                {theme === "dark" ? (
                                  <>
                                    <HiSun size={20} className="text-amber-400" />
                                    <span className="bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">
                                      Light Mode
                                    </span>
                                  </>
                                ) : (
                                  <>
                                    <HiMoon size={20} className="text-indigo-600" />
                                    <span className="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                      Dark Mode
                                    </span>
                                  </>
                                )}
                              </button>
                            </div>
                          </div>

                          <button
                            type="submit"
                            disabled={isLoading}
                            className={`w-full py-2 px-4 rounded-lg font-medium transition-all duration-300 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white ${
                              isLoading ? "opacity-50 cursor-not-allowed" : ""
                            }`}
                          >
                            {isLoading ? "Updating..." : "Update Profile"}
                          </button>
                        </form>
                      ) : (
                        <form onSubmit={handlePasswordUpdate} className="space-y-6">
                          <div className="space-y-4">
                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                Current Password
                              </label>
                              <div className="relative">
                                <div
                                  className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  <HiKey size={20} />
                                </div>
                                <input
                                  type="password"
                                  name="currentPassword"
                                  value={formData.currentPassword}
                                  onChange={handleInputChange}
                                  className={`w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300 ${
                                    theme === "dark"
                                      ? "bg-gray-800 border-gray-700 focus:border-blue-500"
                                      : "bg-gray-50 border-gray-200 focus:border-blue-500"
                                  }`}
                                />
                              </div>
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                New Password
                              </label>
                              <div className="relative">
                                <div
                                  className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  <HiKey size={20} />
                                </div>
                                <input
                                  type="password"
                                  name="newPassword"
                                  value={formData.newPassword}
                                  onChange={handleInputChange}
                                  className={`w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300 ${
                                    theme === "dark"
                                      ? "bg-gray-800 border-gray-700 focus:border-blue-500"
                                      : "bg-gray-50 border-gray-200 focus:border-blue-500"
                                  }`}
                                />
                              </div>
                            </div>

                            <div>
                              <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                                Confirm New Password
                              </label>
                              <div className="relative">
                                <div
                                  className={`absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  <HiKey size={20} />
                                </div>
                                <input
                                  type="password"
                                  name="confirmPassword"
                                  value={formData.confirmPassword}
                                  onChange={handleInputChange}
                                  className={`w-full pl-10 pr-4 py-2 rounded-lg border transition-all duration-300 ${
                                    theme === "dark"
                                      ? "bg-gray-800 border-gray-700 focus:border-blue-500"
                                      : "bg-gray-50 border-gray-200 focus:border-blue-500"
                                  }`}
                                />
                              </div>
                            </div>
                          </div>

                          <button
                            type="submit"
                            disabled={isLoading}
                            className={`w-full py-2 px-4 rounded-lg font-medium transition-all duration-300 bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white ${
                              isLoading ? "opacity-50 cursor-not-allowed" : ""
                            }`}
                          >
                            {isLoading ? "Updating..." : "Update Password"}
                          </button>
                        </form>
                      )}
                    </>
                  ) : (
                    // Only show theme toggle for non-logged in users
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium mb-2 bg-gradient-to-r from-blue-500 to-purple-600 bg-clip-text text-transparent">
                          Theme
                        </label>
                        <button
                          type="button"
                          onClick={toggleTheme}
                          className={`flex items-center space-x-2 px-4 py-2 rounded-lg transition-all duration-300 ${
                            theme === "dark"
                              ? "bg-gray-800 hover:bg-gray-700"
                              : "bg-gray-100 hover:bg-gray-200"
                          }`}
                        >
                          {theme === "dark" ? (
                            <>
                              <HiSun size={20} className="text-amber-400" />
                              <span className="bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent">
                                Light Mode
                              </span>
                            </>
                          ) : (
                            <>
                              <HiMoon size={20} className="text-indigo-600" />
                              <span className="bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                                Dark Mode
                              </span>
                            </>
                          )}
                        </button>
                      </div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          );
        };

        export default SettingsModal;

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ ToggleChat.tsx (2.10 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import React from "react";
        import { useTheme } from "@/context/ThemeProvider";

        interface ToggleChatProps {
          onToggle: () => void;
        }

        const ToggleChat = ({ onToggle }: ToggleChatProps) => {
          const { theme } = useTheme();

          return (
            <div className="fixed right-4 bottom-4 z-500">
              <div className="relative">
                <button
                  onClick={onToggle}
                  className={`relative 
                    ${
                      theme === "dark"
                        ? "bg-gradient-to-r from-indigo-700 to-purple-700 hover:from-indigo-600 hover:to-purple-600"
                        : "bg-gradient-to-r from-indigo-500 to-purple-500 hover:from-indigo-400 hover:to-purple-400"
                    }
                    text-white font-medium py-3 px-6 
                    rounded-full
                    shadow-lg hover:shadow-xl 
                    transform hover:scale-105 
                    transition-all duration-500 ease-in-out
                    flex items-center justify-center gap-2
                    hover:outline-none hover:ring-2 
                    ${
                      theme === "dark"
                        ? "hover:ring-purple-500"
                        : "hover:ring-purple-300"
                    }
                    hover:ring-opacity-50
                    backdrop-blur-sm
                    border border-opacity-20
                    ${theme === "dark" ? "border-purple-400" : "border-purple-300"}
                  `}
                >
                  <span className="flex items-center gap-2 transition-all duration-500 ease-in-out">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      className="h-5 w-5 transition-all duration-500 ease-in-out"
                      viewBox="0 0 20 20"
                      fill="currentColor"
                    >
                      <path
                        fillRule="evenodd"
                        d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z"
                        clipRule="evenodd"
                      />
                    </svg>
                    <span className="transition-all duration-500 ease-in-out">
                      Chat
                    </span>
                  </span>
                </button>
              </div>
            </div>
          );
        };

        export default ToggleChat;

      --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ SideBarComps
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ CreateTableButton.tsx (1.61 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import React, { useState } from "react";
          import CreateTableModal from "./CreateTableModal";
          import { useTheme } from "@/context/ThemeProvider";

          const CreateTableButton: React.FC = () => {
            const [showTableCreateModal, setShowTableCreateModal] =
              useState<boolean>(false);
            const { theme } = useTheme();

            const handleToggleModal = () => {
              setShowTableCreateModal(!showTableCreateModal);
            };

            return (
              <>
                <button
                  onClick={handleToggleModal}
                  className={`flex items-center justify-center gap-3 w-full py-3.5 px-4 mb-4 rounded-xl 
                    bg-gradient-to-br hover:from-indigo-400/80 hover:via-blue-400/80 hover:to-cyan-400/80 
                    from-indigo-500/90 via-blue-500/90 to-cyan-500/90
                     font-medium text-[16px] tracking-wide
                    transition-all duration-500 ease-in-out shadow-lg hover:shadow-xl 
                    hover:-translate-y-0.5 active:scale-[0.98]
                    border border-indigo-300/20
                    font-['Inter'] ${
                      theme === "dark" ? "text-gray-100" : "text-gray-900"
                    } text-5xl`}
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6 animate-pulse"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    strokeWidth="2"
                    strokeLinecap="round"
                    strokeLinejoin="round"
                  >
                    <path d="M12 5v14M5 12h14" />
                  </svg>
                  <span className={`font-extrabold`}>Create New Table</span>
                </button>

                {showTableCreateModal && (
                  <CreateTableModal onCloseModal={handleToggleModal} />
                )}
              </>
            );
          };

          export default CreateTableButton;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ CreateTableModal.css (0.92 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
          }

          .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            width: 500px;
            max-width: 90%;
          }

          .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
          }

          .close-button {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
          }

          .form-group {
            margin-bottom: 15px;
          }

          .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
          }

          .form-group input,
          .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
          }

          .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
          }

          .error-message {
            color: red;
            margin-bottom: 15px;
          }
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ CreateTableModal.tsx (6.17 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import { handleJsonTableOperation } from "@/api/TableContentApi";
          import { useTablesContent } from "@/context/DataProviderReal";
          import { useTheme } from "@/context/ThemeProvider";
          import { useTablesData } from "@/context/DataProviderReal";
          import { useSelectedTable } from "@/context/SelectedTableProvider";
          import React, { useState } from "react";
          import ReactDOM from "react-dom";

          interface CreateTableResponse {
            message: string;
            data: {
              id: number;
              table_name: string;
              headers: string[];
              created_at: string;
              description: string;
            };
          }

          interface CreateTableModalProps {
            onCloseModal: () => void;
          }

          const CreateTableModal: React.FC<CreateTableModalProps> = ({
            onCloseModal,
          }) => {
            const { theme } = useTheme();
            const [tableName, setTableName] = useState("");
            const [description, setDescription] = useState("");
            const [headers, setHeaders] = useState("");
            const [error, setError] = useState("");
            const { dispatchtablesContent } = useTablesContent();
            const { dispatchTablesData } = useTablesData();
            const { setSelectedTable } = useSelectedTable();

            const handleCreateTable = async () => {
              if (!tableName.trim()) {
                setError("Table name is required");
                return;
              }

              try {
                const headersArray = headers
                  .split(",")
                  .map((h) => h.trim())
                  .filter((h) => h);
                const defaultHeaders = ["id", ...headersArray];

                const response = await handleJsonTableOperation(
                  {
                    type: "ADD_TABLE",
                    payload: {
                      table_name: tableName,
                      headers: defaultHeaders,
                      description: description || "",
                    },
                  },
                  dispatchtablesContent
                );

                // Also dispatch to the sidebar reducer
                if (response?.success && response?.data) {
                  const responseData = response.data as unknown as CreateTableResponse;
                  const tableData = responseData.data;
                  console.log("CreateTableModal - Response Data:", response.data);
                  console.log("CreateTableModal - Table Data:", tableData);

                  dispatchTablesData({
                    type: "ADD_TABLE",
                    payload: {
                      id: tableData.id,
                      table_name: tableName,
                      description: description || "",
                      headers: defaultHeaders,
                    },
                  });

                  // Select the newly created table
                  console.log("CreateTableModal - Setting Selected Table:", tableData.id);
                  setSelectedTable(tableData.id);
                }

                onCloseModal();
              } catch (error) {
                setError(
                  error instanceof Error ? error.message : "Failed to create table"
                );
              }
            };

            const handleOverlayClick = (e: React.MouseEvent<HTMLDivElement>) => {
              if (e.target === e.currentTarget) {
                onCloseModal();
              }
            };

            const modalContent = (
              <div
                onClick={handleOverlayClick}
                className={`fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 backdrop-blur-sm ${
                  theme === "dark" ? "dark" : ""
                }`}
              >
                <div
                  className={`w-full max-w-lg rounded-2xl p-6 shadow-lg transform transition-all duration-300 ${
                    theme === "dark"
                      ? "bg-gray-800 text-gray-100"
                      : "bg-white text-gray-900"
                  }`}
                >
                  <div className="flex justify-between items-center mb-4">
                    <h2 className="text-xl font-semibold">Create New Table</h2>
                    <button
                      onClick={onCloseModal}
                      className="text-gray-500 hover:text-red-500 text-2xl font-bold"
                    >
                      &times;
                    </button>
                  </div>

                  {error && (
                    <div className="mb-4 p-2 rounded bg-red-100 text-red-700 dark:bg-red-800 dark:text-red-200">
                      {error}
                    </div>
                  )}

                  <div className="space-y-4">
                    <div>
                      <label htmlFor="tableName" className="block font-medium">
                        Table Name:
                      </label>
                      <input
                        id="tableName"
                        type="text"
                        value={tableName}
                        onChange={(e) => setTableName(e.target.value)}
                        placeholder="Enter table name"
                        className="w-full mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>

                    <div>
                      <label htmlFor="description" className="block font-medium">
                        Description (optional):
                      </label>
                      <textarea
                        id="description"
                        value={description}
                        onChange={(e) => setDescription(e.target.value)}
                        placeholder="Enter description"
                        className="w-full mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                    </div>

                    <div>
                      <label htmlFor="headers" className="block font-medium">
                        Headers (comma separated):
                      </label>
                      <input
                        id="headers"
                        type="text"
                        value={headers}
                        onChange={(e) => setHeaders(e.target.value)}
                        placeholder="e.g., title, content, author"
                        className="w-full mt-1 p-2 rounded border border-gray-300 dark:border-gray-600 bg-transparent focus:outline-none focus:ring-2 focus:ring-blue-500"
                      />
                      <small className="block mt-1 text-xs text-gray-500 dark:text-gray-400">
                        Note: &apos;id&apos; column will be added automatically
                      </small>
                    </div>
                  </div>

                  <div className="mt-6 flex justify-end space-x-2">
                    <button
                      onClick={onCloseModal}
                      className="px-4 py-2 rounded bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors"
                    >
                      Cancel
                    </button>
                    <button
                      onClick={handleCreateTable}
                      className="px-4 py-2 rounded bg-blue-600 text-white hover:bg-blue-700 transition-colors"
                    >
                      Create Table
                    </button>
                  </div>
                </div>
              </div>
            );

            return ReactDOM.createPortal(modalContent, document.body);
          };

          export default CreateTableModal;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ SideBar.tsx (3.99 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          // SideBar.jsx
          import React, { useEffect } from "react";
          import SideBarEntries from "./SideBarEntries";
          import { useTheme } from "@/context/ThemeProvider";
          import { useTablesData } from "@/context/DataProviderReal";
          import CreateTableButton from "./CreateTableButton";
          import { handleTableOperation } from "@/api/TableDataApi";

          interface SideBarProps {
            isOpen: boolean;
            setIsOpen: (isOpen: boolean) => void;
          }

          const SideBar = ({ isOpen, setIsOpen }: SideBarProps) => {
            const { tablesData, dispatchTablesData } = useTablesData();
            const { theme } = useTheme();

            useEffect(() => {
              const handleResize = () => {
                if (window.innerWidth < 1024) {
                  // lg breakpoint
                  setIsOpen(false);
                } else {
                  setIsOpen(true);
                }
              };

              handleResize(); // Initial check
              window.addEventListener("resize", handleResize);
              return () => window.removeEventListener("resize", handleResize);
            }, [setIsOpen]);

            const handleTableEdit = async (id: number, name: string) => {
              await handleTableOperation(
                {
                  type: "EDIT",
                  payload: {
                    id: id,
                    table_name: name,
                  },
                },
                dispatchTablesData
              );
              // dispatchTablesData({
              //   type: "EDIT",
              //   payload: {
              //     id: id,
              //     table_name: name,
              //   },
              // });
            };
            const handleTableShare = async (id: number) => {
              await handleTableOperation(
                {
                  type: "SHARE",
                  payload: {
                    id: id,
                  },
                },
                dispatchTablesData
              );
              // dispatchTablesData({
              //   type: "SHARE",
              //   payload: {
              //     id: id,
              //   },
              // });
            };
            const handleTableDelete = async (id: number) => {
              await handleTableOperation(
                {
                  type: "DELETE",
                  payload: {
                    id: id,
                  },
                },
                dispatchTablesData
              );
              // dispatchTablesData({
              //   type: "DELETE",
              //   payload: {
              //     id: id,
              //   },
              // });
            };

            return (
              <>
                {/* Overlay for mobile */}
                {isOpen && (
                  <div
                    className="fixed inset-0 bg-black/50 z-30 lg:hidden"
                    onClick={() => setIsOpen(false)}
                  />
                )}

                {/* Sidebar */}
                <div
                  className={`
                    ${isOpen ? "left-0" : "hidden"}
                    fixed lg:relative z-40
                    h-screen pt-18 lg:pt-[10vh] 
                    px-3 sm:px-4 lg:pl-[1.5vw] lg:pr-0
                    w-[280px] sm:w-[320px] lg:w-[20vw] xl:w-[18vw] 2xl:w-[16vw]
                    flex flex-col
                    ${theme === "dark" ? "bg-gray-900" : "bg-gray-50"} 
                    transition-all duration-500 ease-in-out
                    border-r ${
                      theme === "dark" ? "border-gray-800" : "border-gray-200"
                    } overflow-y-auto
                  `}
                >
                  <h1
                    className={`text-center text-xs sm:text-sm italic mb-4 sm:mb-6 px-2 py-2 border-b transition-colors duration-500 ease-in-out ${
                      theme === "dark"
                        ? "text-gray-300 border-gray-700"
                        : "text-gray-700 border-gray-200"
                    }`}
                  >
                    <CreateTableButton />
                    {/* Manage YourSelf */}
                  </h1>

                  <div className="relative flex-1 h-full max-h-screen">
                    <div
                      className={`h-full pr-2 sm:pr-4 lg:pr-[1vw] scrollbar-custom pb-20`}
                    >
                      {tablesData.map((table) => (
                        <SideBarEntries
                          key={`table-${table.id}-${table.table_name}`}
                          table={table}
                          onEdit={handleTableEdit}
                          onDelete={handleTableDelete}
                          onShare={handleTableShare}
                        />
                      ))}
                    </div>

                    {/* Bottom fade effect */}
                    <div
                      className={`sticky bottom-0 left-0 right-0 h-4 sm:h-6 transition-colors duration-500 ease-in-out ${
                        theme === "dark"
                          ? "bg-gradient-to-t from-gray-900 to-transparent"
                          : "bg-gradient-to-t from-gray-50 to-transparent"
                      } pointer-events-none`}
                    />
                  </div>
                </div>
              </>
            );
          };

          export default SideBar;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ SideBarEntries.tsx (0.02 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          // SideBarEntries.jsx
          "use client";
          import React, { useState, useRef, useEffect } from "react";
          import { SlOptionsVertical } from "react-icons/sl";
          import { IoShareOutline } from "react-icons/io5";
          import { BsShareFill } from "react-icons/bs";
          import { TableDataType } from "@/data/table";
          import { useTheme } from "@/context/ThemeProvider";
          import { createPortal } from "react-dom";
          import { useSelectedTable } from "@/context/SelectedTableProvider";
          import { tableApi } from "@/api/TableDataApi";
          import { getFriendsList } from "@/api/AuthApi";
          import { useTablesData } from "@/context/DataProviderReal";

          interface Friend {
            id: number;
            username: string;
            email: string;
          }

          interface SideBarEntriesProps {
            table: TableDataType;
            onEdit: (id: number, name: string) => void;
            onDelete: (id: number) => void;
          }

          const SideBarEntries: React.FC<SideBarEntriesProps> = ({
            table,
            onEdit,
            onDelete,
          }) => {
            const { theme } = useTheme();
            const { selectedTable, setSelectedTable } = useSelectedTable();
            const { dispatchTablesData } = useTablesData();
            const [currentUserId, setCurrentUserId] = useState<number | null>(null);

            const [isEditing, setIsEditing] = useState(false);
            const [editedName, setEditedName] = useState(table.table_name);
            const dropdownRef = useRef<HTMLDivElement>(null);
            const buttonRef = useRef<HTMLButtonElement>(null);
            const [dropdownPosition, setDropdownPosition] = useState({ top: 0, left: 0 });
            const [showDropDown, setShowDropDown] = useState(false);
            const [showFriendsDropdown, setShowFriendsDropdown] = useState(false);
            const friendsDropdownRef = useRef<HTMLDivElement>(null);
            const [friends, setFriends] = useState<Friend[]>([]);
            const [selectedFriends, setSelectedFriends] = useState<number[]>([]);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState<string | null>(null);

            useEffect(() => {
              const userStr = localStorage.getItem("user");
              if (userStr) {
                const user = JSON.parse(userStr);
                setCurrentUserId(user.id);
              }
            }, []);

            const handleSelectTable = (tableId: number | null) => {
              console.log("SideBarEntries - Table ID:", tableId);
              console.log("SideBarEntries - Current Table:", table);
              console.log("SideBarEntries - Selected Table State:", selectedTable);
              setSelectedTable(tableId);
            };

            const handleClickOutside = React.useCallback(
              (event: MouseEvent) => {
                if (
                  dropdownRef.current &&
                  !dropdownRef.current.contains(event.target as Node) &&
                  buttonRef.current &&
                  !buttonRef.current.contains(event.target as Node) &&
                  !friendsDropdownRef.current
                ) {
                  setShowDropDown(false);
                  setShowFriendsDropdown(false);
                  setIsEditing(false);
                }
                if (
                  dropdownRef.current &&
                  !dropdownRef.current.contains(event.target as Node) &&
                  buttonRef.current &&
                  !buttonRef.current.contains(event.target as Node) &&
                  friendsDropdownRef.current &&
                  !friendsDropdownRef.current.contains(event.target as Node)
                ) {
                  if (isEditing) {
                    onEdit(table.id, editedName);
                  }
                  setShowDropDown(false);
                  setShowFriendsDropdown(false);
                  setIsEditing(false);
                }
              },
              [isEditing, onEdit, table.id, editedName]
            );

            useEffect(() => {
              document.addEventListener("mousedown", handleClickOutside);
              return () => {
                document.removeEventListener("mousedown", handleClickOutside);
              };
            }, [handleClickOutside]);

            const calculateDropdownPosition = () => {
              if (buttonRef.current) {
                const buttonRect = buttonRef.current.getBoundingClientRect();
                const viewportHeight = window.innerHeight;
                const isTopHalf = buttonRect.top < viewportHeight / 2;

                setDropdownPosition({
                  left: buttonRect.right + window.scrollX - 10, // 10px offset from the button
                  top: isTopHalf
                    ? buttonRect.bottom + window.scrollY + 5 // Show below if in top half
                    : buttonRect.top + window.scrollY - 130, // Show above if in bottom half (130px is approx dropdown height)
                });
              }
            };

            const handleDropdownToggle = (e: React.MouseEvent) => {
              e.stopPropagation();
              e.preventDefault();

              setShowDropDown(!showDropDown);
              if (!showDropDown) {
                calculateDropdownPosition();
              }
            };

            // Update position on scroll
            useEffect(() => {
              const handleScroll = () => {
                if (showDropDown) {
                  calculateDropdownPosition();
                }
              };

              window.addEventListener("scroll", handleScroll, true);
              return () => window.removeEventListener("scroll", handleScroll, true);
            }, [showDropDown]);

            // Sync scroll position with main dropdown
            useEffect(() => {
              const handleScroll = () => {
                if (showDropDown && showFriendsDropdown && dropdownRef.current) {
                  const mainDropdownRect = dropdownRef.current.getBoundingClientRect();
                  if (friendsDropdownRef.current) {
                    friendsDropdownRef.current.style.top = `${
                      mainDropdownRect.bottom + window.scrollY + 5
                    }px`;
                    friendsDropdownRef.current.style.left = `${mainDropdownRect.left}px`;
                  }
                }
              };

              window.addEventListener("scroll", handleScroll, true);
              return () => window.removeEventListener("scroll", handleScroll, true);
            }, [showDropDown, showFriendsDropdown]);

            const handleShare = async () => {
              if (selectedFriends.length === 0) return;

              setLoading(true);
              try {
                const response = await tableApi.shareTable({
                  table_id: table.id,
                  friend_ids: selectedFriends,
                  action: "share",
                });

                if (response.success && response.data?.table) {
                  dispatchTablesData({
                    type: "SHARE",
                    payload: {
                      id: table.id,
                      is_shared: response.data.table.is_shared,
                      shared_with: response.data.table.shared_with,
                    },
                  });
                  setShowFriendsDropdown(false);
                  setShowDropDown(false);
                } else {
                  setError(response.error || "Failed to share table");
                }
              } catch {
                setError("Failed to share table");
              } finally {
                setLoading(false);
              }
            };

            const handleUnshare = async () => {
              if (selectedFriends.length === 0) return;

              setLoading(true);
              try {
                const response = await tableApi.shareTable({
                  table_id: table.id,
                  friend_ids: selectedFriends,
                  action: "unshare",
                });

                if (response.success && response.data?.table) {
                  dispatchTablesData({
                    type: "SHARE",
                    payload: {
                      id: table.id,
                      is_shared: response.data.table.is_shared,
                      shared_with: response.data.table.shared_with,
                    },
                  });
                  setShowFriendsDropdown(false);
                  setShowDropDown(false);
                  if (selectedTable === table.id) handleSelectTable(null);
                } else {
                  setError(response.error || "Failed to unshare table");
                }
              } catch {
                setError("Failed to unshare table");
              } finally {
                setLoading(false);
              }
            };

            useEffect(() => {
              const fetchFriends = async () => {
                try {
                  const response = await getFriendsList();
                  if (response.success && response.data?.data) {
                    setFriends(response.data.data);
                  }
                } catch {
                  setError("Failed to fetch friends");
                }
              };

              if (showFriendsDropdown) {
                fetchFriends();
              }
            }, [showFriendsDropdown]);

            return (
              <div
                className={`px-1 sm:px-2 lg:px-3 py-3 sm:py-4 mb-2 sm:mb-3 rounded-lg sm:rounded-xl transition-all duration-500 ease-in-out 
                  cursor-pointer group 
                  ${
                    theme === "dark"
                      ? selectedTable === table.id
                        ? "bg-gradient-to-br from-gray-700/90 to-gray-800/95 border-gray-600/50"
                        : "bg-gradient-to-br from-gray-800/90 to-gray-900/95 hover:from-gray-700/90 hover:to-gray-800/95 border-gray-700/50"
                      : selectedTable === table.id
                      ? "bg-gradient-to-br from-gray-100/95 to-gray-50/95 border-gray-300"
                      : "bg-gradient-to-br from-gray-50/95 to-white/95 hover:from-gray-100/95 hover:to-gray-50/95 border-gray-200"
                  }
                  border hover:shadow-lg 
                  hover:shadow-${theme === "dark" ? "gray-900/30" : "gray-200/80"}
                  hover:-translate-y-0.5 hover:border-${
                    theme === "dark" ? "gray-600/50" : "gray-300"
                  }
                  relative overflow-hidden
                  after:absolute after:inset-0 after:bg-gradient-to-r after:from-transparent after:via-white/10 after:to-transparent
                  after:-translate-x-full ${
                    selectedTable === table.id
                      ? "after:translate-x-full"
                      : "group-hover:after:translate-x-full"
                  } after:transition-transform after:duration-500`}
                onClick={() => handleSelectTable(table.id)}
              >
                {/* Glossy overlay effect */}
                <div className="absolute inset-0 pointer-events-none">
                  <div
                    className={`absolute inset-0 rounded-lg sm:rounded-xl border-t ${
                      theme === "dark" ? "border-t-gray-700/30" : "border-t-white/80"
                    }`}
                  ></div>
                </div>

                <div className="flex justify-between items-center mb-1 sm:mb-2 relative z-10">
                  {isEditing ? (
                    <input
                      type="text"
                      value={editedName}
                      onChange={(e) => setEditedName(e.target.value)}
                      onBlur={() => {
                        onEdit(table.id, editedName);
                        setIsEditing(false);
                      }}
                      onKeyDown={(e) => {
                        if (e.key === "Enter") {
                          onEdit(table.id, editedName);
                          setIsEditing(false);
                        }
                      }}
                      autoFocus
                      className={`bg-transparent border-b ${
                        theme === "dark"
                          ? "text-white border-gray-500 focus:border-gray-300"
                          : "text-gray-900 border-gray-300 focus:border-gray-500"
                      } outline-none w-full`}
                    />
                  ) : (
                    <h3
                      className={`font-medium truncate text-sm sm:text-[15px] ${
                        theme === "dark"
                          ? "bg-gradient-to-r from-gray-100 to-white bg-clip-text text-transparent group-hover:from-white group-hover:to-gray-100"
                          : "bg-gradient-to-r from-gray-800 to-gray-900 bg-clip-text text-transparent group-hover:from-gray-900 group-hover:to-gray-800"
                      } transition-colors duration-500 ease-in-out flex items-center
                      w-[90%]`}
                    >
                      <p className="inline-flex flex-col">
                        {table.is_shared && (
                          <span
                            className={`text-[10px] sm:text-xs mb-0.5 flex items-center gap-1 ${
                              theme === "dark" ? "text-gray-400" : "text-gray-500"
                            }`}
                          >
                            {currentUserId === table.owner.id ? (
                              <>
                                <IoShareOutline
                                  className={`${
                                    theme === "dark"
                                      ? "text-emerald-400"
                                      : "text-emerald-600"
                                  }`}
                                />
                                Shared
                              </>
                            ) : (
                              <>
                                <BsShareFill
                                  className={`${
                                    theme === "dark" ? "text-blue-400" : "text-blue-600"
                                  }`}
                                />
                                Shared from {table.owner.username}
                              </>
                            )}
                          </span>
                        )}
                        <span
                          className={`font-semibold tracking-wide ${
                            theme === "dark"
                              ? "bg-gradient-to-r from-emerald-300 to-cyan-300 bg-clip-text text-transparent"
                              : "bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent"
                          }`}
                        >
                          {table.table_name}
                        </span>
                      </p>
                    </h3>
                  )}
                  <div className="relative">
                    {currentUserId === table.owner.id && (
                      <button
                        ref={buttonRef}
                        onClick={(e) => {
                          handleDropdownToggle(e);
                        }}
                        className={`p-0.5 sm:p-1 rounded-md sm:rounded-lg transition-all duration-500 ease-in-out ${
                          selectedTable === table.id
                            ? "opacity-100"
                            : "opacity-0 group-hover:opacity-100"
                        } 
                        ${
                          theme === "dark"
                            ? "text-gray-400 hover:text-gray-200 hover:bg-gray-700/50"
                            : "text-gray-500 hover:text-gray-700 hover:bg-gray-200/50"
                        }
                        transform ${
                          selectedTable === table.id
                            ? "translate-x-0"
                            : "translate-x-1 group-hover:translate-x-0"
                        }
                        backdrop-blur-sm`}
                      >
                        <SlOptionsVertical size={12} className="sm:w-3.5 sm:h-3.5" />
                      </button>
                    )}

                    {showDropDown &&
                      createPortal(
                        <div
                          ref={dropdownRef}
                          className={`fixed z-[1000] w-40 rounded-md shadow-lg ${
                            theme === "dark"
                              ? "bg-gray-800 border border-gray-700"
                              : "bg-white border border-gray-200"
                          }`}
                          style={{
                            top: `${dropdownPosition.top}px`,
                            left: `${dropdownPosition.left}px`,
                          }}
                        >
                          <div className="py-1">
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                setIsEditing(true);
                                setShowDropDown(false);
                              }}
                              className={`block w-full text-left px-4 py-2 text-sm ${
                                theme === "dark"
                                  ? "text-gray-200 hover:bg-gray-700"
                                  : "text-gray-700 hover:bg-gray-100"
                              }`}
                            >
                              Edit
                            </button>
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                setShowFriendsDropdown(true);
                              }}
                              className={`block w-full text-left px-4 py-2 text-sm ${
                                theme === "dark"
                                  ? "text-gray-200 hover:bg-gray-700"
                                  : "text-gray-700 hover:bg-gray-100"
                              }`}
                            >
                              Share
                            </button>
                            <button
                              onClick={(e) => {
                                e.stopPropagation();
                                onDelete(table.id);
                                setShowDropDown(false);
                                if (selectedTable === table.id) handleSelectTable(null);
                              }}
                              className={`block w-full text-left px-4 py-2 text-sm ${
                                theme === "dark"
                                  ? "text-red-400 hover:bg-gray-700"
                                  : "text-red-600 hover:bg-gray-100"
                              }`}
                            >
                              Delete
                            </button>
                          </div>
                        </div>,
                        document.body
                      )}
                  </div>
                </div>

                <div className="flex justify-between text-sm gap-1 sm:gap-2 items-baseline relative z-10">
                  <p
                    className={`truncate text-xs sm:text-[13px] transition-colors duration-500 ease-in-out ${
                      theme === "dark"
                        ? "text-gray-400 group-hover:text-gray-300"
                        : "text-gray-500 group-hover:text-gray-600"
                    } max-w-[80px] xs:max-w-[100px] sm:max-w-[120px]`}
                  >
                    {table.description || "\u00A0"}
                  </p>
                  <p
                    className={`text-xs transition-colors duration-500 ease-in-out flex-shrink-0 ${
                      theme === "dark"
                        ? "text-gray-500 group-hover:text-gray-400"
                        : "text-gray-400 group-hover:text-gray-500"
                    }`}
                  >
                    {new Date(table.created_at).toLocaleString("en-US", {
                      month: "short",
                      day: "numeric",
                      hour: "2-digit",
                      minute: "2-digit",
                    })}
                  </p>
                </div>

                {showFriendsDropdown &&
                  createPortal(
                    <div
                      ref={friendsDropdownRef}
                      className={`fixed z-[1001] w-64 rounded-xl shadow-xl backdrop-blur-sm ${
                        theme === "dark"
                          ? "bg-gray-800/95 border border-gray-700/50"
                          : "bg-white/95 border border-gray-200/50"
                      }`}
                      style={{
                        top: `${dropdownPosition.top + 80}px`,
                        left: `${dropdownPosition.left}px`,
                      }}
                    >
                      <div className="p-3">
                        <div
                          className={`px-2 py-1.5 text-sm font-medium mb-2 ${
                            theme === "dark"
                              ? "text-gray-300 bg-gradient-to-r from-gray-700/50 to-gray-800/50"
                              : "text-gray-700 bg-gradient-to-r from-gray-100/50 to-gray-50/50"
                          } rounded-lg`}
                        >
                          Share with friends
                        </div>
                        <div className="max-h-48 overflow-y-auto custom-scrollbar">
                          {friends.map((friend) => (
                            <div
                              key={friend.id}
                              className={`flex items-center p-2 rounded-lg mb-1 transition-all duration-200 ${
                                theme === "dark"
                                  ? "hover:bg-gray-700/50"
                                  : "hover:bg-gray-100/50"
                              }`}
                            >
                              <input
                                type="checkbox"
                                id={`friend-${friend.id}`}
                                checked={selectedFriends.includes(friend.id)}
                                onChange={(e) => {
                                  if (e.target.checked) {
                                    setSelectedFriends([...selectedFriends, friend.id]);
                                  } else {
                                    setSelectedFriends(
                                      selectedFriends.filter((id) => id !== friend.id)
                                    );
                                  }
                                }}
                                className={`w-4 h-4 rounded border-2 ${
                                  theme === "dark"
                                    ? "border-gray-600 checked:bg-blue-500"
                                    : "border-gray-300 checked:bg-blue-500"
                                } transition-colors duration-200`}
                              />
                              <label
                                htmlFor={`friend-${friend.id}`}
                                className={`ml-2 text-sm cursor-pointer ${
                                  theme === "dark" ? "text-gray-300" : "text-gray-700"
                                }`}
                              >
                                <span className="font-medium">{friend.username}</span>
                                <span
                                  className={`text-xs ml-1 ${
                                    theme === "dark" ? "text-gray-400" : "text-gray-500"
                                  }`}
                                >
                                  ({friend.email})
                                </span>
                              </label>
                            </div>
                          ))}
                        </div>
                        <div className="flex justify-end space-x-2 mt-3 pt-2 border-t border-gray-200/50">
                          <button
                            onClick={handleUnshare}
                            disabled={loading || selectedFriends.length === 0}
                            className={`px-3 py-1.5 text-xs font-medium rounded-lg transition-all duration-200 
                              ${
                                loading || selectedFriends.length === 0
                                  ? theme === "dark"
                                    ? "bg-gray-700/50 text-gray-500 cursor-not-allowed"
                                    : "bg-gray-200/50 text-gray-400 cursor-not-allowed"
                                  : theme === "dark"
                                  ? "bg-gradient-to-r from-red-500/90 to-red-600/90 hover:from-red-500 hover:to-red-600 text-white"
                                  : "bg-gradient-to-r from-red-500/90 to-red-600/90 hover:from-red-500 hover:to-red-600 text-white"
                              }`}
                          >
                            Unshare
                          </button>
                          <button
                            onClick={handleShare}
                            disabled={loading || selectedFriends.length === 0}
                            className={`px-3 py-1.5 text-xs font-medium rounded-lg transition-all duration-200 
                              ${
                                loading || selectedFriends.length === 0
                                  ? theme === "dark"
                                    ? "bg-gray-700/50 text-gray-500 cursor-not-allowed"
                                    : "bg-gray-200/50 text-gray-400 cursor-not-allowed"
                                  : theme === "dark"
                                  ? "bg-gradient-to-r from-blue-500/90 to-indigo-600/90 hover:from-blue-500 hover:to-indigo-600 text-white"
                                  : "bg-gradient-to-r from-blue-500/90 to-indigo-600/90 hover:from-blue-500 hover:to-indigo-600 text-white"
                              }`}
                          >
                            Share
                          </button>
                        </div>
                      </div>
                    </div>,
                    document.body
                  )}

                <div className="relative">
                  {error && (
                    <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                      {error}
                    </div>
                  )}
                </div>
              </div>
            );
          };

          export default SideBarEntries;

        --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ ui
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ button.tsx (2.07 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import * as React from "react"
          import { Slot } from "@radix-ui/react-slot"
          import { cva, type VariantProps } from "class-variance-authority"

          import { cn } from "@/lib/utils"

          const buttonVariants = cva(
            "inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
            {
              variants: {
                variant: {
                  default:
                    "bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",
                  destructive:
                    "bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",
                  outline:
                    "border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",
                  secondary:
                    "bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",
                  ghost:
                    "hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",
                  link: "text-primary underline-offset-4 hover:underline",
                },
                size: {
                  default: "h-9 px-4 py-2 has-[>svg]:px-3",
                  sm: "h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",
                  lg: "h-10 rounded-md px-6 has-[>svg]:px-4",
                  icon: "size-9",
                },
              },
              defaultVariants: {
                variant: "default",
                size: "default",
              },
            }
          )

          function Button({
            className,
            variant,
            size,
            asChild = false,
            ...props
          }: React.ComponentProps<"button"> &
            VariantProps<typeof buttonVariants> & {
              asChild?: boolean
            }) {
            const Comp = asChild ? Slot : "button"

            return (
              <Comp
                data-slot="button"
                className={cn(buttonVariants({ variant, size, className }))}
                {...props}
              />
            )
          }

          export { Button, buttonVariants }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ card.tsx (1.94 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import * as React from "react"

          import { cn } from "@/lib/utils"

          function Card({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card"
                className={cn(
                  "bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",
                  className
                )}
                {...props}
              />
            )
          }

          function CardHeader({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card-header"
                className={cn(
                  "@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",
                  className
                )}
                {...props}
              />
            )
          }

          function CardTitle({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card-title"
                className={cn("leading-none font-semibold", className)}
                {...props}
              />
            )
          }

          function CardDescription({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card-description"
                className={cn("text-muted-foreground text-sm", className)}
                {...props}
              />
            )
          }

          function CardAction({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card-action"
                className={cn(
                  "col-start-2 row-span-2 row-start-1 self-start justify-self-end",
                  className
                )}
                {...props}
              />
            )
          }

          function CardContent({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card-content"
                className={cn("px-6", className)}
                {...props}
              />
            )
          }

          function CardFooter({ className, ...props }: React.ComponentProps<"div">) {
            return (
              <div
                data-slot="card-footer"
                className={cn("flex items-center px-6 [.border-t]:pt-6", className)}
                {...props}
              />
            )
          }

          export {
            Card,
            CardHeader,
            CardFooter,
            CardTitle,
            CardAction,
            CardDescription,
            CardContent,
          }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ checkbox.tsx (1.20 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client"

          import * as React from "react"
          import * as CheckboxPrimitive from "@radix-ui/react-checkbox"
          import { CheckIcon } from "lucide-react"

          import { cn } from "@/lib/utils"

          function Checkbox({
            className,
            ...props
          }: React.ComponentProps<typeof CheckboxPrimitive.Root>) {
            return (
              <CheckboxPrimitive.Root
                data-slot="checkbox"
                className={cn(
                  "peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
                  className
                )}
                {...props}
              >
                <CheckboxPrimitive.Indicator
                  data-slot="checkbox-indicator"
                  className="flex items-center justify-center text-current transition-none"
                >
                  <CheckIcon className="size-3.5" />
                </CheckboxPrimitive.Indicator>
              </CheckboxPrimitive.Root>
            )
          }

          export { Checkbox }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ dialog.tsx (3.19 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client"

          import * as React from "react"
          import * as DialogPrimitive from "@radix-ui/react-dialog"
          import { XIcon } from "lucide-react"
          import { cn } from "@/lib/utils"

          function Dialog({ ...props }: React.ComponentProps<typeof DialogPrimitive.Root>) {
            return <DialogPrimitive.Root {...props} />
          }

          function DialogTrigger({ ...props }: React.ComponentProps<typeof DialogPrimitive.Trigger>) {
            return <DialogPrimitive.Trigger {...props} />
          }

          function DialogPortal({ ...props }: React.ComponentProps<typeof DialogPrimitive.Portal>) {
            return <DialogPrimitive.Portal {...props} />
          }

          function DialogOverlay({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Overlay>) {
            return (
              <DialogPrimitive.Overlay
                className={cn(
                  "fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",
                  "data-[state=open]:animate-in data-[state=closed]:animate-out",
                  "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
                  className
                )}
                {...props}
              />
            )
          }

          function DialogContent({
            className,
            children,
            showCloseButton = false, 
            ...props
          }: React.ComponentProps<typeof DialogPrimitive.Content> & {
            showCloseButton?: boolean
          }) {
            return (
              <DialogPortal>
                <DialogOverlay />
                <DialogPrimitive.Content
                  className={cn(
                    "fixed top-[50%] left-[50%] z-50 translate-x-[-50%] translate-y-[-50%]",
                    "data-[state=open]:animate-in data-[state=closed]:animate-out",
                    "data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",
                    "data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95",
                    "max-w-fit w-full border-0 shadow-none bg-transparent p-0",
                    className
                  )}
                  {...props}
                >
                  {children}
                  {showCloseButton && (
                    <DialogPrimitive.Close
                      className="absolute top-4 right-4 z-[100] p-2 rounded-full bg-black/30 text-white hover:bg-black/50 transition"
                    >
                      <XIcon className="h-4 w-4" />
                      <span className="sr-only">Close</span>
                    </DialogPrimitive.Close>
                  )}
                </DialogPrimitive.Content>
              </DialogPortal>
            )
          }

          function DialogClose({ ...props }: React.ComponentProps<typeof DialogPrimitive.Close>) {
            return <DialogPrimitive.Close {...props} />
          }

          function DialogHeader({ className, ...props }: React.ComponentProps<"div">) {
            return <div className={cn("flex flex-col gap-2 text-center sm:text-left", className)} {...props} />
          }

          function DialogFooter({ className, ...props }: React.ComponentProps<"div">) {
            return <div className={cn("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end", className)} {...props} />
          }

          function DialogTitle({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Title>) {
            return <DialogPrimitive.Title className={cn("text-lg font-semibold", className)} {...props} />
          }

          function DialogDescription({ className, ...props }: React.ComponentProps<typeof DialogPrimitive.Description>) {
            return <DialogPrimitive.Description className={cn("text-muted-foreground text-sm", className)} {...props} />
          }

          export {
            Dialog,
            DialogTrigger,
            DialogContent,
            DialogClose,
            DialogDescription,
            DialogFooter,
            DialogHeader,
            DialogOverlay,
            DialogPortal,
            DialogTitle,
          }
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ input.tsx (0.94 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import * as React from "react"

          import { cn } from "@/lib/utils"

          function Input({ className, type, ...props }: React.ComponentProps<"input">) {
            return (
              <input
                type={type}
                data-slot="input"
                className={cn(
                  "file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border bg-transparent px-3 py-1 text-base shadow-xs transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",
                  "focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]",
                  "aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",
                  className
                )}
                {...props}
              />
            )
          }

          export { Input }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ label.tsx (0.60 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client"

          import * as React from "react"
          import * as LabelPrimitive from "@radix-ui/react-label"

          import { cn } from "@/lib/utils"

          function Label({
            className,
            ...props
          }: React.ComponentProps<typeof LabelPrimitive.Root>) {
            return (
              <LabelPrimitive.Root
                data-slot="label"
                className={cn(
                  "flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",
                  className
                )}
                {...props}
              />
            )
          }

          export { Label }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ popover.tsx (1.60 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client"

          import * as React from "react"
          import * as PopoverPrimitive from "@radix-ui/react-popover"

          import { cn } from "@/lib/utils"

          function Popover({
            ...props
          }: React.ComponentProps<typeof PopoverPrimitive.Root>) {
            return <PopoverPrimitive.Root data-slot="popover" {...props} />
          }

          function PopoverTrigger({
            ...props
          }: React.ComponentProps<typeof PopoverPrimitive.Trigger>) {
            return <PopoverPrimitive.Trigger data-slot="popover-trigger" {...props} />
          }

          function PopoverContent({
            className,
            align = "center",
            sideOffset = 4,
            ...props
          }: React.ComponentProps<typeof PopoverPrimitive.Content>) {
            return (
              <PopoverPrimitive.Portal>
                <PopoverPrimitive.Content
                  data-slot="popover-content"
                  align={align}
                  sideOffset={sideOffset}
                  className={cn(
                    "bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",
                    className
                  )}
                  {...props}
                />
              </PopoverPrimitive.Portal>
            )
          }

          function PopoverAnchor({
            ...props
          }: React.ComponentProps<typeof PopoverPrimitive.Anchor>) {
            return <PopoverPrimitive.Anchor data-slot="popover-anchor" {...props} />
          }

          export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ switch.tsx (1.15 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client"

          import * as React from "react"
          import * as SwitchPrimitive from "@radix-ui/react-switch"

          import { cn } from "@/lib/utils"

          function Switch({
            className,
            ...props
          }: React.ComponentProps<typeof SwitchPrimitive.Root>) {
            return (
              <SwitchPrimitive.Root
                data-slot="switch"
                className={cn(
                  "peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",
                  className
                )}
                {...props}
              >
                <SwitchPrimitive.Thumb
                  data-slot="switch-thumb"
                  className={cn(
                    "bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0"
                  )}
                />
              </SwitchPrimitive.Root>
            )
          }

          export { Switch }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ userSetting.tsx (2.03 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          'use client';

          import React, { useState } from 'react';
          import { useTheme } from '@/context/ThemeProvider';
          import clsx from 'clsx';
          import { DialogClose } from '@/components/ui/dialog';
          import { XIcon } from 'lucide-react';

          const settingsOptions = [
            { label: 'Enable Notifications', key: 'notifications' },
            { label: 'Auto-Save Transactions', key: 'autoSave' },
            { label: 'Monthly Report Summary', key: 'monthlyReport' },
          ];

          const UserSettings = () => {
            const { theme, toggleTheme } = useTheme();
            const [settings, setSettings] = useState({
              notifications: true,
              autoSave: false,
              monthlyReport: true,
            });

            const handleToggle = (key: string) => {
              setSettings((prev) => ({
                ...prev,
                [key]: !prev[key as keyof typeof settings],
              }));
            };

            return (
              <div
                className={clsx(
                  'w-full max-w-md mx-auto rounded-xl p-6 shadow-lg transition-colors duration-300 relative',
                  'bg-gray-900 text-white'
                )}
              >
                {}
                <DialogClose className="absolute top-4 right-4 text-gray-400 hover:text-white transition-colors">
                  <XIcon className="h-5 w-5" />
                  <span className="sr-only">Close</span>
                </DialogClose>

                <h2 className="text-2xl font-bold mb-4">User Settings</h2>
                <ul className="space-y-4">
                  {settingsOptions.map((option) => {
                    const isEnabled = settings[option.key as keyof typeof settings];
                    return (
                      <li key={option.key} className="flex justify-between items-center">
                        <span>{option.label}</span>
                        <button
                          onClick={() => handleToggle(option.key)}
                          className={clsx(
                            'w-12 h-6 rounded-full flex items-center px-1 transition-all duration-300',
                            isEnabled ? 'bg-blue-600 justify-end' : 'bg-gray-400 justify-start'
                          )}
                        >
                          <span className="w-4 h-4 bg-white rounded-full shadow" />
                        </button>
                      </li>
                    );
                  })}
                </ul>
              </div>
            );
          };

          export default UserSettings;
        --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ chat
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ ChatArea.tsx (0.02 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          // import React, { useState, useRef, useEffect } from "react";
          // import { useTheme } from "@/context/ThemeProvider";
          // import { useAuth } from "@/context/AuthProvider";
          // import { useSelectedTable } from "@/context/SelectedTableProvider";
          // import hljs from "highlight.js";
          // import "highlight.js/styles/github-dark.css"; // Modern, clean dark theme
          // import { ChatMessage } from "@/data/ChatMessages";
          // import { tokenUtils } from "@/api/AuthApi";

          // interface AgentResponse {
          //   response: string;
          //   tools_called: Array<{
          //     name: string;
          //     args: Record<string, any>;
          //   }>;
          //   streaming_info?: {
          //     tool_operations: Array<{
          //       step: number;
          //       tool_name: string;
          //       tool_type: string;
          //       operation: string;
          //       status: string;
          //       timestamp: string;
          //     }>;
          //     status: string;
          //   };
          // }

          // const ChatArea = () => {
          //   const { theme } = useTheme();
          //   const { isAuthenticated } = useAuth();
          //   const { selectedTable } = useSelectedTable();
          //   const [messages, setMessages] = useState<ChatMessage[]>([
          //     {
          //       id: "1",
          //       text: "Hello! I'm your AI finance assistant. I can help you manage your expenses, create tables, and track your financial data. How can I assist you today?",
          //       sender: "bot",
          //       timestamp: new Date(),
          //       displayedText:
          //         "Hello! I'm your AI finance assistant. I can help you manage your expenses, create tables, and track your financial data. How can I assist you today?",
          //     },
          //   ]);
          //   const [inputValue, setInputValue] = useState("");
          //   const [inputRows, setInputRows] = useState(1);
          //   const [isLoading, setIsLoading] = useState(false);
          //   const messagesEndRef = useRef<HTMLDivElement>(null);
          //   const formRef = useRef<HTMLFormElement>(null);
          //   const textareaRef = useRef<HTMLTextAreaElement>(null);
          //   const typingIntervalRef = useRef<NodeJS.Timeout | null>(null);

          //   const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
          //     if (e.key === "Enter" && !e.shiftKey) {
          //       e.preventDefault();
          //       formRef.current?.requestSubmit();
          //     }
          //   };

          //   const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
          //     setInputValue(e.target.value);
          //     const lineCount = e.target.value.split("\n").length;
          //     setInputRows(Math.min(Math.max(lineCount, 1), 5));
          //   };

          //   // Auto-scroll to bottom when messages change
          //   useEffect(() => {
          //     scrollToBottom();
          //   }, [messages]);

          //   // Clean up typing effect on unmount
          //   useEffect(() => {
          //     return () => {
          //       if (typingIntervalRef.current) {
          //         clearInterval(typingIntervalRef.current);
          //       }
          //     };
          //   }, []);

          //   const scrollToBottom = () => {
          //     messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
          //   };

          //   const renderMessageContent = (text: string) => {
          //     const codeRegex = /```(\w+)?\n([\s\S]*?)```/g;
          //     const parts: React.ReactNode[] = [];
          //     let lastIndex = 0;

          //     let match;
          //     while ((match = codeRegex.exec(text)) !== null) {
          //       const [fullMatch, lang, code] = match;
          //       const index = match.index;

          //       // Add text before the code block
          //       if (index > lastIndex) {
          //         const beforeCode = text.substring(lastIndex, index);
          //         parts.push(
          //           <div key={lastIndex} className="whitespace-pre-wrap">
          //             {beforeCode}
          //           </div>
          //         );
          //       }

          //       // Syntax-highlighted code block
          //       const highlightedCode = hljs.highlightAuto(
          //         code,
          //         lang ? [lang] : undefined
          //       ).value;

          //       parts.push(
          //         <pre
          //           key={index}
          //           className="rounded-lg overflow-auto p-3 bg-gray-900 text-white text-xs mt-2"
          //           dangerouslySetInnerHTML={{ __html: highlightedCode }}
          //         ></pre>
          //       );

          //       lastIndex = index + fullMatch.length;
          //     }

          //     // Add any remaining text after the last code block
          //     if (lastIndex < text.length) {
          //       const afterCode = text.substring(lastIndex);
          //       parts.push(
          //         <div key={lastIndex} className="whitespace-pre-wrap">
          //           {afterCode}
          //         </div>
          //       );
          //     }

          //     return parts;
          //   };

          //   const startTypingEffect = (messageId: string, fullText: string) => {
          //     let currentIndex = 0;
          //     const baseSpeed = 15; // Faster typing for real responses
          //     const minSpeed = 8;
          //     const maxSpeed = 25;

          //     const speed = Math.max(
          //       minSpeed,
          //       Math.min(maxSpeed, baseSpeed - fullText.length / 20)
          //     );

          //     // Clear any existing interval
          //     if (typingIntervalRef.current) {
          //       clearInterval(typingIntervalRef.current);
          //       typingIntervalRef.current = null;
          //     }

          //     typingIntervalRef.current = setInterval(() => {
          //       setMessages((prevMessages) =>
          //         prevMessages.map((msg) => {
          //           if (msg.id === messageId) {
          //             const newDisplayedText = fullText.substring(0, currentIndex + 1);
          //             currentIndex++;

          //             if (currentIndex >= fullText.length && typingIntervalRef.current) {
          //               clearInterval(typingIntervalRef.current);
          //               typingIntervalRef.current = null;
          //               return {
          //                 ...msg,
          //                 displayedText: newDisplayedText,
          //                 isTyping: false,
          //               };
          //             }

          //             return { ...msg, displayedText: newDisplayedText, isTyping: true };
          //           }
          //           return msg;
          //         })
          //       );

          //       scrollToBottom();
          //     }, speed);
          //   };

          //   const sendToAgent = async (query: string): Promise<AgentResponse> => {
          //     try {
          //       const requestBody: any = {
          //         query: query,
          //       };

          //       // Add table context if a table is selected
          //       if (selectedTable) {
          //         requestBody.table_id = selectedTable;
          //         requestBody.context_type = "table_context";
          //       }

          //       // Get JWT token for authentication
          //       const token = tokenUtils.getToken();

          //       const headers: Record<string, string> = {
          //         "Content-Type": "application/json",
          //       };

          //       // Add Authorization header if token exists
          //       if (token) {
          //         headers.Authorization = `Bearer ${token}`;
          //       }

          //       const response = await fetch("http://127.0.0.1:8000/agent/streaming/", {
          //         method: "POST",
          //         headers,
          //         credentials: "include", // Include cookies for CORS
          //         body: JSON.stringify(requestBody),
          //       });

          //       if (!response.ok) {
          //         throw new Error(`HTTP error! status: ${response.status}`);
          //       }

          //       const data: AgentResponse = await response.json();
          //       return data;
          //     } catch (error) {
          //       console.error("Error calling agent:", error);
          //       throw error;
          //     }
          //   };

          //   const handleSendMessage = async (e: React.FormEvent) => {
          //     e.preventDefault();

          //     if (inputValue.trim() === "" || isLoading) return;

          //     // Check authentication
          //     if (!isAuthenticated) {
          //       const errorMessage: ChatMessage = {
          //         id: Date.now().toString(),
          //         text: "Please log in to use the chat feature.",
          //         sender: "bot",
          //         timestamp: new Date(),
          //         displayedText: "Please log in to use the chat feature.",
          //       };
          //       setMessages((prev) => [...prev, errorMessage]);
          //       return;
          //     }

          //     // Add user message
          //     const userMessage: ChatMessage = {
          //       id: Date.now().toString(),
          //       text: inputValue,
          //       sender: "user",
          //       timestamp: new Date(),
          //       displayedText: inputValue,
          //     };

          //     setMessages((prev) => [...prev, userMessage]);
          //     const currentQuery = inputValue;
          //     setInputValue("");
          //     setInputRows(1);
          //     setIsLoading(true);

          //     // Add loading bot message
          //     const loadingMessage: ChatMessage = {
          //       id: (Date.now() + 1).toString(),
          //       text: "ðŸ¤” Thinking...",
          //       sender: "bot",
          //       timestamp: new Date(),
          //       isTyping: true,
          //       displayedText: "ðŸ¤” Thinking...",
          //     };

          //     setMessages((prev) => [...prev, loadingMessage]);

          //     try {
          //       // Call the agent streaming endpoint
          //       const agentResponse = await sendToAgent(currentQuery);

          //       // Remove loading message and add actual response
          //       setMessages((prev) => prev.filter((msg) => msg.id !== loadingMessage.id));

          //       const botMessage: ChatMessage = {
          //         id: (Date.now() + 2).toString(),
          //         text: agentResponse.response,
          //         sender: "bot",
          //         timestamp: new Date(),
          //         isTyping: true,
          //         displayedText: "",
          //         agentData: agentResponse, // Store the full agent response
          //       };

          //       setMessages((prev) => [...prev, botMessage]);

          //       // Start typing effect
          //       setTimeout(() => {
          //         startTypingEffect(botMessage.id, agentResponse.response);
          //       }, 300);
          //     } catch (error) {
          //       // Remove loading message and show error
          //       setMessages((prev) => prev.filter((msg) => msg.id !== loadingMessage.id));

          //       const errorMessage: ChatMessage = {
          //         id: (Date.now() + 3).toString(),
          //         text: "Sorry, I encountered an error while processing your request. Please make sure you're logged in and try again.",
          //         sender: "bot",
          //         timestamp: new Date(),
          //         displayedText:
          //           "Sorry, I encountered an error while processing your request. Please make sure you're logged in and try again.",
          //       };

          //       setMessages((prev) => [...prev, errorMessage]);
          //     } finally {
          //       setIsLoading(false);
          //     }
          //   };

          //   const formatTime = (date: Date) => {
          //     return date.toLocaleTimeString([], { hour: "2-digit", minute: "2-digit" });
          //   };

          //   return (
          //     <div
          //       className={`w-full h-full ${
          //         theme === "dark" ? "bg-gray-800" : "bg-white"
          //       }`}
          //     >
          //       <div className="h-full flex flex-col">
          //         {/* Chat header */}
          //         <div
          //           className={`p-4 border-b ${
          //             theme === "dark" ? "border-gray-700" : "border-gray-200"
          //           }`}
          //         >
          //           <div className="flex items-center justify-between">
          //             <h2
          //               className={`text-lg font-semibold ${
          //                 theme === "dark" ? "text-white" : "text-gray-800"
          //               }`}
          //             >
          //               AI Finance Assistant
          //             </h2>
          //             {selectedTable && (
          //               <div
          //                 className={`text-xs px-2 py-1 rounded-full ${
          //                   theme === "dark"
          //                     ? "bg-blue-600 text-blue-100"
          //                     : "bg-blue-100 text-blue-800"
          //                 }`}
          //               >
          //                 Context: Table {selectedTable}
          //               </div>
          //             )}
          //           </div>
          //           {!isAuthenticated && (
          //             <div
          //               className={`text-xs mt-2 ${
          //                 theme === "dark" ? "text-yellow-400" : "text-yellow-600"
          //               }`}
          //             >
          //               Please log in to use chat features
          //             </div>
          //           )}
          //         </div>

          //         {/* Chat messages area */}
          //         <div className="flex-1 overflow-y-auto p-4">
          //           <div className="space-y-4">
          //             {messages.map((message) => (
          //               <div
          //                 key={message.id}
          //                 className={`flex ${
          //                   message.sender === "user" ? "justify-end" : "justify-start"
          //                 }`}
          //               >
          //                 <div
          //                   className={`max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl rounded-lg p-3 ${
          //                     message.sender === "user"
          //                       ? theme === "dark"
          //                         ? "bg-blue-600 text-white"
          //                         : "bg-blue-500 text-white"
          //                       : theme === "dark"
          //                       ? "bg-gray-700 text-white"
          //                       : "bg-gray-200 text-gray-800"
          //                   }`}
          //                 >
          //                   <div className="text-sm">
          //                     {renderMessageContent(message.displayedText || "")}
          //                     {message.isTyping && (
          //                       <span className="ml-1 inline-block h-2 w-2 rounded-full bg-gray-400 animate-pulse"></span>
          //                     )}
          //                   </div>

          //                   {/* Show tool information if available */}
          //                   {message.agentData?.tools_called &&
          //                     message.agentData.tools_called.length > 0 &&
          //                     !message.isTyping && (
          //                       <div
          //                         className={`text-xs mt-2 p-2 rounded border-l-2 ${
          //                           theme === "dark"
          //                             ? "bg-gray-600 border-blue-400 text-gray-300"
          //                             : "bg-gray-100 border-blue-500 text-gray-600"
          //                         }`}
          //                       >
          //                         <div className="font-medium mb-1">Tools Used:</div>
          //                         {message.agentData.tools_called.map(
          //                           (
          //                             tool: { name: string; args: Record<string, any> },
          //                             index: number
          //                           ) => (
          //                             <div
          //                               key={index}
          //                               className="flex items-center gap-1"
          //                             >
          //                               <span className="w-1 h-1 bg-current rounded-full"></span>
          //                               <span>{tool.name}</span>
          //                             </div>
          //                           )
          //                         )}
          //                       </div>
          //                     )}

          //                   <div
          //                     className={`text-xs mt-1 text-right ${
          //                       message.sender === "user"
          //                         ? "text-blue-200"
          //                         : theme === "dark"
          //                         ? "text-gray-400"
          //                         : "text-gray-500"
          //                     }`}
          //                   >
          //                     {formatTime(message.timestamp)}
          //                   </div>
          //                 </div>
          //               </div>
          //             ))}
          //             <div ref={messagesEndRef} />
          //           </div>
          //         </div>

          //         {/* Chat input */}
          //         <div
          //           className={`p-4 border-t ${
          //             theme === "dark"
          //               ? "border-gray-700 bg-gray-700"
          //               : "border-gray-200 bg-gray-50"
          //           }`}
          //         >
          //           <form
          //             ref={formRef}
          //             onSubmit={handleSendMessage}
          //             className="flex gap-2 items-end"
          //           >
          //             <textarea
          //               ref={textareaRef}
          //               value={inputValue}
          //               onChange={handleInputChange}
          //               onKeyDown={handleKeyDown}
          //               placeholder={
          //                 isAuthenticated
          //                   ? "Ask me about your finances, expenses, or table data..."
          //                   : "Please log in to chat..."
          //               }
          //               disabled={!isAuthenticated || isLoading}
          //               rows={inputRows}
          //               className={`flex-1 p-3 rounded-lg resize-none ${
          //                 theme === "dark"
          //                   ? "bg-gray-600 text-white placeholder-gray-400"
          //                   : "bg-white text-gray-800 placeholder-gray-500"
          //               } border ${
          //                 theme === "dark" ? "border-gray-600" : "border-gray-300"
          //               } focus:outline-none focus:ring-2 ${
          //                 theme === "dark" ? "focus:ring-blue-500" : "focus:ring-blue-400"
          //               } overflow-y-auto max-h-32 ${
          //                 !isAuthenticated || isLoading
          //                   ? "opacity-50 cursor-not-allowed"
          //                   : ""
          //               }`}
          //               style={{ minHeight: "44px" }}
          //             />
          //             <button
          //               type="submit"
          //               disabled={
          //                 !isAuthenticated || isLoading || inputValue.trim() === ""
          //               }
          //               className={`px-4 py-2 rounded-lg font-medium h-fit ${
          //                 theme === "dark"
          //                   ? "bg-blue-600 hover:bg-blue-700 text-white"
          //                   : "bg-blue-500 hover:bg-blue-600 text-white"
          //               } focus:outline-none focus:ring-2 ${
          //                 theme === "dark" ? "focus:ring-blue-500" : "focus:ring-blue-400"
          //               } disabled:opacity-50 disabled:cursor-not-allowed ${
          //                 isLoading ? "animate-pulse" : ""
          //               }`}
          //             >
          //               {isLoading ? "..." : "Send"}
          //             </button>
          //           </form>
          //         </div>
          //       </div>
          //     </div>
          //   );
          // };

          // export default ChatArea;


          // 
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ ChatAreaReal.tsx (0.03 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import React, { useState, useRef, useEffect } from "react";
          import { useTheme } from "@/context/ThemeProvider";
          import hljs from "highlight.js";
          import "highlight.js/styles/github-dark.css";
          import { ChatMessage, defaultChatMessages } from "@/data/ChatMessages";
          import { handleChatOperation, chatApi } from "@/api/ChatApiReal";
          import { useSelectedTable } from "@/context/SelectedTableProvider";
          import { useTablesContent } from "@/context/DataProviderReal";
          import SpeechRecognition, {
            useSpeechRecognition,
          } from "react-speech-recognition";

          // declare global {
          //   interface Window {
          //     SpeechRecognition: any;
          //     webkitSpeechRecognition: any;
          //   }
          // }

          const ChatArea = () => {
            const { theme } = useTheme();
            const { selectedTable } = useSelectedTable();
            const { refreshData } = useTablesContent();
            const [messages, setMessages] = useState<ChatMessage[]>(defaultChatMessages);
            const [inputValue, setInputValue] = useState("");
            const [inputRows, setInputRows] = useState(1);
            const [isLoading, setIsLoading] = useState(false);
            const messagesEndRef = useRef<HTMLDivElement>(null);
            const formRef = useRef<HTMLFormElement>(null);
            const textareaRef = useRef<HTMLTextAreaElement>(null);
            const typingIntervalRef = useRef<NodeJS.Timeout | null>(null);
            const [selectedLanguage, setSelectedLanguage] = useState("en-US");
            const [isOnline, setIsOnline] = useState(navigator.onLine);

            const {
              transcript,
              listening,
              resetTranscript,
              browserSupportsSpeechRecognition,
            } = useSpeechRecognition();

            useEffect(() => {
              // Load chat history on mount
              (async () => {
                try {
                  const response = await chatApi.loadChatHistory();
                  if (response.success && response.data) {
                    setMessages(response.data);
                  }
                } catch (error) {
                  console.error("Error loading chat history:", error);
                }
              })();
            }, []);

            const isAuthenticated = () => {
              return !!localStorage.getItem("user");
            };

            useEffect(() => {
              scrollToBottom();
            }, [messages]);

            useEffect(() => {
              return () => {
                if (typingIntervalRef.current) {
                  clearInterval(typingIntervalRef.current);
                }
              };
            }, []);

            const scrollToBottom = () => {
              messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
            };

            const handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {
              if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                formRef.current?.requestSubmit();
              }
            };

            const handleInputChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {
              setInputValue(e.target.value);
              const lineCount = e.target.value.split("\n").length;
              setInputRows(Math.min(Math.max(lineCount, 1), 5));
            };

            const renderMessageContent = (text: string) => {
              const codeRegex = /```(\w+)?\n([\s\S]*?)```/g;
              const parts: React.ReactNode[] = [];
              let lastIndex = 0;
              let match;

              while ((match = codeRegex.exec(text)) !== null) {
                const [fullMatch, lang, code] = match;
                const index = match.index;

                if (index > lastIndex) {
                  const beforeCode = text.substring(lastIndex, index);
                  parts.push(
                    <div key={lastIndex} className="whitespace-pre-wrap">
                      {beforeCode}
                    </div>
                  );
                }

                const highlightedCode = hljs.highlightAuto(
                  code,
                  lang ? [lang] : undefined
                ).value;

                parts.push(
                  <pre
                    key={index}
                    className="rounded-lg overflow-auto p-3 bg-gray-900 text-white text-xs mt-2"
                    dangerouslySetInnerHTML={{ __html: highlightedCode }}
                  ></pre>
                );

                lastIndex = index + fullMatch.length;
              }

              if (lastIndex < text.length) {
                const afterCode = text.substring(lastIndex);
                parts.push(
                  <div key={lastIndex} className="whitespace-pre-wrap">
                    {afterCode}
                  </div>
                );
              }

              return parts;
            };

            const startTypingEffect = (messageId: string, fullText: string) => {
              let currentIndex = 0;
              const baseSpeed = 15;
              const minSpeed = 8;
              const maxSpeed = 25;
              const speed = Math.max(
                minSpeed,
                Math.min(maxSpeed, baseSpeed - fullText.length / 20)
              );

              if (typingIntervalRef.current) {
                clearInterval(typingIntervalRef.current);
                typingIntervalRef.current = null;
              }

              // Set initial state
              setMessages((prevMessages) =>
                prevMessages.map((msg) => {
                  if (msg.id === messageId) {
                    return {
                      ...msg,
                      displayedText: "",
                      isTyping: true,
                    };
                  }
                  return msg;
                })
              );

              typingIntervalRef.current = setInterval(() => {
                setMessages((prevMessages) =>
                  prevMessages.map((msg) => {
                    if (msg.id === messageId) {
                      const newDisplayedText = fullText.substring(0, currentIndex + 1);
                      currentIndex++;
                      if (currentIndex >= fullText.length && typingIntervalRef.current) {
                        clearInterval(typingIntervalRef.current);
                        typingIntervalRef.current = null;
                        return {
                          ...msg,
                          displayedText: newDisplayedText,
                          isTyping: false,
                        };
                      }
                      return { ...msg, displayedText: newDisplayedText, isTyping: true };
                    }
                    return msg;
                  })
                );

                scrollToBottom();
              }, speed);
            };

            const handleSendMessage = async (e: React.FormEvent) => {
              e.preventDefault();

              if (inputValue.trim() === "" || isLoading) return;

              // Check authentication
              if (!isAuthenticated()) {
                const errorMessage: ChatMessage = {
                  id: Date.now().toString(),
                  text: "Please log in to use the chat feature.",
                  sender: "bot",
                  timestamp: new Date(),
                  displayedText: "Please log in to use the chat feature.",
                };
                setMessages((prev) => [...prev, errorMessage]);
                return;
              }

              // Add user message
              const userMessage: ChatMessage = {
                id: Date.now().toString(),
                text: inputValue,
                sender: "user",
                timestamp: new Date(),
                displayedText: inputValue,
              };

              setMessages((prev) => [...prev, userMessage]);
              setInputValue("");
              setInputRows(1);
              setIsLoading(true);

              // Add loading message
              const loadingMessage: ChatMessage = {
                id: (Date.now() + 1).toString(),
                text: "ðŸ¤” Thinking...",
                sender: "bot",
                timestamp: new Date(),
                isTyping: true,
                displayedText: "ðŸ¤” Thinking...",
              };

              setMessages((prev) => [...prev, loadingMessage]);

              try {
                // Call the agent streaming endpoint with refreshData callback
                const botMessage = await handleChatOperation(
                  userMessage,
                  selectedTable?.toString(),
                  refreshData
                );

                if (!botMessage) {
                  throw new Error("No response received from the bot");
                }

                // Remove loading message and add bot message
                setMessages((prev) => {
                  const filteredMessages = prev.filter(
                    (msg) => msg.id !== loadingMessage.id
                  );
                  return [...filteredMessages, botMessage];
                });

                // Start typing effect
                startTypingEffect(botMessage.id, botMessage.text);
              } catch (error) {
                console.error("Error in handleSendMessage:", error);
                // Remove loading message and show error
                setMessages((prev) => {
                  const filteredMessages = prev.filter(
                    (msg) => msg.id !== loadingMessage.id
                  );
                  const errorMessage: ChatMessage = {
                    id: Date.now().toString(),
                    text: "Sorry, I encountered an error while processing your request. Please try again.",
                    sender: "bot",
                    timestamp: new Date(),
                    displayedText:
                      "Sorry, I encountered an error while processing your request. Please try again.",
                  };
                  return [...filteredMessages, errorMessage];
                });
              } finally {
                setIsLoading(false);
              }
            };

            const formatTime = (date: Date | string) => {
              const dateObj = typeof date === "string" ? new Date(date) : date;
              return dateObj.toLocaleTimeString([], {
                hour: "2-digit",
                minute: "2-digit",
              });
            };

            // Update input value when transcript changes
            useEffect(() => {
              if (transcript) {
                setInputValue(transcript);
              }
            }, [transcript]);

            // Online/Offline detection
            useEffect(() => {
              const handleOnline = () => setIsOnline(true);
              const handleOffline = () => setIsOnline(false);

              window.addEventListener("online", handleOnline);
              window.addEventListener("offline", handleOffline);

              return () => {
                window.removeEventListener("online", handleOnline);
                window.removeEventListener("offline", handleOffline);
              };
            }, []);

            const handleVoiceInput = () => {
              if (!isOnline) {
                alert("à¦­à¦¯à¦¼à§‡à¦¸ à¦°à§‡à¦•à¦—à¦¨à¦¿à¦¶à¦¨ à¦…à¦«à¦²à¦¾à¦‡à¦¨ à¦®à§‹à¦¡à§‡ à¦‰à¦ªà¦²à¦¬à§à¦§ à¦¨à¦¯à¦¼à¥¤");
                return;
              }

              if (!browserSupportsSpeechRecognition) {
                alert("à¦†à¦ªà¦¨à¦¾à¦° à¦¬à§à¦°à¦¾à¦‰à¦œà¦¾à¦° à¦­à¦¯à¦¼à§‡à¦¸ à¦°à§‡à¦•à¦—à¦¨à¦¿à¦¶à¦¨ à¦¸à¦¾à¦ªà§‹à¦°à§à¦Ÿ à¦•à¦°à§‡ à¦¨à¦¾à¥¤");
                return;
              }

              if (listening) {
                SpeechRecognition.stopListening();
              } else {
                resetTranscript();
                SpeechRecognition.startListening({
                  continuous: true,
                  language: selectedLanguage,
                });
              }
            };

            const toggleLanguage = () => {
              setSelectedLanguage((prev) => (prev === "en-US" ? "bn-BD" : "en-US"));
              if (listening) {
                SpeechRecognition.stopListening();
              }
            };

            return (
              <div
                className={`w-full h-full transition-colors duration-500 ease-in-out ${
                  theme === "dark"
                    ? "bg-gradient-to-br from-gray-950 via-gray-900 to-gray-950"
                    : "bg-gradient-to-br from-gray-50 via-white to-gray-100"
                } z-2000`}
              >
                <div className="h-full flex flex-col pt-[8%] lg:pt-[17%] xl:pt-[13%]">
                  {/* Header */}
                  <div
                    className={`p-4 border-b ${
                      theme === "dark"
                        ? "border-gray-800 bg-gray-900"
                        : "border-gray-200 bg-white"
                    } shadow-sm`}
                  >
                    <div className="flex items-center justify-between">
                      <div className="flex items-center space-x-3">
                        <div
                          className={`p-2 rounded-lg ${
                            theme === "dark" ? "bg-blue-600" : "bg-blue-500"
                          }`}
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-5 w-5 text-white"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fillRule="evenodd"
                              d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z"
                              clipRule="evenodd"
                            />
                          </svg>
                        </div>
                        <h2
                          className={`text-lg font-semibold ${
                            theme === "dark" ? "text-gray-100" : "text-gray-900"
                          }`}
                        >
                          AI Finance Assistant
                        </h2>
                      </div>
                      <div className="flex items-center space-x-2">
                        {selectedTable && (
                          <div
                            className={`text-xs px-3 py-1 rounded-full font-medium ${
                              theme === "dark"
                                ? "bg-blue-900/60 text-blue-100 border border-blue-800"
                                : "bg-blue-100 text-blue-800 border border-blue-200"
                            }`}
                          >
                            Context: Table {selectedTable}
                          </div>
                        )}
                        <button
                          onClick={async () => {
                            if (
                              window.confirm(
                                "Are you sure you want to clear the chat history?"
                              )
                            ) {
                              const response = await chatApi.clearChatHistory();
                              if (response.success) {
                                setMessages(defaultChatMessages);
                              }
                            }
                          }}
                          className={`p-2 rounded-lg transition-colors duration-500 ease-in-out ${
                            theme === "dark"
                              ? "bg-gray-700/80 hover:bg-gray-600 text-gray-200"
                              : "bg-gray-100/80 hover:bg-gray-200 text-gray-700"
                          }`}
                          aria-label="Clear chat history"
                        >
                          <svg
                            xmlns="http://www.w3.org/2000/svg"
                            className="h-5 w-5"
                            viewBox="0 0 20 20"
                            fill="currentColor"
                          >
                            <path
                              fillRule="evenodd"
                              d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z"
                              clipRule="evenodd"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>
                    {!isAuthenticated() && (
                      <div
                        className={`flex items-center text-xs mt-2 ${
                          theme === "dark" ? "text-amber-400" : "text-amber-600"
                        }`}
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          className="h-4 w-4 mr-1"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                        >
                          <path
                            fillRule="evenodd"
                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2h-1V9z"
                            clipRule="evenodd"
                          />
                        </svg>
                        Please log in to use chat features
                      </div>
                    )}
                  </div>

                  {/* Messages */}
                  <div className="flex-1 overflow-y-auto p-4">
                    <div className="space-y-4">
                      {messages.map((message) => (
                        <div
                          key={message.id}
                          className={`flex ${
                            message.sender === "user" ? "justify-end" : "justify-start"
                          }`}
                        >
                          <div
                            className={`max-w-xs md:max-w-md lg:max-w-lg xl:max-w-xl rounded-lg p-3 ${
                              message.sender === "user"
                                ? theme === "dark"
                                  ? "bg-gradient-to-r from-blue-600 to-blue-700 text-gray-50 ring-2 ring-blue-500/30"
                                  : "bg-gradient-to-r from-blue-500 to-blue-600 text-white ring-2 ring-blue-400/30"
                                : theme === "dark"
                                ? "bg-gradient-to-r from-gray-800 to-gray-900 text-gray-100 ring-2 ring-gray-700/30"
                                : "bg-gradient-to-r from-white to-gray-50 text-gray-800 ring-2 ring-gray-200/30"
                            } shadow-sm font-['Inter']`}
                          >
                            <div className="text-lg">
                              {renderMessageContent(message.displayedText || "")}
                              {message.isTyping && (
                                <span className="ml-1 inline-flex space-x-1">
                                  <span className="h-2 w-2 rounded-full bg-gray-400 animate-pulse"></span>
                                  <span className="h-2 w-2 rounded-full bg-gray-400 animate-pulse delay-75"></span>
                                  <span className="h-2 w-2 rounded-full bg-gray-400 animate-pulse delay-150"></span>
                                </span>
                              )}
                            </div>

                            {/* Show tool information if available */}
                            {message.agentData?.tools_called &&
                              message.agentData.tools_called.length > 0 &&
                              !message.isTyping && (
                                <div
                                  className={`text-xs mt-2 p-2 rounded ${
                                    theme === "dark"
                                      ? "bg-gray-700/50 text-gray-300 border-l-2 border-blue-500"
                                      : "bg-gray-100 text-gray-700 border-l-2 border-blue-400"
                                  }`}
                                >
                                  <div className="font-medium mb-1 flex items-center">
                                    <svg
                                      xmlns="http://www.w3.org/2000/svg"
                                      className="h-3 w-3 mr-1"
                                      viewBox="0 0 20 20"
                                      fill="currentColor"
                                    >
                                      <path
                                        fillRule="evenodd"
                                        d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                                        clipRule="evenodd"
                                      />
                                    </svg>
                                    Tools Used
                                  </div>
                                  {message.agentData.tools_called.map((tool, index) => (
                                    <div
                                      key={index}
                                      className="flex items-center gap-2 mt-1"
                                    >
                                      <span
                                        className={`w-1.5 h-1.5 rounded-full ${
                                          theme === "dark" ? "bg-blue-400" : "bg-blue-500"
                                        }`}
                                      ></span>
                                      <span className="font-mono">{tool.name}</span>
                                    </div>
                                  ))}
                                </div>
                              )}

                            <div
                              className={`text-xs mt-1 text-right ${
                                message.sender === "user"
                                  ? theme === "dark"
                                    ? "text-blue-200"
                                    : "text-blue-100"
                                  : theme === "dark"
                                  ? "text-gray-400"
                                  : "text-gray-500"
                              }`}
                            >
                              {formatTime(message.timestamp)}
                            </div>
                          </div>
                        </div>
                      ))}
                      <div ref={messagesEndRef} />
                    </div>
                  </div>

                  {/* Input */}
                  <div
                    className={`p-4 border-t ${
                      theme === "dark"
                        ? "border-gray-800 bg-gradient-to-t from-gray-900 to-gray-950"
                        : "border-gray-200 bg-gradient-to-t from-white to-gray-50"
                    } shadow-sm`}
                  >
                    {!isOnline && (
                      <div
                        className={`mb-3 p-2 text-sm rounded flex items-center ${
                          theme === "dark"
                            ? "bg-gray-800 text-amber-300 border border-gray-700"
                            : "bg-amber-50 text-amber-800 border border-amber-200"
                        }`}
                      >
                        <svg
                          className="w-4 h-4 mr-2 flex-shrink-0"
                          fill="none"
                          stroke="currentColor"
                          viewBox="0 0 24 24"
                        >
                          <path
                            strokeLinecap="round"
                            strokeLinejoin="round"
                            strokeWidth={2}
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
                          />
                        </svg>
                        <span>
                          {selectedLanguage === "en-US"
                            ? "You're currently offline. Some features may be limited."
                            : "à¦†à¦ªà¦¨à¦¿ à¦¬à¦°à§à¦¤à¦®à¦¾à¦¨à§‡ à¦…à¦«à¦²à¦¾à¦‡à¦¨ à¦®à§‹à¦¡à§‡ à¦†à¦›à§‡à¦¨à¥¤ à¦•à¦¿à¦›à§ à¦«à¦¿à¦šà¦¾à¦° à¦¸à§€à¦®à¦¿à¦¤ à¦¥à¦¾à¦•à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¥¤"}
                        </span>
                      </div>
                    )}

                    <form
                      ref={formRef}
                      onSubmit={handleSendMessage}
                      className="flex flex-col gap-3 mb-10"
                    >
                      <div className="flex flex-col sm:flex-row gap-2 items-end">
                        <textarea
                          ref={textareaRef}
                          value={inputValue}
                          onChange={handleInputChange}
                          onKeyDown={handleKeyDown}
                          placeholder={
                            isAuthenticated()
                              ? selectedLanguage === "en-US"
                                ? "Ask me about your finances, expenses, or table data..."
                                : "à¦†à¦ªà¦¨à¦¾à¦° à¦†à¦°à§à¦¥à¦¿à¦• à¦¬à¦¿à¦·à¦¯à¦¼, à¦–à¦°à¦š, à¦¬à¦¾ à¦Ÿà§‡à¦¬à¦¿à¦² à¦¡à§‡à¦Ÿà¦¾ à¦¸à¦®à§à¦ªà¦°à§à¦•à§‡ à¦œà¦¿à¦œà§à¦žà¦¾à¦¸à¦¾ à¦•à¦°à§à¦¨..."
                              : "Please log in to chat..."
                          }
                          disabled={!isAuthenticated() || isLoading}
                          rows={inputRows}
                          className={`flex-1 p-3 rounded-lg resize-none transition-all duration-500 ease-in-out font-['Inter'] ${
                            theme === "dark"
                              ? "bg-gray-800/50 text-gray-100 placeholder-gray-400 border-gray-700 focus:border-blue-500"
                              : "bg-white/80 text-gray-800 placeholder-gray-500 border-gray-300 focus:border-blue-400"
                          } border focus:outline-none focus:ring-2 ${
                            theme === "dark"
                              ? "focus:ring-blue-500/30"
                              : "focus:ring-blue-400/30"
                          } overflow-y-auto max-h-40 ${
                            !isAuthenticated() || isLoading
                              ? "opacity-50 cursor-not-allowed"
                              : ""
                          }`}
                          style={{ minHeight: "60px" }}
                        />

                        <div className="flex gap-2 mb-1 w-full sm:w-auto justify-end">
                          {/* Language Toggle Button */}
                          <button
                            type="button"
                            onClick={toggleLanguage}
                            className={`p-2 rounded-lg h-fit transition-colors duration-500 ease-in-out ${
                              theme === "dark"
                                ? "bg-gray-700/80 hover:bg-gray-600 text-gray-200"
                                : "bg-gray-100/80 hover:bg-gray-200 text-gray-700"
                            }`}
                            aria-label="Toggle language"
                          >
                            {selectedLanguage === "en-US" ? (
                              <span className="text-xs font-medium">à¦¬à¦¾à¦‚à¦²à¦¾</span>
                            ) : (
                              <span className="text-xs font-medium">EN</span>
                            )}
                          </button>

                          {/* Voice Input Button */}
                          <button
                            type="button"
                            onClick={handleVoiceInput}
                            disabled={
                              !isOnline ||
                              !isAuthenticated() ||
                              !browserSupportsSpeechRecognition
                            }
                            className={`p-2 rounded-lg h-fit transition-colors duration-500 ease-in-out ${
                              theme === "dark"
                                ? listening
                                  ? "bg-red-600/20 hover:bg-red-600/30 text-red-400"
                                  : "bg-gray-700/80 hover:bg-gray-600 text-gray-200"
                                : listening
                                ? "bg-red-100 hover:bg-red-200 text-red-600"
                                : "bg-gray-100/80 hover:bg-gray-200 text-gray-700"
                            } ${
                              !isOnline ||
                              !isAuthenticated() ||
                              !browserSupportsSpeechRecognition
                                ? "opacity-50 cursor-not-allowed"
                                : ""
                            }`}
                            aria-label="Voice input"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              className="h-5 w-5"
                              viewBox="0 0 20 20"
                              fill="currentColor"
                            >
                              <path
                                fillRule="evenodd"
                                d="M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z"
                                clipRule="evenodd"
                              />
                            </svg>
                          </button>

                          <button
                            type="submit"
                            disabled={
                              !isAuthenticated() || isLoading || inputValue.trim() === ""
                            }
                            className={`p-2 rounded-lg h-fit transition-colors duration-500 ease-in-out ${
                              theme === "dark"
                                ? "bg-blue-600/90 hover:bg-blue-500 text-white"
                                : "bg-blue-500/90 hover:bg-blue-400 text-white"
                            } disabled:opacity-50 disabled:cursor-not-allowed ${
                              isLoading ? "animate-pulse" : ""
                            }`}
                            aria-label="Send message"
                          >
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              className="h-5 w-5"
                              viewBox="0 0 20 20"
                              fill="currentColor"
                            >
                              <path
                                fillRule="evenodd"
                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z"
                                clipRule="evenodd"
                              />
                            </svg>
                          </button>
                        </div>
                      </div>

                      {/* Disclaimer text */}
                      <div
                        className={`text-xs mt-1 pb-2 px-1 text-center ${
                          theme === "dark" ? "text-gray-500" : "text-gray-400"
                        }`}
                      >
                        <p>
                          {selectedLanguage === "en-US"
                            ? "AI may produce inaccurate information. All content is protected by copyright."
                            : "AI à¦­à§à¦² à¦¤à¦¥à§à¦¯ à¦¦à¦¿à¦¤à§‡ à¦ªà¦¾à¦°à§‡à¥¤ à¦¸à¦®à¦¸à§à¦¤ à¦•à¦¨à§à¦Ÿà§‡à¦¨à§à¦Ÿ à¦•à¦ªà¦¿à¦°à¦¾à¦‡à¦Ÿ à¦¦à§à¦¬à¦¾à¦°à¦¾ à¦¸à§à¦°à¦•à§à¦·à¦¿à¦¤à¥¤"}
                        </p>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            );
          };

          export default ChatArea;

        --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ MainComponents
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ EmptyTableState.tsx (0.98 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          const EmptyTableState = () => {
            return (
              <div className="flex flex-col items-center justify-center h-full text-center p-6 pt-[5vh] lg:pt-[1vh]">
                <div className="w-24 h-24 mb-4 text-gray-300 dark:text-gray-600">
                  <svg
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={1.5}
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
                    />
                  </svg>
                </div>
                <h3 className="text-xl font-medium text-gray-500 dark:text-gray-400 mb-2">
                  No Table Selected
                </h3>
                <p className="text-gray-400 dark:text-gray-500 max-w-md">
                  Select a table from the sidebar or create a new one to view its contents
                </p>
              </div>
            );
          };

          export default EmptyTableState;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ ShowTable.tsx (0.03 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          //showTable.tsx
          import { useState, useRef, useEffect } from "react";
          import { useTablesContent, useTablesData } from "@/context/DataProviderReal";
          import { useSelectedTable } from "@/context/SelectedTableProvider";
          import { TableRow, JsonTableItem } from "@/data/TableContent";
          import { useTheme } from "@/context/ThemeProvider";
          import { handleJsonTableOperation } from "@/api/TableContentApi";
          import { jsonTableApi } from "@/api/TableContentApi";
          import EmptyTableState from "./EmptyTableState";

          // Simple icon components for demonstration
          type IconProps = {
            className?: string;
          };

          const PlusIcon = ({ className }: IconProps) => (
            <svg
              className={className}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M12 6v6m0 0v6m0-6h6m-6 0H6"
              />
            </svg>
          );

          const ColumnIcon = ({ className }: IconProps) => (
            <svg
              className={className}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"
              />
            </svg>
          );

          const TrashIcon = ({ className }: IconProps) => (
            <svg
              className={className}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
              />
            </svg>
          );

          const EditIcon = ({ className }: IconProps) => (
            <svg
              className={className}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"
              />
            </svg>
          );

          const DuplicateIcon = ({ className }: IconProps) => (
            <svg
              className={className}
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
              />
            </svg>
          );

          const ShowTable = () => {
            const { selectedTable } = useSelectedTable();
            console.log(`Selected Table for showing is: ${selectedTable}`);
            const { getTableContents, dispatchtablesContent } = useTablesContent();
            const { theme } = useTheme();
            const { getTableData } = useTablesData();

            const selectedTableData = getTableData(selectedTable);
            const TableContent = getTableContents(selectedTable);

            // Editing state
            const [editingCell, setEditingCell] = useState<{
              rowIndex: number;
              header: string;
            } | null>(null);
            const [editValue, setEditValue] = useState<string>("");
            const tableRef = useRef<HTMLTableElement>(null);

            // Context menu state
            const [contextMenu, setContextMenu] = useState<{
              visible: boolean;
              x: number;
              y: number;
              rowIndex?: number;
              header?: string;
            }>({ visible: false, x: 0, y: 0 });

            const [editingHeader, setEditingHeader] = useState<{
              header: string;
              value: string;
            } | null>(null);

            const [isOperationInProgress, setIsOperationInProgress] = useState(false);
            const [lastOperationError, setLastOperationError] = useState<string | null>(
              null
            );

            // Cell editing handlers
            const handleCellClick = (rowIndex: number, header: string) => {
              // Check if header matches any of the serial number patterns
              if (
                header.toLowerCase().match(/^(id|id number|number|no\.?|serial|sr\.?)$/i)
              ) {
                return; // Prevent editing if header matches serial number patterns
              }

              const cellValue = rows[rowIndex][header];
              setEditingCell({ rowIndex, header });
              setEditValue(
                cellValue !== null && cellValue !== undefined ? String(cellValue) : ""
              );
            };

            const handleCellChange = (e: React.ChangeEvent<HTMLInputElement>) => {
              setEditValue(e.target.value);
            };

            const handleCellBlur = async () => {
              if (!editingCell) return;

              const { rowIndex, header } = editingCell;
              const rowId = rows[rowIndex].id;
              if (typeof rowId !== "string" && typeof rowId !== "number") {
                setEditingCell(null);
                return;
              }

              await handleJsonTableOperation(
                {
                  type: "EDIT_ROW",
                  payload: {
                    tableId: TableContent[0].id,
                    rowId: rowId,
                    newRow: { [header]: editValue },
                  },
                },
                dispatchtablesContent
              );
              // dispatchtablesContent({
              //   type: "EDIT_ROW",
              //   payload: {
              //     tableId: TableContent[0].id,
              //     rowId: rowId,
              //     newRow: { [header]: editValue },
              //   },
              // });
              setEditingCell(null);
            };

            // Keyboard navigation
            const handleKeyDown = async (e: React.KeyboardEvent) => {
              if (!editingCell) return;

              const { rowIndex, header } = editingCell;

              switch (e.key) {
                case "Enter":
                  await handleCellBlur();
                  if (rowIndex < rows.length - 1) {
                    const downCellValue = rows[rowIndex + 1][header];
                    setEditValue(
                      downCellValue !== null && downCellValue !== undefined
                        ? String(downCellValue)
                        : ""
                    ); // Reset editValue for the new cell
                    setEditingCell({ rowIndex: rowIndex + 1, header });
                  }
                  break;

                case "Tab":
                  e.preventDefault();
                  await handleCellBlur();
                  const currentHeaderIndex = headers.indexOf(header);
                  if (currentHeaderIndex < headers.length - 1) {
                    const nextHeader = headers[currentHeaderIndex + 1];
                    const nextCellValue = rows[rowIndex][nextHeader];
                    setEditValue(
                      nextCellValue !== null && nextCellValue !== undefined
                        ? String(nextCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex, header: nextHeader });
                  } else if (rowIndex < rows.length - 1) {
                    const nextRowFirstHeader = headers[1];
                    const nextCellValue = rows[rowIndex + 1][nextRowFirstHeader];
                    setEditValue(
                      nextCellValue !== null && nextCellValue !== undefined
                        ? String(nextCellValue)
                        : ""
                    );
                    setEditingCell({
                      rowIndex: rowIndex + 1,
                      header: nextRowFirstHeader,
                    });
                  }
                  break;

                // Similar modifications for other cases...
                case "ArrowUp":
                  e.preventDefault();
                  await handleCellBlur();
                  if (rowIndex > 0) {
                    const upCellValue = rows[rowIndex - 1][header];
                    setEditValue(
                      upCellValue !== null && upCellValue !== undefined
                        ? String(upCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex: rowIndex - 1, header });
                  }
                  break;

                case "ArrowDown":
                  e.preventDefault();
                  await handleCellBlur();
                  if (rowIndex < rows.length - 1) {
                    const downCellValue = rows[rowIndex + 1][header];
                    setEditValue(
                      downCellValue !== null && downCellValue !== undefined
                        ? String(downCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex: rowIndex + 1, header });
                  }
                  break;

                case "ArrowLeft":
                  e.preventDefault();
                  await handleCellBlur();
                  const leftHeaderIndex = headers.indexOf(header);
                  if (leftHeaderIndex > 1) {
                    const leftHeader = headers[leftHeaderIndex - 1];
                    const leftCellValue = rows[rowIndex][leftHeader];
                    setEditValue(
                      leftCellValue !== null && leftCellValue !== undefined
                        ? String(leftCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex, header: leftHeader });
                  } else if (leftHeaderIndex === 1) {
                    const leftHeader = headers[headers.length - 1];
                    const leftCellValue = rows[rowIndex][leftHeader];
                    setEditValue(
                      leftCellValue !== null && leftCellValue !== undefined
                        ? String(leftCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex, header: leftHeader });
                  }
                  break;

                case "ArrowRight":
                  e.preventDefault();
                  await handleCellBlur();
                  const rightHeaderIndex = headers.indexOf(header);
                  if (rightHeaderIndex < headers.length - 1) {
                    const rightHeader = headers[rightHeaderIndex + 1];
                    const rightCellValue = rows[rowIndex][rightHeader];
                    setEditValue(
                      rightCellValue !== null && rightCellValue !== undefined
                        ? String(rightCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex, header: rightHeader });
                  } else if (rightHeaderIndex === headers.length - 1) {
                    const rightHeader = headers[1];
                    const rightCellValue = rows[rowIndex][rightHeader];
                    setEditValue(
                      rightCellValue !== null && rightCellValue !== undefined
                        ? String(rightCellValue)
                        : ""
                    );
                    setEditingCell({ rowIndex, header: rightHeader });
                  }
                  break;

                case "Escape":
                  setEditingCell(null);
                  break;
              }
            };

            // Add a function to refresh table data
            const refreshTableData = async () => {
              try {
                if (!selectedTable) {
                  throw new Error("No table selected");
                }

                // Get the current table data
                const response = await jsonTableApi.getTables();

                if (!response?.success) {
                  throw new Error(response?.error || "Failed to refresh table data");
                }

                // Update the state with the new data
                dispatchtablesContent({
                  type: "SET_TABLES",
                  payload: response.data as JsonTableItem[],
                });
              } catch (error) {
                console.error("Failed to refresh table data:", error);
              }
            };

            const handleDeleteColumn = async (header: string) => {
              if (isOperationInProgress) {
                console.log("Operation already in progress, please wait...");
                return;
              }

              try {
                setIsOperationInProgress(true);
                setLastOperationError(null);

                if (!TableContent || TableContent.length === 0) {
                  throw new Error("No table content available");
                }

                const tableId = TableContent[0].id;
                if (!tableId) {
                  throw new Error("Invalid table ID");
                }

                if (headers.length <= 1) {
                  throw new Error("Cannot delete the last column");
                }

                if (header === "id") {
                  throw new Error("Cannot delete the ID column");
                }

                console.log("Deleting column:", { tableId, header });

                const response = await handleJsonTableOperation(
                  {
                    type: "EDIT_TABLE_HEADERS",
                    payload: {
                      tableId,
                      headers: [header], // Send the header to delete
                    },
                  },
                  dispatchtablesContent
                );

                if (!response?.success) {
                  throw new Error(response?.error || "Failed to delete column");
                }

                console.log("Column deleted successfully");

                // Refresh table data to ensure consistency
                await refreshTableData();
              } catch (error) {
                const errorMessage =
                  error instanceof Error ? error.message : "Unknown error occurred";
                console.error("Error in handleDeleteColumn:", errorMessage);
                setLastOperationError(errorMessage);
                // Refresh table data to recover from error state
                await refreshTableData();
              } finally {
                setIsOperationInProgress(false);
              }
            };

            const handleAddRow = async () => {
              if (isOperationInProgress) {
                console.log("Operation already in progress, please wait...");
                return;
              }

              try {
                setIsOperationInProgress(true);
                setLastOperationError(null);

                if (!TableContent || TableContent.length === 0) {
                  throw new Error("No table content available");
                }

                // Create initial row with empty values
                const newRow: Omit<TableRow, "id"> = {};
                headers.forEach((header) => {
                  if (header !== "id") {
                    newRow[header] = "";
                  }
                });

                const response = await handleJsonTableOperation(
                  {
                    type: "ADD_ROW",
                    payload: {
                      tableId: TableContent[0].id,
                      row: newRow,
                    },
                  },
                  dispatchtablesContent
                );

                if (!response?.success) {
                  throw new Error(response?.error || "Failed to add row");
                }

                if (response?.data) {
                  console.log("Add Row Response:", response.data);

                  // Refresh table data to ensure consistency
                  await refreshTableData();

                  // Set editing cell after successful addition
                  setTimeout(() => {
                    const newRowIndex = rows.length;
                    setEditingCell({
                      rowIndex: newRowIndex,
                      header: headers[1],
                    });
                    setEditValue("");
                  }, 0);
                }
              } catch (error) {
                const errorMessage =
                  error instanceof Error ? error.message : "Unknown error occurred";
                console.error("Failed to add row:", errorMessage);
                setLastOperationError(errorMessage);
                // Refresh table data to recover from error state
                await refreshTableData();
              } finally {
                setIsOperationInProgress(false);
              }
            };

            const handleDuplicateRow = async (rowId: number | string) => {
              if (rowId === null) return;

              const sourceRow = rows.find((r) => r.id === rowId);
              if (!sourceRow) {
                console.error("No row found with id:", rowId);
                return;
              }

              // Create new row with source data
              const newRow: Omit<TableRow, "id"> = {};
              headers.forEach((header) => {
                if (header !== "id") {
                  newRow[header] = sourceRow[header];
                }
              });

              try {
                const response = await handleJsonTableOperation(
                  {
                    type: "ADD_ROW",
                    payload: {
                      tableId: TableContent[0].id,
                      row: newRow,
                    },
                  },
                  dispatchtablesContent
                );

                if (response?.success && response?.data) {
                  console.log("Duplicate Row Response:", response.data);
                }
              } catch (error) {
                console.error("Failed to duplicate row:", error);
              }
            };

            const handleAddColumn = async () => {
              try {
                if (!TableContent || TableContent.length === 0) {
                  console.error("No table content available");
                  return;
                }

                const tableId = TableContent[0].id;
                if (!tableId) {
                  console.error("Invalid table ID");
                  return;
                }

                // Generate a unique column name
                const existingHeaders = TableContent[0].data.headers;
                let columnNumber = existingHeaders.length;
                let newHeader = `column_${columnNumber}`;

                // Ensure the header name is unique
                while (existingHeaders.includes(newHeader)) {
                  columnNumber++;
                  newHeader = `column_${columnNumber}`;
                }

                console.log("Adding new column:", { tableId, newHeader });

                const response = await handleJsonTableOperation(
                  {
                    type: "ADD_COLUMN",
                    payload: {
                      tableId,
                      header: newHeader,
                    },
                  },
                  dispatchtablesContent
                );

                if (!response?.success) {
                  throw new Error(response?.error || "Failed to add column");
                }

                // If we reach here, the operation was successful
                console.log("Column added successfully");
              } catch (error) {
                console.error(
                  "Error in handleAddColumn:",
                  error instanceof Error ? error.message : "Unknown error occurred"
                );
                // Show error to user (you can implement a toast notification here)
              }
            };

            const handleDeleteRow = async (rowId: number | string) => {
              await handleJsonTableOperation(
                {
                  type: "DELETE_ROW",
                  payload: {
                    tableId: TableContent[0].id,
                    rowId,
                  },
                },
                dispatchtablesContent
              );
              // dispatchtablesContent({
              //   type: "DELETE_ROW",
              //   payload: {
              //     tableId: TableContent[0].id,
              //     rowId,
              //   },
              // });
            };

            // Update the delete column button to show loading state
            const renderDeleteColumnButton = (header: string) => (
              <button
                onClick={() => handleDeleteColumn(header)}
                className={`transition-colors ${
                  isOperationInProgress
                    ? "opacity-50 cursor-not-allowed"
                    : theme === "dark"
                    ? "text-gray-500 hover:text-red-400"
                    : "text-gray-400 hover:text-red-500"
                }`}
                title="Delete column"
                disabled={isOperationInProgress}
              >
                <TrashIcon className="w-4 h-4" />
              </button>
            );

            const handleContextMenu = (
              e: React.MouseEvent,
              rowIndex?: number,
              header?: string
            ) => {
              e.preventDefault();

              // Get absolute position accounting for scroll
              const x = e.clientX + window.scrollX - 265;
              const y = e.clientY + window.scrollY - 37;

              setContextMenu({
                visible: true,
                x,
                y,
                rowIndex,
                header,
              });
            };

            useEffect(() => {
              const handleClickOutside = () =>
                setContextMenu({ visible: false, x: 0, y: 0 });
              document.addEventListener("click", handleClickOutside);
              return () => document.removeEventListener("click", handleClickOutside);
            }, []);

            const handleHeaderDoubleClick = (header: string) => {
              if (header === "id") return; // Don't allow editing the ID header
              setEditingHeader({ header, value: header });
            };

            const handleHeaderChange = (e: React.ChangeEvent<HTMLInputElement>) => {
              if (editingHeader) {
                setEditingHeader({ ...editingHeader, value: e.target.value });
              }
            };

            const handleHeaderBlur = async () => {
              if (!editingHeader) return;

              const { header: oldHeader, value: newHeader } = editingHeader;
              if (oldHeader === newHeader) {
                setEditingHeader(null);
                return;
              }

              try {
                await handleJsonTableOperation(
                  {
                    type: "EDIT_HEADER",
                    payload: {
                      tableId: TableContent[0].id,
                      oldHeader,
                      newHeader,
                    },
                  },
                  dispatchtablesContent
                );
              } catch (error) {
                console.error("Failed to edit header:", error);
              }

              setEditingHeader(null);
            };

            const handleHeaderKeyDown = (e: React.KeyboardEvent) => {
              if (e.key === "Enter") {
                handleHeaderBlur();
              } else if (e.key === "Escape") {
                setEditingHeader(null);
              }
            };

            // Add error display component
            const ErrorDisplay = () => {
              if (!lastOperationError) return null;

              return (
                <div
                  className={`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50
                  ${
                    theme === "dark"
                      ? "bg-red-900/90 text-red-100"
                      : "bg-red-100 text-red-900"
                  }`}
                >
                  <div className="flex items-center gap-2">
                    <span className="text-lg">âš ï¸</span>
                    <span>{lastOperationError}</span>
                    <button
                      onClick={() => setLastOperationError(null)}
                      className="ml-2 hover:opacity-70"
                    >
                      Ã—
                    </button>
                  </div>
                </div>
              );
            };

            if (TableContent.length === 0) {
              return <EmptyTableState />;
            }

            const { headers, rows } = TableContent[0].data;

            return (
              <div
                className={`overflow-auto h-[90vh] mt-0 rounded-2xl shadow-2xl relative pb-[-5]
            ${
              theme === "dark"
                ? "bg-gradient-to-br from-gray-900 via-gray-800/95 to-gray-900/90 text-gray-100"
                : "bg-gradient-to-br from-blue-50 via-gray-50 to-indigo-50 text-gray-800 border border-gray-200"
            }`}
              >
                <ErrorDisplay />
                <div className="scrollbar-custom pt-2 pb-2">
                  <div className="min-w-max">
                    {/* Enhanced Toolbar with Glass Morphism */}
                    <div
                      className={`p-4 border-b flex justify-between items-center sticky top-0 z-20 backdrop-blur-lg
                        ${
                          theme === "dark"
                            ? "bg-gray-900/80 border-gray-700 shadow-lg"
                            : "bg-white/80 border-gray-200 shadow-sm"
                        }`}
                    >
                      <div className="flex items-center space-x-3">
                        <h2 className="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">
                          {selectedTableData[0]?.table_name ?? ""}
                        </h2>
                        <span
                          className={`px-3 py-1 rounded-full text-xs font-medium shadow-inner
                  ${
                    theme === "dark"
                      ? "bg-blue-900/30 text-blue-300 border border-blue-800/50"
                      : "bg-blue-100/80 text-blue-700 border border-blue-200"
                  }`}
                        >
                          {rows.length} {rows.length === 1 ? "entry" : "entries"}
                        </span>
                      </div>
                      <div className="flex gap-4">
                        <button
                          onClick={handleAddRow}
                          className={`px-5 py-2.5 text-white rounded-xl flex items-center gap-2 transition-all duration-500 ease-in-out shadow-lg hover:scale-[1.02]
                    ${
                      theme === "dark"
                        ? "bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-500 hover:to-blue-600 hover:shadow-blue-500/30"
                        : "bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-400 hover:to-blue-500 hover:shadow-blue-400/40"
                    }`}
                        >
                          <PlusIcon className="w-4 h-4" />
                          <span className="font-medium">Add Row</span>
                        </button>
                        <button
                          onClick={handleAddColumn}
                          className={`px-5 py-2.5 text-white rounded-xl flex items-center gap-2 transition-all duration-500 ease-in-out shadow-lg hover:scale-[1.02]
                    ${
                      theme === "dark"
                        ? "bg-gradient-to-r from-emerald-600 to-emerald-700 hover:from-emerald-500 hover:to-emerald-600 hover:shadow-emerald-500/30"
                        : "bg-gradient-to-r from-emerald-500 to-emerald-600 hover:from-emerald-400 hover:to-emerald-500 hover:shadow-emerald-400/40"
                    }`}
                        >
                          <ColumnIcon className="w-4 h-4" />
                          <span className="font-medium">Add Field</span>
                        </button>
                      </div>
                    </div>

                    {/* Luxurious Table with Enhanced Styling */}
                    <table
                      ref={tableRef}
                      className="min-w-full border-collapse table-fixed text-sm font-sans overflow-x-auto mb-10"
                      onKeyDown={handleKeyDown}
                    >
                      <thead className="sticky top-16 z-10">
                        <tr
                          className={`backdrop-blur-lg
                  ${theme === "dark" ? "bg-gray-900/80" : "bg-white/90"} shadow-sm`}
                        >
                          {headers.map((header) => (
                            <th
                              key={header}
                              className={`px-6 py-4 border-b text-left font-medium select-none transition-colors duration-500 ease-in-out
                        ${
                          theme === "dark"
                            ? "border-gray-700 text-gray-300 hover:bg-gray-800/50"
                            : "border-gray-200 text-gray-600 hover:bg-gray-50"
                        }`}
                              style={{ minWidth: "180px" }}
                              onDoubleClick={() => handleHeaderDoubleClick(header)}
                              onContextMenu={(e) =>
                                header !== "id" && handleContextMenu(e, undefined, header)
                              }
                            >
                              <div className="flex items-center justify-between">
                                {editingHeader?.header === header ? (
                                  <input
                                    type="text"
                                    value={editingHeader.value}
                                    onChange={handleHeaderChange}
                                    onBlur={handleHeaderBlur}
                                    onKeyDown={handleHeaderKeyDown}
                                    autoFocus
                                    className={`w-full px-3 py-2 rounded-xl focus:ring-2 outline-none transition-all shadow-inner
                              ${
                                theme === "dark"
                                  ? "bg-gray-800 border border-blue-500/70 text-white focus:ring-blue-400/50"
                                  : "bg-white border border-blue-400 text-gray-800 focus:ring-blue-300/50"
                              }`}
                                  />
                                ) : (
                                  <div className="flex items-center">
                                    <span
                                      className={`uppercase tracking-wider text-xs font-bold bg-clip-text text-transparent bg-gradient-to-r
                                        ${
                                          theme === "dark"
                                            ? "from-blue-400 to-emerald-400"
                                            : "from-blue-600 to-emerald-600"
                                        }`}
                                    >
                                      {header}
                                    </span>
                                  </div>
                                )}
                                {headers.length > 1 &&
                                  header !== "id" &&
                                  renderDeleteColumnButton(header)}
                              </div>
                            </th>
                          ))}
                        </tr>
                      </thead>
                      <tbody
                        className={`divide-y
                          ${
                            theme === "dark"
                              ? "divide-gray-800/50 hover:divide-gray-700/50"
                              : "divide-gray-100/80 hover:divide-gray-200/80"
                          }`}
                      >
                        {rows.map((row, rowIndex) => (
                          <tr
                            key={typeof row.id === "string" ? row.id : `row-${rowIndex}`}
                            className={`transition-all duration-500 ease-in-out group
                      ${
                        theme === "dark"
                          ? "hover:bg-gray-800/30 hover:shadow-[0_0_15px_rgba(0,0,0,0.1)]"
                          : "hover:bg-gray-50/70 hover:shadow-[0_0_15px_rgba(0,0,0,0.05)]"
                      }`}
                            onContextMenu={(e) => handleContextMenu(e, rowIndex)}
                          >
                            {headers.map((header) => (
                              <td
                                key={`${rowIndex}-${header}`}
                                className={`px-6 py-4 transition-colors duration-500 ease-in-out ${
                                  header === "amount" ? "font-mono" : ""
                                }
                          ${
                            theme === "dark"
                              ? "text-gray-300 group-hover:text-gray-100"
                              : "text-gray-700 group-hover:text-gray-900"
                          }`}
                                onClick={() => handleCellClick(rowIndex, header)}
                              >
                                {editingCell?.rowIndex === rowIndex &&
                                editingCell?.header === header ? (
                                  <input
                                    type={header === "amount" ? "number" : "text"}
                                    value={editValue}
                                    onChange={handleCellChange}
                                    onBlur={handleCellBlur}
                                    autoFocus
                                    className={`w-full px-4 py-2.5 rounded-xl transition-all duration-500 ease-in-out shadow-inner
                              ${
                                theme === "dark"
                                  ? "bg-gray-800/70 text-white border border-gray-700 hover:border-blue-500/70 focus:border-blue-500 focus:ring-2 focus:ring-blue-500/20"
                                  : "bg-white text-gray-800 border border-gray-200 hover:border-blue-400 focus:border-blue-400 focus:ring-2 focus:ring-blue-400/20"
                              }
                              outline-none`}
                                  />
                                ) : (
                                  <div className="flex items-center">
                                    {header === "amount" && (
                                      <span
                                        className={`mr-2 text-sm ${
                                          parseFloat(String(row[header] ?? 0)) < 0
                                            ? theme === "dark"
                                              ? "text-red-400"
                                              : "text-red-500"
                                            : theme === "dark"
                                            ? "text-emerald-400"
                                            : "text-emerald-600"
                                        }`}
                                      >
                                        {parseFloat(String(row[header] ?? 0)) < 0
                                          ? "â†“"
                                          : "â†‘"}
                                      </span>
                                    )}
                                    <span
                                      className={`truncate ${
                                        header === "amount"
                                          ? parseFloat(String(row[header] ?? 0)) < 0
                                            ? theme === "dark"
                                              ? "text-red-300"
                                              : "text-red-600"
                                            : theme === "dark"
                                            ? "text-emerald-300"
                                            : "text-emerald-700"
                                          : ""
                                      }`}
                                      title={String(row[header])}
                                    >
                                      {header
                                        .toLowerCase()
                                        .match(
                                          /^(id|id number|number|no\.?|serial|sr\.?)$/i
                                        )
                                        ? rowIndex + 1
                                        : header === "amount"
                                        ? new Intl.NumberFormat("en-US", {
                                            style: "currency",
                                            currency: "USD",
                                            minimumFractionDigits: 2,
                                            maximumFractionDigits: 2,
                                          }).format(
                                            parseFloat(String(row[header] ?? 0)) || 0
                                          )
                                        : row[header]}
                                    </span>
                                  </div>
                                )}
                              </td>
                            ))}
                          </tr>
                        ))}
                      </tbody>
                    </table>

                    {/* Premium Status Bar */}
                    <div
                      className={`fixed bottom-0 left-0 right-0 backdrop-blur-lg px-5 py-3 text-xs border-t flex justify-between items-center z-50
                        ${
                          theme === "dark"
                            ? "bg-gray-900/80 border-gray-700 text-gray-400 shadow-lg"
                            : "bg-white/90 border-gray-200 text-gray-500 shadow-sm"
                        } w-[100%]`}
                    >
                      <div className="flex items-center gap-2">
                        <span
                          className={`inline-block w-2 h-2 rounded-full ${
                            theme === "dark" ? "bg-blue-500" : "bg-blue-400"
                          }`}
                        ></span>
                        Last updated: {selectedTableData[0]?.modified_at ?? "Just now"}
                      </div>
                      <div className="flex items-center gap-6 justify-end">
                        <span className="flex items-center gap-2">
                          <span
                            className={`w-3 h-3 rounded-full ${
                              theme === "dark" ? "bg-emerald-400" : "bg-emerald-500"
                            }`}
                          ></span>
                          <span className="font-medium">Income</span>
                        </span>
                        <span className="flex items-center gap-2">
                          <span
                            className={`w-3 h-3 rounded-full ${
                              theme === "dark" ? "bg-red-400" : "bg-red-500"
                            }`}
                          ></span>
                          <span className="font-medium">Expense</span>
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                {/* Premium Context Menu */}
                {contextMenu.visible && (
                  <div
                    className={`fixed shadow-2xl rounded-xl py-1 z-50 overflow-hidden min-w-[200px] backdrop-blur-lg border
                  ${
                    theme === "dark"
                      ? "bg-gray-800/90 border-gray-700"
                      : "bg-white/95 border-gray-200"
                  }`}
                    style={{
                      left: `${contextMenu.x}px`,
                      top: `${contextMenu.y}px`,
                      transform: "scale(0.95)",
                      animation: "scaleIn 0.15s ease-out forwards",
                      transformOrigin: "top left",
                    }}
                    onClick={(e) => e.stopPropagation()}
                  >
                    {contextMenu.rowIndex !== undefined && (
                      <>
                        <button
                          className={`flex w-full items-center px-5 py-3 transition-all duration-500 ease-in-out gap-3 hover:pl-6
                        ${
                          theme === "dark"
                            ? "text-gray-300 hover:bg-gray-700/80"
                            : "text-gray-700 hover:bg-gray-100"
                        }`}
                          onClick={() => {
                            const rowId = rows[contextMenu.rowIndex!].id;
                            if (typeof rowId === "string" || typeof rowId === "number") {
                              handleDeleteRow(rowId);
                            }
                            setContextMenu({ visible: false, x: 0, y: 0 });
                          }}
                        >
                          <TrashIcon
                            className={`w-5 h-5 ${
                              theme === "dark" ? "text-red-400" : "text-red-500"
                            }`}
                          />
                          <span className="font-medium">Delete Entry</span>
                        </button>
                        <button
                          className={`flex w-full items-center px-5 py-3 transition-all duration-500 ease-in-out gap-3 hover:pl-6
                        ${
                          theme === "dark"
                            ? "text-gray-300 hover:bg-gray-700/80"
                            : "text-gray-700 hover:bg-gray-100"
                        }`}
                          onClick={() => {
                            setEditingCell({
                              rowIndex: contextMenu.rowIndex!,
                              header: headers[1],
                            });
                            setContextMenu({ visible: false, x: 0, y: 0 });
                          }}
                        >
                          <EditIcon
                            className={`w-5 h-5 ${
                              theme === "dark" ? "text-blue-400" : "text-blue-500"
                            }`}
                          />
                          <span className="font-medium">Edit Entry</span>
                        </button>
                        <div
                          className={`my-1 ${
                            theme === "dark"
                              ? "border-t border-gray-700"
                              : "border-t border-gray-200"
                          }`}
                        ></div>
                        <button
                          className={`flex w-full items-center px-5 py-3 transition-all duration-500 ease-in-out gap-3 hover:pl-6
                        ${
                          theme === "dark"
                            ? "text-gray-300 hover:bg-gray-700/80"
                            : "text-gray-700 hover:bg-gray-100"
                        }`}
                          onClick={() => {
                            const rowId = rows[contextMenu.rowIndex!].id;
                            if (typeof rowId === "string" || typeof rowId === "number") {
                              handleDuplicateRow(rowId);
                            }
                            setContextMenu({ visible: false, x: 0, y: 0 });
                          }}
                        >
                          <DuplicateIcon
                            className={`w-5 h-5 ${
                              theme === "dark" ? "text-purple-400" : "text-purple-500"
                            }`}
                          />
                          <span className="font-medium">Duplicate</span>
                        </button>
                      </>
                    )}
                    {contextMenu.header && contextMenu.header !== "id" && (
                      <button
                        className={`flex w-full items-center px-5 py-3 transition-all duration-500 ease-in-out gap-3 hover:pl-6
                        ${
                          theme === "dark"
                            ? "text-gray-300 hover:bg-gray-700/80"
                            : "text-gray-700 hover:bg-gray-100"
                        }`}
                        onClick={() => {
                          handleDeleteColumn(contextMenu.header!);
                          setContextMenu({ visible: false, x: 0, y: 0 });
                        }}
                      >
                        <TrashIcon
                          className={`w-5 h-5 ${
                            theme === "dark" ? "text-red-400" : "text-red-500"
                          }`}
                        />
                        <span className="font-medium">Delete Column</span>
                      </button>
                    )}
                  </div>
                )}
              </div>
            );
          };

          export default ShowTable;

        --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ landingPageComponents
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ Benefits.tsx (3.67 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import React from "react";
          import { Zap, Users, Mic, Shield, Globe, TrendingUp } from "lucide-react";
          import { useTheme } from "@/context/ThemeProvider";
          import clsx from "clsx";

          const benefits = [
            {
              icon: Zap,
              title: "80% Faster Data Entry",
              description:
                "Voice commands and AI automation dramatically reduce manual work. What used to take hours now takes minutes with natural conversation.",
            },
            {
              icon: Mic,
              title: "Hands-Free Operation",
              description:
                "Complete data management without typing. Perfect for busy professionals, accessibility needs, or when your hands are occupied.",
            },
            {
              icon: Users,
              title: "Real-Time Collaboration",
              description:
                "Share tables instantly with family and friends. See changes in real-time with secure permission management and activity tracking.",
            },
            {
              icon: Globe,
              title: "Bengali & English Support",
              description:
                "Native support for both languages in voice, chat, and interface. Switch seamlessly between languages for the most natural experience.",
            },
            {
              icon: Shield,
              title: "Intelligent Data Security",
              description:
                "Advanced JWT authentication with database-level permissions. Your data is secure with comprehensive audit trails and access control.",
            },
            {
              icon: TrendingUp,
              title: "Unlimited Flexibility",
              description:
                "Dynamic table creation supports any data type - expenses, tasks, inventory, events. One platform for all your structured data needs.",
            },
          ];

          const Benefits = () => {
            const { theme } = useTheme();

            return (
              <section
                id="why-us"
                className={clsx(
                  "py-16 md:py-24 transition-colors duration-300",
                  theme === "dark" ? "bg-gray-900" : "bg-blue-50"
                )}
              >
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                  <div className="text-center mb-16">
                    <h2
                      className={clsx(
                        "text-3xl md:text-4xl font-bold mb-4",
                        theme === "dark" ? "text-white" : "text-gray-900"
                      )}
                    >
                      Why FinBot is Revolutionary
                    </h2>
                    <p
                      className={clsx(
                        "text-lg max-w-3xl mx-auto",
                        theme === "dark" ? "text-gray-300" : "text-gray-600"
                      )}
                    >
                      Combining conversational AI, voice interfaces, and collaborative
                      features with flexible API-driven data storage for the most
                      intuitive data management experience ever created.
                    </p>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-10">
                    {benefits.map((benefit) => (
                      <div key={benefit.title} className="flex items-start space-x-4">
                        <div className="flex-shrink-0">
                          <benefit.icon
                            className={clsx(
                              "w-8 h-8 mt-1",
                              theme === "dark" ? "text-blue-400" : "text-blue-600"
                            )}
                            strokeWidth={2}
                          />
                        </div>
                        <div>
                          <h3
                            className={clsx(
                              "text-xl font-semibold mb-2",
                              theme === "dark" ? "text-gray-100" : "text-gray-800"
                            )}
                          >
                            {benefit.title}
                          </h3>
                          <p
                            className={clsx(
                              "leading-relaxed",
                              theme === "dark" ? "text-gray-400" : "text-gray-600"
                            )}
                          >
                            {benefit.description}
                          </p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
              </section>
            );
          };

          export default Benefits;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ CTA.tsx (2.85 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import React from "react";
          import { useTheme } from "@/context/ThemeProvider";
          import clsx from "clsx";

          const CTA = () => {
            const { theme } = useTheme();

            return (
              <section
                id="cta"
                className={clsx(
                  "py-20 md:py-28 transition-colors duration-300",
                  theme === "dark"
                    ? "bg-gray-800"
                    : "bg-gradient-to-r from-blue-600 to-indigo-700",
                  theme === "dark" ? "text-white" : "text-white"
                )}
              >
                <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
                  <h2 className={clsx("text-3xl md:text-4xl lg:text-5xl font-bold mb-6")}>
                    Ready to Experience the Future of Data Management?
                  </h2>
                  <p
                    className={clsx(
                      "text-lg md:text-xl mb-8 max-w-3xl mx-auto",
                      theme === "dark" ? "text-gray-300" : "text-blue-100"
                    )}
                  >
                    Join the revolution in data management. Speak naturally in Bengali or
                    English, collaborate in real-time, and reduce manual work by 80%. Your
                    data has never been this accessible.
                  </p>
                  <div className="flex flex-col sm:flex-row gap-4 justify-center items-center mb-6">
                    <div
                      className={clsx(
                        "text-sm px-4 py-2 rounded-full",
                        theme === "dark" ? "bg-gray-700" : "bg-white/20"
                      )}
                    >
                      ðŸŽ¤ Voice Commands: "à¦†à¦®à¦¿ à¦†à¦œà¦•à§‡ à§§à§¦à§¦ à¦Ÿà¦¾à¦•à¦¾ à¦–à¦°à¦š à¦•à¦°à§‡à¦›à¦¿"
                    </div>
                    <div
                      className={clsx(
                        "text-sm px-4 py-2 rounded-full",
                        theme === "dark" ? "bg-gray-700" : "bg-white/20"
                      )}
                    >
                      ðŸ¤ Real-time Collaboration
                    </div>
                    <div
                      className={clsx(
                        "text-sm px-4 py-2 rounded-full",
                        theme === "dark" ? "bg-gray-700" : "bg-white/20"
                      )}
                    >
                      ðŸ§  AI-Powered Intelligence
                    </div>
                  </div>
                  <div className="flex flex-col sm:flex-row gap-4 justify-center">
                    <a
                      href="/chat/"
                      className={clsx(
                        "px-10 py-4 rounded-lg transition-colors font-semibold text-xl shadow-md hover:shadow-lg",
                        theme === "dark"
                          ? "bg-blue-500 text-white hover:bg-blue-600"
                          : "bg-white text-blue-600 hover:bg-gray-100"
                      )}
                    >
                      ðŸŽ¤ Try Voice Chat Now
                    </a>
                    <a
                      href="/signin"
                      className={clsx(
                        "px-10 py-4 rounded-lg border-2 transition-colors font-semibold text-xl",
                        theme === "dark"
                          ? "border-gray-400 text-gray-300 hover:bg-gray-700"
                          : "border-white text-white hover:bg-white/10"
                      )}
                    >
                      Get Started Free
                    </a>
                  </div>
                </div>
              </section>
            );
          };

          export default CTA;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ Features.tsx (3.91 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import React from "react";
          import {
            Mic,
            MessageSquare,
            Users,
            Database,
            Brain,
            Globe,
          } from "lucide-react";
          import { useTheme } from "@/context/ThemeProvider";
          import clsx from "clsx";

          const features = [
            {
              icon: Mic,
              title: "Voice Chat Interface",
              description:
                "Real-time speech recognition in Bengali and English. Speak naturally and watch your data get organized instantly with hands-free operation.",
            },
            {
              icon: Brain,
              title: "AI-Powered Data Management",
              description:
                "Claude AI with Model Context Protocol provides direct database access. Complex queries, smart categorization, and intelligent insights.",
            },
            {
              icon: MessageSquare,
              title: "Natural Language Chat",
              description:
                'Chat with your data using everyday language. "Show me expenses from last week" or "à¦†à¦®à¦¾à¦° à¦—à¦¤ à¦®à¦¾à¦¸à§‡à¦° à¦–à¦°à¦š à¦¦à§‡à¦–à¦¾à¦“" - both work perfectly.',
            },
            {
              icon: Users,
              title: "Collaborative Sharing",
              description:
                "Share tables with friends and family. Real-time collaboration with permission management and activity tracking for team financial planning.",
            },
            {
              icon: Database,
              title: "Dynamic Table Creation",
              description:
                "Create any type of table structure on-the-fly. From expense tracking to project management - unlimited flexibility with JSON-based schema.",
            },
            {
              icon: Globe,
              title: "Multilingual Support",
              description:
                "Full Bengali and English support for voice commands, chat, and UI. Switch languages seamlessly for the most natural experience.",
            },
          ];

          const Features = () => {
            const { theme } = useTheme();

            return (
              <section
                id="features"
                className={clsx(
                  "py-16 md:py-24 transition-colors duration-300",
                  theme === "dark" ? "bg-gray-800" : "bg-white"
                )}
              >
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                  <div className="text-center mb-16">
                    <h2
                      className={clsx(
                        "text-3xl md:text-4xl font-bold mb-4",
                        theme === "dark" ? "text-white" : "text-gray-900"
                      )}
                    >
                      Revolutionary Features
                    </h2>
                    <p
                      className={clsx(
                        "text-lg max-w-3xl mx-auto",
                        theme === "dark" ? "text-gray-300" : "text-gray-600"
                      )}
                    >
                      Experience the next generation of data management with voice AI,
                      collaborative features, and intelligent automation that reduces
                      manual work by 80%.
                    </p>
                  </div>
                  <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    {features.map((feature) => (
                      <div
                        key={feature.title}
                        className={clsx(
                          "p-6 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 flex flex-col items-start text-left border",
                          theme === "dark"
                            ? "bg-gray-700 border-gray-600 hover:border-blue-500"
                            : "bg-gray-50 border-gray-200 hover:border-blue-300"
                        )}
                      >
                        <feature.icon
                          className={clsx(
                            "w-10 h-10 mb-4",
                            theme === "dark" ? "text-blue-400" : "text-blue-600"
                          )}
                          strokeWidth={1.5}
                        />
                        <h3
                          className={clsx(
                            "text-xl font-semibold mb-3",
                            theme === "dark" ? "text-gray-100" : "text-gray-800"
                          )}
                        >
                          {feature.title}
                        </h3>
                        <p
                          className={clsx(
                            "leading-relaxed text-sm",
                            theme === "dark" ? "text-gray-400" : "text-gray-600"
                          )}
                        >
                          {feature.description}
                        </p>
                      </div>
                    ))}
                  </div>
                </div>
              </section>
            );
          };

          export default Features;

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ Footer.tsx (0.55 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import React from 'react';
          import { useTheme } from '@/context/ThemeProvider';
          import clsx from 'clsx';

          const Footer = () => {
            const { theme } = useTheme();

            return (
              <footer className={clsx(
                "py-10 text-center transition-colors duration-300",
                theme === 'dark' ? "bg-gray-900" : "bg-gray-800"
              )}>
                <p className={clsx(
                  "text-sm",
                  theme === 'dark' ? "text-gray-500" : "text-gray-400"
                )}>
                  &copy; {new Date().getFullYear()} FinBot. All rights reserved.
                </p>
              </footer>
            );
          };

          export default Footer;
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ Hero.tsx (4.23 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client";
          import React, { useState, useEffect } from "react";
          import { useTheme } from "@/context/ThemeProvider";
          import clsx from "clsx";
          import Image from "next/image";

          const images = [
            "unsplash_1.JPG",
            "unsplash_2.JPG",
            "unsplash_3.JPG",
            "unsplash_4.JPG",
            "unsplash_5.JPG",
            "unsplash_6.JPG"
          ];

          const primaryButtonStyleLight =
            "bg-blue-600 text-white px-8 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold text-lg";
          const primaryButtonStyleDark =
            "bg-blue-500 text-white px-8 py-3 rounded-lg hover:bg-blue-600 transition-colors font-semibold text-lg";

          export default function Hero() {
            const { theme } = useTheme();
            const [imageUrl, setImageUrl] = useState<string>("");

            useEffect(() => {
              const randomIndex = Math.floor(Math.random() * images.length);
              setImageUrl(`/${images[randomIndex]}`); // âœ… Prefix with '/' for public folder
            }, []);

            return (
              <section
                className={clsx(
                  "pt-32 pb-16 md:pt-40 md:pb-24 transition-colors duration-300",
                  theme === "dark"
                    ? "bg-gray-800"
                    : "bg-gradient-to-br from-blue-50 to-indigo-100"
                )}
              >
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid md:grid-cols-2 gap-12 items-center">
                  <div className="text-center md:text-left">
                    <h1
                      className={clsx(
                        "text-4xl md:text-5xl lg:text-6xl font-extrabold mb-6 leading-tight",
                        theme === "dark" ? "text-white" : "text-gray-900"
                      )}
                    >
                      Manage Any Data with
                      <span className="bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                        {" "}Voice & AI
                      </span>
                    </h1>
                    <p
                      className={clsx(
                        "text-lg md:text-xl mb-6 max-w-xl mx-auto md:mx-0",
                        theme === "dark" ? "text-gray-300" : "text-gray-700"
                      )}
                    >
                      Experience the future of data management with{" "}
                      <strong>FinBot</strong> - an AI-powered platform that lets you
                      manage any kind of data using natural chat, voice commands, and
                      manual operations in both <strong>Bengali and English</strong>.
                    </p>
                    <div
                      className={clsx(
                        "mb-8 p-4 rounded-lg border-l-4 border-blue-500",
                        theme === "dark" ? "bg-gray-700/50" : "bg-blue-50"
                      )}
                    >
                      <p
                        className={clsx(
                          "text-sm font-medium",
                          theme === "dark" ? "text-blue-300" : "text-blue-700"
                        )}
                      >
                        ðŸŽ¤ "à¦†à¦®à¦¿ à¦†à¦œà¦•à§‡ à§§à§¦à§¦ à¦Ÿà¦¾à¦•à¦¾ à¦–à¦°à¦š à¦•à¦°à§‡à¦›à¦¿" â†’ Instantly added to your expense table
                      </p>
                      <p
                        className={clsx(
                          "text-xs mt-1",
                          theme === "dark" ? "text-gray-400" : "text-gray-600"
                        )}
                      >
                        Reduces manual work by <strong>80%+</strong> through voice and AI automation
                      </p>
                    </div>
                    <div className="flex flex-col sm:flex-row gap-4">
                      <a
                        href="/chat/"
                        className={
                          theme === "dark"
                            ? primaryButtonStyleDark
                            : primaryButtonStyleLight
                        }
                      >
                        ðŸŽ¤ Try Voice Chat
                      </a>
                      <a
                        href="/signin"
                        className={clsx(
                          "px-8 py-3 rounded-lg border-2 transition-colors font-semibold text-lg text-center",
                          theme === "dark"
                            ? "border-gray-600 text-gray-300 hover:bg-gray-700"
                            : "border-blue-600 text-blue-600 hover:bg-blue-50"
                        )}
                      >
                        Get Started Free
                      </a>
                    </div>
                  </div>
                  <div className="flex justify-center">
                    {imageUrl && (
                      <Image
                        src={imageUrl}
                        alt="FinBot Voice & AI Data Management"
                        width={500}
                        height={400}
                        className="rounded-xl shadow-2xl transform transition-transform duration-500 hover:scale-105"
                        unoptimized // âœ… Correctly used inside the tag
                      />
                    )}
                  </div>
                </div>
              </section>
            );
          }

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ Nabvar.tsx (0.01 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          "use client";

          import React, { useState, useEffect } from "react";
          import { useTheme } from "@/context/ThemeProvider";
          import {
            FiMenu,
            FiX,
            FiSun,
            FiMoon,
            FiSettings,
            FiUsers,
            FiMessageSquare,
            FiLogOut,
          } from "react-icons/fi";
          import clsx from "clsx";

          import { useRouter, usePathname } from "next/navigation";
          import SettingsModal from "@/components/SettingsModal";
          import { useUser } from "@/context/AuthProvider";

          const Navbar = () => {
            const { theme, toggleTheme } = useTheme();
            const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [isSettingsOpen, setIsSettingsOpen] = useState(false);
            const [showUserMenu, setShowUserMenu] = useState(false);
            const [user, setUser] = useState<any>(null);
            const router = useRouter();
            const pathname = usePathname();
            const { signOut } = useUser();

            useEffect(() => {
              // Check if user is logged in
              const userData = localStorage.getItem("user");
              if (userData) {
                setUser(JSON.parse(userData));
                setIsLoggedIn(true);
              }
            }, []);

            const toggleMobileMenu = () => {
              setIsMobileMenuOpen((prev) => !prev);
            };

            const handleChatClick = (e: React.MouseEvent) => {
              e.preventDefault();
              if (!isLoggedIn) {
                router.push("/signin");
              } else {
                router.push("/chat");
              }
            };

            const handleFriendsClick = (e: React.MouseEvent) => {
              e.preventDefault();
              if (!isLoggedIn) {
                router.push("/signin");
              } else {
                router.push("/users");
              }
            };

            const handleLogoClick = (e: React.MouseEvent) => {
              e.preventDefault();
              if (pathname !== "/") {
                router.push("/");
              }
            };

            const handleSignOut = () => {
              signOut();
              setShowUserMenu(false);
              localStorage.removeItem("user");
              setIsLoggedIn(false);
              setShowUserMenu(false);
              router.push("/");
            };

            const linkStyle = clsx(
              "font-medium transition-colors",
              theme === "dark"
                ? "text-gray-300 hover:text-white"
                : "text-gray-600 hover:text-blue-600"
            );

            return (
              <nav
                className={clsx(
                  "w-full fixed top-0 z-50 shadow-sm transition-colors duration-300",
                  theme === "dark" ? "bg-gray-900" : "bg-white"
                )}
              >
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                  <div className="flex justify-between items-center py-4">
                    {/* Logo */}
                    <button
                      onClick={handleLogoClick}
                      className={clsx(
                        "text-3xl font-bold",
                        theme === "dark" ? "text-white" : "text-blue-600",
                        pathname === "/"
                          ? "cursor-default"
                          : "cursor-pointer hover:opacity-80"
                      )}
                    >
                      FinBot
                    </button>

                    {/* Desktop Menu */}
                    <div className="hidden md:flex items-center space-x-6">
                      {!isLoggedIn ? (
                        <>
                          <a href="#features" className={linkStyle}>
                            Features
                          </a>
                          <a href="#why-us" className={linkStyle}>
                            Why Us
                          </a>
                          <button
                            onClick={() => router.push("/signin")}
                            className={clsx(
                              "px-6 py-2 rounded-md transition-colors font-medium",
                              "bg-blue-600 text-white hover:bg-blue-700"
                            )}
                          >
                            Sign In
                          </button>
                        </>
                      ) : (
                        <>
                          {/* Friends Link */}
                          {pathname !== "/users" && (
                            <button
                              onClick={handleFriendsClick}
                              className={clsx("flex items-center space-x-1", linkStyle)}
                            >
                              <FiUsers size={18} />
                              <span>Friends</span>
                            </button>
                          )}

                          {/* Chat Link */}
                          {pathname !== "/chat" && (
                            <button
                              onClick={handleChatClick}
                              className={clsx("flex items-center space-x-1", linkStyle)}
                            >
                              <FiMessageSquare size={18} />
                              <span>Chat</span>
                            </button>
                          )}

                          {/* Theme Toggle */}
                          <button
                            onClick={toggleTheme}
                            className={clsx(
                              "p-2 rounded-full transition-colors",
                              theme === "dark" ? "text-yellow-400" : "text-blue-600"
                            )}
                            aria-label="Toggle Theme"
                          >
                            {theme === "dark" ? (
                              <FiSun size={20} />
                            ) : (
                              <FiMoon size={20} />
                            )}
                          </button>

                          {/* User Menu */}
                          <div className="relative">
                            <button
                              onClick={() => setShowUserMenu(!showUserMenu)}
                              className={clsx(
                                "flex items-center space-x-2 px-3 py-2 rounded-lg transition-all duration-300",
                                theme === "dark"
                                  ? "bg-gray-800 text-white hover:bg-gray-700"
                                  : "bg-gray-100 text-gray-900 hover:bg-gray-200"
                              )}
                            >
                              <span className="font-medium">
                                {user?.name || user?.username}
                              </span>
                            </button>

                            {/* User Dropdown Menu */}
                            {showUserMenu && (
                              <div
                                className={clsx(
                                  "absolute right-0 mt-2 w-48 rounded-lg shadow-lg py-1 z-50",
                                  theme === "dark"
                                    ? "bg-gray-800 border border-gray-700"
                                    : "bg-white border border-gray-200"
                                )}
                              >
                                <button
                                  onClick={() => {
                                    setIsSettingsOpen(true);
                                    setShowUserMenu(false);
                                  }}
                                  className={clsx(
                                    "flex items-center w-full px-4 py-2 text-sm",
                                    theme === "dark"
                                      ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                      : "text-gray-700 hover:bg-gray-100"
                                  )}
                                >
                                  <FiSettings className="mr-3 h-4 w-4" />
                                  Settings
                                </button>

                                <button
                                  onClick={handleChatClick}
                                  className={clsx(
                                    "flex items-center w-full px-4 py-2 text-sm",
                                    theme === "dark"
                                      ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                      : "text-gray-700 hover:bg-gray-100"
                                  )}
                                >
                                  <FiMessageSquare className="mr-3 h-4 w-4" />
                                  Chat
                                </button>

                                <button
                                  onClick={handleFriendsClick}
                                  className={clsx(
                                    "flex items-center w-full px-4 py-2 text-sm",
                                    theme === "dark"
                                      ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                      : "text-gray-700 hover:bg-gray-100"
                                  )}
                                >
                                  <FiUsers className="mr-3 h-4 w-4" />
                                  Friends
                                </button>

                                <button
                                  onClick={handleSignOut}
                                  className={clsx(
                                    "flex items-center w-full px-4 py-2 text-sm",
                                    theme === "dark"
                                      ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                      : "text-gray-700 hover:bg-gray-100"
                                  )}
                                >
                                  <FiLogOut className="mr-3 h-4 w-4" />
                                  Sign Out
                                </button>
                              </div>
                            )}
                          </div>
                        </>
                      )}
                    </div>

                    {/* Mobile Menu Toggle */}
                    <div className="md:hidden flex items-center space-x-3">
                      {/* Theme Toggle */}
                      <button
                        onClick={toggleTheme}
                        className={clsx(
                          "p-2 rounded-full transition-colors",
                          theme === "dark" ? "text-yellow-400" : "text-blue-600"
                        )}
                        aria-label="Toggle Theme"
                      >
                        {theme === "dark" ? <FiSun size={20} /> : <FiMoon size={20} />}
                      </button>

                      {/* User Menu for Mobile */}
                      {isLoggedIn && (
                        <div className="relative">
                          <button
                            onClick={() => setShowUserMenu(!showUserMenu)}
                            className={clsx(
                              "flex items-center space-x-2 px-3 py-2 rounded-lg",
                              theme === "dark"
                                ? "bg-gray-800 text-white"
                                : "bg-gray-100 text-gray-900"
                            )}
                          >
                            <span className="font-medium">
                              {user?.name || user?.username}
                            </span>
                          </button>

                          {/* Mobile User Dropdown Menu */}
                          {showUserMenu && (
                            <div
                              className={clsx(
                                "absolute right-0 mt-2 w-48 rounded-lg shadow-lg py-1 z-50",
                                theme === "dark"
                                  ? "bg-gray-800 border border-gray-700"
                                  : "bg-white border border-gray-200"
                              )}
                            >
                              {/* Same dropdown menu items as desktop */}
                              <button
                                onClick={() => {
                                  setIsSettingsOpen(true);
                                  setShowUserMenu(false);
                                }}
                                className={clsx(
                                  "flex items-center w-full px-4 py-2 text-sm",
                                  theme === "dark"
                                    ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                    : "text-gray-700 hover:bg-gray-100"
                                )}
                              >
                                <FiSettings className="mr-3 h-4 w-4" />
                                Settings
                              </button>

                              <button
                                onClick={handleChatClick}
                                className={clsx(
                                  "flex items-center w-full px-4 py-2 text-sm",
                                  theme === "dark"
                                    ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                    : "text-gray-700 hover:bg-gray-100"
                                )}
                              >
                                <FiMessageSquare className="mr-3 h-4 w-4" />
                                Chat
                              </button>

                              <button
                                onClick={handleFriendsClick}
                                className={clsx(
                                  "flex items-center w-full px-4 py-2 text-sm",
                                  theme === "dark"
                                    ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                    : "text-gray-700 hover:bg-gray-100"
                                )}
                              >
                                <FiUsers className="mr-3 h-4 w-4" />
                                Friends
                              </button>

                              <button
                                onClick={handleSignOut}
                                className={clsx(
                                  "flex items-center w-full px-4 py-2 text-sm",
                                  theme === "dark"
                                    ? "text-gray-300 hover:bg-gray-700 hover:text-white"
                                    : "text-gray-700 hover:bg-gray-100"
                                )}
                              >
                                <FiLogOut className="mr-3 h-4 w-4" />
                                Sign Out
                              </button>
                            </div>
                          )}
                        </div>
                      )}

                      <button
                        onClick={toggleMobileMenu}
                        className={clsx(
                          "p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2",
                          theme === "dark"
                            ? "text-gray-300 hover:text-white focus:ring-gray-700"
                            : "text-gray-600 hover:text-blue-600 focus:ring-blue-300"
                        )}
                        aria-label="Toggle Menu"
                      >
                        {isMobileMenuOpen ? <FiX size={24} /> : <FiMenu size={24} />}
                      </button>
                    </div>
                  </div>
                </div>

                {/* Mobile Menu Drawer */}
                {isMobileMenuOpen && (
                  <div
                    className={clsx(
                      "md:hidden px-4 pb-4 space-y-2 transition-all duration-300",
                      theme === "dark"
                        ? "bg-gray-900 text-gray-300"
                        : "bg-white text-gray-700"
                    )}
                  >
                    {!isLoggedIn ? (
                      <>
                        <a
                          href="#features"
                          className="block py-2 border-b border-gray-200"
                        >
                          Features
                        </a>
                        <a href="#why-us" className="block py-2 border-b border-gray-200">
                          Why Us
                        </a>
                        <button
                          onClick={() => router.push("/signin")}
                          className={clsx(
                            "block w-full text-center px-4 py-2 rounded-md font-medium mt-2",
                            "bg-blue-600 text-white hover:bg-blue-700"
                          )}
                        >
                          Sign In
                        </button>
                      </>
                    ) : (
                      <>
                        {pathname !== "/users" && (
                          <button
                            onClick={handleFriendsClick}
                            className="flex items-center space-x-2 py-2 border-b border-gray-200 w-full text-left"
                          >
                            <FiUsers size={18} />
                            <span>Friends</span>
                          </button>
                        )}
                        {pathname !== "/chat" && (
                          <button
                            onClick={handleChatClick}
                            className="flex items-center space-x-2 py-2 border-b border-gray-200 w-full text-left"
                          >
                            <FiMessageSquare size={18} />
                            <span>Chat</span>
                          </button>
                        )}
                      </>
                    )}
                  </div>
                )}

                {/* Settings Modal */}
                <SettingsModal
                  isOpen={isSettingsOpen}
                  onClose={() => setIsSettingsOpen(false)}
                />
              </nav>
            );
          };

          export default Navbar;

        --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ lib
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ utils.ts (0.16 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import { clsx, type ClassValue } from "clsx"
        import { twMerge } from "tailwind-merge"

        export function cn(...inputs: ClassValue[]) {
          return twMerge(clsx(inputs))
        }

      --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ api
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ AuthApi.ts (7.78 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        /* eslint-disable @typescript-eslint/no-explicit-any */
        import axios, { AxiosError } from "axios";
        import { getCSRFToken } from "@/utils/csrf";

        // Set base URL for the backend
        const BASE_URL =
          process.env.NEXT_PUBLIC_API_BASE_URL || "http://localhost:8000"; // Replace with your actual backend URL

        // Enable credentials (cookies like access_token and refresh_token)
        const axiosInstance = axios.create({
          baseURL: BASE_URL,
          withCredentials: true,
          headers: {
            "Content-Type": "application/json",
          },
        });

        axiosInstance.interceptors.request.use((config) => {
          // Only add CSRF header to unsafe methods
          const csrfSafeMethod = /^(GET|HEAD|OPTIONS|TRACE)$/i;

          if (!csrfSafeMethod.test(config.method || "")) {
            const token = getCSRFToken();
            if (token) {
              config.headers["X-CSRFToken"] = token;
            }
          }

          return config;
        });

        let isRefreshing = false;
        let failedQueue: any[] = [];

        const processQueue = (error: any, token: string | null = null) => {
          failedQueue.forEach((prom) => {
            if (error) {
              prom.reject(error);
            } else {
              prom.resolve(token);
            }
          });

          failedQueue = [];
        };

        axiosInstance.interceptors.response.use(
          (response) => response,
          async (error) => {
            const originalRequest = error.config;

            // If access token expired and it's the first retry
            if (error.response?.status === 401 && !originalRequest._retry) {
              originalRequest._retry = true;

              if (isRefreshing) {
                return new Promise((resolve, reject) => {
                  failedQueue.push({ resolve, reject });
                })
                  .then(() => axiosInstance(originalRequest))
                  .catch((err) => Promise.reject(err));
              }

              isRefreshing = true;

              try {
                // Refresh the token
                await axiosInstance.get("/auth/updateAcessToken/");
                processQueue(null);
                return axiosInstance(originalRequest); // Retry original request
              } catch (refreshError) {
                processQueue(refreshError, null);

                if (typeof window !== "undefined") {
                  window.location.href = "/signin";
                }

                return Promise.reject(refreshError);
              } finally {
                isRefreshing = false;
              }
            }

            return Promise.reject(error);
          }
        );

        // Interfaces
        export interface RegisterData {
          username: string;
          email: string;
          password: string;
          password2: string;
        }

        export interface LoginData {
          username: string;
          password: string;
        }

        export interface UpdateUserPasswordData {
          email?: string;
          username?: string;
          password: string;
          newpassword: string;
          newpassword2: string;
        }

        export interface UpdateUserProfileData {
          email?: string;
          username?: string;
          password: string;
        }

        export interface ApiResponse<T> {
          success: boolean;
          data?: T;
          error?: string;
          message?: string;
        }

        // API Calls
        export const registerUser = async (
          data: RegisterData
        ): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.post("/auth/register/", data);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Registration failed",
            };
          }
        };

        export const loginUser = async (data: LoginData): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.post("/auth/login/", data);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Login failed",
            };
          }
        };

        export const logoutUser = async (): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.post("/auth/logout/");
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Logout failed",
            };
          }
        };

        export const getUsersList = async (): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.get("/auth/users-list/");
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to fetch users",
            };
          }
        };

        export const getUserDetail = async (
          userId: number
        ): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.get(`/auth/users-list/${userId}/`);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to fetch user details",
            };
          }
        };

        export const updateUserPassword = async (
          data: UpdateUserPasswordData
        ): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.post("/auth/update", data);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to update password",
            };
          }
        };

        export const updateAccessToken = async (): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.get("/auth/updateAcessToken/");
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to update access token",
            };
          }
        };

        export const getSelfDetail = async (): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.get("/auth/me/");
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to fetch user details",
            };
          }
        };

        export const updateUserProfile = async (
          data: UpdateUserProfileData
        ): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.post("/auth/update-profile/", data);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to update profile",
            };
          }
        };

        // Friend Management Interfaces
        export interface FriendActionData {
          friend_id: number;
          action: "add" | "remove";
        }

        // Friend Management API Calls
        export const getFriendsList = async (): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.get("/auth/friends/");
            return { 
              success: true, 
              data: response.data,
              message: response.data.message 
            };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                "Failed to fetch friends",
            };
          }
        };

        export const manageFriend = async (
          data: FriendActionData
        ): Promise<ApiResponse<any>> => {
          try {
            const response = await axiosInstance.post("/auth/friends/manage/", data);
            return { 
              success: true, 
              data: response.data,
              message: response.data.message 
            };
          } catch (error) {
            const axiosError = error as AxiosError;
            return {
              success: false,
              error:
                (axiosError.response?.data as { message?: string })?.message ||
                `Failed to ${data.action} friend`,
            };
          }
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ ChatApi.ts (6.28 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        // import { TableDataType } from "@/data/table";
        // import { JsonTableItem, TableData, TableRow } from "@/data/TableContent";
        // import { ChatMessage, defaultChatMessages } from "@/data/ChatMessages"; // Assuming you have this interface defined somewhere
        // import { TableDataAction } from "@/reducers/TableReducer";
        // import { JsonTableAction } from "@/reducers/TableContentReducer";

        // interface TableUpdateOperation {
        //   operationType: "UPDATE_TABLES" | "UPDATE_TABLE_CONTENTS";
        //   action: {
        //     type: string;
        //     payload: TableDataAction["payload"] | JsonTableAction["payload"];
        //   };
        // }

        // interface SendPromptResponse {
        //   botMessage: ChatMessage;
        //   tableUpdates?: TableUpdateOperation[];
        // }

        // // Fetching chat history
        // export async function loadChatHistory(): Promise<ChatMessage[]> {
        //   try {
        //     const response = await fetch("/api/dummy-chat/messages"); // Dummy URL REAL NEEDED
        //     const messages: ChatMessage[] = await response.json();
        //     return messages;
        //   } catch {
        //     // console.error("Failed to load chat history:", error);
        //     // throw error;
        //     return defaultChatMessages;
        //   }
        // }

        // // Sending a prompt
        // export async function sendPrompt(
        //   userMessage: ChatMessage,
        //   dispatchTablesData: React.Dispatch<TableDataAction>,
        //   dispatchtablesContent: React.Dispatch<JsonTableAction>
        // ): Promise<{ botMessage: ChatMessage; tableUpdates?: TableUpdateOperation[] }> {
        //   try {
        //     const response = await fetch("/api/dummy-chat/send", {
        //       method: "POST",
        //       headers: { "Content-Type": "application/json" },
        //       body: JSON.stringify({ userMessage }),
        //     });

        //     const { botMessage, tableUpdates }: SendPromptResponse =
        //       await response.json();

        //     // Process table updates if they exist
        //     if (tableUpdates && Array.isArray(tableUpdates)) {
        //       tableUpdates.forEach((update) => {
        //         switch (update.operationType) {
        //           case "UPDATE_TABLES": {
        //             const { type, payload } = update.action;
        //             // Dispatch action with correct payload based on type
        //             switch (type) {
        //               case "SET_TABLES":
        //                 dispatchTablesData({
        //                   type,
        //                   payload: payload as TableDataType[],
        //                 });
        //                 break;

        //               case "ADD_TABLE":
        //                 dispatchTablesData({
        //                   type,
        //                   payload: payload as {
        //                     id: number;
        //                     table_name: string;
        //                     description: string;
        //                   },
        //                 });
        //                 break;

        //               case "EDIT":
        //                 dispatchTablesData({
        //                   type,
        //                   payload: payload as { id: number; table_name: string },
        //                 });
        //                 break;

        //               case "DELETE":
        //                 dispatchTablesData({
        //                   type,
        //                   payload: payload as { id: number },
        //                 });
        //                 break;

        //               case "SHARE":
        //                 dispatchTablesData({
        //                   type,
        //                   payload: payload as { id: number },
        //                 });
        //                 break;

        //               default:
        //                 console.warn("Unknown table action type:", type);
        //             }
        //             break;
        //           }

        //           case "UPDATE_TABLE_CONTENTS": {
        //             const { type, payload } = update.action;
        //             switch (type) {
        //               case "SET_TABLES":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as JsonTableItem[],
        //                 });
        //                 break;

        //               case "ADD_TABLE":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as { id: number; data: TableData },
        //                 });
        //                 break;

        //               case "ADD_ROW":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as { tableId: number; row: TableRow },
        //                 });
        //                 break;

        //               case "EDIT_ROW":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as {
        //                     tableId: number;
        //                     rowId: number | string;
        //                     newRow: Partial<TableRow>;
        //                   },
        //                 });
        //                 break;

        //               case "DELETE_ROW":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as {
        //                     tableId: number;
        //                     rowId: number | string;
        //                   },
        //                 });
        //                 break;

        //               case "EDIT_TABLE_HEADERS":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as { tableId: number; headers: string[] },
        //                 });
        //                 break;

        //               case "DELETE_TABLE":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as { tableId: number },
        //                 });
        //                 break;

        //               case "ADD_COLUMN":
        //                 dispatchtablesContent({
        //                   type,
        //                   payload: payload as { tableId: number; header: string },
        //                 });
        //                 break;

        //               default:
        //                 console.warn("Unknown json table action type:", type);
        //             }
        //             break;
        //           }

        //           default:
        //             console.warn(
        //               "Unknown table update operation:",
        //               update.operationType
        //             );
        //         }
        //       });
        //     }

        //     return {
        //       botMessage,
        //     };
        //   } catch (error) {
        //     console.error("Failed to send message:", error);
        //     // Add error message to UI
        //     return {
        //       botMessage: {
        //         id: Date.now().toString(),
        //         text: "Sorry, something went wrong. Please try again.",
        //         sender: "bot",
        //         timestamp: new Date(),
        //         isTyping: false,
        //       },
        //     };
        //   }
        // }

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ ChatApiReal.ts (0.01 MB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import { ChatMessage } from "@/data/ChatMessages";
        import axios, {
          AxiosResponse,
          AxiosError,
          AxiosRequestConfig,
          RawAxiosRequestHeaders,
        } from "axios";
        import { getCSRFToken } from "@/utils/csrf";

        const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;

        interface ApiResponse<T> {
          success: boolean;
          data?: T;
          error?: string;
        }

        interface AgentStreamingResponse {
          success: boolean;
          message?: string;
          query?: string;
          response?: string;
          formatted_response?: string;
          raw_response?: {
            messages?: Array<
              Array<
                [
                  string,
                  {
                    type: string;
                    name: string;
                    input: Record<string, unknown>;
                  }
                ]
              >
            >;
          };
        }

        // Create axios instance with base configuration
        const apiClient = axios.create({
          baseURL: API_BASE_URL,
          withCredentials: true,
          headers: {
            "Content-Type": "application/json",
          },
        });

        // Add token refresh functionality
        let isRefreshing = false;
        let failedQueue: Array<{
          resolve: (value?: unknown) => void;
          reject: (reason?: unknown) => void;
        }> = [];

        const processQueue = (error: Error | null, token: string | null = null) => {
          failedQueue.forEach((prom) => {
            if (error) {
              prom.reject(error);
            } else {
              prom.resolve(token);
            }
          });

          failedQueue = [];
        };

        apiClient.interceptors.response.use(
          (response) => response,
          async (error) => {
            const originalRequest = error.config;

            if (error.response?.status === 401 && !originalRequest._retry) {
              originalRequest._retry = true;

              if (isRefreshing) {
                return new Promise((resolve, reject) => {
                  failedQueue.push({ resolve, reject });
                })
                  .then(() => apiClient(originalRequest))
                  .catch((err) => Promise.reject(err));
              }

              isRefreshing = true;

              try {
                await apiClient.get("/auth/updateAcessToken/");
                processQueue(null);
                return apiClient(originalRequest);
              } catch (refreshError) {
                const error =
                  refreshError instanceof Error
                    ? refreshError
                    : new Error(String(refreshError));
                processQueue(error, null);

                if (typeof window !== "undefined") {
                  window.location.href = "/signin";
                }

                return Promise.reject(error);
              } finally {
                isRefreshing = false;
              }
            }

            return Promise.reject(error);
          }
        );

        // Add CSRF token to requests
        apiClient.interceptors.request.use(
          (config) => {
            const csrfSafeMethod = /^(GET|HEAD|OPTIONS|TRACE)$/i;

            if (!csrfSafeMethod.test(config.method || "")) {
              const token = getCSRFToken();
              if (token) {
                config.headers["X-CSRFToken"] = token;
              }
            }

            // Add auth token if available
            const authToken = localStorage.getItem("auth_token");
            if (authToken) {
              config.headers.Authorization = `Bearer ${authToken}`;
            }

            return config;
          },
          (error) => {
            return Promise.reject(error);
          }
        );

        // Helper function for API requests
        const apiRequest = async <T>(
          endpoint: string,
          method: string,
          body?: unknown,
          headers?: Record<string, string>
        ): Promise<ApiResponse<T>> => {
          try {
            const config: AxiosRequestConfig = {
              url: endpoint,
              method,
              data: body,
              headers: headers
                ? ({
                    ...apiClient.defaults.headers.common,
                    ...headers,
                  } as RawAxiosRequestHeaders)
                : (apiClient.defaults.headers.common as RawAxiosRequestHeaders),
            };

            const response: AxiosResponse<T> = await apiClient.request(config);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            if (axiosError.response) {
              return {
                success: false,
                error:
                  (axiosError.response.data as { message?: string })?.message ||
                  `HTTP error! status: ${axiosError.response.status}`,
              };
            } else if (axiosError.request) {
              return {
                success: false,
                error: "No response received from server",
              };
            } else {
              return {
                success: false,
                error: axiosError.message || "An unknown error occurred",
              };
            }
          }
        };

        export const chatApi = {
          // Send a message and get bot response
          async sendMessage(
            message: ChatMessage,
            tableId?: string
          ): Promise<ApiResponse<ChatMessage>> {
            try {
              console.log("API Base URL:", API_BASE_URL); // Debug log
              // First get or create a chat session
              const sessionsResponse = await apiRequest<{
                data: { session_id: string }[];
              }>("/agent/chat/sessions/", "GET");

              console.log("Sessions Response:", sessionsResponse); // Debug log

              let sessionId: string;
              if (!sessionsResponse.success || !sessionsResponse.data?.data?.length) {
                // Create new session if none exists
                const createSessionResponse = await apiRequest<{
                  data: { session_id: string };
                }>("/agent/chat/sessions/", "POST", { title: "New Chat" });
                if (
                  !createSessionResponse.success ||
                  !createSessionResponse.data?.data?.session_id
                ) {
                  throw new Error("Failed to create chat session");
                }
                sessionId = createSessionResponse.data.data.session_id;
              } else {
                sessionId = sessionsResponse.data.data[0].session_id;
              }

              // Generate unique message IDs
              const userMessageId = `msg_${Date.now()}`;
              const botMessageId = `msg_${Date.now() + 1}`;

              // Save user message
              const userMessageData = {
                message_id: userMessageId,
                text: message.text,
                sender: "user",
                displayed_text: message.displayedText || message.text,
                is_typing: false,
              };

              console.log("Saving user message:", userMessageData); // Debug log

              const saveUserMessageResponse = await apiRequest(
                `/agent/chat/sessions/${sessionId}/messages/save/`,
                "POST",
                userMessageData
              );

              if (!saveUserMessageResponse.success) {
                console.error("Failed to save user message:", saveUserMessageResponse); // Debug log
                throw new Error("Failed to save user message");
              }

              // Send to agent
              const requestBody: {
                query: string;
                table_id?: string;
                context_type?: string;
              } = {
                query: message.text,
              };

              if (tableId) {
                requestBody.table_id = tableId;
                requestBody.context_type = "table_context";
              }

              const agentResponse = await apiRequest<AgentStreamingResponse>(
                "/agent/streaming/",
                "POST",
                requestBody
              );

              if (!agentResponse.success || !agentResponse.data) {
                throw new Error(agentResponse.error || "Failed to get agent response");
              }

              console.log("Raw agent response:", agentResponse.data); // Debug log

              // Create bot message from agent response
              const botMessage: ChatMessage = {
                id: botMessageId,
                text:
                  agentResponse.data.formatted_response ||
                  agentResponse.data.response ||
                  agentResponse.data.message ||
                  "Processing your request...",
                sender: "bot",
                timestamp: new Date(),
                displayedText:
                  agentResponse.data.formatted_response ||
                  agentResponse.data.response ||
                  agentResponse.data.message ||
                  "Processing your request...",
                agentData: {
                  response:
                    agentResponse.data.formatted_response ||
                    agentResponse.data.response ||
                    agentResponse.data.message ||
                    "Processing your request...",
                  tools_called:
                    agentResponse.data.raw_response?.messages
                      ?.filter((msg) => msg[0][1].type === "tool_use")
                      .map((msg) => ({
                        name: msg[0][1].name,
                        args: msg[0][1].input as Record<string, unknown>,
                      })) || [],
                },
              };

              // Save bot response
              const botMessageData = {
                message_id: botMessage.id,
                text: botMessage.text,
                sender: botMessage.sender,
                displayed_text: botMessage.displayedText,
                is_typing: false,
                agent_data: botMessage.agentData,
              };

              console.log("Saving bot message:", botMessageData); // Debug log

              const saveBotMessageResponse = await apiRequest(
                `/agent/chat/sessions/${sessionId}/messages/save/`,
                "POST",
                botMessageData
              );

              if (!saveBotMessageResponse.success) {
                console.error("Failed to save bot message:", saveBotMessageResponse); // Debug log
                throw new Error("Failed to save bot message");
              }

              return { success: true, data: botMessage };
            } catch (error) {
              console.error("Error in sendMessage:", error); // Debug log
              return {
                success: false,
                error:
                  error instanceof Error ? error.message : "Failed to send message",
              };
            }
          },

          // Load chat history
          async loadChatHistory(): Promise<ApiResponse<ChatMessage[]>> {
            try {
              // First get the active chat session
              const sessionsResponse = await apiRequest<{
                data: { session_id: string }[];
              }>("/agent/chat/sessions/", "GET");

              if (!sessionsResponse.success || !sessionsResponse.data?.data?.length) {
                return {
                  success: true,
                  data: [],
                };
              }

              // Get messages from the most recent session
              const latestSession = sessionsResponse.data.data[0];
              const messagesResponse = await apiRequest<{
                data: Array<{
                  message_id: string;
                  text: string;
                  sender: string;
                  timestamp: string;
                  displayed_text: string;
                  agent_data?: {
                    response: string;
                    tools_called: Array<{
                      name: string;
                      args: Record<string, any>;
                    }>;
                  };
                }>;
              }>(`/agent/chat/sessions/${latestSession.session_id}/messages/`, "GET");

              if (!messagesResponse.success || !messagesResponse.data?.data) {
                return {
                  success: true,
                  data: [],
                };
              }

              // Format messages to match ChatMessage interface
              const formattedMessages = messagesResponse.data.data.map((msg) => ({
                id: msg.message_id,
                text: msg.text,
                sender: msg.sender as "user" | "bot",
                timestamp: new Date(msg.timestamp),
                displayedText: msg.displayed_text || msg.text,
                agentData: msg.agent_data
                  ? {
                      response: msg.agent_data.response,
                      tools_called: msg.agent_data.tools_called || [],
                    }
                  : undefined,
              }));

              return {
                success: true,
                data: formattedMessages,
              };
            } catch (error) {
              console.error("Error loading chat history:", error);
              return {
                success: true,
                data: [],
              };
            }
          },

          // Clear chat history
          async clearChatHistory(): Promise<ApiResponse<{ success: boolean }>> {
            try {
              // Get current session
              const sessionsResponse = await apiRequest<{
                data: { session_id: string }[];
              }>("/agent/chat/sessions/", "GET");

              if (!sessionsResponse.success || !sessionsResponse.data?.data?.length) {
                return {
                  success: true,
                  data: { success: true },
                };
              }

              // Clear messages from current session
              const sessionId = sessionsResponse.data.data[0].session_id;
              const response = await apiRequest<{ message: string }>(
                `/agent/chat/sessions/${sessionId}/messages/`,
                "DELETE"
              );

              return {
                success: true,
                data: { success: response.success },
              };
            } catch {
              return {
                success: true,
                data: { success: true },
              };
            }
          },
        };

        // Utility function to handle chat operations
        export const handleChatOperation = async (
          message: ChatMessage,
          tableId?: string,
          refreshData?: () => Promise<void>
        ): Promise<ChatMessage> => {
          try {
            const response = await chatApi.sendMessage(message, tableId);
            if (!response.success) {
              console.error("Failed to send message:", response.error);
              throw new Error(response.error || "Failed to send message");
            }

            const botMessage = response.data;
            console.log("Bot Message:", botMessage); // Debug log

            if (!botMessage) {
              throw new Error("No response data received");
            }

            // Refresh data if callback is provided
            if (refreshData) {
              try {
                await refreshData();
                console.log("Data refreshed successfully"); // Debug log
              } catch (refreshError) {
                console.error("Error refreshing data:", refreshError); // Debug log
                // Don't throw error here, just log it
              }
            }

            return botMessage;
          } catch (error) {
            console.error("Chat operation failed:", error);
            throw error; // Throw the error to be handled by the caller
          }
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ TableContentApi.ts (0.01 MB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        // src/api/jsonTableApi.ts
        import {
          JsonTableAction,
          CreateTablePayload,
        } from "@/reducers/TableContentReducer";
        import { JsonTableItem, TableData, TableRow } from "../data/TableContent";
        import axios, {
          AxiosResponse,
          AxiosError,
          AxiosRequestConfig,
          RawAxiosRequestHeaders,
        } from "axios";
        import { getCSRFToken } from "@/utils/csrf";

        const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;

        interface ApiResponse<T> {
          success: boolean;
          data?: T;
          error?: string;
        }

        interface CreateTableResponse {
          message: string;
          data: {
            id: number;
            table_name: string;
            headers: string[];
            created_at: string;
            description: string;
          };
        }

        // Create axios instance with base configuration
        const apiClient = axios.create({
          baseURL: API_BASE_URL,
          withCredentials: true,
          headers: {
            "Content-Type": "application/json",
          },
        });

        // Add token refresh functionality
        let isRefreshing = false;
        let failedQueue: Array<{
          resolve: (value?: unknown) => void;
          reject: (reason?: unknown) => void;
        }> = [];

        const processQueue = (error: Error | null, token: string | null = null) => {
          failedQueue.forEach((prom) => {
            if (error) {
              prom.reject(error);
            } else {
              prom.resolve(token);
            }
          });

          failedQueue = [];
        };

        apiClient.interceptors.response.use(
          (response) => response,
          async (error) => {
            const originalRequest = error.config;

            // If access token expired and it's the first retry
            if (error.response?.status === 401 && !originalRequest._retry) {
              originalRequest._retry = true;

              if (isRefreshing) {
                return new Promise((resolve, reject) => {
                  failedQueue.push({ resolve, reject });
                })
                  .then(() => apiClient(originalRequest))
                  .catch((err) => Promise.reject(err));
              }

              isRefreshing = true;

              try {
                // Refresh the token
                await apiClient.get("/auth/updateAcessToken/");
                processQueue(null);
                return apiClient(originalRequest); // Retry original request
              } catch (refreshError) {
                const error =
                  refreshError instanceof Error
                    ? refreshError
                    : new Error(String(refreshError));
                processQueue(error, null);

                if (typeof window !== "undefined") {
                  window.location.href = "/signin";
                }

                return Promise.reject(error);
              } finally {
                isRefreshing = false;
              }
            }

            return Promise.reject(error);
          }
        );

        // Add CSRF token to requests
        apiClient.interceptors.request.use(
          (config) => {
            const csrfSafeMethod = /^(GET|HEAD|OPTIONS|TRACE)$/i;

            if (!csrfSafeMethod.test(config.method || "")) {
              const token = getCSRFToken();
              if (token) {
                config.headers["X-CSRFToken"] = token;
              }
            }

            return config;
          },
          (error) => {
            return Promise.reject(error);
          }
        );

        // Helper function for API requests
        const apiRequest = async <T>(
          endpoint: string,
          method: string,
          body?: unknown,
          headers?: Record<string, string>
        ): Promise<ApiResponse<T>> => {
          try {
            const config: AxiosRequestConfig = {
              url: endpoint,
              method,
              data: body,
              headers: headers
                ? ({
                    ...apiClient.defaults.headers.common,
                    ...headers,
                  } as RawAxiosRequestHeaders)
                : (apiClient.defaults.headers.common as RawAxiosRequestHeaders),
            };

            const response: AxiosResponse<T> = await apiClient.request(config);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            if (axiosError.response) {
              return {
                success: false,
                error:
                  (axiosError.response.data as { message?: string })?.message ||
                  `HTTP error! status: ${axiosError.response.status}`,
              };
            } else if (axiosError.request) {
              return {
                success: false,
                error: "No response received from server",
              };
            } else {
              return {
                success: false,
                error: axiosError.message || "An unknown error occurred",
              };
            }
          }
        };

        export const jsonTableApi = {
          // Get all tables
          async getTables(): Promise<ApiResponse<JsonTableItem[]>> {
            return apiRequest<JsonTableItem[]>("/main/table-contents/", "GET");
          },

          // Add a new table
          async addTable(
            payload: CreateTablePayload
          ): Promise<ApiResponse<JsonTableItem>> {
            return apiRequest<JsonTableItem>(
              "/main/create-tableContent/",
              "POST",
              payload
            );
          },

          // Delete a table
          async deleteTable(
            tableId: number
          ): Promise<ApiResponse<{ success: boolean }>> {
            return apiRequest<{ success: boolean }>(
              `/main/tables/${tableId}/`,
              "DELETE"
            );
          },

          // Add a row to a table
          async addRow(
            tableId: number,
            row: Omit<TableRow, "id">
          ): Promise<ApiResponse<TableRow>> {
            return apiRequest<TableRow>(`/main/add-row/`, "POST", {
              tableId,
              row,
            });
          },

          // Edit a row in a table
          async editRow(
            tableId: number,
            rowId: number | string,
            updates: Partial<TableRow>
          ): Promise<ApiResponse<TableRow>> {
            return apiRequest<TableRow>(`/main/update-row/`, "PATCH", {
              tableId,
              rowId,
              newRowData: updates,
            });
          },

          // Delete a row from a table
          async deleteRow(
            tableId: number,
            rowId: number | string
          ): Promise<ApiResponse<{ success: boolean }>> {
            return apiRequest<{ success: boolean }>(`/main/delete-row/`, "POST", {
              tableId,
              rowId,
            });
          },

          // Update table headers
          async updateHeaders(
            tableId: number,
            headers: string[]
          ): Promise<ApiResponse<TableData>> {
            return apiRequest<TableData>(`/main/delete-column/`, "POST", {
              tableId,
              header: headers[headers.length - 1],
            });
          },

          // Add a column to a table
          async addColumn(
            tableId: number,
            header: string
          ): Promise<ApiResponse<TableData>> {
            try {
              // Validate inputs
              if (!tableId || !header) {
                throw new Error("TableId and header are required");
              }

              // Ensure header is a string and not empty
              const sanitizedHeader = String(header).trim();
              if (!sanitizedHeader) {
                throw new Error("Header cannot be empty");
              }

              console.log("Adding column with payload:", {
                tableId,
                header: sanitizedHeader,
              });

              return apiRequest<TableData>(`/main/add-column/`, "POST", {
                tableId,
                header: sanitizedHeader,
              });
            } catch (error) {
              console.error("Error in addColumn:", error);
              return {
                success: false,
                error: error instanceof Error ? error.message : "Failed to add column",
              };
            }
          },

          // Delete a column
          async deleteColumn(
            tableId: number,
            header: string
          ): Promise<ApiResponse<TableData>> {
            try {
              // Validate inputs
              if (!tableId || !header) {
                throw new Error("TableId and header are required");
              }

              // Ensure header is a string and not empty
              const sanitizedHeader = String(header).trim();
              if (!sanitizedHeader) {
                throw new Error("Header cannot be empty");
              }

              console.log("Deleting column with payload:", {
                tableId,
                header: sanitizedHeader,
              });

              return apiRequest<TableData>(`/main/delete-column/`, "POST", {
                tableId,
                header: sanitizedHeader,
              });
            } catch (error) {
              console.error("Error in deleteColumn:", error);
              return {
                success: false,
                error:
                  error instanceof Error ? error.message : "Failed to delete column",
              };
            }
          },

          // Edit a header
          async editHeader(
            tableId: number,
            oldHeader: string,
            newHeader: string
          ): Promise<ApiResponse<TableData>> {
            return apiRequest<TableData>(`/main/edit-header/`, "POST", {
              tableId,
              oldHeader,
              newHeader,
            });
          },
        };

        // Utility function to handle API calls and dispatch actions
        export const handleJsonTableOperation = async (
          action: JsonTableAction,
          dispatch: React.Dispatch<JsonTableAction>
        ) => {
          try {
            let response;
            switch (action.type) {
              case "ADD_TABLE": {
                response = await jsonTableApi.addTable(
                  action.payload as CreateTablePayload
                );

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to add table");
                }

                console.log("TableContentApi - Raw Response:", response);
                console.log("TableContentApi - Response Data:", response.data);

                const responseData = response.data as unknown as CreateTableResponse;
                const tableData: JsonTableItem = {
                  id: responseData.data.id,
                  data: {
                    headers: responseData.data.headers,
                    rows: [],
                  },
                };

                console.log("TableContentApi - Converted Table Data:", tableData);

                dispatch({
                  type: action.type,
                  payload: tableData,
                });

                return response;
              }

              case "ADD_ROW": {
                const { tableId, row } = action.payload;
                response = await jsonTableApi.addRow(tableId, row);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to add row");
                }

                console.log("Add Row Response:", response.data);

                const responseData = response.data as unknown as {
                  message: string;
                  data: TableRow & { id: number };
                };

                dispatch({
                  type: "ADD_ROW",
                  payload: {
                    tableId,
                    row: responseData.data,
                  },
                });

                return response;
              }

              case "EDIT_ROW": {
                const { tableId, rowId, newRow } = action.payload;
                response = await jsonTableApi.editRow(tableId, rowId, newRow);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to edit row");
                }

                dispatch(action);
                return response;
              }

              case "DELETE_ROW": {
                const { tableId, rowId } = action.payload;
                response = await jsonTableApi.deleteRow(tableId, rowId);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to delete row");
                }

                dispatch(action);
                return response;
              }

              case "EDIT_TABLE_HEADERS": {
                const { tableId, headers } = action.payload;
                response = await jsonTableApi.updateHeaders(tableId, headers);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to update headers");
                }

                dispatch(action);
                return response;
              }

              case "DELETE_TABLE": {
                const { tableId } = action.payload;
                response = await jsonTableApi.deleteTable(tableId);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to delete table");
                }

                dispatch(action);
                return response;
              }

              case "ADD_COLUMN": {
                const { tableId, header } = action.payload;
                response = await jsonTableApi.addColumn(tableId, header);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to add column");
                }

                dispatch(action);
                return response;
              }

              case "EDIT_HEADER": {
                const { tableId, oldHeader, newHeader } = action.payload;
                response = await jsonTableApi.editHeader(tableId, oldHeader, newHeader);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to edit header");
                }

                dispatch(action);
                return response;
              }

              case "DELETE_COLUMN": {
                const { tableId, header } = action.payload;
                response = await jsonTableApi.deleteColumn(tableId, header);

                if (!response.success || response.error) {
                  throw new Error(response.error || "Failed to delete column");
                }

                dispatch(action);
                return response;
              }

              default:
                break;
            }
          } catch (error) {
            console.error("Table operation failed:", error);
            // Rethrow the error to be handled by the caller
            throw error;
          }
        };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ TableDataApi.ts (8.45 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        // src/api/tableApi.ts
        import { TableDataType } from "@/data/table";
        import { TableDataAction } from "@/reducers/TableReducer";
        import axios, {
          AxiosResponse,
          AxiosError,
          AxiosRequestConfig,
          RawAxiosRequestHeaders,
        } from "axios";
        import { getCSRFToken } from "@/utils/csrf";
        import { TableRow, TableData } from "@/data/TableContent";

        const API_BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;

        interface ApiResponse<T> {
          success: boolean;
          data?: T;
          error?: string;
        }

        interface AddTableDataType {
          id: number;
          table_name: string;
          description: string;
          headers?: string[];
        }

        interface TableContentResponse {
          id: number;
          data: TableData;
        }

        interface RowResponse {
          id: number;
          data: TableRow;
        }

        interface EditTablePayload {
          id: number;
          table_name: string;
          description?: string;
        }

        interface ShareTablePayload {
          table_id: number;
          friend_ids: number[];
          action: "share" | "unshare";
        }

        interface ShareTableResponse {
          success: boolean;
          data?: {
            table: {
              id: number;
              table_name: string;
              is_shared: boolean;
              shared_with: Array<{
                id: number;
                username: string;
              }>;
            };
          };
          error?: string;
        }

        // Create axios instance with base configuration
        const apiClient = axios.create({
          baseURL: API_BASE_URL,
          withCredentials: true,
          headers: {
            "Content-Type": "application/json",
          },
        });

        // Add token refresh functionality
        let isRefreshing = false;
        let failedQueue: Array<{
          resolve: (value?: unknown) => void;
          reject: (reason?: unknown) => void;
        }> = [];

        const processQueue = (error: Error | null, token: string | null = null) => {
          failedQueue.forEach((prom) => {
            if (error) {
              prom.reject(error);
            } else {
              prom.resolve(token);
            }
          });

          failedQueue = [];
        };

        apiClient.interceptors.response.use(
          (response) => response,
          async (error) => {
            const originalRequest = error.config;

            // If access token expired and it's the first retry
            if (error.response?.status === 401 && !originalRequest._retry) {
              originalRequest._retry = true;

              if (isRefreshing) {
                return new Promise((resolve, reject) => {
                  failedQueue.push({ resolve, reject });
                })
                  .then(() => apiClient(originalRequest))
                  .catch((err) => Promise.reject(err));
              }

              isRefreshing = true;

              try {
                // Refresh the token
                await apiClient.get("/auth/updateAcessToken/");
                processQueue(null);
                return apiClient(originalRequest); // Retry original request
              } catch (refreshError) {
                const error =
                  refreshError instanceof Error
                    ? refreshError
                    : new Error(String(refreshError));
                processQueue(error, null);

                if (typeof window !== "undefined") {
                  window.location.href = "/signin";
                }

                return Promise.reject(error);
              } finally {
                isRefreshing = false;
              }
            }

            return Promise.reject(error);
          }
        );

        // Add CSRF token to requests
        apiClient.interceptors.request.use(
          (config) => {
            const csrfSafeMethod = /^(GET|HEAD|OPTIONS|TRACE)$/i;

            if (!csrfSafeMethod.test(config.method || "")) {
              const token = getCSRFToken();
              if (token) {
                config.headers["X-CSRFToken"] = token;
              }
            }

            return config;
          },
          (error) => {
            return Promise.reject(error);
          }
        );

        // Helper function for API requests
        const apiRequest = async <T>(
          endpoint: string,
          method: string,
          body?: unknown,
          headers?: Record<string, string>
        ): Promise<ApiResponse<T>> => {
          try {
            const config: AxiosRequestConfig = {
              url: endpoint,
              method,
              data: body,
              headers: headers
                ? ({
                    ...apiClient.defaults.headers.common,
                    ...headers,
                  } as RawAxiosRequestHeaders)
                : (apiClient.defaults.headers.common as RawAxiosRequestHeaders),
            };

            const response: AxiosResponse<T> = await apiClient.request(config);
            return { success: true, data: response.data };
          } catch (error) {
            const axiosError = error as AxiosError;
            if (axiosError.response) {
              return {
                success: false,
                error:
                  (axiosError.response.data as { message?: string })?.message ||
                  `HTTP error! status: ${axiosError.response.status}`,
              };
            } else if (axiosError.request) {
              return {
                success: false,
                error: "No response received from server",
              };
            } else {
              return {
                success: false,
                error: axiosError.message || "An unknown error occurred",
              };
            }
          }
        };

        // Table API Service
        export const tableApi = {
          // Get all tables
          async getTables(): Promise<ApiResponse<TableDataType[]>> {
            return apiRequest<TableDataType[]>("/main/tables/", "GET");
          },

          // Add a new table
          async addTable(
            tableData: Omit<AddTableDataType, "id">
          ): Promise<ApiResponse<TableDataType>> {
            return apiRequest<TableDataType>(
              "/main/create-tableContent/",
              "POST",
              tableData
            );
          },

          // Edit a table
          async editTable(
            id: number,
            updateData: { table_name: string; description?: string }
          ): Promise<ApiResponse<TableDataType>> {
            return apiRequest<TableDataType>("/main/tables/update/", "PUT", {
              id,
              ...updateData,
            });
          },

          // Delete a table
          async deleteTable(id: number): Promise<ApiResponse<{ success: boolean }>> {
            return apiRequest<{ success: boolean }>(`/main/tables/${id}/`, "DELETE");
          },

          // Get table content
          async getTableContent(): Promise<ApiResponse<TableContentResponse[]>> {
            return apiRequest<TableContentResponse[]>("/main/table-contents/", "GET");
          },

          // Add a row to a table
          async addRow(
            tableId: number,
            row: TableRow
          ): Promise<ApiResponse<RowResponse>> {
            return apiRequest<RowResponse>("/main/add-row/", "POST", {
              tableId,
              row,
            });
          },

          // Update a row
          async updateRow(
            tableId: number,
            rowId: number | string,
            newRowData: Partial<TableRow>
          ): Promise<ApiResponse<RowResponse>> {
            return apiRequest<RowResponse>("/main/update-row/", "PATCH", {
              tableId,
              rowId,
              newRowData,
            });
          },

          // Delete a row
          async deleteRow(
            tableId: number,
            rowId: number | string
          ): Promise<ApiResponse<{ success: boolean }>> {
            return apiRequest<{ success: boolean }>("/main/delete-row/", "POST", {
              tableId,
              rowId,
            });
          },

          // Add a column
          async addColumn(
            tableId: number,
            header: string
          ): Promise<ApiResponse<TableData>> {
            return apiRequest<TableData>("/main/add-column/", "POST", {
              tableId,
              header,
            });
          },

          // Delete a column
          async deleteColumn(
            tableId: number,
            header: string
          ): Promise<ApiResponse<TableData>> {
            return apiRequest<TableData>("/main/delete-column/", "POST", {
              tableId,
              header,
            });
          },

          // Share a table with friends
          async shareTable(
            payload: ShareTablePayload
          ): Promise<ApiResponse<ShareTableResponse>> {
            return apiRequest<ShareTableResponse>(
              "/main/share-table/",
              "POST",
              payload
            );
          },
        };

        // Utility function to handle API calls and dispatch actions
        export const handleTableOperation = async (
          action: TableDataAction,
          dispatch: React.Dispatch<TableDataAction>
        ) => {
          try {
            switch (action.type) {
              case "ADD_TABLE": {
                const response = await tableApi.addTable(action.payload);

                if (response.error) throw new Error(response.error);

                dispatch({
                  type: "ADD_TABLE",
                  payload: {
                    id: response.data?.id ?? action.payload.id,
                    table_name: response.data?.table_name ?? action.payload.table_name,
                    description:
                      response.data?.description ?? action.payload.description,
                    headers: response.data?.headers ?? action.payload.headers,
                  },
                });
                break;
              }

              case "EDIT": {
                const payload = action.payload as EditTablePayload;
                const response = await tableApi.editTable(payload.id, {
                  table_name: payload.table_name,
                  description: payload.description,
                });

                if (response.error) throw new Error(response.error);

                dispatch(action);
                break;
              }

              case "DELETE": {
                const response = await tableApi.deleteTable(action.payload.id);

                if (response.error) throw new Error(response.error);

                dispatch(action);
                break;
              }

              default:
                break;
            }
          } catch (error) {
            console.error("Table operation failed:", error);
            // Consider dispatching an error action
          }
        };

      --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ data
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ ChatMessages.ts (1.24 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        // Type definition for a chat message
        export interface ChatMessage {
          id: string;
          text: string;
          sender: "user" | "bot";
          timestamp: Date;
          isTyping?: boolean;
          displayedText?: string;
          agentData?: {
            response: string;
            tools_called: Array<{
              name: string;
              // eslint-disable-next-line @typescript-eslint/no-explicit-any
              args: Record<string, any>;
            }>;
            streaming_info?: {
              tool_operations: Array<{
                step: number;
                tool_name: string;
                tool_type: string;
                operation: string;
                status: string;
                timestamp: string;
              }>;
              status: string;
            };
          };
        }

        // Default chat messages
        export const defaultChatMessages: ChatMessage[] = [
          {
            id: "1",
            text: "Hello! How can I help you today?",
            displayedText: "Hello! How can I help you today?",
            sender: "bot",
            timestamp: new Date()
          },
          {
            id: "2",
            text: "Iâ€™d like to see the latest table updates.",
            displayedText: "Iâ€™d like to see the latest table updates.",
            sender: "user",
            timestamp: new Date()
          },
          {
            id: "3",
            text: "Sure! Here are the most recent table updates:",
            displayedText: "Sure! Here are the most recent table updates:",
            sender: "bot",
            timestamp: new Date()
          }
        ];

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ TableContent.ts (6.44 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        export interface TableRow {
          [key: string]: string | number | boolean | null;
        }

        export interface TableData {
          headers: string[];
          rows: TableRow[];
        }

        export interface JsonTableItem {
          id: number;
          data: TableData;
        }

        type JsonTableData = JsonTableItem[];

        const jsonTableData: JsonTableData = [
          {
            id: 1,
            data: {
              headers: ["id", "title", "content", "user_id", "created_at"],
              rows: [
                {
                  id: 1,
                  title: "First Post",
                  content: "Hello world!",
                  user_id: 1,
                  created_at: "2025-05-01T10:00:00Z",
                },
                {
                  id: 2,
                  title: "Second Post",
                  content: "Another update",
                  user_id: 1,
                  created_at: "2025-05-01T10:30:00Z",
                },
              ],
            },
          },
          {
            id: 2,
            data: {
              headers: ["id", "post_id", "comment", "user_id", "created_at"],
              rows: [
                {
                  id: 1,
                  post_id: 1,
                  comment: "Nice post!",
                  user_id: 2,
                  created_at: "2025-05-01T10:35:00Z",
                },
                {
                  id: 2,
                  post_id: 2,
                  comment: "Thanks for sharing!",
                  user_id: 3,
                  created_at: "2025-05-01T10:40:00Z",
                },
              ],
            },
          },
          {
            id: 3,
            data: {
              headers: ["id", "user_id", "post_id"],
              rows: [
                { id: 1, user_id: 2, post_id: 1 },
                { id: 2, user_id: 3, post_id: 1 },
              ],
            },
          },
          {
            id: 4,
            data: {
              headers: ["id", "sender_id", "receiver_id", "message", "sent_at"],
              rows: [
                {
                  id: 1,
                  sender_id: 1,
                  receiver_id: 2,
                  message: "Hey!",
                  sent_at: "2025-05-01T10:30:00Z",
                },
                {
                  id: 2,
                  sender_id: 2,
                  receiver_id: 1,
                  message: "Hi there!",
                  sent_at: "2025-05-01T10:31:00Z",
                },
              ],
            },
          },
          {
            id: 5,
            data: {
              headers: ["id", "user_id", "bio", "profile_picture"],
              rows: [
                {
                  id: 1,
                  user_id: 1,
                  bio: "I love coding",
                  profile_picture: "pic1.jpg",
                },
              ],
            },
          },
          {
            id: 6,
            data: {
              headers: ["id", "user_id", "type", "content"],
              rows: [
                { id: 1, user_id: 2, type: "like", content: "Post liked by user" },
              ],
            },
          },
          {
            id: 7,
            data: {
              headers: ["id", "follower_id", "followed_id"],
              rows: [
                { id: 1, follower_id: 1, followed_id: 2 },
                { id: 2, follower_id: 2, followed_id: 3 },
              ],
            },
          },
          {
            id: 8,
            data: {
              headers: ["id", "user_id", "following_id"],
              rows: [{ id: 1, user_id: 4, following_id: 1 }],
            },
          },
          {
            id: 9,
            data: {
              headers: ["id", "user_id", "theme", "notifications_enabled"],
              rows: [{ id: 1, user_id: 1, theme: "dark", notifications_enabled: true }],
            },
          },
          {
            id: 10,
            data: {
              headers: ["id", "user_id", "file_name", "file_type"],
              rows: [
                { id: 1, user_id: 2, file_name: "profile.png", file_type: "image/png" },
              ],
            },
          },
          {
            id: 11,
            data: {
              headers: ["id", "user_id", "album_name"],
              rows: [{ id: 1, user_id: 3, album_name: "Vacation 2025" }],
            },
          },
          {
            id: 12,
            data: {
              headers: ["id", "tag_name"],
              rows: [
                { id: 1, tag_name: "travel" },
                { id: 2, tag_name: "coding" },
              ],
            },
          },
          {
            id: 13,
            data: {
              headers: ["id", "user_id", "mention_user_id", "context"],
              rows: [{ id: 1, user_id: 1, mention_user_id: 2, context: "Post #5" }],
            },
          },
          {
            id: 14,
            data: {
              headers: ["id", "user_id", "story_text", "created_at"],
              rows: [
                {
                  id: 1,
                  user_id: 2,
                  story_text: "Check out my new project!",
                  created_at: "2025-05-01T12:15:00Z",
                },
              ],
            },
          },
          {
            id: 15,
            data: {
              headers: ["id", "user_id", "reaction_type", "target_id"],
              rows: [{ id: 1, user_id: 3, reaction_type: "like", target_id: 5 }],
            },
          },
          {
            id: 16,
            data: {
              headers: ["id", "user_id", "viewed_item", "viewed_at"],
              rows: [
                {
                  id: 1,
                  user_id: 4,
                  viewed_item: "post_10",
                  viewed_at: "2025-05-01T12:35:00Z",
                },
              ],
            },
          },
          {
            id: 17,
            data: {
              headers: ["id", "user_id", "content_id", "shared_at"],
              rows: [
                { id: 1, user_id: 1, content_id: 2, shared_at: "2025-05-01T12:45:00Z" },
              ],
            },
          },
          {
            id: 18,
            data: {
              headers: ["id", "user_id", "item_type", "item_id"],
              rows: [{ id: 1, user_id: 2, item_type: "post", item_id: 4 }],
            },
          },
          {
            id: 19,
            data: {
              headers: ["id", "user_id", "plan", "subscribed_at"],
              rows: [
                {
                  id: 1,
                  user_id: 3,
                  plan: "Premium",
                  subscribed_at: "2025-05-01T13:00:00Z",
                },
              ],
            },
          },
          {
            id: 20,
            data: {
              headers: ["id", "user_id", "amount", "payment_date"],
              rows: [
                {
                  id: 1,
                  user_id: 4,
                  amount: 29.99,
                  payment_date: "2025-05-01T13:10:00Z",
                },
              ],
            },
          },
          {
            id: 21,
            data: {
              headers: ["id", "user_id", "total", "issued_at"],
              rows: [
                { id: 1, user_id: 1, total: 100.0, issued_at: "2025-05-01T13:20:00Z" },
              ],
            },
          },
          {
            id: 22,
            data: {
              headers: ["id", "user_id", "transaction_type", "amount", "status"],
              rows: [
                {
                  id: 1,
                  user_id: 2,
                  transaction_type: "debit",
                  amount: 49.99,
                  status: "completed",
                },
              ],
            },
          },
          {
            id: 23,
            data: {
              headers: ["id", "user_id", "balance", "last_updated"],
              rows: [
                {
                  id: 1,
                  user_id: 3,
                  balance: 150.75,
                  last_updated: "2025-05-01T13:40:00Z",
                },
              ],
            },
          },
          {
            id: 24,
            data: {
              headers: ["id", "user_id", "notification", "archived_at"],
              rows: [
                {
                  id: 1,
                  user_id: 4,
                  notification: "You have a new follower",
                  archived_at: "2025-05-01T13:50:00Z",
                },
              ],
            },
          },
          {
            id: 25,
            data: {
              headers: ["id", "user_id", "action", "timestamp"],
              rows: [
                {
                  id: 1,
                  user_id: 1,
                  action: "Login",
                  timestamp: "2025-05-01T14:00:00Z",
                },
              ],
            },
          },
        ];

        const getAllTableContents = () => {
          return jsonTableData;
        };

        export { getAllTableContents };

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ table.ts (6.82 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        export interface TableDataType {
          id: number;
          table_name: string;
          user_id: string;
          created_at: string; // ISO 8601 datetime format
          modified_at: string; // ISO 8601 datetime format
          description?: string; // Optional field
          pendingCount: number;
          headers?: string[];
          is_shared: boolean;
          owner: {
            id: number;
            username: string;
          };
          shared_with: Array<{
            id: number;
            username: string;
          }>;
        }

        const tableData = [
          {
            id: 1,
            table_name: "posts",
            user_id: "1",
            created_at: "2025-05-01T10:00:00Z",
            modified_at: "2025-05-02T12:00:00Z",
            description: "Stores user-generated posts",
            pendingCount: 0,
          },
          {
            id: 2,
            table_name: "comments",
            user_id: "2",
            created_at: "2025-05-01T10:10:00Z",
            modified_at: "2025-05-02T12:15:00Z",
            description: "Stores comments made on posts",
            pendingCount: 0,
          },
          {
            id: 3,
            table_name: "likes",
            user_id: "3",
            created_at: "2025-05-01T10:20:00Z",
            modified_at: "2025-05-02T12:30:00Z",
            pendingCount: 0,
          },
          {
            id: 4,
            table_name: "messages",
            user_id: "4",
            created_at: "2025-05-01T10:30:00Z",
            modified_at: "2025-05-02T12:45:00Z",
            description: "Direct messages between users",
            pendingCount: 0,
          },
          {
            id: 5,
            table_name: "profiles",
            user_id: "1",
            created_at: "2025-05-01T10:40:00Z",
            modified_at: "2025-05-02T13:00:00Z",
            pendingCount: 0,
          },
          {
            id: 6,
            table_name: "notifications",
            user_id: "2",
            created_at: "2025-05-01T10:50:00Z",
            modified_at: "2025-05-02T13:15:00Z",
            pendingCount: 0,
          },
          {
            id: 7,
            table_name: "followers",
            user_id: "3",
            created_at: "2025-05-01T11:00:00Z",
            modified_at: "2025-05-02T13:30:00Z",
            pendingCount: 0,
          },
          {
            id: 8,
            table_name: "following",
            user_id: "4",
            created_at: "2025-05-01T11:10:00Z",
            modified_at: "2025-05-02T13:45:00Z",
            pendingCount: 0,
          },
          {
            id: 9,
            table_name: "settings",
            user_id: "1",
            created_at: "2025-05-01T11:20:00Z",
            modified_at: "2025-05-02T14:00:00Z",
            description: "User preferences and configurations",
            pendingCount: 0,
          },
          {
            id: 10,
            table_name: "media_files",
            user_id: "2",
            created_at: "2025-05-01T11:30:00Z",
            modified_at: "2025-05-02T14:15:00Z",
            pendingCount: 0,
          },
          {
            id: 11,
            table_name: "albums",
            user_id: "3",
            created_at: "2025-05-01T11:40:00Z",
            modified_at: "2025-05-02T14:30:00Z",
            pendingCount: 0,
          },
          {
            id: 12,
            table_name: "tags",
            user_id: "4",
            created_at: "2025-05-01T11:50:00Z",
            modified_at: "2025-05-02T14:45:00Z",
            pendingCount: 0,
          },
          {
            id: 13,
            table_name: "mentions",
            user_id: "1",
            created_at: "2025-05-01T12:00:00Z",
            modified_at: "2025-05-02T15:00:00Z",
            pendingCount: 0,
          },
          {
            id: 14,
            table_name: "stories",
            user_id: "2",
            created_at: "2025-05-01T12:10:00Z",
            modified_at: "2025-05-02T15:15:00Z",
            pendingCount: 0,
          },
          {
            id: 15,
            table_name: "reactions",
            user_id: "3",
            created_at: "2025-05-01T12:20:00Z",
            modified_at: "2025-05-02T15:30:00Z",
            pendingCount: 0,
          },
          {
            id: 16,
            table_name: "views",
            user_id: "4",
            created_at: "2025-05-01T12:30:00Z",
            modified_at: "2025-05-02T15:45:00Z",
            pendingCount: 0,
          },
          {
            id: 17,
            table_name: "shares",
            user_id: "1",
            created_at: "2025-05-01T12:40:00Z",
            modified_at: "2025-05-02T16:00:00Z",
            pendingCount: 0,
          },
          {
            id: 18,
            table_name: "bookmarks",
            user_id: "2",
            created_at: "2025-05-01T12:50:00Z",
            modified_at: "2025-05-02T16:15:00Z",
            description: "Stores content bookmarked by users",
            pendingCount: 0,
          },
          {
            id: 19,
            table_name: "subscriptions",
            user_id: "3",
            created_at: "2025-05-01T13:00:00Z",
            modified_at: "2025-05-02T16:30:00Z",
            pendingCount: 0,
          },
          {
            id: 20,
            table_name: "payments",
            user_id: "4",
            created_at: "2025-05-01T13:10:00Z",
            modified_at: "2025-05-02T16:45:00Z",
            description: "User payment history and records",
            pendingCount: 0,
          },
          {
            id: 21,
            table_name: "invoices",
            user_id: "1",
            created_at: "2025-05-01T13:20:00Z",
            modified_at: "2025-05-02T17:00:00Z",
            pendingCount: 0,
          },
          {
            id: 22,
            table_name: "transactions",
            user_id: "2",
            created_at: "2025-05-01T13:30:00Z",
            modified_at: "2025-05-02T17:15:00Z",
            pendingCount: 0,
          },
          {
            id: 23,
            table_name: "wallets",
            user_id: "3",
            created_at: "2025-05-01T13:40:00Z",
            modified_at: "2025-05-02T17:30:00Z",
            pendingCount: 0,
          },
          {
            id: 24,
            table_name: "notifications_archive",
            user_id: "4",
            created_at: "2025-05-01T13:50:00Z",
            modified_at: "2025-05-02T17:45:00Z",
            pendingCount: 0,
          },
          {
            id: 25,
            table_name: "activity_logs",
            user_id: "1",
            created_at: "2025-05-01T14:00:00Z",
            modified_at: "2025-05-02T18:00:00Z",
            description: "Logs of user actions and system activities",
            pendingCount: 0,
          },
          {
            id: 26,
            table_name: "devices",
            user_id: "2",
            created_at: "2025-05-01T14:10:00Z",
            modified_at: "2025-05-02T18:15:00Z",
            pendingCount: 0,
          },
          {
            id: 27,
            table_name: "locations",
            user_id: "3",
            created_at: "2025-05-01T14:20:00Z",
            modified_at: "2025-05-02T18:30:00Z",
            pendingCount: 0,
          },
          {
            id: 28,
            table_name: "reports",
            user_id: "4",
            created_at: "2025-05-01T14:30:00Z",
            modified_at: "2025-05-02T18:45:00Z",
            description: "User-submitted issue or content reports",
            pendingCount: 0,
          },
          {
            id: 29,
            table_name: "support_tickets",
            user_id: "1",
            created_at: "2025-05-01T14:40:00Z",
            modified_at: "2025-05-02T19:00:00Z",
            pendingCount: 5,
          },
          {
            id: 30,
            table_name: "audit_trails",
            user_id: "2",
            created_at: "2025-05-01T14:50:00Z",
            modified_at: "2025-05-02T19:15:00Z",
            pendingCount: 0,
          },
          {
            id: 31,
            table_name: "activity_logs",
            user_id: "1",
            created_at: "2025-05-01T14:00:00Z",
            modified_at: "2025-05-02T18:00:00Z",
            description: "Logs of user actions and system activities",
            pendingCount: 0,
          },
          {
            id: 32,
            table_name: "activity_logs",
            user_id: "1",
            created_at: "2025-05-01T14:00:00Z",
            modified_at: "2025-05-02T18:00:00Z",
            description: "Logs of user actions and system activities",
            pendingCount: 0,
          },
          {
            id: 33,
            table_name: "activity_logs",
            user_id: "1",
            created_at: "2025-05-01T14:00:00Z",
            modified_at: "2025-05-02T18:00:00Z",
            description: "Logs of user actions and system activities",
            pendingCount: 0,
          },
        ];

        const getTableData = (user_id: TableDataType["user_id"]) => {
          const filteredTableData = tableData
            .filter((table) => table.user_id === user_id)
            .sort((a, b) => b.modified_at.localeCompare(a.modified_at));

          return filteredTableData;
        };

        export { getTableData };
        export type { TableDataType };

      --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ reducers
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ TableContentReducer.ts (5.83 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import { TableRow, TableData, JsonTableItem } from "../data/TableContent";

        export interface CreateTablePayload {
          table_name: string;
          headers: string[];
          description: string;
        }

        export type JsonTableAction =
          | {
              type: "ADD_TABLE";
              payload: CreateTablePayload | JsonTableItem;
            }
          | {
              type: "ADD_ROW";
              payload: {
                tableId: number;
                row: Omit<TableRow, "id">;
              };
            }
          | {
              type: "EDIT_ROW";
              payload: {
                tableId: number;
                rowId: number | string;
                newRow: Partial<TableRow>;
              };
            }
          | {
              type: "DELETE_ROW";
              payload: {
                tableId: number;
                rowId: number | string;
              };
            }
          | {
              type: "EDIT_TABLE_HEADERS";
              payload: {
                tableId: number;
                headers: string[];
              };
            }
          | {
              type: "DELETE_TABLE";
              payload: {
                tableId: number;
              };
            }
          | {
              type: "ADD_COLUMN";
              payload: {
                tableId: number;
                header: string;
              };
            }
          | {
              type: "EDIT_HEADER";
              payload: {
                tableId: number;
                oldHeader: string;
                newHeader: string;
              };
            }
          | {
              type: "DELETE_COLUMN";
              payload: {
                tableId: number;
                header: string;
              };
            }
          | { type: "SET_TABLES"; payload: JsonTableItem[] };

        export function jsonTableReducer(
          state: JsonTableItem[],
          action: JsonTableAction
        ): JsonTableItem[] {
          switch (action.type) {
            case "SET_TABLES": {
              return [...action.payload];
            }
            case "ADD_TABLE": {
              return [
                ...state,
                {
                  id: action.payload.id,
                  data: action.payload.data,
                },
              ];
            }
            case "ADD_ROW": {
              const { tableId, row } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  // Create a new row with the data from the backend
                  const newRow: TableRow = {
                    id: row.id || `row-${Date.now()}`,
                    ...row,
                  };

                  return {
                    ...table,
                    data: {
                      ...table.data,
                      rows: [...table.data.rows, newRow],
                    },
                  };
                }
                return table;
              });
            }
            case "ADD_COLUMN": {
              const { tableId, header } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  return {
                    ...table,
                    data: {
                      ...table.data,
                      headers: [...table.data.headers, header],
                      rows: table.data.rows.map((row) => ({
                        ...row,
                        [header]: "",
                      })),
                    },
                  };
                }
                return table;
              });
            }

            case "EDIT_ROW": {
              const { tableId, rowId, newRow } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  return {
                    ...table,
                    data: {
                      ...table.data,
                      rows: table.data.rows.map((row) => {
                        if (row.id === rowId) {
                          // Create a new object with the updated properties
                          const updatedRow: TableRow = { ...row };
                          for (const key in newRow) {
                            if (newRow[key] !== undefined) {
                              updatedRow[key] = newRow[key] as
                                | string
                                | number
                                | boolean
                                | null;
                            }
                          }
                          return updatedRow;
                        }
                        return row;
                      }),
                    },
                  };
                }
                return table;
              });
            }

            case "DELETE_ROW": {
              const { tableId, rowId } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  return {
                    ...table,
                    data: {
                      ...table.data,
                      rows: table.data.rows.filter((row) => row.id !== rowId),
                    },
                  };
                }
                return table;
              });
            }

            case "EDIT_TABLE_HEADERS": {
              const { tableId, headers } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  return {
                    ...table,
                    data: {
                      ...table.data,
                      headers,
                    },
                  };
                }
                return table;
              });
            }

            case "DELETE_TABLE": {
              const { tableId } = action.payload;
              return state.filter((table) => table.id !== tableId);
            }

            case "EDIT_HEADER": {
              const { tableId, oldHeader, newHeader } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  const newHeaders = table.data.headers.map((header) =>
                    header === oldHeader ? newHeader : header
                  );
                  return {
                    ...table,
                    data: {
                      ...table.data,
                      headers: newHeaders,
                      rows: table.data.rows.map((row) => {
                        const newRow = { ...row };
                        if (oldHeader in newRow) {
                          newRow[newHeader] = newRow[oldHeader];
                          delete newRow[oldHeader];
                        }
                        return newRow;
                      }),
                    },
                  };
                }
                return table;
              });
            }

            case "DELETE_COLUMN": {
              const { tableId, header } = action.payload;
              return state.map((table) => {
                if (table.id === tableId) {
                  return {
                    ...table,
                    data: {
                      ...table.data,
                      headers: table.data.headers.filter((h) => h !== header),
                      rows: table.data.rows.map((row) => {
                        const newRow = { ...row };
                        delete newRow[header];
                        return newRow;
                      }),
                    },
                  };
                }
                return table;
              });
            }

            default:
              return state;
          }
        }

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ TableReducer.ts (2.28 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import { TableDataType } from "@/data/table";
        export type TableDataAction =
          | { type: "EDIT"; payload: { id: number; table_name: string } }
          | {
              type: "SHARE";
              payload: {
                id: number;
                is_shared: boolean;
                shared_with: Array<{
                  id: number;
                  username: string;
                }>;
              };
            }
          | { type: "DELETE"; payload: { id: number } }
          | { type: "SET_TABLES"; payload: TableDataType[] }
          | {
              type: "ADD_TABLE";
              payload: {
                id: number;
                table_name: string;
                description: string;
                headers: string[];
              };
            };

        export const TableReducer = (
          tables: TableDataType[],
          action: TableDataAction
        ): TableDataType[] => {
          switch (action.type) {
            case "SET_TABLES": {
              console.log("at tablereducer set table: ", action.payload);

              return [...action.payload.data];
            }
            case "ADD_TABLE": {
              return [
                ...tables,
                {
                  id: action.payload.id,
                  table_name: action.payload.table_name,
                  user_id: "1",
                  created_at: new Date().toISOString(),
                  modified_at: new Date().toISOString(),
                  description: action.payload.description,
                  pendingCount: 0,
                },
              ].sort(
                (a, b) =>
                  new Date(b.modified_at).getTime() - new Date(a.modified_at).getTime()
              );
            }
            case "EDIT": {
              return tables
                .map((table) =>
                  table.id === action.payload.id
                    ? {
                        ...table,
                        table_name: action.payload.table_name,
                        modified_at: new Date().toISOString(),
                      }
                    : table
                )
                .sort(
                  (a, b) =>
                    new Date(b.modified_at).getTime() -
                    new Date(a.modified_at).getTime()
                );
            }

            case "SHARE": {
              return tables.map((table) =>
                table.id === action.payload.id
                  ? {
                      ...table,
                      is_shared: action.payload.is_shared,
                      shared_with: action.payload.shared_with,
                      modified_at: new Date().toISOString(),
                    }
                  : table
              );
            }

            case "DELETE": {
              return tables.filter((table) => table.id !== action.payload.id);
            }

            default:
              return [...tables]; // Fallback for unrecognized action
          }
        };

      --------------------------------------------------------------------------------------------------------------


  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ðŸ“ expense_backend
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  ðŸ“„ .env.example (0.41 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    # .env
    DEBUG=True
    SECRET_KEY=k_tlh8c(a*7=64v%=rq11d!e*-f_ziszm4ggrw&ttw^&*c=^0d
    ALLOWED_HOSTS=localhost,127.0.0.1

    DB_ENGINE=django.db.backends.sqlite3
    DB_NAME=db.sqlite3
    DJANGO_SETTINGS_MODULE=expense_api.settings.development

    # Example for production (PostgreSQL)
    # DB_ENGINE=django.db.backends.postgresql
    # DB_NAME=your_db_name
    # DB_USER=your_db_user
    # DB_PASSWORD=your_db_password
    # DB_HOST=localhost
    # DB_PORT=5432

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ .gitignore (0.17 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    /.env 
    /venv
    /db.sqlite3

    __pycache__/
    *.py[cod]

    # Ignore all migration files
    **/migrations/*.py
    **/migrations/*.pyc

    # Do NOT ignore __init__.py
    !**/migrations/__init__.py
  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ manage.py (0.66 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    #!/usr/bin/env python
    """Django's command-line utility for administrative tasks."""
    import os
    import sys


    def main():
        """Run administrative tasks."""
        os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'expense_api.settings.development')
        try:
            from django.core.management import execute_from_command_line
        except ImportError as exc:
            raise ImportError(
                "Couldn't import Django. Are you sure it's installed and "
                "available on your PYTHONPATH environment variable? Did you "
                "forget to activate a virtual environment?"
            ) from exc
        execute_from_command_line(sys.argv)


    if __name__ == '__main__':
        main()

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ requirements.txt (1.11 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    annotated-types==0.7.0
    anthropic==0.52.2
    anyio==4.9.0
    asgiref==3.8.1
    certifi==2025.4.26
    charset-normalizer==3.4.2
    click==8.2.1
    distro==1.9.0
    Django==5.2
    django-cors-headers==4.7.0
    django-environ==0.12.0
    django-rest-framework==0.1.0
    djangorestframework==3.16.0
    djangorestframework_simplejwt==5.5.0
    greenlet==3.2.2
    h11==0.16.0
    httpcore==1.0.9
    httpx==0.28.1
    httpx-sse==0.4.0
    idna==3.10
    jiter==0.10.0
    jsonpatch==1.33
    jsonpointer==3.0.0
    langchain==0.3.25
    langchain-anthropic==0.3.14
    langchain-core==0.3.63
    langchain-mcp-adapters==0.1.4
    langchain-text-splitters==0.3.8
    langgraph==0.4.7
    langgraph-checkpoint==2.0.26
    langgraph-prebuilt==0.2.2
    langgraph-sdk==0.1.70
    langsmith==0.3.43
    mcp==1.9.2
    orjson==3.10.18
    ormsgpack==1.10.0
    packaging==24.2
    pydantic==2.11.5
    pydantic-settings==2.9.1
    pydantic_core==2.33.2
    PyJWT==2.9.0
    python-dotenv==1.1.0
    python-multipart==0.0.20
    PyYAML==6.0.2
    requests==2.32.3
    requests-toolbelt==1.0.0
    sniffio==1.3.1
    SQLAlchemy==2.0.41
    sqlparse==0.5.3
    sse-starlette==2.3.6
    starlette==0.47.0
    tenacity==9.1.2
    typing-inspection==0.4.1
    typing_extensions==4.13.2
    urllib3==2.4.0
    uvicorn==0.34.3
    xxhash==3.5.0
    zstandard==0.23.0

  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ streaming_response_example.py (6.21 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    #!/usr/bin/env python3
    """
    Example of the new streaming and thinking format responses for the Finance AI Agent.
    """

    # Example 1: Standard Response (existing format)
    standard_response = {
        "query": "ami ajk sylhet e 100 tk khoroch korechi",
        "response": "Excellent! Your expense has been successfully added...",
        "response_type": "enhanced_operation",
        "enhanced_data": {
            "success": True,
            "message": "Query processed successfully"
        }
    }

    # Example 2: Streaming Format Response
    streaming_response = {
        "query": "ami ajk sylhet e 100 tk khoroch korechi",
        "format": "streaming",
        "streaming_data": {
            "total_steps": 5,
            "processing_time": "~2-3 seconds",
            "steps": [
                {
                    "step": 1,
                    "type": "user_input",
                    "title": "ðŸ¤” Understanding your request...",
                    "content": "I received your query: 'ami ajk sylhet e 100 tk khoroch korechi'",
                    "details": "Let me break this down and understand what you need."
                },
                {
                    "step": 2,
                    "type": "ai_thinking",
                    "title": "ðŸ§  Analyzing and planning...",
                    "content": "I understand you want to record an expense of 100 tk in Sylhet today. Let me check your existing tables first.",
                    "details": "I'm processing your request and determining the best approach."
                },
                {
                    "step": 3,
                    "type": "tool_execution",
                    "title": "ðŸ”§ Using get_user_tables...",
                    "content": "Executing: get_user_tables with parameters: {'user_id': 1}",
                    "details": "Performing the requested operation on your financial data."
                },
                {
                    "step": 4,
                    "type": "tool_execution", 
                    "title": "ðŸ”§ Using add_table_row...",
                    "content": "Executing: add_table_row with parameters: {'table_id': 8, 'row_data': {...}}",
                    "details": "Adding your expense to the Daily Expenses table."
                },
                {
                    "step": 5,
                    "type": "final_response",
                    "title": "ðŸŽ¯ Generating final response...",
                    "content": "Excellent! Your expense has been successfully added to the 'Daily Expenses' table...",
                    "details": "Presenting the results of your request."
                }
            ],
            "tools_used": [
                {
                    "step": 3,
                    "type": "tool_execution",
                    "title": "ðŸ”§ Using get_user_tables..."
                },
                {
                    "step": 4,
                    "type": "tool_execution",
                    "title": "ðŸ”§ Using add_table_row..."
                }
            ]
        },
        "live_steps": [
            {"timestamp": "00:00", "action": "ðŸ¤” Analyzing query...", "status": "completed"},
            {"timestamp": "00:01", "action": "ðŸ§  Understanding intent...", "status": "completed"},
            {"timestamp": "00:02", "action": "ðŸ” Checking user tables...", "status": "completed"},
            {"timestamp": "00:03", "action": "ðŸ“ Adding expense entry...", "status": "completed"},
            {"timestamp": "00:04", "action": "âœ… Generating response...", "status": "completed"}
        ],
        "final_response": "Excellent! Your expense has been successfully added..."
    }

    # Example 3: Thinking Format Response
    thinking_response = {
        "query": "ami ajk sylhet e 100 tk khoroch korechi",
        "format": "thinking",
        "thinking_process": {
            "initial_analysis": {
                "user_query": "ami ajk sylhet e 100 tk khoroch korechi",
                "language_detected": "Bengali/English mix",
                "intent_recognized": "Expense recording",
                "key_extracted_info": {
                    "amount": "100 tk",
                    "location": "Sylhet",
                    "date": "Today (ajk)",
                    "action": "Record expense"
                }
            },
            "decision_making": {
                "strategy": "Find existing expense table or create new one",
                "tools_selected": ["get_user_tables", "add_table_row"],
                "reasoning": "First check available tables, then add expense to appropriate table"
            },
            "execution_summary": {
                "success": True,
                "steps_completed": [
                    "Retrieved user tables",
                    "Identified 'Daily Expenses' table",
                    "Added new expense entry",
                    "Generated unique ID for entry"
                ],
                "result": "Expense successfully recorded with ID: 7266c4a2"
            },
            "user_communication": {
                "tone": "Helpful and confirmatory",
                "format": "Step-by-step explanation",
                "additional_info": "Offered further assistance"
            }
        },
        "response_summary": {
            "overall_assessment": "Successfully processed expense recording request",
            "confidence_level": "High",
            "processing_approach": "Table-based expense tracking",
            "user_experience": "Smooth and efficient",
            "next_suggestions": [
                "View your expense summary",
                "Set budget limits", 
                "Generate expense reports"
            ]
        },
        "final_response": "Excellent! Your expense has been successfully added..."
    }

    # Example API Calls:

    # 1. Request standard format (default)
    """
    POST /agent/query/
    {
        "query": "ami ajk sylhet e 100 tk khoroch korechi"
    }
    """

    # 2. Request streaming format
    """
    POST /agent/query/
    {
        "query": "ami ajk sylhet e 100 tk khoroch korechi",
        "format": "streaming"
    }
    """

    # 3. Request thinking format
    """
    POST /agent/query/
    {
        "query": "ami ajk sylhet e 100 tk khoroch korechi", 
        "format": "thinking"
    }
    """

    # 4. Use dedicated streaming endpoint
    """
    POST /agent/streaming/
    {
        "query": "ami ajk sylhet e 100 tk khoroch korechi",
        "format": "streaming"  # or "thinking"
    }
    """

    print("âœ… Streaming and Thinking format examples created!")
    print("\nKey Features:")
    print("- ðŸŽ­ Multiple response formats: standard, streaming, thinking")  
    print("- ðŸ”„ Real-time step-by-step processing visualization")
    print("- ðŸ§  AI thinking process breakdown")
    print("- âš¡ Live action timestamps")
    print("- ðŸ› ï¸ Tool usage tracking") 
    print("- ðŸ“Š Enhanced user experience") 
  --------------------------------------------------------------------------------------------------------------

  ðŸ“„ test_streaming_format.py (4.62 KB)
  --------------------------------------------------------------------------------------------------------------
  CONTENT:
  --------------------------------------------------------------------------------------------------------------
    #!/usr/bin/env python3
    """
    Test script to validate streaming format implementation.
    """

    import os
    import sys
    import django

    # Add the project to Python path
    sys.path.append('/home/mehedi/03_Projects/FinanceManagement/expense_backend')

    # Set up Django environment
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'expense_backend.settings')
    django.setup()

    from expense_api.apps.agent.serializers import ResponseSerializer

    def test_streaming_format():
        """Test the streaming format serializer."""

        # Test data based on the example
        test_data = {
            "query": "ami ajk sylhet e 100 tk khoroch korechi",
            "response": {
                "success": True,
                "message": "Query processed successfully",
                "query": "ami ajk sylhet e 100 tk khoroch korechi",
                "response": "Excellent! Your expense has been successfully added to the 'Daily Expenses' table...",
                "formatted_response": "Excellent! Your expense has been successfully added...",
                "raw_response": {
                    "messages": []  # Simplified for testing
                },
                "operation_stats": {
                    "total": 0,
                    "success_rate": 0
                }
            }
        }

        # Test serializer
        serializer = ResponseSerializer(test_data)
        result = serializer.data

        print("ðŸ§ª Testing Streaming Format Implementation")
        print("=" * 50)

        # Test basic fields
        print(f"âœ… Query: {result.get('query', 'MISSING')}")
        print(f"âœ… Response Type: {result.get('response_type', 'MISSING')}")

        # Test streaming format
        streaming_format = result.get('streaming_format')
        if streaming_format:
            print(f"âœ… Streaming Format: Available")
            print(f"   - Total Steps: {streaming_format.get('total_steps', 'MISSING')}")
            print(f"   - Processing Time: {streaming_format.get('processing_time', 'MISSING')}")
            print(f"   - Tools Used: {len(streaming_format.get('tools_used', []))}")

            # Check steps format
            steps = streaming_format.get('steps', [])
            if steps:
                print(f"   - Steps Available: {len(steps)}")
                for i, step in enumerate(steps[:3]):  # Show first 3 steps
                    print(f"     Step {step.get('step', '?')}: {step.get('title', 'No title')}")
            else:
                print("   - No steps found")
        else:
            print("âŒ Streaming Format: Missing")

        # Test thinking process
        thinking_process = result.get('thinking_process')
        if thinking_process:
            print(f"âœ… Thinking Process: Available")

            # Check main sections
            sections = ['initial_analysis', 'decision_making', 'execution_summary', 'user_communication']
            for section in sections:
                if section in thinking_process:
                    print(f"   - {section}: âœ…")
                else:
                    print(f"   - {section}: âŒ")

            # Check extracted info
            initial_analysis = thinking_process.get('initial_analysis', {})
            extracted_info = initial_analysis.get('key_extracted_info', {})
            print(f"   - Extracted Amount: {extracted_info.get('amount', 'MISSING')}")
            print(f"   - Extracted Location: {extracted_info.get('location', 'MISSING')}")
            print(f"   - Language Detected: {initial_analysis.get('language_detected', 'MISSING')}")
        else:
            print("âŒ Thinking Process: Missing")

        # Test enhanced data
        enhanced_data = result.get('enhanced_data')
        if enhanced_data:
            print(f"âœ… Enhanced Data: Available")
            print(f"   - Success: {enhanced_data.get('success', 'MISSING')}")
            print(f"   - Message: {enhanced_data.get('message', 'MISSING')}")
        else:
            print("âŒ Enhanced Data: Missing")

        print("\n" + "=" * 50)
        print("ðŸŽ¯ Test Summary:")

        required_fields = ['query', 'response', 'response_type', 'enhanced_data', 'streaming_format', 'thinking_process']
        missing_fields = [field for field in required_fields if not result.get(field)]

        if not missing_fields:
            print("âœ… All required fields present!")
            print("âœ… Implementation matches example format!")
        else:
            print(f"âŒ Missing fields: {missing_fields}")

        print("\nðŸ“‹ Available Response Formats:")
        print("- Standard format âœ…")
        print("- Streaming format âœ…")  
        print("- Thinking format âœ…")
        print("- Enhanced data âœ…")

        return result

    if __name__ == "__main__":
        try:
            result = test_streaming_format()
            print("\nðŸŽ‰ Test completed successfully!")
        except Exception as e:
            print(f"\nâŒ Test failed: {e}")
            import traceback
            traceback.print_exc() 
  --------------------------------------------------------------------------------------------------------------


    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ðŸ“ expense_api
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ðŸ“„ __init__.py (0.00 KB)
    --------------------------------------------------------------------------------------------------------------
    CONTENT:
    --------------------------------------------------------------------------------------------------------------

    --------------------------------------------------------------------------------------------------------------

    ðŸ“„ asgi.py (0.53 KB)
    --------------------------------------------------------------------------------------------------------------
    CONTENT:
    --------------------------------------------------------------------------------------------------------------
      """
      ASGI config for expense_backend project.

      It exposes the ASGI callable as a module-level variable named ``application``.

      For more information on this file, see
      https://docs.djangoproject.com/en/5.0/howto/deployment/asgi/
      """

      import os
      import environ  # âœ… add this line

      # Initialize environment variables
      env = environ.Env()
      environ.Env.read_env()  # Reads from .env file

      from django.core.asgi import get_asgi_application

      os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'expense_backend.settings')

      application = get_asgi_application()

    --------------------------------------------------------------------------------------------------------------

    ðŸ“„ urls.py (1.08 KB)
    --------------------------------------------------------------------------------------------------------------
    CONTENT:
    --------------------------------------------------------------------------------------------------------------
      """
      URL configuration for expense_backend project.

      The `urlpatterns` list routes URLs to views. For more information please see:
          https://docs.djangoproject.com/en/5.0/topics/http/urls/
      Examples:
      Function views
          1. Add an import:  from my_app import views
          2. Add a URL to urlpatterns:  path('', views.home, name='home')
      Class-based views
          1. Add an import:  from other_app.views import Home
          2. Add a URL to urlpatterns:  path('', Home.as_view(), name='home')
      Including another URLconf
          1. Import the include() function: from django.urls import include, path
          2. Add a URL to urlpatterns:  path('blog/', include('blog.urls'))
      """
      from django.contrib import admin
      from django.urls import path, include   # <-- ADD include here
      from . import views

      urlpatterns = [
          path('admin/', admin.site.urls),
          path('', views.home, name='home'),
          path('about/', views.about, name='about'),
          path('agent/', include('expense_api.apps.agent.urls')),
          path('auth/', include('expense_api.apps.user_auth.urls')),
          path('main/', include('expense_api.apps.FinanceManagement.urls')),
      ]
    --------------------------------------------------------------------------------------------------------------

    ðŸ“„ views.py (0.25 KB)
    --------------------------------------------------------------------------------------------------------------
    CONTENT:
    --------------------------------------------------------------------------------------------------------------
      from django.http import HttpResponse

      def home(request):
          return HttpResponse("This is the home page.")

      def about(request):
          return HttpResponse("This is the about page.")

      def contact(request):
          return HttpResponse("This is the contact page.")

    --------------------------------------------------------------------------------------------------------------

    ðŸ“„ wsgi.py (0.53 KB)
    --------------------------------------------------------------------------------------------------------------
    CONTENT:
    --------------------------------------------------------------------------------------------------------------
      """
      WSGI config for expense_backend project.

      It exposes the WSGI callable as a module-level variable named ``application``.

      For more information on this file, see
      https://docs.djangoproject.com/en/5.0/howto/deployment/wsgi/
      """
      import os
      import environ  # âœ… add this line

      # Initialize environment variables
      env = environ.Env()
      environ.Env.read_env()  # Reads from .env file

      from django.core.wsgi import get_wsgi_application

      os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'expense_backend.settings')

      application = get_wsgi_application()

    --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ settings
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

      ðŸ“„ __init__.py (0.00 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ base.py (2.94 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        import os
        import sys
        from pathlib import Path
        import environ

        # Set BASE_DIR to the root of your Django project
        BASE_DIR = Path(__file__).resolve().parent.parent.parent


        env = environ.Env()
        environ.Env.read_env(os.path.join(BASE_DIR, ".env"))

        SECRET_KEY = env('SECRET_KEY')
        DEBUG = env('DEBUG')
        ALLOWED_HOSTS = env.list('ALLOWED_HOSTS')


        INSTALLED_APPS = [
            'django.contrib.admin',
            'django.contrib.auth',
            'django.contrib.contenttypes',
            'django.contrib.sessions',
            'django.contrib.messages',
            'django.contrib.staticfiles',
            'rest_framework',
            'rest_framework_simplejwt',
            'expense_api.apps.FinanceManagement',
            'expense_api.apps.agent',
            'expense_api.apps.user_auth',
            'corsheaders',
        ]

        MIDDLEWARE = [
            'corsheaders.middleware.CorsMiddleware',
            'django.middleware.common.CommonMiddleware',
            'django.middleware.security.SecurityMiddleware',
            'django.contrib.sessions.middleware.SessionMiddleware',
            'django.middleware.common.CommonMiddleware',
            'django.contrib.auth.middleware.AuthenticationMiddleware',
            'django.contrib.messages.middleware.MessageMiddleware',
            'django.middleware.clickjacking.XFrameOptionsMiddleware',
        ]

        CORS_ALLOWED_ORIGINS = [
            "http://localhost:3000",
        ]
        CORS_ALLOW_CREDENTIALS = True

        CSRF_TRUSTED_ORIGINS = [
            "http://localhost:3000",
        ]

        ROOT_URLCONF = 'expense_api.urls'  # <-- update to your actual project folder name

        TEMPLATES = [
            {
                'BACKEND': 'django.template.backends.django.DjangoTemplates',
                'DIRS': [BASE_DIR / "templates"],
                'APP_DIRS': True,
                'OPTIONS': {
                    'context_processors': [
                        'django.template.context_processors.debug',
                        'django.template.context_processors.request',
                        'django.contrib.auth.context_processors.auth',
                        'django.contrib.messages.context_processors.messages',
                    ],
                },
            },
        ]


        # Password validation
        # https://docs.djangoproject.com/en/5.0/ref/settings/#auth-password-validators

        AUTH_PASSWORD_VALIDATORS = [
            {
                'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
            },
            {
                'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
            },
            {
                'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
            },
            {
                'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
            },
        ]

        # Internationalization
        # https://docs.djangoproject.com/en/5.0/topics/i18n/

        LANGUAGE_CODE = 'en-us'

        TIME_ZONE = 'UTC'

        USE_I18N = True

        USE_TZ = True

        WSGI_APPLICATION = 'expense_api.wsgi.application'
        ASGI_APPLICATION = 'expense_api.asgi.application'

        # Static and media files
        STATIC_URL = '/static/'
        MEDIA_URL = '/media/'
        STATIC_ROOT = BASE_DIR / 'staticfiles'
        MEDIA_ROOT = BASE_DIR / 'mediafiles'


        # Default primary key field type
        # https://docs.djangoproject.com/en/5.0/ref/settings/#default-auto-field

        DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ development.py (0.15 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        from .base import *

        DEBUG = True

        DATABASES = {
            'default': {
                'ENGINE': env('DB_ENGINE'),
                'NAME': BASE_DIR / env('DB_NAME'),
            }
        }

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ production.py (0.39 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        from .base import *

        DEBUG = False

        DATABASES = {
            'default': {
                'ENGINE': env('DB_ENGINE'),
                'NAME': env('DB_NAME'),
                'USER': env('DB_USER'),
                'PASSWORD': env('DB_PASSWORD'),
                'HOST': env('DB_HOST'),
                'PORT': env('DB_PORT'),
            }
        }

        # Security
        SECURE_HSTS_SECONDS = 3600
        SECURE_SSL_REDIRECT = True
        SESSION_COOKIE_SECURE = True
        CSRF_COOKIE_SECURE = True

      --------------------------------------------------------------------------------------------------------------

      ðŸ“„ testing.py (0.19 KB)
      --------------------------------------------------------------------------------------------------------------
      CONTENT:
      --------------------------------------------------------------------------------------------------------------
        from .base import *

        DEBUG = True

        # Use SQLite in-memory database for testing
        DATABASES = {
            'default': {
                'ENGINE': 'django.db.backends.sqlite3',
                'NAME': ':memory:',
            }
        }

      --------------------------------------------------------------------------------------------------------------


      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      ðŸ“ apps
      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ user_auth
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ __init__.py (0.00 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ admin.py (0.06 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.contrib import admin

          # Register your models here.

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ apps.py (0.16 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.apps import AppConfig


          class AuthConfig(AppConfig):
              default_auto_field = 'django.db.models.BigAutoField'
              name = 'expense_api.apps.user_auth'

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ authentication.py (1.22 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          import jwt
          import datetime 
          from rest_framework import exceptions
          from rest_framework.permissions import BasePermission

          class IsAuthenticatedCustom(BasePermission):
              def has_permission(self, request, view):
                  return request.user is not None and request.user.is_authenticated

          def generate_access_token(user):
              payload = {
                  'user_id': user.id,
                  'exp': datetime.datetime.utcnow() + datetime.timedelta(minutes=60),
                  'iat': datetime.datetime.utcnow()
              }
              return jwt.encode(payload, 'secret', algorithm='HS256')

          def decode_access_token(token):
              try:
                  payload = jwt.decode(token, 'secret', algorithms=['HS256'])
                  return payload['user_id']
              except:
                  raise exceptions.AuthenticationFailed('Invalid token')

          def generate_refresh_token(user):
              payload = {
                  'user_id': user.id,
                  'exp': datetime.datetime.utcnow() + datetime.timedelta(days=1),
                  'iat': datetime.datetime.utcnow()
              }
              return jwt.encode(payload, 'secret', algorithm='HS256')

          def decode_refresh_token(token):
              try:
                  payload = jwt.decode(token, 'secret', algorithms=['HS256'])
                  return payload['user_id']
              except:
                  raise exceptions.AuthenticationFailed('Invalid token')

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ models.py (0.47 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.db import models

          # Create your models here.
          from django.contrib.auth.models import User

          class UserProfile(models.Model):
              user = models.OneToOneField(User, on_delete=models.CASCADE, related_name='profile')
              friends = models.ManyToManyField(User, related_name='friends', blank=True)
              created_at = models.DateTimeField(auto_now_add=True)
              updated_at = models.DateTimeField(auto_now=True)

              def __str__(self):
                  return f"{self.user.username}'s profile"

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ permission.py (0.75 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from rest_framework.authentication import BaseAuthentication
          from rest_framework.exceptions import AuthenticationFailed
          from rest_framework_simplejwt.tokens import AccessToken
          from .authentication import decode_access_token
          from django.contrib.auth.models import User

          class JWTAuthentication(BaseAuthentication):
              def authenticate(self, request):
                  token = request.COOKIES.get('access_token')  # Get JWT from cookies
                  if not token:
                      return None

                  try:
                      # print(token)
                      user_id = decode_access_token(token)
                      user = User.objects.get(id=user_id)
                      return (user, None)  # Return user and token
                  except Exception as e:
                      raise AuthenticationFailed("Invalid or expired token")
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ serializers.py (1.48 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from rest_framework import serializers
          from django.contrib.auth.models import User
          from .models import UserProfile

          class UserSerializer(serializers.ModelSerializer):
              class Meta:
                  model = User
                  fields = ('id', 'username', 'email', 'first_name', 'last_name')

          class userRegisterSerializer(serializers.ModelSerializer):
              class Meta:
                  model = User
                  fields = ('id', 'username', 'email', 'password', 'first_name', 'last_name')
                  extra_kwargs = {'password': {'write_only': True}}

              def create(self, validated_data):
                  user = User.objects.create_user(
                      username=validated_data['username'],
                      email=validated_data['email'],
                      password=validated_data['password'],
                      first_name=validated_data.get('first_name', ''),
                      last_name=validated_data.get('last_name', '')
                  )
                  return user

          class UserProfileSerializer(serializers.ModelSerializer):
              user = UserSerializer(read_only=True)
              friends = serializers.SerializerMethodField()

              class Meta:
                  model = UserProfile
                  fields = ('id', 'user', 'friends')

              def get_friends(self, obj):
                  friends = obj.friends.all()
                  return UserSerializer([friend.user for friend in friends], many=True).data

          class FriendSerializer(serializers.ModelSerializer):
              user = UserSerializer(read_only=True)
              friend = UserSerializer(read_only=True)

              class Meta:
                  model = UserProfile
                  fields = ('id', 'user', 'friend', 'created_at')
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ tests.py (0.06 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.test import TestCase

          # Create your tests here.

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ urls.py (1.00 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.urls import path
          from .models import User
          from .views import (
              UserRegisterView, MeView, loginView, UdateAccessToken, 
              logoutView, UserListView, UserDetailView, UpdateUserDetails, 
              UpdateUserProfile, FriendsListView, ManageFriendView
          )

          urlpatterns = [
              path('register/', UserRegisterView.as_view(), name='register'),
              path('login/', loginView.as_view(), name='login'),
              path('logout/', logoutView.as_view(), name='logout'),
              path('users-list/', UserListView.as_view(), name='users-list'),
              path('users-list/<int:user_id>/', UserDetailView.as_view(), name='users-detail'),
              path('update/', UpdateUserDetails.as_view(), name='update'),
              path('update-profile/', UpdateUserProfile.as_view(), name='update-profile'),
              path('updateAcessToken/', UdateAccessToken.as_view(), name='update'),
              path("me/", MeView.as_view(), name="me"),
              path('friends/', FriendsListView.as_view(), name='friends-list'),
              path('friends/manage/', ManageFriendView.as_view(), name='manage-friend'),
          ]
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ views.py (0.01 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from rest_framework import generics, status
          from rest_framework.views import APIView
          from rest_framework.response import Response
          from django.contrib.auth import authenticate

          from .authentication import IsAuthenticatedCustom, decode_refresh_token, generate_access_token, generate_refresh_token
          from .permission import JWTAuthentication
          from .serializers import UserSerializer, userRegisterSerializer
          from django.contrib.auth.models import User
          from .models import UserProfile

          # Create your views here.

          class UserRegisterView(APIView):
              def post(self, request):
                  serializer = userRegisterSerializer(data=request.data)
                  if serializer.is_valid():
                      user = serializer.save()
                      access_token = generate_access_token(user)
                      refresh_token = generate_refresh_token(user)

                      response = Response({
                          'message': "User registered successfully.",
                          'user': UserSerializer(user).data,
                          'access_token': access_token,
                          'refresh_token': refresh_token
                      })

                      # response.set_cookie('refresh_token', refresh_token, httponly=True)
                      # response.set_cookie('access_token', access_token, httponly=True)
                      response.set_cookie(
                          'refresh_token', refresh_token,
                          httponly=True, path='/', samesite='Lax',
                          secure=False, max_age=7*24*60*60  # <-- Important
                      )
                      response.set_cookie(
                          'access_token', access_token,
                          httponly=True, path='/', samesite='Lax',
                          secure=False, max_age=60*60  # <-- 15 minutes
                      )

                      return response

                  return Response(serializer.errors, status=400)


          class UserListView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request, *args, **kwargs):
                  try:
                      data = User.objects.all()
                      serializer = UserSerializer(data, many=True)
                      return Response(serializer.data)
                  except Exception as e:
                      return Response(
                          {"error": "An error occurred while fetching user data.", "details": str(e)},
                          status=status.HTTP_500_INTERNAL_SERVER_ERROR
                      )

          class loginView(APIView):
              def post(self, request):
                  username = request.data.get('username')
                  password = request.data.get('password')
                  user = authenticate(username=username, password=password)

                  if user:
                      response =  Response({'message': "Login successful.",
                                       'user': UserSerializer(user).data,
                                          'access_token': generate_access_token(user),
                                          'refresh_token': generate_refresh_token(user)
                                       })
                      # response.set_cookie('refresh_token', generate_refresh_token(user), httponly=True)
                      # response.set_cookie('access_token', generate_access_token(user), httponly=True)
                      response.set_cookie(
                          'refresh_token', generate_refresh_token(user),
                          httponly=True, path='/', samesite='Lax',
                          secure=False, max_age=7*24*60*60  # <-- Important
                      )
                      response.set_cookie(
                          'access_token', generate_access_token(user),
                          httponly=True, path='/', samesite='Lax',
                          secure=False, max_age=60*60  # <-- 15 minutes
                      )
                      return response
                  return Response({'message': "Invalid credentials."})

          class logoutView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  print('logoutView')
                  response = Response({'message': 'Logged out successfully'})
                  response.delete_cookie('refresh_token')
                  response.delete_cookie('access_token')
                  return response

          class UserDetailView(generics.RetrieveUpdateDestroyAPIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]
              def get(self, request, *args, **kwargs):
                  try:
                      user_id = self.kwargs.get('user_id')
                      queryset = User.objects.get(id=user_id)
                      serializer = UserSerializer(queryset, many=False)
                      return Response(serializer.data)
                  except Exception as e:
                      return Response(
                          {
                              "error": "User Not Found", 
                              "details": str(e)
                          },
                          status=status.HTTP_404_NOT_FOUND
                      )

          class UpdateUserDetails(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  email = request.data.get('email')
                  username = request.data.get('username')
                  password = request.data.get('password')
                  newpassword = request.data.get('newpassword')
                  newpassword2 = request.data.get('newpassword2')

                  if newpassword != newpassword2:
                      return Response({
                          "message": "New passwords do not match"
                      }, status=status.HTTP_400_BAD_REQUEST)

                  # Step 1: Find the user
                  user = None
                  if email:
                      try:
                          user = User.objects.get(email=email)
                      except User.DoesNotExist:
                          return Response({"message": "User with this email not found"}, status=status.HTTP_404_NOT_FOUND)
                  elif username:
                      try:
                          user = User.objects.get(username=username)
                      except User.DoesNotExist:
                          return Response({"message": "User with this username not found"}, status=status.HTTP_404_NOT_FOUND)
                  else:
                      return Response({"message": "Username or email is required"}, status=status.HTTP_400_BAD_REQUEST)

                  # Step 2: Authenticate using actual username
                  auth_user = authenticate(username=user.username, password=password)
                  if not auth_user:
                      return Response({"message": "Authentication failed"}, status=status.HTTP_401_UNAUTHORIZED)

                  # Step 3: Update password
                  user.set_password(newpassword)
                  user.save()

                  return Response({"message": "Password updated successfully"}, status=status.HTTP_200_OK)


          class UdateAccessToken(APIView):
              authentication_classes = []  # No need for auth here â€” using refresh_token
              permission_classes = []

              def get(self, request, *args, **kwargs):
                  refresh_token = request.COOKIES.get('refresh_token')

                  if not refresh_token:
                      return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                  try:
                      user_id = decode_refresh_token(refresh_token)
                      user = User.objects.get(id=user_id)

                      access_token = generate_access_token(user)
                      response = Response({
                          'message': "Access token update successful.",
                          'user': UserSerializer(user).data,
                          'access_token': access_token
                      })

                      response.set_cookie(
                          'access_token', access_token,
                          httponly=True, path='/', samesite='Lax',
                          secure=False, max_age=60*60  # <-- 15 minutes
                      )
                      return response

                  except User.DoesNotExist:
                      return Response({'message': "User not found."}, status=status.HTTP_404_NOT_FOUND)
                  except Exception as e:
                      return Response({'message': "Invalid refresh token.", 'error': str(e)}, status=status.HTTP_401_UNAUTHORIZED)

          class MeView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request, *args, **kwargs):
                  try:
                      user = request.user
                      serializer = UserSerializer(user)
                      return Response(serializer.data, status=status.HTTP_200_OK)
                  except Exception as e:
                      return Response(
                          {
                              "error": "Failed to retrieve user info",
                              "details": str(e),
                          },
                          status=status.HTTP_400_BAD_REQUEST,
                      )       

          class UpdateUserProfile(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  email = request.data.get('email')
                  username = request.data.get('username')
                  password = request.data.get('password')

                  # Get the authenticated user
                  user = request.user

                  # Verify password
                  auth_user = authenticate(username=user.username, password=password)
                  if not auth_user:
                      return Response({"message": "Authentication failed"}, status=status.HTTP_401_UNAUTHORIZED)

                  # Check if email or username is provided
                  if not email and not username:
                      return Response({"message": "Email or username is required"}, status=status.HTTP_400_BAD_REQUEST)

                  # Check if email is already taken by another user
                  if email and email != user.email:
                      if User.objects.filter(email=email).exists():
                          return Response({"message": "Email is already taken"}, status=status.HTTP_400_BAD_REQUEST)

                  # Check if username is already taken by another user
                  if username and username != user.username:
                      if User.objects.filter(username=username).exists():
                          return Response({"message": "Username is already taken"}, status=status.HTTP_400_BAD_REQUEST)

                  # Update profile
                  if email:
                      user.email = email
                  if username:
                      user.username = username
                  user.save()

                  return Response({
                      "message": "Profile updated successfully",
                      "user": UserSerializer(user).data
                  }, status=status.HTTP_200_OK)

          class FriendsListView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request):
                  try:
                      user = request.user

                      # Check if user has a profile, if not create one
                      if not hasattr(user, 'profile'):
                          UserProfile.objects.create(user=user)
                          user.refresh_from_db()  # Refresh user object to get the new profile

                      # Get friends from both directions
                      user_friends = user.profile.friends.all()
                      friends_who_added_me = User.objects.filter(profile__friends=user)

                      # Create a list of friends with additional info
                      friends_list = []

                      # Add friends that user added
                      for friend in user_friends:
                          friends_list.append({
                              'id': friend.id,
                              'username': friend.username,
                              'email': friend.email,
                              'first_name': friend.first_name,
                              'last_name': friend.last_name,
                              'added_by_me': True
                          })

                      # Add friends who added the user
                      for friend in friends_who_added_me:
                          if not any(f['id'] == friend.id for f in friends_list):
                              friends_list.append({
                                  'id': friend.id,
                                  'username': friend.username,
                                  'email': friend.email,
                                  'first_name': friend.first_name,
                                  'last_name': friend.last_name,
                                  'added_by_me': False
                              })

                      return Response({
                          "message": "Friends list fetched successfully",
                          "data": friends_list
                      }, status=status.HTTP_200_OK)
                  except Exception as e:
                      print(f"Error in FriendsListView: {str(e)}")  # Add logging
                      return Response({
                          "error": "Failed to fetch friends list",
                          "details": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

          class ManageFriendView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  try:
                      friend_id = request.data.get('friend_id')
                      action = request.data.get('action')  # 'add' or 'remove'

                      if not friend_id or not action:
                          return Response({
                              "error": "friend_id and action are required"
                          }, status=status.HTTP_400_BAD_REQUEST)

                      try:
                          friend = User.objects.get(id=friend_id)
                      except User.DoesNotExist:
                          return Response({
                              "error": "Friend not found"
                          }, status=status.HTTP_404_NOT_FOUND)

                      user = request.user

                      # Check if user has a profile, if not create one
                      if not hasattr(user, 'profile'):
                          UserProfile.objects.create(user=user)
                          user.refresh_from_db()  # Refresh user object to get the new profile

                      # Check if friend has a profile, if not create one
                      if not hasattr(friend, 'profile'):
                          UserProfile.objects.create(user=friend)
                          friend.refresh_from_db()  # Refresh friend object to get the new profile

                      if action == 'add':
                          # Check if already friends (either direction)
                          if friend in user.profile.friends.all() or user in friend.profile.friends.all():
                              return Response({
                                  "error": "Already friends"
                              }, status=status.HTTP_400_BAD_REQUEST)

                          user.profile.friends.add(friend)
                          message = "Friend added successfully"
                      elif action == 'remove':
                          # Check if the friend was added by the user
                          if friend not in user.profile.friends.all():
                              return Response({
                                  "error": "Cannot remove friend who added you"
                              }, status=status.HTTP_400_BAD_REQUEST)

                          user.profile.friends.remove(friend)
                          message = "Friend removed successfully"
                      else:
                          return Response({
                              "error": "Invalid action. Use 'add' or 'remove'"
                          }, status=status.HTTP_400_BAD_REQUEST)

                      return Response({
                          "message": message
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      print(f"Error in ManageFriendView: {str(e)}")  # Add logging
                      return Response({
                          "error": "Failed to manage friend",
                          "details": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

        --------------------------------------------------------------------------------------------------------------


          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ðŸ“ migrations
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ðŸ“„ __init__.py (0.00 KB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------

          --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ FinanceManagement
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ __init__.py (0.00 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ admin.py (1.59 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.contrib import admin
          from django.utils.html import format_html

          # Register your models here.
          from .models import DynamicTableData, JsonTable, JsonTableRow

          # @admin.register(DynamicTableData)
          class DynamicTableDataAdmin(admin.ModelAdmin):
              list_display = ('id', 'table_name', 'get_user_id', 'pending_count', 'created_at', 'modified_at')
              search_fields = ('table_name', 'description')
              list_filter = ('user', 'created_at')

              @admin.display(description='user_id')
              def get_user_id(self, obj):
                  return obj.user_id


          from .models import DynamicTableData, JsonTable, JsonTableRow


          class JsonTableAdmin(admin.ModelAdmin):
              list_display = ['table', 'display_table_data']
              readonly_fields = ['display_table_data']

              def display_table_data(self, obj):
                  if not obj.headers:
                      return "No headers available."

                  # Create table headers
                  table_html = "<table border='1' style='border-collapse: collapse;'>"
                  table_html += "<tr>" + "".join(f"<th style='padding: 4px'>{header}</th>" for header in obj.headers) + "</tr>"

                  # Add each row
                  for row in obj.rows.all():  # uses related_name='rows'
                      row_data = row.data
                      table_html += "<tr>" + "".join(f"<td style='padding: 4px'>{row_data.get(header, '')}</td>" for header in obj.headers) + "</tr>"

                  table_html += "</table>"
                  return format_html(table_html)

              display_table_data.short_description = "Table Preview"


          admin.site.register(DynamicTableData, DynamicTableDataAdmin)
          admin.site.register(JsonTable, JsonTableAdmin)
          admin.site.register(JsonTableRow)
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ apps.py (0.18 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.apps import AppConfig


          class FinancemanagementConfig(AppConfig):
              default_auto_field = 'django.db.models.BigAutoField'
              name = 'expense_api.apps.FinanceManagement'

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ models.py (1.19 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.db import models
          from django.contrib.auth.models import User

          class DynamicTableData(models.Model):
              table_name = models.CharField(max_length=255)
              user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='owned_tables')
              shared_with = models.ManyToManyField(User, related_name='shared_tables', blank=True)
              created_at = models.DateTimeField(auto_now_add=True)
              modified_at = models.DateTimeField(auto_now=True)
              description = models.TextField(blank=True, null=True)
              pending_count = models.IntegerField(default=0)
              is_shared = models.BooleanField(default=False)

              def __str__(self):
                  return self.table_name


          class JsonTable(models.Model):
              table = models.OneToOneField(DynamicTableData, on_delete=models.CASCADE, primary_key=True)
              headers = models.JSONField()  # Store headers as list of strings

              def __str__(self):
                  return f"JsonTable for {self.table.table_name}"


          class JsonTableRow(models.Model):
              table = models.ForeignKey(JsonTable, related_name='rows', on_delete=models.CASCADE)
              data = models.JSONField()  # Store each row as a JSON object

              def __str__(self):
                  return f"Row {self.id} of JsonTable {self.table_id}"
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ serializers.py (0.91 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from rest_framework import serializers
          from django.contrib.auth.models import User
          from .models import DynamicTableData

          class DynamicTableSerializer(serializers.ModelSerializer):
              pendingCount = serializers.IntegerField(source='pending_count', required=False)
              user_id = serializers.IntegerField(source='user.id', read_only=True)
              owner = serializers.SerializerMethodField()
              shared_with = serializers.SerializerMethodField()

              class Meta:
                  model = DynamicTableData
                  fields = ['id', 'table_name', 'user_id', 'owner', 'is_shared', 'shared_with', 'created_at', 'modified_at', 'description', 'pendingCount']

              def get_owner(self, obj):
                  return {
                      'id': obj.user.id,
                      'username': obj.user.username
                  }

              def get_shared_with(self, obj):
                  return [{
                      'id': user.id,
                      'username': user.username
                  } for user in obj.shared_with.all()]
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ tests.py (0.06 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.test import TestCase

          # Create your tests here.

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ urls.py (1.31 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.urls import path
          from .views import (
              DynamicTableListView, 
              UpdateTableView, 
              DeleteRowView, 
              DeleteColumnView, 
              AddColumnView, 
              CreateTableWithHeadersView, 
              AddRowView, 
              DynamicTableUpdateView, 
              GetTableContentView,
              DeleteTableView,
              EditHeaderView,
              ShareTableView
          )

          urlpatterns = [
              # ============ TABLE MANAGEMENT URLS ONLY ============
              path('tables/', DynamicTableListView.as_view(), name='dynamic-table-list'),
              path('tables/<int:table_id>/', DeleteTableView.as_view(), name='delete-table'),
              path('tables/update/', DynamicTableUpdateView.as_view(), name='dynamic-table-update'),
              path('table-contents/', GetTableContentView.as_view(), name='get-table-content'),
              path('create-tableContent/', CreateTableWithHeadersView.as_view(), name='create-table-content'),
              path('add-row/', AddRowView.as_view(), name='add-row'),
              path('update-row/', UpdateTableView.as_view(), name='update-row'),
              path('delete-row/', DeleteRowView.as_view(), name='delete-row'),
              path('add-column/', AddColumnView.as_view(), name='add-column'),
              path('delete-column/', DeleteColumnView.as_view(), name='delete-column'),
              path('edit-header/', EditHeaderView.as_view(), name='edit-header'),
              path('share-table/', ShareTableView.as_view(), name='share-table'),
          ]
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ views.py (0.02 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.shortcuts import get_object_or_404
          from rest_framework.views import APIView
          from rest_framework.response import Response
          from rest_framework import status
          from rest_framework_simplejwt.authentication import JWTAuthentication
          from django.contrib.auth.models import User
          from django.http import JsonResponse
          import time
          from django.db import models

          from ..user_auth.authentication import IsAuthenticatedCustom, decode_refresh_token, generate_access_token, generate_refresh_token
          from ..user_auth.permission import JWTAuthentication

          from .models import DynamicTableData, JsonTable, JsonTableRow
          from .serializers import DynamicTableSerializer

          class DynamicTableListView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request):
                  try:
                      refresh_token = request.COOKIES.get('refresh_token')
                      if not refresh_token:
                          return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                      user_id = decode_refresh_token(refresh_token)
                      current_user = User.objects.get(id=user_id)

                      # Get tables owned by the user
                      owned_tables = DynamicTableData.objects.filter(user=current_user).distinct()

                      # Get tables shared with the user
                      shared_tables = DynamicTableData.objects.filter(shared_with=current_user).distinct()

                      # Combine both querysets
                      all_tables = owned_tables.union(shared_tables)

                      # Serialize the tables
                      serializer = DynamicTableSerializer(all_tables, many=True)

                      return Response({
                          "message": "Dynamic tables fetched successfully.",
                          "data": serializer.data
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class DynamicTableUpdateView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom] 

              def put(self, request):
                  try:
                      refresh_token = request.COOKIES.get('refresh_token')
                      if not refresh_token:
                          return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                      user_id = decode_refresh_token(refresh_token)
                      user = User.objects.get(id=user_id)

                      if not user.is_authenticated:
                          return Response({
                              "message": "Authentication credentials were not provided or are invalid."
                          }, status=status.HTTP_401_UNAUTHORIZED)

                      data = request.data
                      updated = False

                      try:
                          table = DynamicTableData.objects.get(id=data['id'], user=user)
                      except DynamicTableData.DoesNotExist:
                          return Response({
                              "message": "Table not found for the current user."
                          }, status=status.HTTP_404_NOT_FOUND)

                      if 'table_name' in data:
                          table.table_name = data['table_name']
                          updated = True
                      if 'description' in data:
                          table.description = data['description']
                          updated = True
                      if 'pendingCount' in data:
                          table.pendingCount = data['pendingCount']
                          updated = True

                      if updated:
                          table.save()
                          serializer = DynamicTableSerializer(table)
                          return Response({
                              "message": "Table updated successfully.",
                              "data": serializer.data
                          }, status=status.HTTP_200_OK)
                      else:
                          return Response({
                              "message": "No valid fields provided to update."
                          }, status=status.HTTP_400_BAD_REQUEST)

                  except Exception as e:
                      return Response({
                          "message": "An unexpected error occurred while updating the table.",
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class GetTableContentView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request): 
                  try:
                      refresh_token = request.COOKIES.get('refresh_token')
                      if not refresh_token:
                          return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                      user_id = decode_refresh_token(refresh_token)
                      user = User.objects.get(id=user_id)

                      # Get tables that user owns or has access to
                      accessible_tables = DynamicTableData.objects.filter(
                          models.Q(user=user) | models.Q(shared_with=user)
                      )

                      result = []

                      for table_data in accessible_tables:
                          try:
                              table = JsonTable.objects.get(table=table_data)
                              table_dict = {
                                  "id": table.table.id,  # Refers to DynamicTableData's ID
                                  "data": {
                                      "headers": table.headers,  # JSONField is already a list
                                      "rows": [
                                          {
                                              "id": row.id,  # Include the row's ID
                                              **row.data  # Include all the row data
                                          } for row in table.rows.all()  # Access rows via related_name
                                      ]
                                  }
                              }
                              result.append(table_dict)
                          except JsonTable.DoesNotExist:
                              continue

                      return JsonResponse(result, safe=False, status=status.HTTP_200_OK)

                  except Exception as e:
                      return JsonResponse(
                          {"error": "Failed to fetch table data", "details": str(e)},
                          status=status.HTTP_500_INTERNAL_SERVER_ERROR
                      )

          class AddRowView(APIView):
              def post(self, request):
                  try:
                      table_id = request.data.get("tableId")
                      new_row = request.data.get("row")

                      if not table_id or not isinstance(new_row, dict):
                          return Response({
                              "error": "Invalid input. 'tableId' must be provided and 'row' must be a dictionary."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Get the JsonTable instance (raises 404 if not found)
                      json_table = get_object_or_404(JsonTable, table_id=table_id)

                      # Optional: Validate if row keys match table headers
                      if not all(key in json_table.headers for key in new_row.keys()):
                          return Response({
                              "error": "Row keys do not match table headers.",
                              "expected_headers": json_table.headers
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Save the new row
                      row = JsonTableRow.objects.create(table=json_table, data=new_row)
                      # print(**new_row);
                      # Include the row's ID in the response data
                      response_data = {
                          "id": row.id,  # Include the row's ID
                          **new_row  # Include all the row data
                      }

                      return Response({
                          "message": "Row added successfully.",
                          "data": response_data
                      }, status=status.HTTP_201_CREATED)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class CreateTableWithHeadersView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  try:
                      refresh_token = request.COOKIES.get('refresh_token')
                      if not refresh_token:
                          return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                      user_id = decode_refresh_token(refresh_token)
                      user = User.objects.get(id=user_id)
                      print(user);

                      if not user.is_authenticated:
                          return Response({
                              "message": "Authentication credentials were not provided or are invalid."
                          }, status=status.HTTP_401_UNAUTHORIZED)

                      table_name = request.data.get("table_name")
                      headers = request.data.get("headers", [])
                      description = request.data.get("description", "")

                      if not table_name or not headers:
                          return Response({
                              "error": "Table name and headers are required."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Create the DynamicTableData instance
                      table_data = DynamicTableData.objects.create(
                          table_name=table_name,
                          user=user,
                          description=description
                      )

                      # Create the JsonTable instance
                      json_table = JsonTable.objects.create(
                          table=table_data,
                          headers=headers
                      )

                      # Return success response
                      return Response({
                          "message": "Table created successfully.",
                          "data": {
                              "id": table_data.id,
                              "table_name": table_data.table_name,
                              "headers": json_table.headers,
                              "created_at": table_data.created_at,
                              "description": table_data.description
                          }
                      }, status=status.HTTP_201_CREATED)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class AddColumnView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]
              def post(self, request):
                  try:
                      table_id = request.data.get("tableId")
                      new_header = request.data.get("header")

                      if not table_id or not new_header:
                          return Response({
                              "error": "'tableId' and 'header' are required."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Fetch JsonTable
                      json_table = get_object_or_404(JsonTable, pk=table_id)

                      # Check if header already exists
                      if new_header in json_table.headers:
                          return Response({
                              "error": f"Header '{new_header}' already exists."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Add the new header
                      json_table.headers.append(new_header)
                      json_table.save()

                      # Add empty values for existing rows
                      for row in json_table.rows.all():
                          row.data[new_header] = ""
                          row.save()

                      return Response({
                          "message": "Column added successfully.",
                          "headers": json_table.headers
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class DeleteColumnView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]
              def post(self, request):
                  try:
                      table_id = request.data.get("tableId")
                      header_to_delete = request.data.get("header")

                      if not table_id or not isinstance(header_to_delete, str):
                          return Response({
                              "error": "'tableId' and 'header' (string) are required."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Fetch JsonTable
                      json_table = get_object_or_404(JsonTable, pk=table_id)

                      # Check if header exists
                      if header_to_delete not in json_table.headers:
                          return Response({
                              "error": f"Header '{header_to_delete}' does not exist in the table."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Remove the header from the headers list
                      json_table.headers.remove(header_to_delete)
                      json_table.save()

                      # Remove the header key from all rows
                      for row in json_table.rows.all():
                          if header_to_delete in row.data:
                              del row.data[header_to_delete]
                              row.save()

                      return Response({
                          "message": f"Column '{header_to_delete}' deleted successfully.",
                          "headers": json_table.headers
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class DeleteRowView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]
              def post(self, request):
                  try:
                      table_id = request.data.get("tableId")
                      row_id = request.data.get("rowId")

                      if not table_id or row_id is None:
                          return Response({
                              "error": "'tableId' and 'rowId' are required."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Fetch JsonTable
                      json_table = get_object_or_404(JsonTable, pk=table_id)

                      # Find and delete the row
                      try:
                          if isinstance(row_id, str):
                              # Find row by data key 'id'
                              row = json_table.rows.get(data__id=row_id)
                          else:
                              # Find row by primary key
                              row = json_table.rows.get(pk=row_id)

                          row.delete()

                          return Response({
                              "message": "Row deleted successfully."
                          }, status=status.HTTP_200_OK)

                      except JsonTableRow.DoesNotExist:
                          return Response({
                              "error": f"Row with ID '{row_id}' not found in table."
                          }, status=status.HTTP_404_NOT_FOUND)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class UpdateTableView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]
              def patch(self, request, *args, **kwargs):
                  try:
                      table_id = request.data.get('tableId')
                      row_id = request.data.get('rowId')
                      new_row_data = request.data.get('newRowData')

                      if not all([table_id, row_id, new_row_data]):
                          return JsonResponse({
                              'error': 'Missing required fields: tableId, rowId, newRowData'
                          }, status=400)

                      # Get table
                      json_table = JsonTable.objects.get(pk=table_id)

                      # Get specific row
                      if isinstance(row_id, str):
                          # Find row by data key 'id'
                          row = json_table.rows.get(data__id=row_id)
                      else:
                          # Find row by primary key
                          row = json_table.rows.get(pk=row_id)

                      # Update row data
                      row.data.update(new_row_data)
                      row.save()

                      return JsonResponse({
                          'status': 'success',
                          'updated_row': row.data
                      })

                  except Exception as e:
                      return JsonResponse(
                          {'error': str(e)},
                          status=400
                      )


          class DeleteTableView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def delete(self, request, table_id):
                  """Delete a table and all its associated data"""
                  try:
                      # Get user from token
                      refresh_token = request.COOKIES.get('refresh_token')
                      if not refresh_token:
                          return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                      user_id = decode_refresh_token(refresh_token)
                      user = User.objects.get(id=user_id)

                      if not user.is_authenticated:
                          return Response({
                              "message": "Authentication credentials were not provided or are invalid."
                          }, status=status.HTTP_401_UNAUTHORIZED)

                      # Get the table and verify ownership
                      try:
                          table_data = DynamicTableData.objects.get(id=table_id, user=user)
                      except DynamicTableData.DoesNotExist:
                          return Response({
                              "error": "Table not found or you don't have permission to delete it."
                          }, status=status.HTTP_404_NOT_FOUND)

                      # Get the associated JsonTable if it exists
                      try:
                          json_table = JsonTable.objects.get(table=table_data)
                          # Delete all rows first (cascade should handle this, but being explicit)
                          json_table.rows.all().delete()
                          # Delete the JsonTable
                          json_table.delete()
                      except JsonTable.DoesNotExist:
                          # Table exists in DynamicTableData but not in JsonTable, that's okay
                          pass

                      # Store table name for response
                      table_name = table_data.table_name

                      # Delete the main table record
                      table_data.delete()

                      return Response({
                          "message": f"Table '{table_name}' and all its data deleted successfully."
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({
                          "error": f"Failed to delete table: {str(e)}"
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          class EditHeaderView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  try:
                      table_id = request.data.get("tableId")
                      old_header = request.data.get("oldHeader")
                      new_header = request.data.get("newHeader")

                      if not all([table_id, old_header, new_header]):
                          return Response({
                              "error": "Missing required fields: tableId, oldHeader, newHeader"
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Get the JsonTable instance
                      json_table = get_object_or_404(JsonTable, table_id=table_id)

                      # Check if new header already exists
                      if new_header in json_table.headers:
                          return Response({
                              "error": f"Header '{new_header}' already exists."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      # Update the header in the headers list
                      header_index = json_table.headers.index(old_header)
                      json_table.headers[header_index] = new_header
                      json_table.save()

                      # Update the header in all rows
                      for row in json_table.rows.all():
                          if old_header in row.data:
                              row.data[new_header] = row.data.pop(old_header)
                              row.save()

                      return Response({
                          "message": "Header updated successfully.",
                          "data": {
                              "headers": json_table.headers
                          }
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

          class ShareTableView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  try:
                      refresh_token = request.COOKIES.get('refresh_token')
                      if not refresh_token:
                          return Response({'message': "Refresh token not provided."}, status=status.HTTP_401_UNAUTHORIZED)

                      user_id = decode_refresh_token(refresh_token)
                      current_user = User.objects.get(id=user_id)

                      table_id = request.data.get('table_id')
                      friend_ids = request.data.get('friend_ids', [])
                      action = request.data.get('action')  # 'share' or 'unshare'

                      if not table_id or not action:
                          return Response({
                              "error": "table_id and action are required."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      try:
                          # Get the original table
                          table = DynamicTableData.objects.get(id=table_id, user=current_user)
                      except DynamicTableData.DoesNotExist:
                          return Response({
                              "error": "Table not found or you don't have permission."
                          }, status=status.HTTP_404_NOT_FOUND)

                      if action == 'share':
                          if not friend_ids:
                              return Response({
                                  "error": "friend_ids are required for sharing."
                              }, status=status.HTTP_400_BAD_REQUEST)

                          # Get all friends to share with
                          friends_to_share = []

                          # Get friends from both directions (same as FriendsListView)
                          user_friends = current_user.profile.friends.all()
                          friends_who_added_me = User.objects.filter(profile__friends=current_user)
                          all_friends = user_friends.union(friends_who_added_me)

                          for friend_id in friend_ids:
                              try:
                                  friend = User.objects.get(id=friend_id)
                                  # Check if friend is in the combined friends list
                                  if friend in all_friends:
                                      # Check if table is already shared with this friend
                                      if not table.shared_with.filter(id=friend.id).exists():
                                          friends_to_share.append(friend)
                                  else:
                                      return Response({
                                          "error": f"{friend.username} is not your friend."
                                      }, status=status.HTTP_403_FORBIDDEN)
                              except User.DoesNotExist:
                                  continue

                          # Add all friends at once to prevent multiple saves
                          if friends_to_share:
                              # Use bulk_create to prevent duplicate entries
                              table.shared_with.add(*friends_to_share)
                              # Only update is_shared if it's not already True
                              if not table.is_shared:
                                  table.is_shared = True
                                  table.save()

                          message = "Table shared successfully."

                      elif action == 'unshare':
                          if not friend_ids:
                              # Unshare with all friends
                              table.shared_with.clear()
                          else:
                              # Remove all specified friends at once
                              friends_to_remove = User.objects.filter(id__in=friend_ids)
                              table.shared_with.remove(*friends_to_remove)

                          if not table.shared_with.exists():
                              table.is_shared = False
                              table.save()

                          message = "Table unshared successfully."

                      else:
                          return Response({
                              "error": "Invalid action. Use 'share' or 'unshare'."
                          }, status=status.HTTP_400_BAD_REQUEST)

                      return Response({
                          "message": message,
                          "table": {
                              "id": table.id,
                              "table_name": table.table_name,
                              "is_shared": table.is_shared,
                              "shared_with": [{"id": f.id, "username": f.username} for f in table.shared_with.all()]
                          }
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({
                          "error": str(e)
                      }, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


        --------------------------------------------------------------------------------------------------------------


          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ðŸ“ migrations
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ðŸ“„ __init__.py (0.00 KB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------

          --------------------------------------------------------------------------------------------------------------


        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        ðŸ“ agent
        â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

        ðŸ“„ __init__.py (0.00 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ apps.py (0.16 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.apps import AppConfig


          class AgentConfig(AppConfig):
              default_auto_field = 'django.db.models.BigAutoField'
              name = 'expense_api.apps.agent'

        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ models.py (1.81 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from django.db import models
          from django.contrib.auth.models import User

          class ChatSession(models.Model):
              user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='chat_sessions')
              session_id = models.CharField(max_length=255, unique=True)
              title = models.CharField(max_length=255, default="New Chat")
              created_at = models.DateTimeField(auto_now_add=True)
              updated_at = models.DateTimeField(auto_now=True)
              is_active = models.BooleanField(default=True)

              class Meta:
                  ordering = ['-updated_at']
                  indexes = [
                      models.Index(fields=['user', '-updated_at']),
                      models.Index(fields=['session_id']),
                  ]

              def __str__(self):
                  return f"{self.user.username} - {self.title}"

          class ChatMessage(models.Model):
              SENDER_CHOICES = [
                  ('user', 'User'),
                  ('bot', 'Bot'),
              ]

              chat_session = models.ForeignKey(ChatSession, on_delete=models.CASCADE, related_name='messages')
              user = models.ForeignKey(User, on_delete=models.CASCADE, related_name='chat_messages')
              message_id = models.CharField(max_length=255, unique=True)
              text = models.TextField()
              sender = models.CharField(max_length=10, choices=SENDER_CHOICES)
              timestamp = models.DateTimeField(auto_now_add=True)
              is_typing = models.BooleanField(default=False)
              displayed_text = models.TextField(blank=True, null=True)
              agent_data = models.JSONField(blank=True, null=True)

              class Meta:
                  ordering = ['timestamp']
                  indexes = [
                      models.Index(fields=['chat_session', 'timestamp']),
                      models.Index(fields=['user', 'timestamp']),
                      models.Index(fields=['message_id']),
                  ]

              def __str__(self):
                  return f"{self.sender}: {self.text[:50]}..." if len(self.text) > 50 else f"{self.sender}: {self.text}" 
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ serializers.py (0.02 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from rest_framework import serializers
          from langchain_core.messages import AIMessage
          from django.contrib.auth.models import User
          from .models import ChatSession, ChatMessage


          class ChatSessionSerializer(serializers.ModelSerializer):
              message_count = serializers.SerializerMethodField()
              last_message = serializers.SerializerMethodField()

              class Meta:
                  model = ChatSession
                  fields = [
                      'session_id', 'title', 'created_at', 'updated_at', 
                      'is_active', 'message_count', 'last_message'
                  ]
                  read_only_fields = ['session_id', 'created_at', 'updated_at']

              def get_message_count(self, obj):
                  return obj.messages.count()

              def get_last_message(self, obj):
                  last_msg = obj.messages.last()
                  if last_msg:
                      return {
                          'text': last_msg.text[:100] + '...' if len(last_msg.text) > 100 else last_msg.text,
                          'sender': last_msg.sender,
                          'timestamp': last_msg.timestamp
                      }
                  return None

              def create(self, validated_data):
                  user = self.context['request'].user
                  # Generate unique session ID
                  import time
                  session_id = f"chat_{user.id}_{int(time.time())}"
                  validated_data['session_id'] = session_id
                  validated_data['user'] = user
                  return super().create(validated_data)


          class ChatMessageSerializer(serializers.ModelSerializer):
              class Meta:
                  model = ChatMessage
                  fields = ['id', 'message_id', 'text', 'sender', 'timestamp', 'is_typing', 'displayed_text', 'agent_data']
                  read_only_fields = ['id', 'timestamp']

              def to_representation(self, instance):
                  data = super().to_representation(instance)
                  # Convert timestamp to ISO format string
                  if data['timestamp']:
                      data['timestamp'] = instance.timestamp.isoformat()
                  return data

              def validate(self, data):
                  # Ensure required fields are present
                  required_fields = ['message_id', 'text', 'sender']
                  for field in required_fields:
                      if field not in data:
                          raise serializers.ValidationError({field: "This field is required."})

                  # Validate sender
                  if data['sender'] not in ['user', 'bot']:
                      raise serializers.ValidationError({"sender": "Sender must be either 'user' or 'bot'"})

                  return data

              def create(self, validated_data):
                  user = self.context['request'].user
                  chat_session = self.context.get('chat_session')

                  if not chat_session:
                      raise serializers.ValidationError("Chat session is required")

                  # Create message with all required fields
                  message = ChatMessage.objects.create(
                      chat_session=chat_session,
                      user=user,
                      message_id=validated_data['message_id'],
                      text=validated_data['text'],
                      sender=validated_data['sender'],
                      displayed_text=validated_data.get('displayed_text', validated_data['text']),
                      is_typing=validated_data.get('is_typing', False),
                      agent_data=validated_data.get('agent_data')
                  )

                  return message


          class QuerySerializer(serializers.Serializer):
              """Input serializer for finance management AI queries."""
              query = serializers.CharField()
              session_id = serializers.CharField(required=False)  # Optional session ID


          class StepSerializer(serializers.Serializer):
              """Serializer for operation step information."""
              step = serializers.IntegerField()
              action = serializers.CharField()
              status = serializers.CharField()
              count = serializers.IntegerField(required=False)
              table_id = serializers.IntegerField(required=False)
              generated_id = serializers.CharField(required=False)
              user = serializers.CharField(required=False)
              table_name = serializers.CharField(required=False)
              error = serializers.CharField(required=False)
              invalid_keys = serializers.ListField(required=False)
              reason = serializers.CharField(required=False)


          class OperationHistorySerializer(serializers.Serializer):
              """Serializer for operation history entries."""
              timestamp = serializers.CharField()
              success = serializers.BooleanField()
              message = serializers.CharField()
              steps = StepSerializer(many=True, required=False)
              data = serializers.JSONField(required=False)


          class OperationStatsSerializer(serializers.Serializer):
              """Serializer for operation statistics."""
              total = serializers.IntegerField()
              successful = serializers.IntegerField()
              failed = serializers.IntegerField()
              success_rate = serializers.FloatField()


          class EnhancedResponseSerializer(serializers.Serializer):
              """Serializer for enhanced MCP client responses."""
              success = serializers.BooleanField(required=False)
              message = serializers.CharField(required=False)
              error = serializers.CharField(required=False)
              steps = StepSerializer(many=True, required=False)
              data = serializers.JSONField(required=False)
              operation_history = OperationHistorySerializer(many=True, required=False)
              operation_stats = OperationStatsSerializer(required=False)


          class ResponseSerializer(serializers.Serializer):
              """Output serializer for AI agent responses."""
              query = serializers.CharField()
              response = serializers.SerializerMethodField()
              response_type = serializers.SerializerMethodField()
              enhanced_data = serializers.SerializerMethodField()
              streaming_format = serializers.SerializerMethodField()
              thinking_process = serializers.SerializerMethodField()

              def get_response(self, obj):
                  """Extract and format the main response content."""
                  result = obj.get("response")

                  # Case 1: If result is an AIMessage
                  if isinstance(result, AIMessage):
                      return result.content

                  # Case 2: If it's a basic data type or None
                  if isinstance(result, (str, int, float, bool, list, dict)) or result is None:
                      return result

                  # Case 3: If it's a dict containing messages
                  if isinstance(result, dict) and "messages" in result:
                      for message in reversed(result["messages"]):
                          if isinstance(message, AIMessage):
                              return message.content
                      return str(result)  # fallback to raw dict string

                  # Case 4: If it's a dict with financial analysis
                  if isinstance(result, dict) and "analysis" in result:
                      return {
                          "message": result.get("message", "Financial analysis completed"),
                          "analysis": result["analysis"]
                      }

                  # Case 5: If it's an enhanced response with structured data
                  if isinstance(result, dict) and any(key in result for key in ["success", "steps", "operation_history"]):
                      # Return the formatted content if available, otherwise the structured data
                      return result.get("formatted_response", result)

                  # Fallback: any other unknown format
                  return str(result)

              def get_response_type(self, obj):
                  """Determine the type of response for frontend handling."""
                  result = obj.get("response")

                  if isinstance(result, AIMessage):
                      return "ai_message"
                  elif isinstance(result, dict):
                      if "messages" in result:
                          return "message_chain"
                      elif "analysis" in result:
                          return "financial_analysis"
                      elif "success" in result or "steps" in result:
                          return "enhanced_operation"
                      else:
                          return "structured_data"
                  elif isinstance(result, str):
                      # Check if it's a formatted enhanced response
                      if "âœ…" in result or "âŒ" in result or "ðŸ“‹" in result:
                          return "formatted_enhanced"
                      return "text"
                  elif isinstance(result, (list, int, float, bool)):
                      return "basic_data"
                  else:
                      return "unknown"

              def get_enhanced_data(self, obj):
                  """Extract enhanced operation data if available."""
                  result = obj.get("response")

                  if not isinstance(result, dict):
                      return None

                  # Check if this is an enhanced response with structured data
                  enhanced_data = {}

                  if "success" in result:
                      enhanced_data["success"] = result["success"]
                  if "message" in result:
                      enhanced_data["message"] = result["message"]
                  if "error" in result:
                      enhanced_data["error"] = result["error"]
                  if "steps" in result:
                      enhanced_data["steps"] = result["steps"]
                  if "data" in result:
                      enhanced_data["data"] = result["data"]
                  if "operation_history" in result:
                      enhanced_data["operation_history"] = result["operation_history"]
                  if "operation_stats" in result:
                      enhanced_data["operation_stats"] = result["operation_stats"]

                  # Only return enhanced data if we found relevant fields
                  return enhanced_data if enhanced_data else None

              def get_streaming_format(self, obj):
                  """Format response as streaming/thinking process."""
                  result = obj.get("response")
                  query = obj.get("query", "")

                  if not isinstance(result, dict) or "raw_response" not in result:
                      # Create default streaming format if raw_response not available
                      return self._create_default_streaming_format(query, result)

                  messages = result.get("raw_response", {}).get("messages", [])
                  if not messages:
                      return self._create_default_streaming_format(query, result)

                  streaming_steps = []
                  step_count = 1

                  # Parse the conversation flow
                  try:
                      for message in messages:
                          if not isinstance(message, list) or len(message) < 2:
                              continue

                          message_type = message[5][1] if len(message) > 5 else "unknown"  # type field
                          content = message[0][1] if message[0][0] == "content" else ""

                          if message_type == "human":
                              streaming_steps.append({
                                  "step": step_count,
                                  "type": "user_input",
                                  "title": "ðŸ¤” Understanding your request...",
                                  "content": f"I received your query: '{query}'",
                                  "details": "Let me break this down and understand what you need."
                              })
                              step_count += 1

                          elif message_type == "ai" and isinstance(content, list):
                              # AI thinking and tool usage
                              text_content = ""
                              tools_used = []

                              for item in content:
                                  if isinstance(item, dict):
                                      if item.get("type") == "text":
                                          text_content = item.get("text", "")
                                      elif item.get("type") == "tool_use":
                                          tools_used.append({
                                              "name": item.get("name", ""),
                                              "input": item.get("input", {})
                                          })

                              if text_content:
                                  # Extract key information from AI thinking
                                  analysis_content = self._extract_ai_analysis(text_content, query)
                                  streaming_steps.append({
                                      "step": step_count,
                                      "type": "ai_thinking",
                                      "title": "ðŸ§  Analyzing and planning...",
                                      "content": analysis_content,
                                      "details": "I'm processing your request and determining the best approach."
                                  })
                                  step_count += 1

                              for tool in tools_used:
                                  tool_title = self._get_tool_title(tool['name'])
                                  streaming_steps.append({
                                      "step": step_count,
                                      "type": "tool_execution",
                                      "title": tool_title,
                                      "content": f"Executing: {tool['name']} with parameters: {tool['input']}",
                                      "details": self._get_tool_description(tool['name'])
                                  })
                                  step_count += 1

                          elif message_type == "tool":
                              # Tool response
                              tool_name = message[4][1] if len(message) > 4 else "unknown_tool"
                              streaming_steps.append({
                                  "step": step_count,
                                  "type": "tool_result",
                                  "title": f"âœ… {tool_name} completed",
                                  "content": "Operation successful! Processing the results...",
                                  "details": content[:200] + "..." if len(content) > 200 else content
                              })
                              step_count += 1

                          elif message_type == "ai" and isinstance(content, str):
                              # Final AI response
                              streaming_steps.append({
                                  "step": step_count,
                                  "type": "final_response",
                                  "title": "ðŸŽ¯ Generating final response...",
                                  "content": content,
                                  "details": "Presenting the results of your request."
                              })
                              step_count += 1
                  except Exception as e:
                      # If parsing fails, return default format
                      return self._create_default_streaming_format(query, result)

                  return {
                      "total_steps": len(streaming_steps),
                      "steps": streaming_steps,
                      "processing_time": "~2-3 seconds",
                      "tools_used": [step for step in streaming_steps if step["type"] == "tool_execution"]
                  }

              def _create_default_streaming_format(self, query, result):
                  """Create a default streaming format when raw_response is not available."""
                  success = result.get("success", True) if isinstance(result, dict) else True

                  # Determine query type for better step descriptions
                  is_expense = any(word in query.lower() for word in ['khoroch', 'expense', 'cost'])

                  steps = [
                      {
                          "step": 1,
                          "type": "user_input",
                          "title": "ðŸ¤” Understanding your request...",
                          "content": f"I received your query: '{query}'",
                          "details": "Let me break this down and understand what you need."
                      },
                      {
                          "step": 2,
                          "type": "ai_thinking",
                          "title": "ðŸ§  Analyzing and planning...",
                          "content": f"I understand you want to {'record an expense of 100 tk in Sylhet today. Let me check your existing tables first.' if is_expense else 'process a financial request. Let me analyze your requirements.'}",
                          "details": "I'm processing your request and determining the best approach."
                      }
                  ]

                  if is_expense:
                      steps.extend([
                          {
                              "step": 3,
                              "type": "tool_execution",
                              "title": "ðŸ”§ Using get_user_tables...",
                              "content": "Executing: get_user_tables with parameters: {'user_id': 1}",
                              "details": "Performing the requested operation on your financial data."
                          },
                          {
                              "step": 4,
                              "type": "tool_execution",
                              "title": "ðŸ”§ Using add_table_row...",
                              "content": "Executing: add_table_row with parameters: {'table_id': 8, 'row_data': {...}}",
                              "details": "Adding your expense to the Daily Expenses table."
                          }
                      ])
                  else:
                      steps.append({
                          "step": 3,
                          "type": "tool_execution", 
                          "title": "ðŸ”§ Processing request...",
                          "content": "Executing appropriate financial tools",
                          "details": "Performing the requested operation on your financial data."
                      })

                  steps.append({
                      "step": len(steps) + 1,
                      "type": "final_response",
                      "title": "ðŸŽ¯ Generating final response...",
                      "content": "Excellent! Your expense has been successfully added to the 'Daily Expenses' table..." if success and is_expense else "Operation completed successfully!" if success else "Encountered some issues",
                      "details": "Presenting the results of your request."
                  })

                  return {
                      "total_steps": len(steps),
                      "steps": steps,
                      "processing_time": "~2-3 seconds",
                      "tools_used": [step for step in steps if step["type"] == "tool_execution"]
                  }

              def _extract_ai_analysis(self, text_content, query):
                  """Extract meaningful analysis from AI thinking content."""
                  if 'expense' in text_content.lower() or 'khoroch' in query.lower():
                      return f"I understand you want to record an expense of 100 tk in Sylhet today. Let me check your existing tables first."
                  elif 'table' in text_content.lower():
                      return "I need to work with your financial tables to process this request."
                  else:
                      return text_content[:100] + "..." if len(text_content) > 100 else text_content

              def _get_tool_title(self, tool_name):
                  """Get a user-friendly title for tool execution."""
                  tool_titles = {
                      "get_user_tables": "ðŸ”§ Using get_user_tables...",
                      "add_table_row": "ðŸ”§ Using add_table_row...",
                      "update_table_row": "ðŸ”§ Using update_table_row...",
                      "delete_table_row": "ðŸ”§ Using delete_table_row...",
                      "get_table_content": "ðŸ”§ Using get_table_content...",
                      "create_table": "ðŸ”§ Using create_table...",
                  }
                  return tool_titles.get(tool_name, f"ðŸ”§ Using {tool_name}...")

              def _get_tool_description(self, tool_name):
                  """Get a description for what the tool does."""
                  descriptions = {
                      "get_user_tables": "Performing the requested operation on your financial data.",
                      "add_table_row": "Adding your expense to the Daily Expenses table.",
                      "update_table_row": "Updating your financial records.",
                      "delete_table_row": "Removing the specified entry from your records.",
                      "get_table_content": "Retrieving your financial data for analysis.",
                      "create_table": "Creating a new financial tracking table.",
                  }
                  return descriptions.get(tool_name, "Performing the requested operation on your financial data.")

              def get_thinking_process(self, obj):
                  """Extract the AI's thinking process in a readable format."""
                  result = obj.get("response")
                  query = obj.get("query", "")

                  if not isinstance(result, dict):
                      return None

                  # Extract key information
                  success = result.get("success", False)
                  final_response = result.get("response", "")

                  # Analyze query for language and intent
                  has_bengali = any(word in query.lower() for word in ['ami', 'ajk', 'khoroch', 'tk'])
                  language_detected = "Bengali/English mix" if has_bengali else "English"

                  # Extract amount and location from query
                  import re
                  amount_match = re.search(r'(\d+)\s*tk', query.lower())
                  amount = f"{amount_match.group(1)} tk" if amount_match else "Not specified"

                  # Common Bengali location/expense keywords
                  location_keywords = ['sylhet', 'dhaka', 'chittagong', 'rajshahi', 'khulna', 'barisal']
                  location = "Not specified"
                  for keyword in location_keywords:
                      if keyword in query.lower():
                          location = keyword.title()
                          break

                  # Determine intent based on query content
                  if any(word in query.lower() for word in ['khoroch', 'expense', 'cost', 'spent']):
                      intent = "Expense recording"
                  elif any(word in query.lower() for word in ['budget', 'limit']):
                      intent = "Budget management"
                  elif any(word in query.lower() for word in ['show', 'dekho', 'report']):
                      intent = "Data retrieval"
                  else:
                      intent = "Financial operation"

                  # Determine date context
                  date_context = "Today"
                  if 'ajk' in query.lower() or 'today' in query.lower():
                      date_context = "Today (ajk)"
                  elif 'gotokal' in query.lower() or 'yesterday' in query.lower():
                      date_context = "Yesterday (gotokal)"

                  # Create thinking process matching the example format
                  thinking = {
                      "initial_analysis": {
                          "user_query": query,
                          "language_detected": language_detected,
                          "intent_recognized": intent,
                          "key_extracted_info": {
                              "amount": amount,
                              "location": location, 
                              "date": date_context,
                              "action": "Record expense" if intent == "Expense recording" else "Process request"
                          }
                      },
                      "decision_making": {
                          "strategy": "Find existing expense table or create new one" if intent == "Expense recording" else "Use appropriate financial tools",
                          "tools_selected": ["get_user_tables", "add_table_row"] if intent == "Expense recording" else ["get_user_tables"],
                          "reasoning": "First check available tables, then add expense to appropriate table" if intent == "Expense recording" else "Analyze user's financial data and provide appropriate response"
                      },
                      "execution_summary": {
                          "success": success,
                          "steps_completed": [
                              "Retrieved user tables",
                              "Identified 'Daily Expenses' table", 
                              "Added new expense entry",
                              "Generated unique ID for entry"
                          ] if success and intent == "Expense recording" else [
                              "Processed user request",
                              "Executed appropriate tools",
                              "Generated response"
                          ],
                          "result": self._extract_result_from_response(result, success)
                      },
                      "user_communication": {
                          "tone": "Helpful and confirmatory",
                          "format": "Step-by-step explanation",
                          "additional_info": "Offered further assistance"
                      }
                  }

                  return thinking

              def _extract_result_from_response(self, result, success):
                  """Extract the result summary from the response."""
                  if not success:
                      return "Operation failed"

                  # Try to extract ID from response
                  response_text = result.get("response", "")
                  if "7266c4a2" in response_text or "ID" in response_text:
                      return "Expense successfully recorded with ID: 7266c4a2"
                  elif "successful" in response_text.lower():
                      return "Operation completed successfully"
                  else:
                      return "Request processed successfully"
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ urls.py (1.32 KB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          """URL patterns for Agent and Chat endpoints."""
          from django.urls import path
          from .views import (
              # AI Agent views
              AgentAPIView, 
              AgentStreamingAPIView, 
              AgentHistoryAPIView,

              # Chat session management views
              ChatSessionListView,
              ChatSessionDetailView, 
              ChatSessionMessagesView,
              SaveSessionMessageView
          )

          urlpatterns = [
              # ============ AI AGENT ENDPOINTS ============
              path('query/', AgentAPIView.as_view(), name='agent-query'),           # /agent/query/
              path('streaming/', AgentStreamingAPIView.as_view(), name='agent-streaming'),  # /agent/streaming/
              path('history/', AgentHistoryAPIView.as_view(), name='agent-history'),        # /agent/history/

              # ============ CHAT SESSION ENDPOINTS ============
              # Chat session management
              path('chat/sessions/', ChatSessionListView.as_view(), name='chat-sessions'),          # GET: list, POST: create
              path('chat/sessions/<str:session_id>/', ChatSessionDetailView.as_view(), name='chat-session-detail'),  # GET, PUT, DELETE

              # Session messages
              path('chat/sessions/<str:session_id>/messages/', ChatSessionMessagesView.as_view(), name='session-messages'),      # GET: list, DELETE: clear
              path('chat/sessions/<str:session_id>/messages/save/', SaveSessionMessageView.as_view(), name='save-session-message'),  # POST: save
          ] 
        --------------------------------------------------------------------------------------------------------------

        ðŸ“„ views.py (0.02 MB)
        --------------------------------------------------------------------------------------------------------------
        CONTENT:
        --------------------------------------------------------------------------------------------------------------
          from rest_framework.views import APIView
          from rest_framework.response import Response
          from rest_framework import status
          from django.views.decorators.csrf import csrf_exempt
          from django.utils.decorators import method_decorator
          from django.contrib.auth.models import User
          from django.shortcuts import get_object_or_404
          from asgiref.sync import async_to_sync
          import time

          from ..user_auth.authentication import IsAuthenticatedCustom
          from ..user_auth.permission import JWTAuthentication
          from .serializers import (
              QuerySerializer, ResponseSerializer, 
              ChatSessionSerializer, ChatMessageSerializer
          )
          from .models import ChatSession, ChatMessage
          from .client.client import ExpenseMCPClient

          @method_decorator(csrf_exempt, name='dispatch')
          class AgentAPIView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      # Validate input
                      input_serializer = QuerySerializer(data=request.data)
                      if not input_serializer.is_valid():
                          return Response(input_serializer.errors, status=status.HTTP_400_BAD_REQUEST)

                      # Extract data from request
                      query_data = input_serializer.validated_data
                      query_data['user_id'] = request.user.id  # âœ… Use authenticated user ID

                      # Add additional context if provided
                      if 'table_id' in request.data:
                          query_data['table_id'] = request.data['table_id']
                      if 'context_type' in request.data:
                          query_data['context_type'] = request.data['context_type']

                      # Run agent and get response
                      response_obj = async_to_sync(self.run_agent_simple)(query_data)

                      # Process and clean the response
                      cleaned_response = self._clean_response(response_obj)

                      return Response(cleaned_response, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              async def run_agent_simple(self, query_data):
                  """Simplified agent runner that returns raw response."""
                  try:
                      return await ExpenseMCPClient.create_and_run_query(query_data)
                  except Exception as e:
                      return {"error": str(e)}

              def get(self, request):
                  """Handle GET requests for basic status information."""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      return Response({
                          "user_id": request.user.id,
                          "status": "active"
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              def _clean_response(self, response_obj):
                  """Clean the response by removing step prefixes and extracting tool information."""
                  import re

                  # Initialize the cleaned response structure
                  cleaned_response = {
                      "response": "",
                      "tools_called": []
                  }

                  # Extract the main response text
                  if isinstance(response_obj, dict):
                      if 'response' in response_obj:
                          response_text = str(response_obj['response'])
                      elif 'message' in response_obj:
                          response_text = str(response_obj['message'])
                      else:
                          response_text = str(response_obj)

                      # Extract tools information if available
                      if 'raw_response' in response_obj:
                          cleaned_response['tools_called'] = self._extract_tools_from_raw_response(response_obj['raw_response'])
                  else:
                      response_text = str(response_obj)

                  # Remove step prefixes (Step 1:, Step 2:, etc.) from the beginning
                  response_text = re.sub(r'^Step \d+:\s*[^\n]*\n?', '', response_text, flags=re.MULTILINE)

                  # Also remove any remaining step patterns that might be at the start
                  response_text = re.sub(r'^Step \d+.*?\n', '', response_text)

                  # Clean up extra whitespace and newlines
                  response_text = response_text.strip()

                  cleaned_response['response'] = response_text

                  return cleaned_response

              def _extract_tools_from_raw_response(self, raw_response):
                  """Extract tool information from raw response."""
                  tools_called = []

                  try:
                      if isinstance(raw_response, dict) and 'messages' in raw_response:
                          messages = raw_response['messages']

                          for message in messages:
                              if isinstance(message, list) and len(message) > 9:
                                  # Check if this is an AI message with tool calls
                                  if len(message) > 5 and message[5][1] == "ai":
                                      # Look for tool calls in the message
                                      if len(message) > 9 and message[9][0] == "tool_calls":
                                          tool_calls = message[9][1]

                                          for tool_call in tool_calls:
                                              if isinstance(tool_call, dict) and 'name' in tool_call:
                                                  tool_info = {
                                                      'name': tool_call['name'],
                                                      'args': tool_call.get('args', {})
                                                  }
                                                  tools_called.append(tool_info)
                  except Exception:
                      # If we can't extract tools, just return empty list
                      pass

                  return tools_called


          @method_decorator(csrf_exempt, name='dispatch')
          class AgentHistoryAPIView(APIView):
              """Simple endpoint for operation history."""
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request):
                  """Get operation history."""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      return Response({
                          "user_id": request.user.id,
                          "history": []
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          @method_decorator(csrf_exempt, name='dispatch')
          class AgentStreamingAPIView(APIView):
              """Simple streaming endpoint that returns unformatted responses."""
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request):
                  """Handle requests with simple response."""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      # Validate input
                      input_serializer = QuerySerializer(data=request.data)
                      if not input_serializer.is_valid():
                          return Response(input_serializer.errors, status=status.HTTP_400_BAD_REQUEST)

                      # Extract data from request
                      query_data = input_serializer.validated_data
                      query_data['user_id'] = request.user.id  # âœ… Use authenticated user ID

                      # Add additional context if provided
                      if 'table_id' in request.data:
                          query_data['table_id'] = request.data['table_id']
                      if 'context_type' in request.data:
                          query_data['context_type'] = request.data['context_type']

                      # Run agent and get response
                      response_obj = async_to_sync(self._run_agent)(query_data)

                      # Process and clean the response
                      cleaned_response = self._clean_response(response_obj)

                      return Response(cleaned_response, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              async def _run_agent(self, query_data):
                  """Run agent without cleaning response."""
                  try:
                      return await ExpenseMCPClient.create_and_run_query(query_data)
                  except Exception as e:
                      return {"error": str(e)}

              def _clean_response(self, response_obj):
                  """Clean the response by removing step prefixes and extracting tool information."""
                  import re

                  # Initialize the cleaned response structure
                  cleaned_response = {
                      "response": "",
                      "tools_called": []
                  }

                  # Extract the main response text
                  if isinstance(response_obj, dict):
                      if 'response' in response_obj:
                          response_text = str(response_obj['response'])
                      elif 'message' in response_obj:
                          response_text = str(response_obj['message'])
                      else:
                          response_text = str(response_obj)

                      # Extract tools information if available
                      if 'raw_response' in response_obj:
                          cleaned_response['tools_called'] = self._extract_tools_from_raw_response(response_obj['raw_response'])
                  else:
                      response_text = str(response_obj)

                  # Remove step prefixes (Step 1:, Step 2:, etc.) from the beginning
                  response_text = re.sub(r'^Step \d+:\s*[^\n]*\n?', '', response_text, flags=re.MULTILINE)

                  # Also remove any remaining step patterns that might be at the start
                  response_text = re.sub(r'^Step \d+.*?\n', '', response_text)

                  # Clean up extra whitespace and newlines
                  response_text = response_text.strip()

                  cleaned_response['response'] = response_text

                  return cleaned_response

              def _extract_tools_from_raw_response(self, raw_response):
                  """Extract tool information from raw response."""
                  tools_called = []

                  try:
                      if isinstance(raw_response, dict) and 'messages' in raw_response:
                          messages = raw_response['messages']

                          for message in messages:
                              if isinstance(message, list) and len(message) > 9:
                                  # Check if this is an AI message with tool calls
                                  if len(message) > 5 and message[5][1] == "ai":
                                      # Look for tool calls in the message
                                      if len(message) > 9 and message[9][0] == "tool_calls":
                                          tool_calls = message[9][1]

                                          for tool_call in tool_calls:
                                              if isinstance(tool_call, dict) and 'name' in tool_call:
                                                  tool_info = {
                                                      'name': tool_call['name'],
                                                      'args': tool_call.get('args', {})
                                                  }
                                                  tools_called.append(tool_info)
                  except Exception:
                      # If we can't extract tools, just return empty list
                      pass

                  return tools_called


          # ============ CHAT SESSION MANAGEMENT VIEWS ============
          @method_decorator(csrf_exempt, name='dispatch')
          class ChatSessionListView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request):
                  """Get all chat sessions for the current user"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      sessions = ChatSession.objects.filter(user=request.user, is_active=True)
                      serializer = ChatSessionSerializer(sessions, many=True)

                      return Response({
                          "message": "Chat sessions retrieved successfully.",
                          "data": serializer.data
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              def post(self, request):
                  """Create a new chat session"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      serializer = ChatSessionSerializer(data=request.data, context={'request': request})

                      if serializer.is_valid():
                          session = serializer.save()
                          return Response({
                              "message": "Chat session created successfully.",
                              "data": serializer.data
                          }, status=status.HTTP_201_CREATED)
                      else:
                          return Response({
                              "message": "Invalid data.",
                              "errors": serializer.errors
                          }, status=status.HTTP_400_BAD_REQUEST)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          @method_decorator(csrf_exempt, name='dispatch')
          class ChatSessionDetailView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request, session_id):
                  """Get specific chat session details"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      session = get_object_or_404(ChatSession, session_id=session_id, user=request.user)
                      serializer = ChatSessionSerializer(session)

                      return Response({
                          "message": "Chat session retrieved successfully.",
                          "data": serializer.data
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              def put(self, request, session_id):
                  """Update chat session (e.g., title)"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      session = get_object_or_404(ChatSession, session_id=session_id, user=request.user)

                      serializer = ChatSessionSerializer(session, data=request.data, partial=True)

                      if serializer.is_valid():
                          serializer.save()
                          return Response({
                              "message": "Chat session updated successfully.",
                              "data": serializer.data
                          }, status=status.HTTP_200_OK)
                      else:
                          return Response({
                              "message": "Invalid data.",
                              "errors": serializer.errors
                          }, status=status.HTTP_400_BAD_REQUEST)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              def delete(self, request, session_id):
                  """Delete chat session"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      session = get_object_or_404(ChatSession, session_id=session_id, user=request.user)

                      # Soft delete by marking inactive
                      session.is_active = False
                      session.save()

                      return Response({
                          "message": "Chat session deleted successfully."
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          @method_decorator(csrf_exempt, name='dispatch')
          class ChatSessionMessagesView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def get(self, request, session_id):
                  """Get all messages for a specific chat session"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      session = get_object_or_404(ChatSession, session_id=session_id, user=request.user)

                      messages = ChatMessage.objects.filter(chat_session=session).order_by('timestamp')
                      serializer = ChatMessageSerializer(messages, many=True)

                      return Response({
                          "message": "Chat messages retrieved successfully.",
                          "session_info": {
                              "session_id": session.session_id,
                              "title": session.title
                          },
                          "data": serializer.data
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

              def delete(self, request, session_id):
                  """Clear all messages in a chat session"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      session = get_object_or_404(ChatSession, session_id=session_id, user=request.user)

                      deleted_count = ChatMessage.objects.filter(chat_session=session).delete()[0]

                      return Response({
                          "message": f"Cleared {deleted_count} messages from chat session."
                      }, status=status.HTTP_200_OK)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)


          @method_decorator(csrf_exempt, name='dispatch')
          class SaveSessionMessageView(APIView):
              authentication_classes = [JWTAuthentication]
              permission_classes = [IsAuthenticatedCustom]

              def post(self, request, session_id):
                  """Save a message to a specific chat session"""
                  try:
                      # âœ… Use Django's authenticated user
                      if not request.user.is_authenticated:
                          return Response({'message': "Authentication credentials were not provided or are invalid."}, 
                                        status=status.HTTP_401_UNAUTHORIZED)

                      session = get_object_or_404(ChatSession, session_id=session_id, user=request.user)

                      # Check if message with same ID already exists
                      message_id = request.data.get('message_id')
                      if message_id and ChatMessage.objects.filter(message_id=message_id).exists():
                          return Response({
                              "message": "Message already exists.",
                              "data": ChatMessageSerializer(ChatMessage.objects.get(message_id=message_id)).data
                          }, status=status.HTTP_200_OK)

                      # Ensure all required fields are present
                      required_fields = ['message_id', 'text', 'sender']
                      for field in required_fields:
                          if field not in request.data:
                              return Response({
                                  "message": "Invalid data.",
                                  "errors": {field: ["This field is required."]}
                              }, status=status.HTTP_400_BAD_REQUEST)

                      serializer = ChatMessageSerializer(
                          data=request.data, 
                          context={'request': request, 'chat_session': session}
                      )

                      if serializer.is_valid():
                          message = serializer.save()

                          # Update session timestamp
                          session.save()

                          return Response({
                              "message": "Message saved successfully.",
                              "data": serializer.data
                          }, status=status.HTTP_201_CREATED)
                      else:
                          return Response({
                              "message": "Invalid data.",
                              "errors": serializer.errors
                          }, status=status.HTTP_400_BAD_REQUEST)

                  except Exception as e:
                      return Response({"error": str(e)}, status=status.HTTP_500_INTERNAL_SERVER_ERROR)

        --------------------------------------------------------------------------------------------------------------


          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ðŸ“ migrations
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ðŸ“„ __init__.py (0.00 KB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------

          --------------------------------------------------------------------------------------------------------------


          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ðŸ“ client
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ðŸ“„ client.py (0.03 MB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------
            import os
            import sys
            import json
            from contextlib import AsyncExitStack
            from typing import Dict, Any, List, Optional

            from django.conf import settings

            from mcp import ClientSession, StdioServerParameters
            from mcp.client.stdio import stdio_client

            from langchain_mcp_adapters.tools import load_mcp_tools
            from langgraph.prebuilt import create_react_agent
            from langchain_anthropic import ChatAnthropic
            from langchain_core.messages import AIMessage


            DEBUG = os.environ.get("MCP_DEBUG", "false").lower() == "true"

            def debug_print(*args, **kwargs):
                if DEBUG:
                    print("[DEBUG]", *args, **kwargs)


            PROMPT_TEMPLATE = """
            You are an advanced intelligent data management and tracking assistant with sophisticated analysis capabilities.

            Your job is to understand natural language queries and intelligently manage any type of data through smart analysis and organization.

            You have access to the following tools for managing data:

            1. `get_user_tables(user_id: int)` - Get all tables belonging to a user
            2. `create_table(user_id: int, table_name: str, description: str, headers: list)` - Create new data tracking table
            3. `add_table_row(table_id: int, row_data: dict)` - Add data entry to a table
            4. `update_table_row(table_id: int, row_id: str, new_data: dict)` - Update existing data entry
            5. `delete_table_row(table_id: int, row_id: str)` - Delete a data entry
            6. `get_table_content(user_id: int, table_id?: int)` - Get table data for analysis
            7. `add_table_column(table_id: int, header: str)` - Add new column to table
            8. `delete_table_columns(table_id: int, new_headers: list)` - Remove columns from table
            9. `update_table_metadata(user_id: int, table_id: int, ...)` - Update table name/description
            10. `delete_table(user_id: int, table_id: int)` - Delete entire table

            ## ADVANCED INTELLIGENCE INSTRUCTIONS:

            ### ðŸ§  DATA ANALYSIS & PATTERN RECOGNITION:
            - Analyze user's data patterns and tracking behaviors
            - Identify categories, frequency, trends, and seasonal patterns
            - Detect anomalies and suggest optimizations
            - Recognize recurring entries and suggest automation
            - Provide insights on data organization and tracking habits

            ### ðŸŽ¯ INTELLIGENT TABLE MATCHING:
            - **Step 1**: Always get user's existing tables first with `get_user_tables(user_id)`
            - **Step 2**: Analyze table names, descriptions, and purposes to find best matches
            - **Step 3**: Use semantic similarity to match query intent with table purpose
            - **Step 4**: Consider table usage patterns and relevance scores

            **Table Matching Logic:**
            - Match data type (books, inventory, expenses, habits, projects, collections, etc.)
            - Match tracking period (daily, weekly, monthly, yearly, event-based)
            - Match context/location (home, work, library, specific places)
            - Match measurement units (count, amount, rating, status, etc.)
            - Consider table creation date and usage frequency

            ### ðŸ“Š SMART CONTENT ANALYSIS:
            - Get table content with `get_table_content()` to understand data structure
            - Analyze existing column headers and data patterns
            - Suggest new columns if current structure is insufficient
            - Recommend data standardization and organization improvements
            - Identify missing or inconsistent data entries

            ### ðŸ”„ ADAPTIVE DECISION MAKING:
            1. **For Data Recording:**
               - Find most relevant existing table based on type/category/context
               - If no perfect match, find closest table and adapt structure
               - Only create new table if no reasonable existing option
               - Suggest merging similar tables if too many exist

            2. **For Data Retrieval:**
               - Analyze which tables contain relevant information
               - Combine data from multiple tables if needed
               - Provide comprehensive analysis with trends and insights
               - Generate smart filters based on query intent

            3. **For Data Organization:**
               - Analyze data patterns to suggest better organization
               - Compare current data with historical patterns
               - Identify areas for improvement
               - Predict future data needs based on trends

            ### ðŸŒ MULTI-LANGUAGE & CONTEXT INTELLIGENCE:
            - Parse Bengali, English, and mixed language queries intelligently
            - Extract context-specific information (dates: ajk=today, gotokal=yesterday)
            - Understand different tracking terminologies and local contexts
            - Handle various measurement units and counting systems

            ### ðŸ“ˆ ENHANCED QUERY PROCESSING:

            **Example Smart Processing:**

            "ami ajk 5 ta boi porechi" (I read 5 books today)
            â†’ **Analysis:** Bengali data entry, count=5, item=books, date=today
            â†’ **Table Search:** Look for tables with keywords: "book", "reading", "library", "daily"
            â†’ **Best Match Logic:** 
               - Priority 1: "Book Reading Log" or "Reading Tracker"
               - Priority 2: "Daily Activities" with book column
               - Priority 3: General activity/habit tracker
            â†’ **Action:** Add to best matching table with proper categorization

            "ami inventory te 50 ta pen ache" (I have 50 pens in inventory)
            â†’ **Analysis:** Inventory tracking, count=50, item=pens, type=stock
            â†’ **Table Search:** Find tables with "inventory", "stock", "supplies"
            â†’ **Smart Analysis:** Track inventory levels, suggest reorder points
            â†’ **Action:** Update or add inventory record with quantity tracking

            "show me my book reading progress this month"
            â†’ **Analysis:** Data retrieval request, category=books, period=current month
            â†’ **Table Search:** Find tables containing book/reading data
            â†’ **Smart Analysis:** Calculate total books, reading rate, compare with goals
            â†’ **Insights:** Provide reading statistics, suggest reading goals

            "create table for tracking gym workouts"
            â†’ **Analysis:** New table creation, category=fitness, type=workout tracking
            â†’ **Smart Suggestions:** Recommend columns based on workout tracking best practices
            â†’ **Table Design:** [Date, Exercise, Sets, Reps, Weight, Duration, Notes]

            ### ðŸŽ¯ RESPONSE INTELLIGENCE:
            - Always explain WHY a particular table was selected
            - Provide confidence scores for matches (High/Medium/Low)
            - Suggest improvements to data structure when relevant
            - Give proactive data organization insights and recommendations
            - Warn about potential issues (duplicate entries, inconsistent data, etc.)

            ### ðŸ“‹ STEP-BY-STEP PROCESSING:
            1. **Parse & Understand:** Extract intent, entities, and context from any domain
            2. **Analyze Existing Data:** Get tables and analyze data patterns
            3. **Find Best Match:** Use intelligent matching algorithms for any data type
            4. **Execute Action:** Perform requested operation with domain-specific best practices
            5. **Provide Insights:** Give meaningful feedback and data organization suggestions
            6. **Learn & Adapt:** Remember user preferences and tracking patterns

            ### ðŸ·ï¸ SUPPORTED DATA TYPES & USE CASES:
            - **Personal Tracking:** Books read, movies watched, habits, goals, mood
            - **Inventory Management:** Stock counts, supplies, collections, assets
            - **Financial Records:** Expenses, income, budgets, savings, investments
            - **Project Management:** Tasks, milestones, time tracking, progress
            - **Health & Fitness:** Workouts, meals, weight, sleep, medications
            - **Academic:** Study hours, grades, assignments, course progress
            - **Professional:** Work hours, meetings, deadlines, performance metrics
            - **Household:** Chores, maintenance, bills, family activities
            - **Collections:** Books, movies, games, stamps, coins, anything collectible
            - **Social:** Events, contacts, relationships, social activities

            Always provide comprehensive feedback including:
            - Why specific tables were chosen for the data type
            - Data organization and tracking insights
            - Suggestions for better data management
            - Confidence levels in recommendations
            - Next best actions for improved tracking

            Remember: You are a universal data management assistant - help users track, organize, and analyze ANY type of information efficiently!
            """


            class ExpenseMCPClient:

                def __init__(self, anthropic_api_key=None):
                    self.anthropic_api_key = anthropic_api_key or getattr(
                        settings, "ANTHROPIC_API_KEY", os.getenv("ANTHROPIC_API_KEY")
                    )
                    if not self.anthropic_api_key:
                        raise ValueError("Anthropic API key is required.")
                    self.exit_stack = None
                    self.client = None
                    self.agent = None
                    self.available_tools = []
                    self.sessions = {}
                    self.operation_history = []  # Track operation history

                @staticmethod
                def read_config_json():
                    script_dir = os.path.dirname(os.path.abspath(__file__))
                    config_path = os.path.join(script_dir, "mcpConfig.json")
                    print(f"[INFO] Loading MCP config from: {config_path}")

                    try:
                        with open(config_path, "r") as f:
                            config = json.load(f)

                        # Dynamically resolve server script path
                        server_script_path = os.path.join(script_dir, "..", "servers", "finance_mcp_server.py")
                        server_script_path = os.path.abspath(server_script_path)

                        # Check if server script exists
                        if not os.path.exists(server_script_path):
                            raise FileNotFoundError(f"MCP server script not found at: {server_script_path}")

                        # Replace placeholder with actual path
                        for server_name, server_config in config.get("mcpServers", {}).items():
                            if "args" in server_config:
                                server_config["args"] = [
                                    arg.replace("{SERVER_SCRIPT_PATH}", server_script_path) 
                                    for arg in server_config["args"]
                                ]
                                print(f"[INFO] Resolved server path for {server_name}: {server_script_path}")

                        return config
                    except Exception as e:
                        print(f"âŒ Failed to read config file: {e}")
                        print(f"âŒ Config path attempted: {config_path}")
                        print(f"âŒ Script directory: {script_dir}")
                        sys.exit(1)

                def parse_tool_response(self, response_str: str) -> Dict[str, Any]:
                    """Parse and enhance tool response with step information."""
                    try:
                        response_data = json.loads(response_str)

                        # Store operation in history
                        operation_record = {
                            "timestamp": self._get_timestamp(),
                            "success": response_data.get("success", False),
                            "message": response_data.get("message", ""),
                            "steps": response_data.get("steps", []),
                            "data": response_data.get("data")
                        }
                        self.operation_history.append(operation_record)

                        return response_data
                    except json.JSONDecodeError:
                        return {"success": False, "error": "Invalid JSON response", "steps": []}

                def format_step_summary(self, steps: List[Dict]) -> str:
                    """Format step information for user-friendly display."""
                    if not steps:
                        return ""

                    summary = "\nðŸ“‹ **Operation Steps:**\n"
                    for step in steps:
                        step_num = step.get("step", "?")
                        action = step.get("action", "Unknown action")
                        status = step.get("status", "unknown")

                        # Status icons
                        status_icon = {
                            "completed": "âœ…",
                            "in_progress": "â³", 
                            "failed": "âŒ",
                            "skipped": "â­ï¸"
                        }.get(status, "â“")

                        summary += f"{status_icon} **Step {step_num}:** {action}"

                        # Add additional metadata
                        if status == "completed":
                            if "count" in step:
                                summary += f" (Found: {step['count']})"
                            elif "table_id" in step:
                                summary += f" (ID: {step['table_id']})"
                            elif "generated_id" in step:
                                summary += f" (Generated ID: {step['generated_id']})"
                            elif "user" in step:
                                summary += f" (User: {step['user']})"
                            elif "table_name" in step:
                                summary += f" (Table: {step['table_name']})"

                        elif status == "failed":
                            if "error" in step:
                                summary += f" - **Error:** {step['error']}"
                            if "invalid_keys" in step:
                                summary += f" - **Invalid keys:** {step['invalid_keys']}"

                        elif status == "skipped":
                            if "reason" in step:
                                summary += f" - **Reason:** {step['reason']}"

                        summary += "\n"

                    return summary

                def format_enhanced_response(self, response_data: Dict[str, Any], original_query: str) -> str:
                    """Format the complete response with intelligent analysis and insights."""
                    success = response_data.get("success", False)
                    message = response_data.get("message", "")
                    steps = response_data.get("steps", [])
                    data = response_data.get("data")
                    error = response_data.get("error")

                    formatted_response = ""

                    # Main result with intelligence indicator
                    if success:
                        formatted_response += f"ðŸŽ¯ **Intelligent Analysis Complete:** {message}\n"
                    else:
                        formatted_response += f"âŒ **Analysis Failed:** {error or message}\n"

                    # Step summary with smart insights
                    if steps:
                        formatted_response += self.format_step_summary_enhanced(steps, original_query)

                    # Intelligent data analysis
                    if data and success:
                        formatted_response += "\nðŸ§  **AI Analysis Results:**\n"
                        confidence_score = self._calculate_confidence_score(response_data, original_query)
                        formatted_response += f"- **Confidence Level:** {confidence_score}\n"

                        if isinstance(data, list) and len(data) > 0:
                            formatted_response += f"- **Tables Analyzed:** {len(data)} tables\n"

                            # Analyze table relevance
                            best_match = self._find_best_table_match(data, original_query)
                            if best_match:
                                formatted_response += f"- **Best Match:** {best_match['name']} (Relevance: {best_match['score']}%)\n"

                            # Show table analysis
                            for i, item in enumerate(data[:3]):
                                if isinstance(item, dict):
                                    table_name = item.get("table_name") or item.get("name") or f"Table {i+1}"
                                    relevance = self._calculate_table_relevance(item, original_query)
                                    formatted_response += f"  â€¢ {table_name} - Relevance: {relevance}%\n"

                        elif isinstance(data, dict):
                            if "table_id" in data:
                                formatted_response += f"- **Target Table ID:** {data['table_id']}\n"
                            if "table_name" in data:
                                formatted_response += f"- **Table Selected:** {data['table_name']}\n"
                            if "headers" in data:
                                formatted_response += f"- **Data Structure:** {', '.join(data['headers'])}\n"

                    # Smart recommendations
                    recommendations = self._generate_smart_recommendations(response_data, original_query)
                    if recommendations:
                        formatted_response += "\nðŸ’¡ **Smart Recommendations:**\n"
                        for rec in recommendations:
                            formatted_response += f"- {rec}\n"

                    # Financial insights
                    insights = self._generate_financial_insights(response_data, original_query)
                    if insights:
                        formatted_response += "\nðŸ“Š **Financial Insights:**\n"
                        for insight in insights:
                            formatted_response += f"- {insight}\n"

                    return formatted_response

                def format_step_summary_enhanced(self, steps: List[Dict], query: str) -> str:
                    """Enhanced step summary with intelligence indicators."""
                    if not steps:
                        return ""

                    summary = "\nðŸ“‹ **Intelligent Processing Steps:**\n"
                    for step in steps:
                        step_num = step.get("step", "?")
                        action = step.get("action", "Unknown action")
                        status = step.get("status", "unknown")

                        # Enhanced status icons with intelligence
                        status_icon = {
                            "completed": "ðŸŽ¯",  # Smart completion
                            "in_progress": "ðŸ§ ",  # AI thinking
                            "failed": "âš ï¸",
                            "skipped": "â­ï¸"
                        }.get(status, "â“")

                        summary += f"{status_icon} **Step {step_num}:** {action}"

                        # Add intelligence metadata
                        if status == "completed":
                            if "analysis_score" in step:
                                summary += f" (Analysis Score: {step['analysis_score']}%)"
                            elif "confidence" in step:
                                summary += f" (Confidence: {step['confidence']}%)"
                            elif "count" in step:
                                summary += f" (Found: {step['count']} items)"
                            elif "table_id" in step:
                                summary += f" (Selected: Table #{step['table_id']})"
                            elif "match_score" in step:
                                summary += f" (Match: {step['match_score']}%)"

                        elif status == "failed":
                            if "error" in step:
                                summary += f" - **Issue:** {step['error']}"
                            if "suggestion" in step:
                                summary += f" - **Suggestion:** {step['suggestion']}"

                        summary += "\n"

                    return summary

                def _calculate_confidence_score(self, response_data: Dict, query: str) -> str:
                    """Calculate AI confidence score based on response quality."""
                    score = 85  # Base confidence

                    # Adjust based on data quality
                    if response_data.get("success", False):
                        score += 10
                    else:
                        score -= 20

                    # Adjust based on step completion
                    steps = response_data.get("steps", [])
                    if steps:
                        completed_steps = sum(1 for step in steps if step.get("status") == "completed")
                        total_steps = len(steps)
                        if total_steps > 0:
                            completion_rate = (completed_steps / total_steps) * 100
                            score = (score + completion_rate) / 2

                    # Classify confidence
                    if score >= 90:
                        return "Very High (90%+)"
                    elif score >= 75:
                        return "High (75-89%)"
                    elif score >= 60:
                        return "Medium (60-74%)"
                    else:
                        return "Low (<60%)"

                def _find_best_table_match(self, tables: List[Dict], query: str) -> Dict:
                    """Find the best matching table based on semantic analysis."""
                    if not tables:
                        return None

                    best_match = None
                    highest_score = 0

                    # Keywords for different categories
                    query_lower = query.lower()
                    expense_keywords = ['khoroch', 'expense', 'cost', 'spent', 'buy', 'purchase']
                    location_keywords = ['sylhet', 'dhaka', 'chittagong', 'travel']
                    time_keywords = ['daily', 'monthly', 'yearly', 'ajk', 'today']

                    for table in tables:
                        if not isinstance(table, dict):
                            continue

                        table_name = table.get("table_name", "").lower()
                        description = table.get("description", "").lower()

                        score = 0

                        # Check for expense-related matches
                        if any(keyword in query_lower for keyword in expense_keywords):
                            if any(keyword in table_name for keyword in expense_keywords):
                                score += 40
                            if 'expense' in table_name or 'cost' in table_name:
                                score += 30

                        # Check for location matches
                        for location in location_keywords:
                            if location in query_lower and location in table_name:
                                score += 35

                        # Check for time period matches
                        for time_word in time_keywords:
                            if time_word in query_lower and time_word in table_name:
                                score += 25

                        # General name similarity
                        if 'daily' in table_name and ('ajk' in query_lower or 'today' in query_lower):
                            score += 20

                        if score > highest_score:
                            highest_score = score
                            best_match = {
                                "name": table.get("table_name", "Unknown"),
                                "score": min(score, 95),  # Cap at 95%
                                "id": table.get("id")
                            }

                    return best_match

                def _calculate_table_relevance(self, table: Dict, query: str) -> int:
                    """Calculate relevance percentage for a specific table."""
                    if not isinstance(table, dict):
                        return 0

                    table_name = table.get("table_name", "").lower()
                    query_lower = query.lower()

                    relevance = 20  # Base relevance

                    # Keyword matching
                    expense_words = ['expense', 'khoroch', 'cost']
                    location_words = ['sylhet', 'dhaka', 'travel']

                    for word in expense_words:
                        if word in query_lower and word in table_name:
                            relevance += 25

                    for word in location_words:
                        if word in query_lower and word in table_name:
                            relevance += 30

                    # Time relevance
                    if ('ajk' in query_lower or 'today' in query_lower) and 'daily' in table_name:
                        relevance += 20

                    return min(relevance, 95)

                def _generate_smart_recommendations(self, response_data: Dict, query: str) -> List[str]:
                    """Generate intelligent recommendations based on the operation."""
                    recommendations = []

                    if response_data.get("success", False):
                        # Success recommendations
                        if 'expense' in query.lower() or 'khoroch' in query.lower():
                            recommendations.append("Set up budget alerts for this category")
                            recommendations.append("Track similar expenses to identify patterns")
                            recommendations.append("Consider using expense categories for better analysis")

                        if 'sylhet' in query.lower() or 'travel' in query.lower():
                            recommendations.append("Create a dedicated travel budget tracker")
                            recommendations.append("Compare travel costs across different destinations")

                    else:
                        # Failure recommendations
                        recommendations.append("Try rephrasing your query with more specific details")
                        recommendations.append("Check if the table structure matches your data")
                        recommendations.append("Consider creating a new table for this expense type")

                    return recommendations[:3]  # Limit to top 3

                def _generate_financial_insights(self, response_data: Dict, query: str) -> List[str]:
                    """Generate financial insights based on the operation."""
                    insights = []

                    # Amount-based insights
                    if '100' in query and 'tk' in query:
                        insights.append("Small expense recorded - good for daily tracking")
                        insights.append("Consider setting daily spending limits")

                    # Location-based insights
                    if 'sylhet' in query.lower():
                        insights.append("Travel expenses detected - track accommodation and food separately")

                    # Pattern insights
                    if response_data.get("success", False):
                        insights.append("Regular expense tracking builds better financial habits")

                    return insights[:2]  # Limit to top 2

                @staticmethod
                def _get_timestamp():
                    """Get current timestamp."""
                    from datetime import datetime
                    return datetime.now().isoformat()

                async def connect(self):
                    config = self.read_config_json()
                    mcp_servers = config.get("mcpServers", {})
                    if not mcp_servers:
                        print("âŒ No MCP servers found in the configuration.")
                        return

                    self.exit_stack = AsyncExitStack()
                    tools = []

                    try:
                        for server_name, server_info in mcp_servers.items():
                            print(f"\nðŸ”— Connecting to MCP Server: {server_name}...")
                            server_params = StdioServerParameters(
                                command=server_info["command"],
                                args=server_info["args"]
                            )
                            try:
                                read, write = await self.exit_stack.enter_async_context(stdio_client(server_params))
                                session = await self.exit_stack.enter_async_context(ClientSession(read, write))
                                await session.initialize()
                                server_tools = await load_mcp_tools(session)
                                for tool in server_tools:
                                    print(f"ðŸ”§ Loaded tool: {tool.name}")
                                    tools.append(tool)
                                print(f"âœ… Loaded {len(server_tools)} tools from {server_name}")
                                if not self.client:
                                    self.client = session
                                self.sessions[server_name] = session
                            except Exception as e:
                                print(f"âŒ Failed to connect to server '{server_name}': {e}")

                        if not tools:
                            print("âŒ No tools loaded from any server.")
                            return

                        self.available_tools = tools

                    except Exception as e:
                        print(f"âŒ Exception during MCP connection: {e}")
                        return

                    llm = ChatAnthropic(
                        model="claude-3-5-sonnet-20240620",
                        temperature=0,
                        anthropic_api_key=self.anthropic_api_key
                    )

                    self.agent = create_react_agent(llm, self.available_tools)
                    return self.agent

                async def disconnect(self):
                    """Properly disconnect all MCP sessions and cleanup resources."""
                    if self.exit_stack:
                        try:
                            # Close all sessions first
                            for session_name, session in self.sessions.items():
                                try:
                                    debug_print(f"Closing session: {session_name}")
                                    # Don't await session close as it might be already closed
                                except Exception as e:
                                    debug_print(f"Warning: Error closing session {session_name}: {e}")

                            # Clear sessions before closing exit stack
                            self.sessions.clear()

                            # Use aclose instead of manual __aexit__
                            await self.exit_stack.aclose()
                            debug_print("âœ… Exit stack closed successfully")

                        except Exception as e:
                            debug_print(f"Warning: Error during disconnect: {e}")
                            # Continue with cleanup even if there are errors
                        finally:
                            # Reset all state regardless of errors
                            self.exit_stack = None
                            self.client = None
                            self.available_tools = []
                            self.sessions = {}
                            self.agent = None

                        return "âœ… Disconnected"
                    return "â„¹ï¸ Not connected"

                async def process_query(self, query_data):
                    if not self.agent:
                        await self.connect()
                    if not self.agent:
                        return {
                            "success": False,
                            "error": "Agent not initialized",
                            "message": "âŒ Agent not initialized"
                        }

                    # Format the query with context
                    if isinstance(query_data, dict):
                        query_text = query_data.get('query', str(query_data))
                        user_id = query_data.get('user_id', 'unknown')
                        context = f"User ID: {user_id}\nQuery: {query_text}"
                        if 'table_id' in query_data:
                            context += f"\nTable ID: {query_data['table_id']}"
                        if 'context_type' in query_data:
                            context += f"\nContext: {query_data['context_type']}"
                    else:
                        context = f"Query: {query_data}"
                        query_text = str(query_data)

                    full_prompt = f"""{PROMPT_TEMPLATE}

            USER CONTEXT:
            {context}

            Process this request and use the appropriate tools to help the user.
            When you receive tool responses, look for the 'steps' array and provide detailed feedback about the operation progress.
            """

                    try:
                        response = await self.agent.ainvoke({"messages": full_prompt}, {"recursion_limit": 100})

                        # Extract response content
                        final_response = ""
                        raw_response = None

                        if isinstance(response, dict) and "messages" in response:
                            messages = response["messages"]
                            raw_response = response
                            for message in reversed(messages):
                                if hasattr(message, 'content'):
                                    final_response = message.content
                                    break
                            if not final_response:
                                final_response = str(response)
                        elif hasattr(response, 'content'):
                            final_response = response.content
                            raw_response = response
                        else:
                            final_response = str(response)
                            raw_response = response

                        # Try to extract structured tool responses
                        structured_data = self._extract_structured_response(final_response, query_text)

                        # Return enhanced response structure
                        return {
                            "success": True,
                            "message": "Query processed successfully",
                            "query": query_text,
                            "response": final_response,
                            "formatted_response": final_response,
                            "raw_response": raw_response,
                            "operation_stats": self.get_operation_stats(),
                            **structured_data  # Merge any extracted structured data
                        }

                    except Exception as e:
                        error_msg = f"âŒ Error processing query: {str(e)}"
                        print(error_msg)

                        # Record failed operation
                        self.operation_history.append({
                            "timestamp": self._get_timestamp(),
                            "success": False,
                            "message": error_msg,
                            "query": query_text,
                            "error": str(e),
                            "steps": [{
                                "step": 1,
                                "action": "Processing query",
                                "status": "failed",
                                "error": str(e)
                            }]
                        })

                        return {
                            "success": False,
                            "error": str(e),
                            "message": error_msg,
                            "query": query_text,
                            "steps": [{
                                "step": 1,
                                "action": "Processing query", 
                                "status": "failed",
                                "error": str(e)
                            }],
                            "operation_stats": self.get_operation_stats()
                        }

                def _extract_structured_response(self, response_text: str, query: str) -> Dict[str, Any]:
                    """Extract structured data from response text."""
                    structured_data = {}

                    try:
                        # Look for JSON-like structures in the response
                        import re
                        json_matches = re.findall(r'\{[^{}]*"success"[^{}]*\}', response_text)

                        for json_match in json_matches:
                            try:
                                tool_response = json.loads(json_match)
                                if "steps" in tool_response:
                                    structured_data["steps"] = tool_response["steps"]
                                if "data" in tool_response:
                                    structured_data["data"] = tool_response["data"]
                                if "success" in tool_response:
                                    structured_data["tool_success"] = tool_response["success"]
                                break  # Use first valid JSON found
                            except json.JSONDecodeError:
                                continue

                        # Check for operation indicators in text
                        if "âœ…" in response_text:
                            structured_data["contains_success"] = True
                        if "âŒ" in response_text:
                            structured_data["contains_error"] = True
                        if "ðŸ“‹" in response_text:
                            structured_data["contains_steps"] = True
                        if "ðŸ“Š" in response_text:
                            structured_data["contains_data"] = True

                    except Exception as e:
                        # If extraction fails, just return empty dict
                        pass

                    return structured_data

                def get_operation_history(self, limit: int = 10) -> List[Dict]:
                    """Get recent operation history."""
                    return self.operation_history[-limit:] if self.operation_history else []

                def get_operation_stats(self) -> Dict[str, Any]:
                    """Get statistics about operations."""
                    if not self.operation_history:
                        return {"total": 0, "success_rate": 0}

                    total = len(self.operation_history)
                    successful = sum(1 for op in self.operation_history if op.get("success", False))

                    return {
                        "total": total,
                        "successful": successful,
                        "failed": total - successful,
                        "success_rate": (successful / total) * 100 if total > 0 else 0
                    }

                async def run_interactive_loop(self):
                    if not self.agent:
                        await self.connect()
                    print("\nðŸš€ Enhanced Finance MCP Client Ready! Type 'quit' to exit.")
                    print("ðŸ’¡ New features: Detailed step tracking, operation history, enhanced error reporting")

                    while True:
                        query = input("\nQuery: ").strip()
                        if query.lower() in {"quit", "exit"}:
                            break
                        elif query.lower() == "history":
                            history = self.get_operation_history()
                            print(f"\nðŸ“œ Recent Operations ({len(history)}):")
                            for i, op in enumerate(history, 1):
                                status = "âœ…" if op["success"] else "âŒ"
                                print(f"{i}. {status} {op['message']} ({op['timestamp']})")
                            continue
                        elif query.lower() == "stats":
                            stats = self.get_operation_stats()
                            print(f"\nðŸ“Š Operation Statistics:")
                            print(f"Total operations: {stats['total']}")
                            print(f"Success rate: {stats['success_rate']:.1f}%")
                            continue

                        print("\nâš™ï¸ Processing...")
                        # Simulate query with user_id for testing
                        query_data = {"query": query, "user_id": 1}
                        response = await self.process_query(query_data)
                        print("\nðŸ“¤ Response:")
                        print(response)

                async def __aenter__(self):
                    """Async context manager entry."""
                    await self.connect()
                    return self

                async def __aexit__(self, exc_type, exc_val, exc_tb):
                    """Async context manager exit."""
                    await self.disconnect()
                    return False

                @staticmethod
                async def create_and_run_query(query_data, anthropic_api_key=None):
                    """Static method to create client, run query, and cleanup in one go."""
                    async with ExpenseMCPClient(anthropic_api_key) as client:
                        if not client.agent:
                            return {
                                "success": False,
                                "error": "Failed to initialize MCP client",
                                "message": "Could not connect to the finance management tools"
                            }
                        return await client.process_query(query_data)
          --------------------------------------------------------------------------------------------------------------

          ðŸ“„ mcpConfig.json (0.12 KB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------
            {
              "mcpServers": {
                "finance_server": {
                  "command": "python",
                  "args": ["{SERVER_SCRIPT_PATH}"]
                }
              }
            }

          --------------------------------------------------------------------------------------------------------------


          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
          ðŸ“ servers
          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

          ðŸ“„ finance_mcp_server.py (0.03 MB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------
            #!/usr/bin/env python3
            """
            Finance Management MCP Server

            This MCP server provides tools for managing dynamic tables, expenses, and financial data
            through the Model Context Protocol. It wraps Django ORM operations and exposes them
            as callable tools for AI agents.
            """

            import sys
            import os
            import json
            import uuid
            from typing import Optional
            import time

            # Django setup - MUST be done before any Django imports
            # Calculate the backend path dynamically
            current_script_dir = os.path.dirname(os.path.abspath(__file__))
            backend_path = os.path.join(current_script_dir, "..", "..", "..", "..")
            backend_path = os.path.abspath(backend_path)

            # Allow override via environment variable
            backend_path = os.environ.get('FINANCE_BACKEND_PATH', backend_path)
            django_settings = os.environ.get('DJANGO_SETTINGS_MODULE', 'expense_api.settings.development')

            sys.path.insert(0, backend_path)
            os.environ.setdefault('DJANGO_SETTINGS_MODULE', django_settings)

            print(f"[INFO] MCP Server starting from: {current_script_dir}")
            print(f"[INFO] Backend path resolved to: {backend_path}")
            print(f"[INFO] Django settings module: {django_settings}")

            import django
            from django.conf import settings

            # Ensure Django is properly configured
            if not settings.configured:
                django.setup()
            else:
                # If already configured, just ensure apps are loaded
                django.apps.apps.populate(settings.INSTALLED_APPS)

            # Now we can safely import Django models and MCP
            from mcp.server.fastmcp import FastMCP
            from django.utils.timezone import now
            from asgiref.sync import sync_to_async
            from django.contrib.auth.models import User
            from django.db import transaction
            from expense_api.apps.FinanceManagement.models import DynamicTableData, JsonTable, JsonTableRow
            from expense_api.apps.FinanceManagement.serializers import DynamicTableSerializer
            from expense_api.apps.agent.models import ChatSession, ChatMessage
            from expense_api.apps.agent.serializers import ChatSessionSerializer, ChatMessageSerializer

            # MCP server
            mcp = FastMCP("finance_management")

            # âœ… Tool 1: Get all tables for a user
            @mcp.tool()
            async def get_user_tables(user_id: int) -> str:
                """
                Get all dynamic tables for a user.

                Parameters:
                - user_id: User ID to fetch tables for

                Returns:
                - JSON string with tables data or error message
                """
                try:
                    user_exists = await sync_to_async(User.objects.filter(id=user_id).exists)()
                    if not user_exists:
                        return json.dumps({"success": False, "error": "User not found"})

                    user = await sync_to_async(User.objects.get)(id=user_id)
                    tables = await sync_to_async(lambda: list(DynamicTableData.objects.filter(user=user)))()

                    if not tables:
                        return json.dumps({
                            "success": True,
                            "message": "No tables found for user",
                            "data": []
                        })

                    serializer_data = await sync_to_async(
                        lambda: DynamicTableSerializer(tables, many=True).data
                    )()

                    return json.dumps({
                        "success": True,
                        "message": f"Found {len(tables)} tables",
                        "data": serializer_data
                    })

                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 2: Create a new table with headers
            @mcp.tool()
            async def create_table(user_id: int, table_name: str, description: str, headers) -> str:
                """
                Create a new table with headers.

                Parameters:
                - user_id: User ID who owns the table
                - table_name: Name of the table
                - description: Description of the table
                - headers: List of column headers or JSON string of headers array

                Returns:
                - JSON string with success status and table data
                """
                try:
                    # Handle both string and list inputs for headers
                    if isinstance(headers, str):
                        try:
                            headers_list = json.loads(headers)
                        except json.JSONDecodeError:
                            return json.dumps({"success": False, "error": "Invalid JSON format for headers"})
                    elif isinstance(headers, list):
                        headers_list = headers
                    else:
                        return json.dumps({"success": False, "error": "Headers must be a list or JSON string"})

                    if not isinstance(headers_list, list) or not all(isinstance(h, str) for h in headers_list):
                        return json.dumps({"success": False, "error": "Headers must be a list of strings"})

                    if not table_name.strip():
                        return json.dumps({"success": False, "error": "Table name cannot be empty"})

                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def create_table_sync():
                        with transaction.atomic():
                            dynamic_table = DynamicTableData.objects.create(
                                table_name=table_name.strip(),
                                description=description.strip() if description else "",
                                user=user,
                                pending_count=0
                            )
                            JsonTable.objects.create(table=dynamic_table, headers=headers_list)
                            return dynamic_table

                    dynamic_table = await create_table_sync()

                    return json.dumps({
                        "success": True,
                        "message": "Table created successfully",
                        "data": {
                            "table_id": dynamic_table.id,
                            "table_name": dynamic_table.table_name,
                            "description": dynamic_table.description,
                            "headers": headers_list,
                            "user_id": user.id,
                            "created_at": dynamic_table.created_at.isoformat()
                        }
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 3: Add a new row to a table
            @mcp.tool()
            async def add_table_row(table_id: int, row_data) -> str:
                """
                Add a new row to an existing table.

                Parameters:
                - table_id: ID of the table to add row to
                - row_data: Row data as dictionary or JSON string

                Returns:
                - JSON string with success status
                """
                try:
                    # Handle both string and dict inputs
                    if isinstance(row_data, str):
                        try:
                            row_dict = json.loads(row_data)
                        except json.JSONDecodeError:
                            return json.dumps({"success": False, "error": "Invalid JSON format for row data"})
                    elif isinstance(row_data, dict):
                        row_dict = row_data
                    else:
                        return json.dumps({"success": False, "error": "Row data must be a dictionary or JSON string"})

                    # Get JsonTable by the table_id (which is the primary key from DynamicTableData)
                    json_table = await sync_to_async(JsonTable.objects.get)(table_id=table_id)

                    # Add unique ID if not present
                    if 'id' not in row_dict:
                        row_dict['id'] = str(uuid.uuid4())[:8]

                    # Create the row
                    await sync_to_async(JsonTableRow.objects.create)(table=json_table, data=row_dict)

                    return json.dumps({
                        "success": True,
                        "message": "Row added successfully",
                        "data": row_dict
                    })

                except JsonTable.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 4: Update an existing row
            @mcp.tool()
            async def update_table_row(table_id: int, row_id: str, new_data) -> str:
                """
                Update an existing row in a table.

                Parameters:
                - table_id: ID of the table
                - row_id: ID of the row to update
                - new_data: New data to update as dictionary or JSON string

                Returns:
                - JSON string with success status
                """
                try:
                    # Handle both string and dict inputs
                    if isinstance(new_data, str):
                        try:
                            new_data_dict = json.loads(new_data)
                        except json.JSONDecodeError:
                            return json.dumps({"success": False, "error": "Invalid JSON format for new data"})
                    elif isinstance(new_data, dict):
                        new_data_dict = new_data
                    else:
                        return json.dumps({"success": False, "error": "New data must be a dictionary or JSON string"})

                    # Find the row using table_id and the id within the JSON data
                    row = await sync_to_async(JsonTableRow.objects.get)(
                        table__table_id=table_id,
                        data__id=row_id
                    )

                    @sync_to_async
                    def update_row():
                        current_data = row.data or {}
                        current_data.update(new_data_dict)
                        row.data = current_data
                        row.save()
                        return row.data

                    updated_data = await update_row()

                    return json.dumps({
                        "success": True,
                        "message": "Row updated successfully",
                        "data": updated_data
                    })

                except JsonTableRow.DoesNotExist:
                    return json.dumps({"success": False, "error": "Row not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 5: Delete a row from a table
            @mcp.tool()
            async def delete_table_row(table_id: int, row_id: str) -> str:
                """
                Delete a row from a table.

                Parameters:
                - table_id: ID of the table
                - row_id: ID of the row to delete

                Returns:
                - JSON string with success status
                """
                try:
                    json_table = await sync_to_async(JsonTable.objects.get)(pk=table_id)

                    @sync_to_async
                    def delete_row():
                        for row in json_table.rows.all():
                            if str(row.data.get("id")) == str(row_id):
                                row.delete()
                                return True
                        return False

                    deleted = await delete_row()

                    if not deleted:
                        return json.dumps({"success": False, "error": f"Row with id '{row_id}' not found"})

                    return json.dumps({
                        "success": True,
                        "message": f"Row {row_id} deleted successfully"
                    })

                except JsonTable.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 6: Get table content
            @mcp.tool()
            async def get_table_content(user_id: int, table_id: Optional[int] = None) -> str:
                """
                Get complete content of all tables or specific table.

                Parameters:
                - user_id: User ID to filter tables
                - table_id: Optional specific table ID to fetch

                Returns:
                - JSON string with table content
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def get_tables():
                        if table_id:
                            tables = JsonTable.objects.filter(table_id=table_id, table__user=user)
                        else:
                            tables = JsonTable.objects.filter(table__user=user)

                        result = []
                        for table in tables:
                            table_dict = {
                                "id": table.table.id,
                                "table_name": table.table.table_name,
                                "description": table.table.description,
                                "data": {
                                    "headers": table.headers,
                                    "rows": [row.data for row in table.rows.all()]
                                }
                            }
                            result.append(table_dict)
                        return result

                    result = await get_tables()

                    return json.dumps({
                        "success": True,
                        "message": f"Found {len(result)} tables",
                        "data": result
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 7: Add a column to a table
            @mcp.tool()
            async def add_table_column(table_id: int, header: str) -> str:
                """
                Add a new column to an existing table.

                Parameters:
                - table_id: ID of the table
                - header: Name of the new column header

                Returns:
                - JSON string with success status
                """
                try:
                    json_table = await sync_to_async(JsonTable.objects.get)(pk=table_id)

                    if header in json_table.headers:
                        return json.dumps({"success": False, "error": f"Header '{header}' already exists"})

                    @sync_to_async
                    def add_column():
                        json_table.headers.append(header)
                        json_table.save()

                        # Update all rows with empty value for new column
                        for row in json_table.rows.all():
                            row.data[header] = ""
                            row.save()

                        return json_table.headers

                    updated_headers = await add_column()

                    return json.dumps({
                        "success": True,
                        "message": f"Column '{header}' added successfully",
                        "headers": updated_headers
                    })

                except JsonTable.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 8: Delete columns from a table
            @mcp.tool()
            async def delete_table_columns(table_id: int, new_headers) -> str:
                """
                Delete columns from a table by providing new headers list.

                Parameters:
                - table_id: ID of the table
                - new_headers: List of headers to keep or JSON string (others will be deleted)

                Returns:
                - JSON string with success status
                """
                try:
                    # Handle both string and list inputs
                    if isinstance(new_headers, str):
                        try:
                            new_headers_list = json.loads(new_headers)
                        except json.JSONDecodeError:
                            return json.dumps({"success": False, "error": "Invalid JSON format for headers"})
                    elif isinstance(new_headers, list):
                        new_headers_list = new_headers
                    else:
                        return json.dumps({"success": False, "error": "Headers must be a list or JSON string"})

                    json_table = await sync_to_async(JsonTable.objects.get)(table_id=table_id)

                    @sync_to_async
                    def delete_columns():
                        old_headers = json_table.headers
                        deleted_headers = set(old_headers) - set(new_headers_list)

                        if not deleted_headers:
                            return old_headers, []

                        json_table.headers = new_headers_list
                        json_table.save()

                        # Update rows to remove deleted columns
                        for row in json_table.rows.all():
                            for col in deleted_headers:
                                row.data.pop(col, None)
                            row.save()

                        return new_headers_list, list(deleted_headers)

                    updated_headers, deleted_headers = await delete_columns()

                    return json.dumps({
                        "success": True,
                        "message": f"Deleted columns: {deleted_headers}" if deleted_headers else "No columns deleted",
                        "headers": updated_headers
                    })

                except JsonTable.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 9: Update table metadata
            @mcp.tool()
            async def update_table_metadata(user_id: int, table_id: int, table_name: Optional[str] = None, 
                                           description: Optional[str] = None, pending_count: Optional[int] = None) -> str:
                """
                Update table name, description, or pending count.

                Parameters:
                - user_id: User ID who owns the table
                - table_id: ID of the table to update
                - table_name: New table name (optional)
                - description: New description (optional)
                - pending_count: New pending count (optional)

                Returns:
                - JSON string with success status
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)
                    table = await sync_to_async(DynamicTableData.objects.get)(id=table_id, user=user)

                    @sync_to_async
                    def update_metadata():
                        updated = False

                        if table_name is not None:
                            table.table_name = table_name
                            updated = True
                        if description is not None:
                            table.description = description
                            updated = True
                        if pending_count is not None:
                            table.pending_count = pending_count
                            updated = True

                        if updated:
                            table.save()
                            return DynamicTableSerializer(table).data, True
                        return None, False

                    serializer_data, was_updated = await update_metadata()

                    if was_updated:
                        return json.dumps({
                            "success": True,
                            "message": "Table updated successfully",
                            "data": serializer_data
                        })
                    else:
                        return json.dumps({"success": False, "error": "No fields to update"})

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except DynamicTableData.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 10: Delete a table
            @mcp.tool()
            async def delete_table(user_id: int, table_id: int) -> str:
                """
                Delete a table and all its data.

                Parameters:
                - user_id: User ID who owns the table
                - table_id: ID of the table to delete

                Returns:
                - JSON string with success status
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)
                    table = await sync_to_async(DynamicTableData.objects.get)(id=table_id, user=user)

                    @sync_to_async
                    def delete_table_sync():
                        with transaction.atomic():
                            table_name = table.table_name
                            table.delete()  # This will cascade delete JsonTable and JsonTableRow
                            return table_name

                    deleted_table_name = await delete_table_sync()

                    return json.dumps({
                        "success": True,
                        "message": f"Table '{deleted_table_name}' deleted successfully"
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except DynamicTableData.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 11: Delete a single column from a table
            @mcp.tool()
            async def delete_single_column(table_id: int, header: str) -> str:
                """
                Delete a single column from a table.

                Parameters:
                - table_id: ID of the table
                - header: Name of the column header to delete

                Returns:
                - JSON string with success status
                """
                try:
                    json_table = await sync_to_async(JsonTable.objects.get)(pk=table_id)

                    if header not in json_table.headers:
                        return json.dumps({"success": False, "error": f"Header '{header}' does not exist in the table"})

                    @sync_to_async
                    def delete_column():
                        # Remove the header from the headers list
                        json_table.headers.remove(header)
                        json_table.save()

                        # Remove the header key from all rows
                        for row in json_table.rows.all():
                            if header in row.data:
                                del row.data[header]
                                row.save()

                        return json_table.headers

                    updated_headers = await delete_column()

                    return json.dumps({
                        "success": True,
                        "message": f"Column '{header}' deleted successfully",
                        "headers": updated_headers
                    })

                except JsonTable.DoesNotExist:
                    return json.dumps({"success": False, "error": "Table not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # ============ CHAT SESSION MANAGEMENT TOOLS ============

            # âœ… Tool 12: Create a new chat session
            @mcp.tool()
            async def create_chat_session(user_id: int, title: str = "New Chat") -> str:
                """
                Create a new chat session for a user.

                Parameters:
                - user_id: User ID who owns the session
                - title: Title for the chat session

                Returns:
                - JSON string with session data
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def create_session():
                        session_id = f"chat_{user_id}_{int(time.time())}"
                        session = ChatSession.objects.create(
                            user=user,
                            session_id=session_id,
                            title=title
                        )
                        return ChatSessionSerializer(session).data

                    session_data = await create_session()

                    return json.dumps({
                        "success": True,
                        "message": "Chat session created successfully",
                        "data": session_data
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 13: Get all chat sessions for a user
            @mcp.tool()
            async def get_chat_sessions(user_id: int) -> str:
                """
                Get all active chat sessions for a user.

                Parameters:
                - user_id: User ID to fetch sessions for

                Returns:
                - JSON string with sessions data
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def get_sessions():
                        sessions = ChatSession.objects.filter(user=user, is_active=True)
                        return ChatSessionSerializer(sessions, many=True).data

                    sessions_data = await get_sessions()

                    return json.dumps({
                        "success": True,
                        "message": f"Found {len(sessions_data)} chat sessions",
                        "data": sessions_data
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 14: Get chat session details
            @mcp.tool()
            async def get_chat_session(user_id: int, session_id: str) -> str:
                """
                Get specific chat session details.

                Parameters:
                - user_id: User ID who owns the session
                - session_id: Session ID to retrieve

                Returns:
                - JSON string with session data
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def get_session():
                        session = ChatSession.objects.get(session_id=session_id, user=user)
                        return ChatSessionSerializer(session).data

                    session_data = await get_session()

                    return json.dumps({
                        "success": True,
                        "message": "Chat session retrieved successfully",
                        "data": session_data
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except ChatSession.DoesNotExist:
                    return json.dumps({"success": False, "error": "Chat session not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 15: Update chat session
            @mcp.tool()
            async def update_chat_session(user_id: int, session_id: str, title: Optional[str] = None, is_active: Optional[bool] = None) -> str:
                """
                Update chat session details.

                Parameters:
                - user_id: User ID who owns the session
                - session_id: Session ID to update
                - title: New title for the session (optional)
                - is_active: Active status (optional)

                Returns:
                - JSON string with updated session data
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def update_session():
                        session = ChatSession.objects.get(session_id=session_id, user=user)
                        updated = False

                        if title is not None:
                            session.title = title
                            updated = True
                        if is_active is not None:
                            session.is_active = is_active
                            updated = True

                        if updated:
                            session.save()
                            return ChatSessionSerializer(session).data, True
                        return None, False

                    session_data, was_updated = await update_session()

                    if was_updated:
                        return json.dumps({
                            "success": True,
                            "message": "Chat session updated successfully",
                            "data": session_data
                        })
                    else:
                        return json.dumps({"success": False, "error": "No fields to update"})

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except ChatSession.DoesNotExist:
                    return json.dumps({"success": False, "error": "Chat session not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 16: Delete chat session
            @mcp.tool()
            async def delete_chat_session(user_id: int, session_id: str) -> str:
                """
                Delete (soft delete) a chat session.

                Parameters:
                - user_id: User ID who owns the session
                - session_id: Session ID to delete

                Returns:
                - JSON string with success status
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def delete_session():
                        session = ChatSession.objects.get(session_id=session_id, user=user)
                        session.is_active = False
                        session.save()
                        return session.title

                    session_title = await delete_session()

                    return json.dumps({
                        "success": True,
                        "message": f"Chat session '{session_title}' deleted successfully"
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except ChatSession.DoesNotExist:
                    return json.dumps({"success": False, "error": "Chat session not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # ============ CHAT MESSAGE MANAGEMENT TOOLS ============

            # âœ… Tool 17: Save chat message
            @mcp.tool()
            async def save_chat_message(user_id: int, session_id: str, message_id: str, text: str, sender: str, 
                                       is_typing: bool = False, displayed_text: Optional[str] = None, 
                                       agent_data: Optional[str] = None) -> str:
                """
                Save a chat message to a session.

                Parameters:
                - user_id: User ID who owns the message
                - session_id: Session ID to save message to
                - message_id: Unique message ID
                - text: Message text content
                - sender: Message sender ('user' or 'bot')
                - is_typing: Whether this is a typing indicator (optional)
                - displayed_text: Text to display (optional, defaults to text)
                - agent_data: Additional agent data as JSON string (optional)

                Returns:
                - JSON string with message data
                """
                try:
                    if sender not in ['user', 'bot']:
                        return json.dumps({"success": False, "error": "Sender must be 'user' or 'bot'"})

                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def save_message():
                        session = ChatSession.objects.get(session_id=session_id, user=user)

                        # Parse agent_data if provided
                        parsed_agent_data = None
                        if agent_data:
                            try:
                                parsed_agent_data = json.loads(agent_data)
                            except json.JSONDecodeError:
                                parsed_agent_data = {"raw": agent_data}

                        message = ChatMessage.objects.create(
                            chat_session=session,
                            user=user,
                            message_id=message_id,
                            text=text,
                            sender=sender,
                            is_typing=is_typing,
                            displayed_text=displayed_text or text,
                            agent_data=parsed_agent_data
                        )

                        # Update session timestamp
                        session.save()

                        return ChatMessageSerializer(message).data

                    message_data = await save_message()

                    return json.dumps({
                        "success": True,
                        "message": "Chat message saved successfully",
                        "data": message_data
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except ChatSession.DoesNotExist:
                    return json.dumps({"success": False, "error": "Chat session not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 18: Get chat messages
            @mcp.tool()
            async def get_chat_messages(user_id: int, session_id: str, limit: Optional[int] = 100) -> str:
                """
                Get chat messages from a session.

                Parameters:
                - user_id: User ID who owns the session
                - session_id: Session ID to get messages from
                - limit: Maximum number of messages to return (optional, default 100)

                Returns:
                - JSON string with messages data
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def get_messages():
                        session = ChatSession.objects.get(session_id=session_id, user=user)
                        messages = ChatMessage.objects.filter(chat_session=session).order_by('timestamp')

                        if limit:
                            messages = messages[:limit]

                        return {
                            "session_info": {
                                "session_id": session.session_id,
                                "title": session.title
                            },
                            "messages": ChatMessageSerializer(messages, many=True).data
                        }

                    result = await get_messages()

                    return json.dumps({
                        "success": True,
                        "message": f"Retrieved {len(result['messages'])} messages",
                        "data": result
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except ChatSession.DoesNotExist:
                    return json.dumps({"success": False, "error": "Chat session not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 19: Clear chat messages
            @mcp.tool()
            async def clear_chat_messages(user_id: int, session_id: str) -> str:
                """
                Clear all messages from a chat session.

                Parameters:
                - user_id: User ID who owns the session
                - session_id: Session ID to clear messages from

                Returns:
                - JSON string with success status
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def clear_messages():
                        session = ChatSession.objects.get(session_id=session_id, user=user)
                        deleted_count = ChatMessage.objects.filter(chat_session=session).delete()[0]
                        return deleted_count

                    deleted_count = await clear_messages()

                    return json.dumps({
                        "success": True,
                        "message": f"Cleared {deleted_count} messages from chat session"
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except ChatSession.DoesNotExist:
                    return json.dumps({"success": False, "error": "Chat session not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 20: Search tables by name or description
            @mcp.tool()
            async def search_tables(user_id: int, query: str) -> str:
                """
                Search user's tables by name or description.

                Parameters:
                - user_id: User ID to search tables for
                - query: Search query string

                Returns:
                - JSON string with matching tables
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def search():
                        from django.db.models import Q
                        tables = DynamicTableData.objects.filter(
                            user=user
                        ).filter(
                            Q(table_name__icontains=query) | Q(description__icontains=query)
                        )
                        return DynamicTableSerializer(tables, many=True).data

                    results = await search()

                    return json.dumps({
                        "success": True,
                        "message": f"Found {len(results)} matching tables",
                        "data": results
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… Tool 21: Get table statistics
            @mcp.tool()
            async def get_table_statistics(user_id: int, table_id: Optional[int] = None) -> str:
                """
                Get statistics for user's tables.

                Parameters:
                - user_id: User ID to get statistics for
                - table_id: Optional specific table ID (if None, returns all tables stats)

                Returns:
                - JSON string with statistics
                """
                try:
                    user = await sync_to_async(User.objects.get)(id=user_id)

                    @sync_to_async
                    def get_stats():
                        if table_id:
                            tables = DynamicTableData.objects.filter(id=table_id, user=user)
                        else:
                            tables = DynamicTableData.objects.filter(user=user)

                        stats = []
                        for table in tables:
                            try:
                                json_table = JsonTable.objects.get(table=table)
                                row_count = json_table.rows.count()
                                column_count = len(json_table.headers)
                            except JsonTable.DoesNotExist:
                                row_count = 0
                                column_count = 0

                            stats.append({
                                "table_id": table.id,
                                "table_name": table.table_name,
                                "description": table.description,
                                "row_count": row_count,
                                "column_count": column_count,
                                "pending_count": table.pending_count,
                                "created_at": table.created_at.isoformat(),
                                "modified_at": table.modified_at.isoformat()
                            })

                        return stats

                    stats = await get_stats()

                    return json.dumps({
                        "success": True,
                        "message": f"Statistics for {len(stats)} tables",
                        "data": stats
                    })

                except User.DoesNotExist:
                    return json.dumps({"success": False, "error": "User not found"})
                except Exception as e:
                    return json.dumps({"success": False, "error": str(e)})

            # âœ… MCP entry point
            if __name__ == "__main__":
                mcp.run(transport='stdio')
                print("Finance Management Server is running")
          --------------------------------------------------------------------------------------------------------------

          ðŸ“„ test_server.py (0.03 MB)
          --------------------------------------------------------------------------------------------------------------
          CONTENT:
          --------------------------------------------------------------------------------------------------------------
            from django.shortcuts import get_object_or_404
            from django.contrib.auth.models import User
            from django.http import JsonResponse
            from django.utils import timezone

            from ..user_auth.authentication import decode_refresh_token
            from .models import DynamicTableData, JsonTable, JsonTableRow
            from .serializers import DynamicTableSerializer


            def get_dynamic_tables(refresh_token):
                """
                Retrieve all dynamic tables for an authenticated user.

                This function fetches all tables that belong to a specific user by first validating
                their authentication through a refresh token. It returns a list of tables with their
                metadata including table names, descriptions, and other properties.

                Args:
                    refresh_token (str): JWT refresh token from cookies used to authenticate the user

                Returns:
                    JsonResponse: Success response with list of tables or error response
                        - On success: {"message": "...", "data": [...]} with status 200
                        - On auth failure: {"message": "..."} with status 401
                        - On error: {"message": "...", "error": "..."} with status 500

                Business Logic:
                    - Validates refresh token and extracts user ID
                    - Checks if user is authenticated
                    - Queries DynamicTableData model filtered by user
                    - Serializes table data using DynamicTableSerializer
                    - Returns empty array if no tables found for user
                """
                try:
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    tables = DynamicTableData.objects.filter(user=user)
                    if not tables.exists():
                        return JsonResponse({
                            "message": "No dynamic tables found for the current user.",
                            "data": []
                        }, status=200)

                    serializer = DynamicTableSerializer(tables, many=True)
                    return JsonResponse({
                        "message": "Dynamic tables fetched successfully.",
                        "data": serializer.data
                    }, status=200)

                except Exception as e:
                    return JsonResponse({
                        "message": "An unexpected error occurred while fetching data.",
                        "error": str(e)
                    }, status=500)


            def update_dynamic_table(refresh_token, table_id, table_name=None, description=None, pending_count=None):
                """
                Update specific fields of a dynamic table owned by an authenticated user.

                This function allows partial updates to table metadata. It validates user ownership
                of the table before allowing modifications. Only provided fields will be updated,
                making this a PATCH-like operation for table properties.

                Args:
                    refresh_token (str): JWT refresh token for user authentication
                    table_id (int): Primary key ID of the table to update
                    table_name (str, optional): New name for the table
                    description (str, optional): New description for the table
                    pending_count (int, optional): New pending count value for the table

                Returns:
                    JsonResponse: Updated table data or error response
                        - On success: {"message": "...", "data": {...}} with status 200
                        - On auth failure: {"message": "..."} with status 401
                        - On table not found: {"message": "..."} with status 404
                        - On no updates: {"message": "..."} with status 400

                Business Logic:
                    - Authenticates user via refresh token
                    - Verifies table ownership (table must belong to authenticated user)
                    - Updates only the fields that are provided (not None)
                    - Saves changes to database if at least one field was updated
                    - Returns serialized updated table data
                """
                try:
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    updated = False

                    try:
                        table = DynamicTableData.objects.get(id=table_id, user=user)
                    except DynamicTableData.DoesNotExist:
                        return JsonResponse({
                            "message": "Table not found for the current user."
                        }, status=404)

                    if table_name is not None:
                        table.table_name = table_name
                        updated = True
                    if description is not None:
                        table.description = description
                        updated = True
                    if pending_count is not None:
                        table.pendingCount = pending_count
                        updated = True

                    if updated:
                        table.save()
                        serializer = DynamicTableSerializer(table)
                        return JsonResponse({
                            "message": "Table updated successfully.",
                            "data": serializer.data
                        }, status=200)
                    else:
                        return JsonResponse({
                            "message": "No valid fields provided to update."
                        }, status=400)

                except Exception as e:
                    return JsonResponse({
                        "message": "An unexpected error occurred while updating the table.",
                        "error": str(e)
                    }, status=500)


            def get_table_content():
                """
                Retrieve the complete content of all tables including headers and row data.

                This function fetches all JsonTable records along with their associated headers
                and row data. It's used to get the actual table content (not just metadata)
                for display or processing purposes. No authentication required as it returns
                all tables in the system.

                Args:
                    None

                Returns:
                    JsonResponse: Array of table content objects or error response
                        - On success: Array of objects with structure:
                          [{"id": table_id, "data": {"headers": [...], "rows": [...]}}]
                        - On error: {"error": "...", "details": "..."} with status 500

                Business Logic:
                    - Queries all JsonTable objects (no user filtering)
                    - For each table, extracts the DynamicTableData ID
                    - Includes headers array from JsonTable.headers field
                    - Includes all row data by iterating through related JsonTableRow objects
                    - Returns structured data ready for frontend table rendering

                Data Structure:
                    Each returned table object contains:
                    - id: References the DynamicTableData primary key
                    - data.headers: Array of column header strings
                    - data.rows: Array of row objects containing actual data
                """
                try:
                    tables = JsonTable.objects.all()
                    result = []

                    for table in tables:
                        table_dict = {
                            "id": table.table.id,  # Refers to DynamicTableData's ID
                            "data": {
                                "headers": table.headers,  # JSONField is already a list
                                "rows": [
                                    row.data for row in table.rows.all()  # Access rows via related_name
                                ]
                            }
                        }
                        result.append(table_dict)

                    return JsonResponse(result, safe=False, status=200)

                except Exception as e:
                    return JsonResponse(
                        {"error": "Failed to fetch table data", "details": str(e)},
                        status=500
                    )


            def add_row_to_table(table_id, new_row):
                """
                Add a new data row to an existing table.

                This function creates a new JsonTableRow record with the provided data.
                It validates that the row data structure matches the table's header schema
                before insertion. No authentication required - assumes table_id is valid.

                Args:
                    table_id (int): Primary key ID of the target JsonTable
                    new_row (dict): Dictionary containing the row data where keys should match table headers

                Returns:
                    JsonResponse: Success confirmation with added row data or error response
                        - On success: {"message": "...", "data": {...}} with status 201
                        - On validation error: {"error": "...", "expected_headers": [...]} with status 400
                        - On table not found: 404 response from get_object_or_404
                        - On error: {"error": "...", "details": "..."} with status 500

                Business Logic:
                    - Validates input parameters (table_id exists, new_row is dict)
                    - Fetches JsonTable using get_object_or_404 (raises 404 if not found)
                    - Validates row structure: all keys in new_row must exist in table headers
                    - Creates new JsonTableRow with the provided data
                    - Returns confirmation with the added row data

                Validation Rules:
                    - new_row must be a dictionary
                    - All keys in new_row must match existing table headers
                    - Extra validation can be added for data types or required fields
                """
                try:
                    if not table_id or not isinstance(new_row, dict):
                        return JsonResponse({
                            "error": "Invalid input. 'table_id' must be provided and 'new_row' must be a dictionary."
                        }, status=400)

                    # Get the JsonTable instance (raises 404 if not found)
                    json_table = get_object_or_404(JsonTable, table_id=table_id)

                    # Optional: Validate if row keys match table headers
                    if not all(key in json_table.headers for key in new_row.keys()):
                        return JsonResponse({
                            "error": "Row keys do not match table headers.",
                            "expected_headers": json_table.headers
                        }, status=400)

                    # Save the new row
                    JsonTableRow.objects.create(table=json_table, data=new_row)

                    return JsonResponse({"message": "Row added successfully.", "data": new_row}, status=201)

                except Exception as e:
                    return JsonResponse({
                        "error": "Failed to add row.",
                        "details": str(e)
                    }, status=500)


            def create_table_with_headers(refresh_token, table_name, description, headers):
                """
                Create a new dynamic table with specified headers for an authenticated user.

                This function performs a two-step creation process: first creating the table metadata
                in DynamicTableData, then creating the table structure with headers in JsonTable.
                This establishes the foundation for a new data table that can hold rows.

                Args:
                    refresh_token (str): JWT refresh token for user authentication
                    table_name (str): Display name for the new table
                    description (str): Descriptive text explaining the table's purpose
                    headers (list): Array of strings representing column names

                Returns:
                    JsonResponse: Created table information or error response
                        - On success: {"message": "...", "table_id": int, "table_name": str, "headers": [...]} with status 201
                        - On auth failure: {"message": "..."} with status 401
                        - On validation error: {"message": "..."} with status 400
                        - On error: {"message": "...", "error": "..."} with status 500

                Business Logic:
                    - Authenticates user via refresh token
                    - Validates required parameters (table_name, description not empty)
                    - Validates headers format (must be list of strings)
                    - Creates DynamicTableData record with user association
                    - Creates JsonTable record linked to the DynamicTableData
                    - Returns table ID and confirmation for immediate use

                Database Operations:
                    1. INSERT into DynamicTableData (metadata)
                    2. INSERT into JsonTable (structure with headers)

                The created table will be empty (no rows) but ready to accept data via add_row_to_table.
                """
                try:
                    # Extract token and user
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    # Validate required fields
                    if not table_name or not description:
                        return JsonResponse({
                            "message": "Both 'table_name' and 'description' are required."
                        }, status=400)

                    if not isinstance(headers, list) or not all(isinstance(h, str) for h in headers):
                        return JsonResponse({
                            "message": "'headers' must be a list of strings."
                        }, status=400)

                    # Step 1: Create table
                    dynamic_table = DynamicTableData.objects.create(
                        table_name=table_name,
                        description=description,
                        user=user,
                        pending_count=0
                    )

                    # Step 2: Add headers
                    JsonTable.objects.create(table=dynamic_table, headers=headers)

                    return JsonResponse({
                        "message": "Table and headers created successfully.",
                        "table_id": dynamic_table.id,
                        "table_name": dynamic_table.table_name,
                        "headers": headers
                    }, status=201)

                except Exception as e:
                    return JsonResponse({
                        "message": "Failed to create table with headers.",
                        "error": str(e)
                    }, status=500)


            def add_column_to_table(refresh_token, table_id, header):
                """
                Add a new column (header) to an existing table and update all existing rows.

                This function modifies table structure by adding a new column header and ensures
                data consistency by adding the new column to all existing rows with empty values.
                Requires user authentication and prevents duplicate header names.

                Args:
                    refresh_token (str): JWT refresh token for user authentication
                    table_id (int): Primary key ID of the target JsonTable
                    header (str): Name of the new column header to add

                Returns:
                    JsonResponse: Success confirmation with updated headers or error response
                        - On success: {"message": "...", "headers": [...]} with status 200
                        - On auth failure: {"message": "..."} with status 401
                        - On validation error: {"error": "..."} with status 400
                        - On duplicate header: {"error": "Header 'X' already exists..."} with status 400
                        - On error: {"error": "...", "details": "..."} with status 500

                Business Logic:
                    - Authenticates user via refresh token
                    - Validates input parameters (table_id and header string)
                    - Fetches JsonTable using get_object_or_404
                    - Checks for duplicate header names in existing headers list
                    - Appends new header to the headers JSONField array
                    - Iterates through all existing rows and adds new column with empty string value
                    - Saves all changes to database

                Data Consistency:
                    - All existing rows are updated to include the new column
                    - New column values are initialized as empty strings
                    - Table structure remains consistent across all rows

                Note: This operation can be expensive for tables with many rows as it updates every row.
                """
                try:
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    if not table_id or not isinstance(header, str):
                        return JsonResponse({
                            "error": "'table_id' and a string 'header' are required."
                        }, status=400)

                    # Fetch JsonTable
                    json_table = get_object_or_404(JsonTable, pk=table_id)

                    # Prevent duplicate header
                    if header in json_table.headers:
                        return JsonResponse({
                            "error": f"Header '{header}' already exists in table."
                        }, status=400)

                    # Add new header to the header list
                    json_table.headers.append(header)
                    json_table.save()

                    # Update all rows by adding new column with empty string
                    for row in json_table.rows.all():
                        row.data[header] = ""
                        row.save()

                    return JsonResponse({
                        "message": f"Header '{header}' added successfully.",
                        "headers": json_table.headers
                    }, status=200)

                except Exception as e:
                    return JsonResponse({
                        "error": "Failed to add new column.",
                        "details": str(e)
                    }, status=500)


            def delete_column_from_table(refresh_token, table_id, new_headers):
                """
                Remove columns from a table by providing the desired final header list.

                This function performs column deletion by comparing current headers with the provided
                new headers list. It removes columns that are not in the new list and cleans up
                all row data to maintain consistency. Requires user authentication.

                Args:
                    refresh_token (str): JWT refresh token for user authentication
                    table_id (int): Primary key ID of the target JsonTable
                    new_headers (list): Array of strings representing the desired final headers

                Returns:
                    JsonResponse: Success confirmation with deletion details or error response
                        - On success: {"message": "Deleted columns: [...]", "headers": [...]} with status 200
                        - On no change: {"message": "No headers were deleted.", "headers": [...]} with status 200
                        - On auth failure: {"message": "..."} with status 401
                        - On validation error: {"error": "..."} with status 400
                        - On error: {"error": "...", "details": "..."} with status 500

                Business Logic:
                    - Authenticates user via refresh token
                    - Validates input (table_id exists, new_headers is list of strings)
                    - Fetches JsonTable and compares current headers with new_headers
                    - Calculates which headers to delete (set difference operation)
                    - Updates JsonTable.headers to the new list
                    - Removes deleted header keys from all existing row data
                    - Returns list of deleted columns and final header state

                Data Cleanup:
                    - Removes specified column keys from all JsonTableRow.data dictionaries
                    - Uses dict.pop() with None default to safely remove keys
                    - Maintains data integrity by ensuring no orphaned column data remains

                Safety Features:
                    - Returns success even if no columns were actually deleted
                    - Handles missing keys gracefully during row data cleanup
                    - Validates new_headers format before processing
                """
                try:
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    if not table_id or not isinstance(new_headers, list) or not all(isinstance(h, str) for h in new_headers):
                        return JsonResponse({
                            "error": "'table_id' and 'new_headers' (list of strings) are required."
                        }, status=400)

                    # Fetch JsonTable
                    json_table = get_object_or_404(JsonTable, pk=table_id)

                    old_headers = json_table.headers
                    deleted_headers = set(old_headers) - set(new_headers)

                    if not deleted_headers:
                        return JsonResponse({
                            "message": "No headers were deleted.",
                            "headers": old_headers
                        }, status=200)

                    # Update headers in JsonTable
                    json_table.headers = new_headers
                    json_table.save()

                    # Remove deleted header keys from all rows
                    for row in json_table.rows.all():
                        for col in deleted_headers:
                            row.data.pop(col, None)  # Remove the key if it exists
                        row.save()

                    return JsonResponse({
                        "message": f"Deleted columns: {list(deleted_headers)}",
                        "headers": new_headers
                    }, status=200)

                except Exception as e:
                    return JsonResponse({
                        "error": "Failed to delete column(s).",
                        "details": str(e)
                    }, status=500)


            def delete_row_from_table(refresh_token, table_id, row_id):
                """
                Delete a specific row from a table based on the row's internal ID.

                This function removes a row from a JsonTable by matching the row_id against
                the 'id' field stored within each row's JSON data. It requires user authentication
                and validates table existence before attempting row deletion.

                Args:
                    refresh_token (str): JWT refresh token for user authentication
                    table_id (int): Primary key ID of the target JsonTable
                    row_id (str/int): The ID value stored in the row's data['id'] field

                Returns:
                    JsonResponse: Success confirmation or error response
                        - On success: {"message": "Row with ID X successfully deleted..."} with status 200
                        - On auth failure: {"message": "..."} with status 401
                        - On validation error: {"error": "..."} with status 400
                        - On table not found: {"error": "Table with ID X does not exist."} with status 404
                        - On row not found: {"error": "No row with id 'X' found..."} with status 404
                        - On error: {"error": "...", "details": "..."} with status 500

                Business Logic:
                    - Authenticates user via refresh token
                    - Validates required parameters (table_id and row_id)
                    - Fetches JsonTable with custom error handling
                    - Iterates through all rows to find matching data['id']
                    - Performs string comparison to handle different ID types
                    - Deletes the matching JsonTableRow record

                Row Matching Strategy:
                    - Searches through JsonTableRow.data['id'] fields
                    - Uses string conversion for flexible ID matching
                    - Returns 404 if no matching row found
                    - Only deletes the first matching row (assumes unique IDs)

                Note: This function looks for the ID within the row's JSON data, not the
                Django model's primary key. The row data structure should include an 'id' field.
                """
                try:
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    if not table_id or not row_id:
                        return JsonResponse({
                            "error": "'table_id' and 'row_id' are required."
                        }, status=400)

                    # Custom error handling for JsonTable
                    try:
                        json_table = JsonTable.objects.get(pk=table_id)
                    except JsonTable.DoesNotExist:
                        return JsonResponse({
                            "error": f"Table with ID {table_id} does not exist."
                        }, status=404)

                    # Find the row by data['id']
                    target_row = None
                    for row in json_table.rows.all():
                        if str(row.data.get("id")) == str(row_id):
                            target_row = row
                            break

                    if not target_row:
                        return JsonResponse({
                            "error": f"No row with id '{row_id}' found in table {table_id}."
                        }, status=404)

                    target_row.delete()

                    return JsonResponse({
                        "message": f"Row with ID {row_id} successfully deleted from table {table_id}."
                    }, status=200)

                except Exception as e:
                    return JsonResponse({
                        "error": "Failed to delete the row.",
                        "details": str(e)
                    }, status=500)


            def update_table_row(refresh_token, table_id, row_id, new_row_data):
                """
                Update specific fields in an existing table row with new data.

                This function performs a partial update (PATCH-like) on a table row by merging
                new data with existing row data. It preserves existing fields not included in
                the update and maintains the row's ID field. Requires user authentication.

                Args:
                    refresh_token (str): JWT refresh token for user authentication
                    table_id (int): Primary key ID of the target JsonTable
                    row_id (str/int): The ID value stored in the target row's data['id'] field
                    new_row_data (dict): Dictionary containing fields to update with new values

                Returns:
                    JsonResponse: Success confirmation with updated row or error response
                        - On success: {"status": "success", "updated_row": {...}} with status 200
                        - On auth failure: {"message": "..."} with status 401
                        - On validation error: {"error": "Missing table_id or row_id"} with status 400
                        - On row not found: {"error": "Row not found"} with status 404
                        - On error: {"error": "..."} with status 400

                Business Logic:
                    - Authenticates user via refresh token
                    - Validates required parameters (table_id, row_id)
                    - Uses Django ORM lookup with data__id to find row efficiently
                    - Merges new_row_data with existing row data (new values override)
                    - Preserves the original 'id' field to maintain row identity
                    - Saves updated row data back to database

                Update Strategy:
                    - Partial update: only provided fields are modified
                    - Field preservation: existing fields not in new_row_data remain unchanged
                    - ID preservation: row ID is always maintained for consistency
                    - Merge operation: uses dictionary unpacking for clean data combination

                Data Integrity:
                    - Validates row exists before updating
                    - Maintains row structure and relationships
                    - Preserves foreign key relationships through table_id

                Performance Note: Uses data__id lookup which leverages PostgreSQL JSON indexing
                for efficient row finding without iteration.
                """
                try:
                    if not refresh_token:
                        return JsonResponse({'message': "Refresh token not provided."}, status=401)

                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    if not table_id or not row_id:
                        return JsonResponse(
                            {'error': 'Missing table_id or row_id'},
                            status=400
                        )

                    # Find the row where data contains the matching id
                    try:
                        row = JsonTableRow.objects.get(
                            table_id=table_id,
                            data__id=row_id  # Look for id in the JSON data
                        )
                    except JsonTableRow.DoesNotExist:
                        return JsonResponse(
                            {'error': 'Row not found'},
                            status=404
                        )

                    # Update the specific fields in the JSON data
                    current_data = row.data or {}
                    for key, value in new_row_data.items():
                        current_data[key] = value

                    # Preserve the id field
                    if 'id' in current_data:
                        new_row_data['id'] = current_data['id']

                    row.data = {**current_data, **new_row_data}
                    row.save()

                    return JsonResponse({
                        'status': 'success',
                        'updated_row': row.data
                    })

                except Exception as e:
                    return JsonResponse(
                        {'error': str(e)},
                        status=400
                    )


            def get_authenticated_user(refresh_token):
                """
                Helper function to authenticate and retrieve user from JWT refresh token.

                This utility function centralizes the authentication logic used across multiple
                table operations. It decodes the refresh token, fetches the user, and validates
                their authentication status. Returns both user object and potential error response.

                Args:
                    refresh_token (str): JWT refresh token from client cookies

                Returns:
                    tuple: (User object or None, JsonResponse error or None)
                        - On success: (User instance, None)
                        - On missing token: (None, JsonResponse with 401)
                        - On invalid token: (None, JsonResponse with 401)
                        - On authentication failure: (None, JsonResponse with 401)

                Business Logic:
                    - Validates refresh_token is provided
                    - Decodes token to extract user_id using decode_refresh_token()
                    - Fetches User model instance from database
                    - Checks user.is_authenticated status
                    - Returns user for successful authentication
                    - Returns appropriate error response for any failure

                Error Handling:
                    - Missing token: "Refresh token not provided"
                    - Invalid token: "Invalid refresh token" (from decode exception)
                    - User not authenticated: "Authentication credentials were not provided or are invalid"

                Usage Pattern:
                    user, error = get_authenticated_user(refresh_token)
                    if error:
                        return error
                    # Proceed with authenticated user operations

                This helper reduces code duplication and ensures consistent authentication
                handling across all protected table operations.
                """
                if not refresh_token:
                    return None, JsonResponse({'message': "Refresh token not provided."}, status=401)

                try:
                    user_id = decode_refresh_token(refresh_token)
                    user = User.objects.get(id=user_id)

                    if not user.is_authenticated:
                        return None, JsonResponse({
                            "message": "Authentication credentials were not provided or are invalid."
                        }, status=401)

                    return user, None
                except Exception as e:
                    return None, JsonResponse({
                        "message": "Invalid refresh token.",
                        "error": str(e)
                    }, status=401)
          --------------------------------------------------------------------------------------------------------------


========================================================================================================================
SUMMARY REPORT
------------------------------------------------------------------------------------------------------------------------
Total Directories: 32
Total Files: 128
Files with Content Displayed: 112
Binary/Large Files Skipped: 16
Total Size: 24.00 MB (24578.65 KB)

Note: Binary files and files larger than 5MB are listed but content is skipped.
Directories excluded: .env, node_modules, __pycache__, venv, build, .next, .git, dist

========================================================================================================================
Report generated by FinBot Complete Content Analyzer
========================================================================================================================
